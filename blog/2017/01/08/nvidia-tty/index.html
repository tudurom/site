<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="the blog of Tudor Roman">
	<meta name="author" content="Tudor Roman">
	<meta name="keywords" content="tudor roman, tudor's blog, blog, linux, unix">
	<meta name="theme-color" content="#333">

	<meta property="og:title" content="High resolution TTY with the nvidia proprietary driver">
	<meta property="og:type" content="article">
	<meta property="og:description" content="the blog of Tudor Roman">
	<meta property="og:author" content="Tudor Roman">
	<meta property="og:site_name" content="tudor's blog">

	<!-- jekyll-feed gem required -->
	<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="tudor's blog" />

	<link rel="stylesheet" href="/blog/css/main.css">
	<link rel="icon" href="/blog/favicon.png">
	<title>High resolution TTY with the nvidia proprietary driver - tudor's blog</title>
</head>
<body>
	<main>
		<header class="site-header">
			<h1 class="site-title"><a href="/blog/">tudor's blog</a></h1>
			<nav class="site-nav">
				
					
				
					
					
						<a href="/blog/about/" class="">About</a>
					
	            	
				
					
					
	            	
				
					
					
	            	
				
					
					
	            	
				
					
					
	            	
				
			</nav>
		</header>
		<article class="post">
    <h2 class="post-header">High resolution TTY with the nvidia proprietary driver</h2>
    <p class="post-subtitle"></p>
    <p class="post-meta">2017-01-08 00:00:00+02:00</p>
    <p>My laptop is a ThinkPad T430 with discrete NVIDIA graphics. It can switch between integrated
graphics (Intel) and discrete.</p>

<p>You may know that graphics switching is <em>hard</em> on laptops with NVIDIA discrete
graphics. I wish I could use integrated graphics by default and just use NVIDIA
for video acceleration, but I can’t. <a href="http://bumblebee-project.org/">Bumblebee</a>
doesn’t work. Also, I’m using my laptop mainly with mouse, keyboard and monitor
plugged in, making it a full-fledged PC. The external monitor is full-HD, it
looks horrible connected through VGA, forcing me to use the DisplayPort
connection. The problem is that the DisplayPort is hardwired to the NVIDIA card
(according to <code class="highlighter-rouge">xrandr</code> I have <a href="http://pub.iotek.org/p/z7r3RmK.png">6 DP connections??</a>). Because the monitor is connected to the discrete card, it doesn’t output anything, only the GRUB prompt (how does that even work?). Luckily, I can switch between the two graphics modes from the UEFI/BIOS menu.</p>

<p>The problem is that I get low resolution in the TTY. I solved this problem with
a GRUB trick and pure luck.</p>

<p><a href="https://wiki.archlinux.org/index.php/GRUB/">GRUB</a> can be configured to use a
specific video mode and then transfer the graphics payload to the Linux kernel.
That means that the TTY will use the same video mode and the same resolution.
GRUB can also automatically select the best video mode available. The problem is
that the NVIDIA card doesn’t report all video modes available, making GRUB, and
implicitly the kernel, use a low resolution video mode.</p>

<p>The hack I discovered is that I can supply the resolution of the laptop display
as my preferable video mode and it will just work. I got native resolution in
the TTY (yay).</p>

<p>Here is how it works:</p>

<p>The video mode is set in the <code class="highlighter-rouge">GRUB_GFXMODE</code> variable from the
<code class="highlighter-rouge">/etc/default/grub</code> configuration file. To keep the video mode after Linux
boots, set
<code class="highlighter-rouge">GRUB_GFXPAYLOAD_LINUX</code> to <code class="highlighter-rouge">keep</code>.</p>

<p>To get native resolution, just set <code class="highlighter-rouge">GRUB_GFXMODE</code> to your native resolution and
append <code class="highlighter-rouge">x32</code> to it (that’s 32 bit color depth). My setting is
<code class="highlighter-rouge">GRUB_GFXMODE=1600x900x32</code>.</p>

<p>Run <code class="highlighter-rouge">grub-mkconfig</code> to generate the configuration file, reboot and you’re
done!</p>

<div class="highlighter-rouge"><pre class="highlight"><code># grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
</div>

    
</article>

		<footer>
			<hr />
			<nav class="footer-nav">
				<ul>
					
					<a href="/blog/" id="back_link">Back</a>
					
					<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width: 0; float: right;" src="/blog/assets/cc.png" /></a>
				</ul>
			</nav>
	    </footer>
	</main>
	
</body>
</html>
