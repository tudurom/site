<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="the blog of Tudor Roman">
	<meta name="author" content="Tudor Roman">
	<meta name="keywords" content="tudor roman, tudor's blog, blog, linux, unix">
	<meta name="theme-color" content="#333">

	<meta property="og:title" content="Dynamically reloading Neovim">
	<meta property="og:type" content="article">
	<meta property="og:description" content="the blog of Tudor Roman">
	<meta property="og:author" content="Tudor Roman">
	<meta property="og:site_name" content="tudor's blog">

	<!-- jekyll-feed gem required -->
	<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="tudor's blog" />

	<link rel="stylesheet" href="/blog/css/main.css">
	<link rel="icon" href="/blog/favicon.png">
	<title>Dynamically reloading Neovim - tudor's blog</title>
</head>
<body>
	<main>
		<header class="site-header">
			<h1 class="site-title"><a href="/blog/">tudor's blog</a></h1>
			<nav class="site-nav">
				
					
				
					
					
						<a href="/blog/about/" class="">About</a>
					
	            	
				
					
					
	            	
				
					
					
	            	
				
					
					
	            	
				
					
					
	            	
				
			</nav>
		</header>
		<article class="post">
    <h2 class="post-header">Dynamically reloading Neovim</h2>
    <p class="post-subtitle">I riced too much</p>
    <p class="post-meta">2017-03-03 20:38:34+02:00</p>
    <p>While writing my <a href="https://github.com/tudurom/dotfiles/tree/master/wm/">“shell based desktop environment”</a>, more specifically its dynamic themes feature, I realized that, unlike regular Vim, Neovim doesn’t have flags likes <code class="highlighter-rouge">--servername</code>, <code class="highlighter-rouge">--remote-send</code> and such, so there was no way I could send a message to all Neovim instances to reload themselves. This problem remained unsolved for a month or so.</p>

<p>Then, while I was a bit bored, I read <a href="https://neovim.io/news/">Neovim’s news page</a>. Scrolling down a bit, I found this:</p>

<blockquote>
  <p><a href="https://github.com/mhinz/neovim-remote">nvr</a> now supports the Vim “clientserver” options –servername, –remote, etc. nvr is perfect for communicating with a parent nvim instance from a :terminal buffer.</p>
</blockquote>

<p>Bingo, that’s exactly what I need!</p>

<p>To make all Neovim instances listen to some socket whose path I know, I made
a shell function:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>nvim<span class="o">()</span> <span class="o">{</span>
	<span class="c"># Set the name of neovim's socket</span>
	<span class="nb">local </span><span class="nv">fn</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>mktemp -u <span class="s2">"/tmp/nvimsocket-XXXXXXX"</span><span class="k">)</span><span class="s2">"</span>
	<span class="nv">NVIM_LISTEN_ADDRESS</span><span class="o">=</span><span class="nv">$fn</span> /usr/bin/nvim <span class="nv">$@</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Now, to reload all Neovim instances I can run:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="k">for </span>nvim_inst <span class="k">in</span> /tmp/nvimsocket-<span class="k">*</span>; <span class="k">do
	</span>nvr --servername <span class="s2">"</span><span class="nv">$nvim_inst</span><span class="s2">"</span> --remote-send <span class="s1">'&lt;Esc&gt;:so $HOME/.config/nvim/init.vim&lt;CR&gt;'</span> &amp;
<span class="k">done</span>
</code></pre>
</div>

    
</article>

		<footer>
			<hr />
			<nav class="footer-nav">
				<ul>
					
					<a href="/blog/" id="back_link">Back</a>
					
					<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width: 0; float: right;" src="/blog/assets/cc.png" /></a>
				</ul>
			</nav>
	    </footer>
	</main>
	
</body>
</html>
