<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>code cleanup - glenda - Program that plays the Flood Wars game for a contest.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="glenda.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>glenda</h1><span class="desc">Program that plays the Flood Wars game for a contest.
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/glenda.git">git://thetudor.ddns.net/glenda.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/e0ba01733d9e0cb8c91cbd5da81f661b90a89562.html">e0ba01733d9e0cb8c91cbd5da81f661b90a89562</a>
<b>parent</b> <a href="../commit/f04f5328b0c44dd5f04e14482d23d85417375c31.html">f04f5328b0c44dd5f04e14482d23d85417375c31</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Sat May 28 15:38:39 +0300

code cleanup

<b>Diffstat:</b>
<table><tr><td><a href="#h0">glenda.c</a></td><td> | </td><td class="num">80</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------------------</span></td></tr>
</table>1 file changed, 48 insertions(+), 32 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/glenda.c.html">glenda.c</a> b/<a href="../file/glenda.c.html">glenda.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -34,6 +34,7 @@ http://glenda.cat-v.org/
</a> #include &lt;stdlib.h&gt;
 #include &lt;time.h&gt;
 
<a href="#h0-0-3" id="h0-0-3" class="i">+/* Constants {{{ */
</a> /* DEBUG */
 #ifdef D
 #define debug(...) fprintf(stderr, __VA_ARGS__)
<a href="#h0-1" id="h0-1" class="h">@@ -53,12 +54,16 @@ http://glenda.cat-v.org/
</a> #define J 1
 /* borders are pre-initialized with -infinity (-1) for faster flooding, so all values are shifted by one */
 #define B(lin, col) board[lin + 1][col + 1]
<a href="#h0-1-3" id="h0-1-3" class="i">+/* }}} */
</a> 
 typedef char color;
<a href="#h0-1-6" id="h0-1-6" class="i">+typedef char player;
</a> 
 color board[1 + MAX_H + 1][1 + MAX_W + 1];
<a href="#h0-1-9" id="h0-1-9" class="i">+int board_lines, board_cols;
</a><a href="#h0-1-10" id="h0-1-10" class="i">+
</a> color colors[] = {&apos;@&apos;, &apos;#&apos;, &apos;+&apos;, &apos;.&apos;, &apos;*&apos;};
<a href="#h0-1-12" id="h0-1-12" class="d">-color player;
</a><a href="#h0-1-13" id="h0-1-13" class="i">+player current_player;
</a> 
 unsigned char bfs_lines[MAX_W * MAX_H * 4];
 unsigned char bfs_cols[MAX_W * MAX_H * 4];
<a href="#h0-2" id="h0-2" class="h">@@ -72,6 +77,19 @@ int bfs_begin, bfs_end;
</a> char dlin[N_DIR] = { 0, -1, +1,  0};
 char dcol[N_DIR] = {-1,  0,  0, +1};
 
<a href="#h0-2-3" id="h0-2-3" class="i">+/* Get player corners {{{ */
</a><a href="#h0-2-4" id="h0-2-4" class="i">+inline void get_corner(player current_player, int *lin, int *col) {
</a><a href="#h0-2-5" id="h0-2-5" class="i">+    if (current_player == S) {
</a><a href="#h0-2-6" id="h0-2-6" class="i">+        *lin = 0;
</a><a href="#h0-2-7" id="h0-2-7" class="i">+        *col = board_cols - 1;
</a><a href="#h0-2-8" id="h0-2-8" class="i">+    } else {
</a><a href="#h0-2-9" id="h0-2-9" class="i">+        *lin = board_lines - 1;
</a><a href="#h0-2-10" id="h0-2-10" class="i">+        *col = 0;
</a><a href="#h0-2-11" id="h0-2-11" class="i">+    }
</a><a href="#h0-2-12" id="h0-2-12" class="i">+}
</a><a href="#h0-2-13" id="h0-2-13" class="i">+/* }}} */
</a><a href="#h0-2-14" id="h0-2-14" class="i">+
</a><a href="#h0-2-15" id="h0-2-15" class="i">+/* Create board border (for faster filling) {{{ */
</a> void init_board(int lin, int col, color (*board)[MAX_W + 2]) {
     int i, j;
     for (i = 0; i &lt;= 1; i++)
<a href="#h0-3" id="h0-3" class="h">@@ -82,10 +100,11 @@ void init_board(int lin, int col, color (*board)[MAX_W + 2]) {
</a>         for (i = 0; i &lt; lin + 2; i++)
             board[i][j * (col + 2 - 1)] = -1;
 }
<a href="#h0-3-3" id="h0-3-3" class="i">+/* }}} */
</a> 
<a href="#h0-3-5" id="h0-3-5" class="d">-/* Flood fill old color with new one */
</a><a href="#h0-3-6" id="h0-3-6" class="i">+/* Flood fill old color with new one {{{ */
</a> #ifndef USE_BFS
<a href="#h0-3-8" id="h0-3-8" class="d">-int fill(int lin, int col, color old, color new) {
</a><a href="#h0-3-9" id="h0-3-9" class="i">+int fill(int lin, int col, color old, color new) { /* {{{ */
</a>     debug(&quot;[FIL] replacing at line %d col %d\n&quot;, lin, col);
     int cnt = 1;
     B(lin, col) = new;
<a href="#h0-4" id="h0-4" class="h">@@ -98,12 +117,11 @@ int fill(int lin, int col, color old, color new) {
</a>     if (B(lin, col + 1) == old)
         cnt += fill(lin, col + 1, old, new);
     return cnt;
<a href="#h0-4-3" id="h0-4-3" class="d">-}
</a><a href="#h0-4-4" id="h0-4-4" class="i">+} /* }}} */
</a> #endif
 
 #ifdef USE_BFS
<a href="#h0-4-8" id="h0-4-8" class="d">-/* Iterative flood fill (BFS). Replaces old color with new one at a given position and spreads */
</a><a href="#h0-4-9" id="h0-4-9" class="d">-int fill(int lin, int col, color old, color new) {
</a><a href="#h0-4-10" id="h0-4-10" class="i">+int fill(int lin, int col, color old, color new) { /* {{{ */
</a>     int cnt = 1;
     int l, c;
     int d;
<a href="#h0-5" id="h0-5" class="h">@@ -128,12 +146,12 @@ int fill(int lin, int col, color old, color new) {
</a>         }
     }
     return cnt;
<a href="#h0-5-3" id="h0-5-3" class="d">-}
</a><a href="#h0-5-4" id="h0-5-4" class="i">+} /* }}} */
</a> #endif
<a href="#h0-5-6" id="h0-5-6" class="i">+/* }}} */
</a> 
<a href="#h0-5-8" id="h0-5-8" class="d">-int main() {
</a><a href="#h0-5-9" id="h0-5-9" class="i">+int main() { /* {{{ */
</a>     int lin, col;
<a href="#h0-5-11" id="h0-5-11" class="d">-    int n, m;
</a>     color c;
     /* colors of the current player and opponent */
     color me, op;
<a href="#h0-6" id="h0-6" class="h">@@ -147,18 +165,19 @@ int main() {
</a>         freopen(&quot;glenda.out&quot;, &quot;w&quot;, stdout);
     }
 
<a href="#h0-6-3" id="h0-6-3" class="d">-    player = fgetc(stdin);
</a><a href="#h0-6-4" id="h0-6-4" class="i">+    current_player = fgetc(stdin);
</a>     fgetc(stdin);
<a href="#h0-6-6" id="h0-6-6" class="d">-    if (player == &apos;J&apos;)
</a><a href="#h0-6-7" id="h0-6-7" class="d">-        player = J;
</a><a href="#h0-6-8" id="h0-6-8" class="i">+    if (current_player == &apos;J&apos;)
</a><a href="#h0-6-9" id="h0-6-9" class="i">+        current_player = J;
</a>     else
<a href="#h0-6-11" id="h0-6-11" class="d">-        player = S;
</a><a href="#h0-6-12" id="h0-6-12" class="i">+        current_player = S;
</a> 
<a href="#h0-6-14" id="h0-6-14" class="i">+    /* Read board {{{ */
</a>     c = fgetc(stdin);
     lin = col = 0;
     while (c != EOF) {
         if (c == &apos;\n&apos;) {
<a href="#h0-6-19" id="h0-6-19" class="d">-            m = col;
</a><a href="#h0-6-20" id="h0-6-20" class="i">+            board_cols = col;
</a>             lin++;
             col = 0;
         } else {
<a href="#h0-7" id="h0-7" class="h">@@ -167,15 +186,16 @@ int main() {
</a>         }
         c = fgetc(stdin);
     }
<a href="#h0-7-3" id="h0-7-3" class="d">-    n = lin;
</a><a href="#h0-7-4" id="h0-7-4" class="d">-    if (player == J) {
</a><a href="#h0-7-5" id="h0-7-5" class="d">-        me = B(n - 1, 0);
</a><a href="#h0-7-6" id="h0-7-6" class="d">-        op = B(0, m - 1);
</a><a href="#h0-7-7" id="h0-7-7" class="i">+    board_lines = lin;
</a><a href="#h0-7-8" id="h0-7-8" class="i">+    if (current_player == J) {
</a><a href="#h0-7-9" id="h0-7-9" class="i">+        me = B(board_lines - 1, 0);
</a><a href="#h0-7-10" id="h0-7-10" class="i">+        op = B(0, board_cols - 1);
</a>     } else {
<a href="#h0-7-12" id="h0-7-12" class="d">-        me = B(0, m - 1);
</a><a href="#h0-7-13" id="h0-7-13" class="d">-        op = B(n - 1, 0);
</a><a href="#h0-7-14" id="h0-7-14" class="i">+        me = B(0, board_cols - 1);
</a><a href="#h0-7-15" id="h0-7-15" class="i">+        op = B(board_lines - 1, 0);
</a>     }
<a href="#h0-7-17" id="h0-7-17" class="d">-    init_board(n, m, board);
</a><a href="#h0-7-18" id="h0-7-18" class="i">+    init_board(board_lines, board_cols, board);
</a><a href="#h0-7-19" id="h0-7-19" class="i">+    /* }}} */
</a>     debug(&quot;i&apos;m %c and he is %c\n&quot;, me, op);
 
     /* Remove colors used by the player and the opponent */
<a href="#h0-8" id="h0-8" class="h">@@ -192,25 +212,19 @@ int main() {
</a>     debug(&quot;now i&apos;m %c\n&quot;, colors[pos]);
 
     /* do the move */
<a href="#h0-8-3" id="h0-8-3" class="d">-    if (player == S) {
</a><a href="#h0-8-4" id="h0-8-4" class="d">-        lin = 0;
</a><a href="#h0-8-5" id="h0-8-5" class="d">-        col = m - 1;
</a><a href="#h0-8-6" id="h0-8-6" class="d">-    } else {
</a><a href="#h0-8-7" id="h0-8-7" class="d">-        lin = n - 1;
</a><a href="#h0-8-8" id="h0-8-8" class="d">-        col = 0;
</a><a href="#h0-8-9" id="h0-8-9" class="d">-    }
</a><a href="#h0-8-10" id="h0-8-10" class="i">+    get_corner(current_player, &amp;lin, &amp;col);
</a>     debug(&quot;my corner is line %d col %d\n&quot;, lin, col);
     cnt = fill(lin, col, B(lin, col), colors[pos]);
     debug(&quot;replaced %d squares&quot;, cnt);
 
     /* print the board */
<a href="#h0-8-16" id="h0-8-16" class="d">-    if (player == J)
</a><a href="#h0-8-17" id="h0-8-17" class="i">+    if (current_player == J)
</a>         fputc(&apos;S&apos;, stdout);
     else
         fputc(&apos;J&apos;, stdout);
     fputc(&apos;\n&apos;, stdout);
<a href="#h0-8-22" id="h0-8-22" class="d">-    for (lin = 0; lin &lt; n; lin++) {
</a><a href="#h0-8-23" id="h0-8-23" class="d">-        for (col = 0; col &lt; m; col++)
</a><a href="#h0-8-24" id="h0-8-24" class="i">+    for (lin = 0; lin &lt; board_lines; lin++) {
</a><a href="#h0-8-25" id="h0-8-25" class="i">+        for (col = 0; col &lt; board_cols; col++)
</a>             fputc(B(lin, col), stdout);
         fputc(&apos;\n&apos;, stdout);
     }
<a href="#h0-9" id="h0-9" class="h">@@ -219,4 +233,6 @@ int main() {
</a>     fclose(stdin);
     fclose(stdout);
     return 0;
<a href="#h0-9-3" id="h0-9-3" class="d">-}
</a><a href="#h0-9-4" id="h0-9-4" class="i">+} /* }}} */
</a><a href="#h0-9-5" id="h0-9-5" class="i">+
</a><a href="#h0-9-6" id="h0-9-6" class="i">+/* vim: set fdm=marker : */
</a></pre>
</div>
</body>
</html>
