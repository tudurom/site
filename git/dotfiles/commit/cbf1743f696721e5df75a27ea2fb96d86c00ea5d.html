<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>Switching to LuaKit - dotfiles - My small load of configuration files and scripts.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dotfiles.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>dotfiles</h1><span class="desc">My small load of configuration files and scripts.
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/dotfiles.git">git://thetudor.ddns.net/dotfiles.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/cbf1743f696721e5df75a27ea2fb96d86c00ea5d.html">cbf1743f696721e5df75a27ea2fb96d86c00ea5d</a>
<b>parent</b> <a href="../commit/161387927f8a4bb0d3b28bebf1a6f71e11606f4e.html">161387927f8a4bb0d3b28bebf1a6f71e11606f4e</a>
<b>Author:</b> Tudor &lt;<a href="mailto:tudurom@gmail.com">tudurom@gmail.com</a>&gt;
<b>Date:</b>   Mon Feb  8 19:59:50 2016

Switching to LuaKit

<b>Diffstat:</b>
 .gitmodules                        |   3 +-
 home/.compton.conf                 |   2 +-
 home/.config/gtk-3.0/gtk.css       |   6 +-
 home/.config/luakit/binds.lua      | 588 ++++++++++++++++++++++++++-
 home/.config/luakit/globals.lua    |  83 ++++-
 home/.config/luakit/luakit-adblock |   1 +-
 home/.config/luakit/modes.lua      | 163 +++++++-
 home/.config/luakit/rc.lua         | 184 ++++++++-
 home/.config/luakit/theme.lua      |  69 +++-
 home/.config/luakit/webview.lua    | 350 +++++++++++++++-
 home/.config/luakit/window.lua     | 859 ++++++++++++++++++++++++++++++++++++++-
 11 files changed, 2307 insertions(+), 1 deletion(-)
<hr/><b>diff --git a/<a href="../file/.gitmodules.html">.gitmodules</a> b/<a href="../file/.gitmodules.html">.gitmodules</a></b>
<a href="#h0" id="h0" class="h">@@ -1,3 +1,6 @@
</a> [submodule &quot;home/.scripts/clint&quot;]
 	path = home/.scripts/clint
 	url = https://github.com/tudurom/clint.git
<a href="#h0-3" id="h0-3" class="i">+[submodule &quot;home/.config/luakit/luakit-adblock&quot;]
</a><a href="#h0-4" id="h0-4" class="i">+	path = home/.config/luakit/luakit-adblock
</a><a href="#h0-5" id="h0-5" class="i">+	url = https://github.com/Plaque-fcc/luakit-adblock/
</a><b>diff --git a/<a href="../file/home/.compton.conf.html">home/.compton.conf</a> b/<a href="../file/home/.compton.conf.html">home/.compton.conf</a></b>
<a href="#h0" id="h0" class="h">@@ -2,7 +2,7 @@ backend = &quot;glx&quot;;
</a> paint-on-overlay = true;
 glx-no-stencil = true;
 glx-no-rebind-pixmap = true;
<a href="#h0-3" id="h0-3" class="d">-vsync = &quot;opengl-swc&quot;;
</a><a href="#h0-4" id="h0-4" class="i">+vsync = &quot;opengl-mswc&quot;;
</a> 
 # These are important. The first one enables the opengl backend. The last one is the vsync method. Depending on the driver you might need to use a different method.
 # Theother options are smaller performance tweaks that work well in most cases.
<b>diff --git a/<a href="../file/home/.config/gtk-3.0/gtk.css.html">home/.config/gtk-3.0/gtk.css</a> b/<a href="../file/home/.config/gtk-3.0/gtk.css.html">home/.config/gtk-3.0/gtk.css</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,6 @@
</a><a href="#h0-0" id="h0-0" class="i">+.window-frame, .window-frame:backdrop {
</a><a href="#h0-1" id="h0-1" class="i">+    box-shadow: 0 0 0 black; /* removes shadow completely */
</a><a href="#h0-2" id="h0-2" class="i">+    border-style: none;
</a><a href="#h0-3" id="h0-3" class="i">+    margin: 0; /* this retains the ability to resize with the mouse, if 1px is too narrow, set some higher values */
</a><a href="#h0-4" id="h0-4" class="i">+    border-radius: 0;
</a><a href="#h0-5" id="h0-5" class="i">+}
</a><b>diff --git a/<a href="../file/home/.config/luakit/binds.lua.html">home/.config/luakit/binds.lua</a> b/<a href="../file/home/.config/luakit/binds.lua.html">home/.config/luakit/binds.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,588 @@
</a><a href="#h0-0" id="h0-0" class="i">+-----------------
</a><a href="#h0-1" id="h0-1" class="i">+-- Keybindings --
</a><a href="#h0-2" id="h0-2" class="i">+-----------------
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+-- Binding aliases
</a><a href="#h0-5" id="h0-5" class="i">+local key, buf, but = lousy.bind.key, lousy.bind.buf, lousy.bind.but
</a><a href="#h0-6" id="h0-6" class="i">+local cmd, any = lousy.bind.cmd, lousy.bind.any
</a><a href="#h0-7" id="h0-7" class="i">+
</a><a href="#h0-8" id="h0-8" class="i">+-- Util aliases
</a><a href="#h0-9" id="h0-9" class="i">+local match, join = string.match, lousy.util.table.join
</a><a href="#h0-10" id="h0-10" class="i">+local strip, split = lousy.util.string.strip, lousy.util.string.split
</a><a href="#h0-11" id="h0-11" class="i">+
</a><a href="#h0-12" id="h0-12" class="i">+-- Globals or defaults that are used in binds
</a><a href="#h0-13" id="h0-13" class="i">+local scroll_step = globals.scroll_step or 20
</a><a href="#h0-14" id="h0-14" class="i">+local zoom_step = globals.zoom_step or 0.1
</a><a href="#h0-15" id="h0-15" class="i">+
</a><a href="#h0-16" id="h0-16" class="i">+-- Add binds to a mode
</a><a href="#h0-17" id="h0-17" class="i">+function add_binds(mode, binds, before)
</a><a href="#h0-18" id="h0-18" class="i">+    assert(binds and type(binds) == &quot;table&quot;, &quot;invalid binds table type: &quot; .. type(binds))
</a><a href="#h0-19" id="h0-19" class="i">+    mode = type(mode) ~= &quot;table&quot; and {mode} or mode
</a><a href="#h0-20" id="h0-20" class="i">+    for _, m in ipairs(mode) do
</a><a href="#h0-21" id="h0-21" class="i">+        local mdata = get_mode(m)
</a><a href="#h0-22" id="h0-22" class="i">+        if mdata and before then
</a><a href="#h0-23" id="h0-23" class="i">+            mdata.binds = join(binds, mdata.binds or {})
</a><a href="#h0-24" id="h0-24" class="i">+        elseif mdata then
</a><a href="#h0-25" id="h0-25" class="i">+            mdata.binds = mdata.binds or {}
</a><a href="#h0-26" id="h0-26" class="i">+            for _, b in ipairs(binds) do table.insert(mdata.binds, b) end
</a><a href="#h0-27" id="h0-27" class="i">+        else
</a><a href="#h0-28" id="h0-28" class="i">+            new_mode(m, { binds = binds })
</a><a href="#h0-29" id="h0-29" class="i">+        end
</a><a href="#h0-30" id="h0-30" class="i">+    end
</a><a href="#h0-31" id="h0-31" class="i">+end
</a><a href="#h0-32" id="h0-32" class="i">+
</a><a href="#h0-33" id="h0-33" class="i">+-- Add commands to command mode
</a><a href="#h0-34" id="h0-34" class="i">+function add_cmds(cmds, before)
</a><a href="#h0-35" id="h0-35" class="i">+    add_binds(&quot;command&quot;, cmds, before)
</a><a href="#h0-36" id="h0-36" class="i">+end
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+-- Adds the default menu widget bindings to a mode
</a><a href="#h0-39" id="h0-39" class="i">+menu_binds = {
</a><a href="#h0-40" id="h0-40" class="i">+    -- Navigate items
</a><a href="#h0-41" id="h0-41" class="i">+    key({},          &quot;j&quot;,       function (w) w.menu:move_down() end),
</a><a href="#h0-42" id="h0-42" class="i">+    key({},          &quot;k&quot;,       function (w) w.menu:move_up()   end),
</a><a href="#h0-43" id="h0-43" class="i">+    key({},          &quot;Down&quot;,    function (w) w.menu:move_down() end),
</a><a href="#h0-44" id="h0-44" class="i">+    key({},          &quot;Up&quot;,      function (w) w.menu:move_up()   end),
</a><a href="#h0-45" id="h0-45" class="i">+    key({},          &quot;Tab&quot;,     function (w) w.menu:move_down() end),
</a><a href="#h0-46" id="h0-46" class="i">+    key({&quot;Shift&quot;},   &quot;Tab&quot;,     function (w) w.menu:move_up()   end),
</a><a href="#h0-47" id="h0-47" class="i">+}
</a><a href="#h0-48" id="h0-48" class="i">+
</a><a href="#h0-49" id="h0-49" class="i">+-- Add binds to special mode &quot;all&quot; which adds its binds to all modes.
</a><a href="#h0-50" id="h0-50" class="i">+add_binds(&quot;all&quot;, {
</a><a href="#h0-51" id="h0-51" class="i">+    key({}, &quot;Escape&quot;, &quot;Return to `normal` mode.&quot;,
</a><a href="#h0-52" id="h0-52" class="i">+        function (w) w:set_mode() end),
</a><a href="#h0-53" id="h0-53" class="i">+
</a><a href="#h0-54" id="h0-54" class="i">+    key({&quot;Control&quot;}, &quot;[&quot;, &quot;Return to `normal` mode.&quot;,
</a><a href="#h0-55" id="h0-55" class="i">+        function (w) w:set_mode() end),
</a><a href="#h0-56" id="h0-56" class="i">+
</a><a href="#h0-57" id="h0-57" class="i">+    -- Mouse bindings
</a><a href="#h0-58" id="h0-58" class="i">+    but({}, 8, &quot;Go back.&quot;,
</a><a href="#h0-59" id="h0-59" class="i">+        function (w) w:back() end),
</a><a href="#h0-60" id="h0-60" class="i">+
</a><a href="#h0-61" id="h0-61" class="i">+    but({}, 9, &quot;Go forward.&quot;,
</a><a href="#h0-62" id="h0-62" class="i">+        function (w) w:forward() end),
</a><a href="#h0-63" id="h0-63" class="i">+
</a><a href="#h0-64" id="h0-64" class="i">+    -- Open link in new tab or navigate to selection
</a><a href="#h0-65" id="h0-65" class="i">+    but({}, 2, [[Open link under mouse cursor in new tab or navigate to the
</a><a href="#h0-66" id="h0-66" class="i">+        contents of `luakit.selection.primary`.]],
</a><a href="#h0-67" id="h0-67" class="i">+        function (w, m)
</a><a href="#h0-68" id="h0-68" class="i">+            -- Ignore button 2 clicks in form fields
</a><a href="#h0-69" id="h0-69" class="i">+            if not m.context.editable then
</a><a href="#h0-70" id="h0-70" class="i">+                -- Open hovered uri in new tab
</a><a href="#h0-71" id="h0-71" class="i">+                local uri = w.view.hovered_uri
</a><a href="#h0-72" id="h0-72" class="i">+                if uri then
</a><a href="#h0-73" id="h0-73" class="i">+                    w:new_tab(uri, false)
</a><a href="#h0-74" id="h0-74" class="i">+                else -- Open selection in current tab
</a><a href="#h0-75" id="h0-75" class="i">+                    uri = luakit.selection.primary
</a><a href="#h0-76" id="h0-76" class="i">+                    if uri then w:navigate(w:search_open(uri)) end
</a><a href="#h0-77" id="h0-77" class="i">+                end
</a><a href="#h0-78" id="h0-78" class="i">+            end
</a><a href="#h0-79" id="h0-79" class="i">+        end),
</a><a href="#h0-80" id="h0-80" class="i">+
</a><a href="#h0-81" id="h0-81" class="i">+    -- Open link in new tab when Ctrl-clicked.
</a><a href="#h0-82" id="h0-82" class="i">+    but({&quot;Control&quot;}, 1, &quot;Open link under mouse cursor in new tab.&quot;,
</a><a href="#h0-83" id="h0-83" class="i">+        function (w, m)
</a><a href="#h0-84" id="h0-84" class="i">+            local uri = w.view.hovered_uri
</a><a href="#h0-85" id="h0-85" class="i">+            if uri then
</a><a href="#h0-86" id="h0-86" class="i">+                w:new_tab(uri, false)
</a><a href="#h0-87" id="h0-87" class="i">+            end
</a><a href="#h0-88" id="h0-88" class="i">+        end),
</a><a href="#h0-89" id="h0-89" class="i">+
</a><a href="#h0-90" id="h0-90" class="i">+    -- Zoom binds
</a><a href="#h0-91" id="h0-91" class="i">+    but({&quot;Control&quot;}, 4, &quot;Increase text zoom level.&quot;,
</a><a href="#h0-92" id="h0-92" class="i">+        function (w, m) w:zoom_in() end),
</a><a href="#h0-93" id="h0-93" class="i">+
</a><a href="#h0-94" id="h0-94" class="i">+    but({&quot;Control&quot;}, 5, &quot;Reduce text zoom level.&quot;,
</a><a href="#h0-95" id="h0-95" class="i">+        function (w, m) w:zoom_out() end),
</a><a href="#h0-96" id="h0-96" class="i">+
</a><a href="#h0-97" id="h0-97" class="i">+    -- Horizontal mouse scroll binds
</a><a href="#h0-98" id="h0-98" class="i">+    but({&quot;Shift&quot;}, 4, &quot;Scroll left.&quot;,
</a><a href="#h0-99" id="h0-99" class="i">+        function (w, m) w:scroll{ xrel = -scroll_step } end),
</a><a href="#h0-100" id="h0-100" class="i">+
</a><a href="#h0-101" id="h0-101" class="i">+    but({&quot;Shift&quot;}, 5, &quot;Scroll right.&quot;,
</a><a href="#h0-102" id="h0-102" class="i">+        function (w, m) w:scroll{ xrel =  scroll_step } end),
</a><a href="#h0-103" id="h0-103" class="i">+})
</a><a href="#h0-104" id="h0-104" class="i">+
</a><a href="#h0-105" id="h0-105" class="i">+add_binds(&quot;normal&quot;, {
</a><a href="#h0-106" id="h0-106" class="i">+    -- Autoparse the `[count]` before a binding and re-call the hit function
</a><a href="#h0-107" id="h0-107" class="i">+    -- with the count removed and added to the opts table.
</a><a href="#h0-108" id="h0-108" class="i">+    any([[Meta-binding to detect the `^[count]` syntax. The `[count]` is parsed
</a><a href="#h0-109" id="h0-109" class="i">+        and stripped from the internal buffer string and the value assigned to
</a><a href="#h0-110" id="h0-110" class="i">+        `state.count`. Then `lousy.bind.hit()` is re-called with the modified
</a><a href="#h0-111" id="h0-111" class="i">+        buffer string &amp; original modifier state.
</a><a href="#h0-112" id="h0-112" class="i">+
</a><a href="#h0-113" id="h0-113" class="i">+        #### Example binding
</a><a href="#h0-114" id="h0-114" class="i">+
</a><a href="#h0-115" id="h0-115" class="i">+            lousy.bind.key({}, &quot;%&quot;, function (w, state)
</a><a href="#h0-116" id="h0-116" class="i">+                w:scroll{ ypct = state.count }
</a><a href="#h0-117" id="h0-117" class="i">+            end, { count = 0 })
</a><a href="#h0-118" id="h0-118" class="i">+
</a><a href="#h0-119" id="h0-119" class="i">+        This binding demonstrates several concepts. Firstly that you are able to
</a><a href="#h0-120" id="h0-120" class="i">+        specify per-binding default values of `count`. In this case if the user
</a><a href="#h0-121" id="h0-121" class="i">+        types `&quot;%&quot;` the document will be scrolled vertically to `0%` (the top).
</a><a href="#h0-122" id="h0-122" class="i">+
</a><a href="#h0-123" id="h0-123" class="i">+        If the user types `&quot;100%&quot;` then the document will be scrolled to `100%`
</a><a href="#h0-124" id="h0-124" class="i">+        (the bottom). All without the need to use `lousy.bind.buf` bindings
</a><a href="#h0-125" id="h0-125" class="i">+        everywhere and or using a `^(%d*)` pattern prefix on every binding which
</a><a href="#h0-126" id="h0-126" class="i">+        would like to make use of the `[count]` syntax.]],
</a><a href="#h0-127" id="h0-127" class="i">+        function (w, m)
</a><a href="#h0-128" id="h0-128" class="i">+            local count, buf
</a><a href="#h0-129" id="h0-129" class="i">+            if m.buffer then
</a><a href="#h0-130" id="h0-130" class="i">+                count = string.match(m.buffer, &quot;^(%d+)&quot;)
</a><a href="#h0-131" id="h0-131" class="i">+            end
</a><a href="#h0-132" id="h0-132" class="i">+            if count then
</a><a href="#h0-133" id="h0-133" class="i">+                buf = string.sub(m.buffer, #count + 1, (m.updated_buf and -2) or -1)
</a><a href="#h0-134" id="h0-134" class="i">+                local opts = join(m, {count = tonumber(count)})
</a><a href="#h0-135" id="h0-135" class="i">+                opts.buffer = (#buf &gt; 0 and buf) or nil
</a><a href="#h0-136" id="h0-136" class="i">+                if lousy.bind.hit(w, m.binds, m.mods, m.key, opts) then
</a><a href="#h0-137" id="h0-137" class="i">+                    return true
</a><a href="#h0-138" id="h0-138" class="i">+                end
</a><a href="#h0-139" id="h0-139" class="i">+            end
</a><a href="#h0-140" id="h0-140" class="i">+            return false
</a><a href="#h0-141" id="h0-141" class="i">+        end),
</a><a href="#h0-142" id="h0-142" class="i">+
</a><a href="#h0-143" id="h0-143" class="i">+    key({}, &quot;i&quot;, &quot;Enter `insert` mode.&quot;,
</a><a href="#h0-144" id="h0-144" class="i">+        function (w) w:set_mode(&quot;insert&quot;)  end),
</a><a href="#h0-145" id="h0-145" class="i">+
</a><a href="#h0-146" id="h0-146" class="i">+    key({}, &quot;:&quot;, &quot;Enter `command` mode.&quot;,
</a><a href="#h0-147" id="h0-147" class="i">+        function (w) w:set_mode(&quot;command&quot;) end),
</a><a href="#h0-148" id="h0-148" class="i">+
</a><a href="#h0-149" id="h0-149" class="i">+    -- Scrolling
</a><a href="#h0-150" id="h0-150" class="i">+    key({}, &quot;j&quot;, &quot;Scroll document down.&quot;,
</a><a href="#h0-151" id="h0-151" class="i">+        function (w) w:scroll{ yrel =  scroll_step } end),
</a><a href="#h0-152" id="h0-152" class="i">+
</a><a href="#h0-153" id="h0-153" class="i">+    key({}, &quot;k&quot;, &quot;Scroll document up.&quot;,
</a><a href="#h0-154" id="h0-154" class="i">+        function (w) w:scroll{ yrel = -scroll_step } end),
</a><a href="#h0-155" id="h0-155" class="i">+
</a><a href="#h0-156" id="h0-156" class="i">+    key({}, &quot;h&quot;, &quot;Scroll document left.&quot;,
</a><a href="#h0-157" id="h0-157" class="i">+        function (w) w:scroll{ xrel = -scroll_step } end),
</a><a href="#h0-158" id="h0-158" class="i">+
</a><a href="#h0-159" id="h0-159" class="i">+    key({}, &quot;l&quot;, &quot;Scroll document right.&quot;,
</a><a href="#h0-160" id="h0-160" class="i">+        function (w) w:scroll{ xrel =  scroll_step } end),
</a><a href="#h0-161" id="h0-161" class="i">+
</a><a href="#h0-162" id="h0-162" class="i">+    key({}, &quot;Down&quot;, &quot;Scroll document down.&quot;,
</a><a href="#h0-163" id="h0-163" class="i">+        function (w) w:scroll{ yrel =  scroll_step } end),
</a><a href="#h0-164" id="h0-164" class="i">+
</a><a href="#h0-165" id="h0-165" class="i">+    key({}, &quot;Up&quot;,   &quot;Scroll document up.&quot;,
</a><a href="#h0-166" id="h0-166" class="i">+        function (w) w:scroll{ yrel = -scroll_step } end),
</a><a href="#h0-167" id="h0-167" class="i">+
</a><a href="#h0-168" id="h0-168" class="i">+    key({}, &quot;Left&quot;, &quot;Scroll document left.&quot;,
</a><a href="#h0-169" id="h0-169" class="i">+        function (w) w:scroll{ xrel = -scroll_step } end),
</a><a href="#h0-170" id="h0-170" class="i">+
</a><a href="#h0-171" id="h0-171" class="i">+    key({}, &quot;Right&quot;, &quot;Scroll document right.&quot;,
</a><a href="#h0-172" id="h0-172" class="i">+        function (w) w:scroll{ xrel =  scroll_step } end),
</a><a href="#h0-173" id="h0-173" class="i">+
</a><a href="#h0-174" id="h0-174" class="i">+    key({}, &quot;^&quot;, &quot;Scroll to the absolute left of the document.&quot;,
</a><a href="#h0-175" id="h0-175" class="i">+        function (w) w:scroll{ x =  0 } end),
</a><a href="#h0-176" id="h0-176" class="i">+
</a><a href="#h0-177" id="h0-177" class="i">+    key({}, &quot;$&quot;, &quot;Scroll to the absolute right of the document.&quot;,
</a><a href="#h0-178" id="h0-178" class="i">+        function (w) w:scroll{ x = -1 } end),
</a><a href="#h0-179" id="h0-179" class="i">+
</a><a href="#h0-180" id="h0-180" class="i">+    key({}, &quot;0&quot;, &quot;Scroll to the absolute left of the document.&quot;,
</a><a href="#h0-181" id="h0-181" class="i">+        function (w, m)
</a><a href="#h0-182" id="h0-182" class="i">+            if not m.count then w:scroll{ y = 0 } else return false end
</a><a href="#h0-183" id="h0-183" class="i">+        end),
</a><a href="#h0-184" id="h0-184" class="i">+
</a><a href="#h0-185" id="h0-185" class="i">+    key({&quot;Control&quot;}, &quot;e&quot;, &quot;Scroll document down.&quot;,
</a><a href="#h0-186" id="h0-186" class="i">+        function (w) w:scroll{ yrel =  scroll_step } end),
</a><a href="#h0-187" id="h0-187" class="i">+
</a><a href="#h0-188" id="h0-188" class="i">+    key({&quot;Control&quot;}, &quot;y&quot;, &quot;Scroll document up.&quot;,
</a><a href="#h0-189" id="h0-189" class="i">+        function (w) w:scroll{ yrel = -scroll_step } end),
</a><a href="#h0-190" id="h0-190" class="i">+
</a><a href="#h0-191" id="h0-191" class="i">+    key({&quot;Control&quot;}, &quot;d&quot;, &quot;Scroll half page down.&quot;,
</a><a href="#h0-192" id="h0-192" class="i">+        function (w) w:scroll{ ypagerel =  0.5 } end),
</a><a href="#h0-193" id="h0-193" class="i">+
</a><a href="#h0-194" id="h0-194" class="i">+    key({&quot;Control&quot;}, &quot;u&quot;, &quot;Scroll half page up.&quot;,
</a><a href="#h0-195" id="h0-195" class="i">+        function (w) w:scroll{ ypagerel = -0.5 } end),
</a><a href="#h0-196" id="h0-196" class="i">+
</a><a href="#h0-197" id="h0-197" class="i">+    key({&quot;Control&quot;}, &quot;f&quot;, &quot;Scroll page down.&quot;,
</a><a href="#h0-198" id="h0-198" class="i">+        function (w) w:scroll{ ypagerel =  1.0 } end),
</a><a href="#h0-199" id="h0-199" class="i">+
</a><a href="#h0-200" id="h0-200" class="i">+    key({&quot;Control&quot;}, &quot;b&quot;, &quot;Scroll page up.&quot;,
</a><a href="#h0-201" id="h0-201" class="i">+        function (w) w:scroll{ ypagerel = -1.0 } end),
</a><a href="#h0-202" id="h0-202" class="i">+
</a><a href="#h0-203" id="h0-203" class="i">+    key({}, &quot;space&quot;, &quot;Scroll page down.&quot;,
</a><a href="#h0-204" id="h0-204" class="i">+        function (w) w:scroll{ ypagerel =  1.0 } end),
</a><a href="#h0-205" id="h0-205" class="i">+
</a><a href="#h0-206" id="h0-206" class="i">+    key({&quot;Shift&quot;}, &quot;space&quot;, &quot;Scroll page up.&quot;,
</a><a href="#h0-207" id="h0-207" class="i">+        function (w) w:scroll{ ypagerel = -1.0 } end),
</a><a href="#h0-208" id="h0-208" class="i">+
</a><a href="#h0-209" id="h0-209" class="i">+    key({}, &quot;BackSpace&quot;, &quot;Scroll page up.&quot;,
</a><a href="#h0-210" id="h0-210" class="i">+        function (w) w:scroll{ ypagerel = -1.0 } end),
</a><a href="#h0-211" id="h0-211" class="i">+
</a><a href="#h0-212" id="h0-212" class="i">+    key({}, &quot;Page_Down&quot;, &quot;Scroll page down.&quot;,
</a><a href="#h0-213" id="h0-213" class="i">+        function (w) w:scroll{ ypagerel =  1.0 } end),
</a><a href="#h0-214" id="h0-214" class="i">+
</a><a href="#h0-215" id="h0-215" class="i">+    key({}, &quot;Page_Up&quot;, &quot;Scroll page up.&quot;,
</a><a href="#h0-216" id="h0-216" class="i">+        function (w) w:scroll{ ypagerel = -1.0 } end),
</a><a href="#h0-217" id="h0-217" class="i">+
</a><a href="#h0-218" id="h0-218" class="i">+    key({}, &quot;Home&quot;, &quot;Go to the end of the document.&quot;,
</a><a href="#h0-219" id="h0-219" class="i">+        function (w) w:scroll{ y =  0 } end),
</a><a href="#h0-220" id="h0-220" class="i">+
</a><a href="#h0-221" id="h0-221" class="i">+    key({}, &quot;End&quot;, &quot;Go to the top of the document.&quot;,
</a><a href="#h0-222" id="h0-222" class="i">+        function (w) w:scroll{ y = -1 } end),
</a><a href="#h0-223" id="h0-223" class="i">+
</a><a href="#h0-224" id="h0-224" class="i">+    -- Specific scroll
</a><a href="#h0-225" id="h0-225" class="i">+    buf(&quot;^gg$&quot;, &quot;Go to the top of the document.&quot;,
</a><a href="#h0-226" id="h0-226" class="i">+        function (w, b, m) w:scroll{ ypct = m.count } end, {count=0}),
</a><a href="#h0-227" id="h0-227" class="i">+
</a><a href="#h0-228" id="h0-228" class="i">+    buf(&quot;^G$&quot;, &quot;Go to the bottom of the document.&quot;,
</a><a href="#h0-229" id="h0-229" class="i">+        function (w, b, m) w:scroll{ ypct = m.count } end, {count=100}),
</a><a href="#h0-230" id="h0-230" class="i">+
</a><a href="#h0-231" id="h0-231" class="i">+    buf(&quot;^%%$&quot;, &quot;Go to `[count]` percent of the document.&quot;,
</a><a href="#h0-232" id="h0-232" class="i">+        function (w, b, m) w:scroll{ ypct = m.count } end),
</a><a href="#h0-233" id="h0-233" class="i">+
</a><a href="#h0-234" id="h0-234" class="i">+    -- Zooming
</a><a href="#h0-235" id="h0-235" class="i">+    key({}, &quot;+&quot;, &quot;Enlarge text zoom of the current page.&quot;,
</a><a href="#h0-236" id="h0-236" class="i">+        function (w, m) w:zoom_in(zoom_step * m.count) end, {count=1}),
</a><a href="#h0-237" id="h0-237" class="i">+
</a><a href="#h0-238" id="h0-238" class="i">+    key({}, &quot;-&quot;, &quot;Reduce text zom of the current page.&quot;,
</a><a href="#h0-239" id="h0-239" class="i">+        function (w, m) w:zoom_out(zoom_step * m.count) end, {count=1}),
</a><a href="#h0-240" id="h0-240" class="i">+
</a><a href="#h0-241" id="h0-241" class="i">+    key({}, &quot;=&quot;, &quot;Reset zoom level.&quot;,
</a><a href="#h0-242" id="h0-242" class="i">+        function (w, m) w:zoom_set() end),
</a><a href="#h0-243" id="h0-243" class="i">+
</a><a href="#h0-244" id="h0-244" class="i">+    buf(&quot;^z[iI]$&quot;, [[Enlarge text zoom of current page with `zi` or `zI` to
</a><a href="#h0-245" id="h0-245" class="i">+        reduce full zoom.]],
</a><a href="#h0-246" id="h0-246" class="i">+        function (w, b, m)
</a><a href="#h0-247" id="h0-247" class="i">+            w:zoom_in(zoom_step  * m.count, b == &quot;zI&quot;)
</a><a href="#h0-248" id="h0-248" class="i">+        end, {count=1}),
</a><a href="#h0-249" id="h0-249" class="i">+
</a><a href="#h0-250" id="h0-250" class="i">+    buf(&quot;^z[oO]$&quot;, [[Reduce text zoom of current page with `zo` or `zO` to
</a><a href="#h0-251" id="h0-251" class="i">+        reduce full zoom.]],
</a><a href="#h0-252" id="h0-252" class="i">+        function (w, b, m)
</a><a href="#h0-253" id="h0-253" class="i">+            w:zoom_out(zoom_step * m.count, b == &quot;zO&quot;)
</a><a href="#h0-254" id="h0-254" class="i">+        end, {count=1}),
</a><a href="#h0-255" id="h0-255" class="i">+
</a><a href="#h0-256" id="h0-256" class="i">+    -- Zoom reset or specific zoom ([count]zZ for full content zoom)
</a><a href="#h0-257" id="h0-257" class="i">+    buf(&quot;^z[zZ]$&quot;, [[Set current page zoom to `[count]` percent with
</a><a href="#h0-258" id="h0-258" class="i">+        `[count]zz`, use `[count]zZ` to set full zoom percent.]],
</a><a href="#h0-259" id="h0-259" class="i">+        function (w, b, m)
</a><a href="#h0-260" id="h0-260" class="i">+            w:zoom_set(m.count/100, b == &quot;zZ&quot;)
</a><a href="#h0-261" id="h0-261" class="i">+        end, {count=100}),
</a><a href="#h0-262" id="h0-262" class="i">+
</a><a href="#h0-263" id="h0-263" class="i">+    -- Fullscreen
</a><a href="#h0-264" id="h0-264" class="i">+    key({}, &quot;F11&quot;, &quot;Toggle fullscreen mode.&quot;,
</a><a href="#h0-265" id="h0-265" class="i">+        function (w) w.win.fullscreen = not w.win.fullscreen end),
</a><a href="#h0-266" id="h0-266" class="i">+
</a><a href="#h0-267" id="h0-267" class="i">+    -- Clipboard
</a><a href="#h0-268" id="h0-268" class="i">+    key({}, &quot;p&quot;, [[Open a URL based on the current primary selection contents
</a><a href="#h0-269" id="h0-269" class="i">+        in the current tab.]],
</a><a href="#h0-270" id="h0-270" class="i">+        function (w)
</a><a href="#h0-271" id="h0-271" class="i">+            local uri = luakit.selection.primary
</a><a href="#h0-272" id="h0-272" class="i">+            if not uri then w:notify(&quot;No primary selection...&quot;) return end
</a><a href="#h0-273" id="h0-273" class="i">+            w:navigate(w:search_open(uri))
</a><a href="#h0-274" id="h0-274" class="i">+        end),
</a><a href="#h0-275" id="h0-275" class="i">+
</a><a href="#h0-276" id="h0-276" class="i">+    key({}, &quot;P&quot;, [[Open a URL based on the current primary selection contents
</a><a href="#h0-277" id="h0-277" class="i">+        in `[count=1]` new tab(s).]],
</a><a href="#h0-278" id="h0-278" class="i">+        function (w, m)
</a><a href="#h0-279" id="h0-279" class="i">+            local uri = luakit.selection.primary
</a><a href="#h0-280" id="h0-280" class="i">+            if not uri then w:notify(&quot;No primary selection...&quot;) return end
</a><a href="#h0-281" id="h0-281" class="i">+            for i = 1, m.count do w:new_tab(w:search_open(uri)) end
</a><a href="#h0-282" id="h0-282" class="i">+        end, {count = 1}),
</a><a href="#h0-283" id="h0-283" class="i">+
</a><a href="#h0-284" id="h0-284" class="i">+    -- Yanking
</a><a href="#h0-285" id="h0-285" class="i">+    key({}, &quot;y&quot;, &quot;Yank current URI to primary selection.&quot;,
</a><a href="#h0-286" id="h0-286" class="i">+        function (w)
</a><a href="#h0-287" id="h0-287" class="i">+            local uri = string.gsub(w.view.uri or &quot;&quot;, &quot; &quot;, &quot;%%20&quot;)
</a><a href="#h0-288" id="h0-288" class="i">+            luakit.selection.primary = uri
</a><a href="#h0-289" id="h0-289" class="i">+            w:notify(&quot;Yanked uri: &quot; .. uri)
</a><a href="#h0-290" id="h0-290" class="i">+        end),
</a><a href="#h0-291" id="h0-291" class="i">+
</a><a href="#h0-292" id="h0-292" class="i">+    -- Commands
</a><a href="#h0-293" id="h0-293" class="i">+    key({&quot;Control&quot;}, &quot;a&quot;, &quot;Increment last number in URL.&quot;,
</a><a href="#h0-294" id="h0-294" class="i">+        function (w) w:navigate(w:inc_uri(1)) end),
</a><a href="#h0-295" id="h0-295" class="i">+
</a><a href="#h0-296" id="h0-296" class="i">+    key({&quot;Control&quot;}, &quot;x&quot;, &quot;Decrement last number in URL.&quot;,
</a><a href="#h0-297" id="h0-297" class="i">+        function (w) w:navigate(w:inc_uri(-1)) end),
</a><a href="#h0-298" id="h0-298" class="i">+
</a><a href="#h0-299" id="h0-299" class="i">+    key({}, &quot;o&quot;, &quot;Open one or more URLs.&quot;,
</a><a href="#h0-300" id="h0-300" class="i">+        function (w) w:enter_cmd(&quot;:open &quot;) end),
</a><a href="#h0-301" id="h0-301" class="i">+
</a><a href="#h0-302" id="h0-302" class="i">+    key({}, &quot;t&quot;, &quot;Open one or more URLs in a new tab.&quot;,
</a><a href="#h0-303" id="h0-303" class="i">+        function (w) w:enter_cmd(&quot;:tabopen &quot;) end),
</a><a href="#h0-304" id="h0-304" class="i">+
</a><a href="#h0-305" id="h0-305" class="i">+    key({}, &quot;w&quot;, &quot;Open one or more URLs in a new window.&quot;,
</a><a href="#h0-306" id="h0-306" class="i">+        function (w) w:enter_cmd(&quot;:winopen &quot;) end),
</a><a href="#h0-307" id="h0-307" class="i">+
</a><a href="#h0-308" id="h0-308" class="i">+    key({}, &quot;O&quot;, &quot;Open one or more URLs based on current location.&quot;,
</a><a href="#h0-309" id="h0-309" class="i">+        function (w) w:enter_cmd(&quot;:open &quot; .. (w.view.uri or &quot;&quot;)) end),
</a><a href="#h0-310" id="h0-310" class="i">+
</a><a href="#h0-311" id="h0-311" class="i">+    key({}, &quot;T&quot;,
</a><a href="#h0-312" id="h0-312" class="i">+        &quot;Open one or more URLs based on current location in a new tab.&quot;,
</a><a href="#h0-313" id="h0-313" class="i">+        function (w) w:enter_cmd(&quot;:tabopen &quot; .. (w.view.uri or &quot;&quot;)) end),
</a><a href="#h0-314" id="h0-314" class="i">+
</a><a href="#h0-315" id="h0-315" class="i">+    key({}, &quot;W&quot;,
</a><a href="#h0-316" id="h0-316" class="i">+        &quot;Open one or more URLs based on current locaton in a new window.&quot;,
</a><a href="#h0-317" id="h0-317" class="i">+        function (w) w:enter_cmd(&quot;:winopen &quot; .. (w.view.uri or &quot;&quot;)) end),
</a><a href="#h0-318" id="h0-318" class="i">+
</a><a href="#h0-319" id="h0-319" class="i">+    -- History
</a><a href="#h0-320" id="h0-320" class="i">+    key({}, &quot;H&quot;, &quot;Go back in the browser history `[count=1]` items.&quot;,
</a><a href="#h0-321" id="h0-321" class="i">+        function (w, m) w:back(m.count) end),
</a><a href="#h0-322" id="h0-322" class="i">+
</a><a href="#h0-323" id="h0-323" class="i">+    key({}, &quot;L&quot;, &quot;Go forward in the browser history `[count=1]` times.&quot;,
</a><a href="#h0-324" id="h0-324" class="i">+        function (w, m) w:forward(m.count) end),
</a><a href="#h0-325" id="h0-325" class="i">+
</a><a href="#h0-326" id="h0-326" class="i">+    key({}, &quot;XF86Back&quot;, &quot;Go back in the browser history.&quot;,
</a><a href="#h0-327" id="h0-327" class="i">+        function (w, m) w:back(m.count) end),
</a><a href="#h0-328" id="h0-328" class="i">+
</a><a href="#h0-329" id="h0-329" class="i">+    key({}, &quot;XF86Forward&quot;, &quot;Go forward in the browser history.&quot;,
</a><a href="#h0-330" id="h0-330" class="i">+        function (w, m) w:forward(m.count) end),
</a><a href="#h0-331" id="h0-331" class="i">+
</a><a href="#h0-332" id="h0-332" class="i">+    key({&quot;Control&quot;}, &quot;o&quot;, &quot;Go back in the browser history.&quot;,
</a><a href="#h0-333" id="h0-333" class="i">+        function (w, m) w:back(m.count) end),
</a><a href="#h0-334" id="h0-334" class="i">+
</a><a href="#h0-335" id="h0-335" class="i">+    key({&quot;Control&quot;}, &quot;i&quot;, &quot;Go forward in the browser history.&quot;,
</a><a href="#h0-336" id="h0-336" class="i">+        function (w, m) w:forward(m.count) end),
</a><a href="#h0-337" id="h0-337" class="i">+
</a><a href="#h0-338" id="h0-338" class="i">+    -- Tab
</a><a href="#h0-339" id="h0-339" class="i">+    key({&quot;Control&quot;}, &quot;Page_Up&quot;, &quot;Go to previous tab.&quot;,
</a><a href="#h0-340" id="h0-340" class="i">+        function (w) w:prev_tab() end),
</a><a href="#h0-341" id="h0-341" class="i">+
</a><a href="#h0-342" id="h0-342" class="i">+    key({&quot;Control&quot;}, &quot;Page_Down&quot;, &quot;Go to next tab.&quot;,
</a><a href="#h0-343" id="h0-343" class="i">+        function (w) w:next_tab() end),
</a><a href="#h0-344" id="h0-344" class="i">+
</a><a href="#h0-345" id="h0-345" class="i">+    key({&quot;Control&quot;}, &quot;Tab&quot;, &quot;Go to next tab.&quot;,
</a><a href="#h0-346" id="h0-346" class="i">+        function (w) w:next_tab() end),
</a><a href="#h0-347" id="h0-347" class="i">+
</a><a href="#h0-348" id="h0-348" class="i">+    key({&quot;Shift&quot;,&quot;Control&quot;}, &quot;Tab&quot;, &quot;Go to previous tab.&quot;,
</a><a href="#h0-349" id="h0-349" class="i">+        function (w) w:prev_tab() end),
</a><a href="#h0-350" id="h0-350" class="i">+
</a><a href="#h0-351" id="h0-351" class="i">+    buf(&quot;^gT$&quot;, &quot;Go to previous tab.&quot;,
</a><a href="#h0-352" id="h0-352" class="i">+        function (w) w:prev_tab() end),
</a><a href="#h0-353" id="h0-353" class="i">+
</a><a href="#h0-354" id="h0-354" class="i">+    buf(&quot;^gt$&quot;, &quot;Go to next tab (or `[count]` nth tab).&quot;,
</a><a href="#h0-355" id="h0-355" class="i">+        function (w, b, m)
</a><a href="#h0-356" id="h0-356" class="i">+            if not w:goto_tab(m.count) then w:next_tab() end
</a><a href="#h0-357" id="h0-357" class="i">+        end, {count=0}),
</a><a href="#h0-358" id="h0-358" class="i">+
</a><a href="#h0-359" id="h0-359" class="i">+    buf(&quot;^g0$&quot;, &quot;Go to first tab.&quot;,
</a><a href="#h0-360" id="h0-360" class="i">+        function (w) w:goto_tab(1) end),
</a><a href="#h0-361" id="h0-361" class="i">+
</a><a href="#h0-362" id="h0-362" class="i">+    buf(&quot;^g$$&quot;, &quot;Go to last tab.&quot;,
</a><a href="#h0-363" id="h0-363" class="i">+        function (w) w:goto_tab(-1) end),
</a><a href="#h0-364" id="h0-364" class="i">+
</a><a href="#h0-365" id="h0-365" class="i">+    key({&quot;Control&quot;}, &quot;t&quot;, &quot;Open a new tab.&quot;,
</a><a href="#h0-366" id="h0-366" class="i">+        function (w) w:new_tab(globals.homepage) end),
</a><a href="#h0-367" id="h0-367" class="i">+
</a><a href="#h0-368" id="h0-368" class="i">+    key({&quot;Control&quot;}, &quot;w&quot;, &quot;Close current tab.&quot;,
</a><a href="#h0-369" id="h0-369" class="i">+        function (w) w:close_tab() end),
</a><a href="#h0-370" id="h0-370" class="i">+
</a><a href="#h0-371" id="h0-371" class="i">+    key({}, &quot;d&quot;, &quot;Close current tab (or `[count]` tabs).&quot;,
</a><a href="#h0-372" id="h0-372" class="i">+        function (w, m) for i=1,m.count do w:close_tab() end end, {count=1}),
</a><a href="#h0-373" id="h0-373" class="i">+
</a><a href="#h0-374" id="h0-374" class="i">+    key({}, &quot;&lt;&quot;, &quot;Reorder tab left `[count=1]` positions.&quot;,
</a><a href="#h0-375" id="h0-375" class="i">+        function (w, m)
</a><a href="#h0-376" id="h0-376" class="i">+            w.tabs:reorder(w.view, w.tabs:current() - m.count)
</a><a href="#h0-377" id="h0-377" class="i">+        end, {count=1}),
</a><a href="#h0-378" id="h0-378" class="i">+
</a><a href="#h0-379" id="h0-379" class="i">+    key({}, &quot;&gt;&quot;, &quot;Reorder tab right `[count=1]` positions.&quot;,
</a><a href="#h0-380" id="h0-380" class="i">+        function (w, m)
</a><a href="#h0-381" id="h0-381" class="i">+            w.tabs:reorder(w.view,
</a><a href="#h0-382" id="h0-382" class="i">+                (w.tabs:current() + m.count) % w.tabs:count())
</a><a href="#h0-383" id="h0-383" class="i">+        end, {count=1}),
</a><a href="#h0-384" id="h0-384" class="i">+
</a><a href="#h0-385" id="h0-385" class="i">+    buf(&quot;^gH$&quot;, &quot;Open homepage in new tab.&quot;,
</a><a href="#h0-386" id="h0-386" class="i">+        function (w) w:new_tab(globals.homepage) end),
</a><a href="#h0-387" id="h0-387" class="i">+
</a><a href="#h0-388" id="h0-388" class="i">+    buf(&quot;^gh$&quot;, &quot;Open homepage.&quot;,
</a><a href="#h0-389" id="h0-389" class="i">+        function (w) w:navigate(globals.homepage) end),
</a><a href="#h0-390" id="h0-390" class="i">+
</a><a href="#h0-391" id="h0-391" class="i">+    buf(&quot;^gy$&quot;, &quot;Duplicate current tab.&quot;,
</a><a href="#h0-392" id="h0-392" class="i">+        function (w) w:new_tab(w.view.history or &quot;&quot;) end),
</a><a href="#h0-393" id="h0-393" class="i">+
</a><a href="#h0-394" id="h0-394" class="i">+    key({}, &quot;r&quot;, &quot;Reload current tab.&quot;,
</a><a href="#h0-395" id="h0-395" class="i">+        function (w) w:reload() end),
</a><a href="#h0-396" id="h0-396" class="i">+
</a><a href="#h0-397" id="h0-397" class="i">+    key({}, &quot;R&quot;, &quot;Reload current tab (skipping cache).&quot;,
</a><a href="#h0-398" id="h0-398" class="i">+        function (w) w:reload(true) end),
</a><a href="#h0-399" id="h0-399" class="i">+
</a><a href="#h0-400" id="h0-400" class="i">+    key({&quot;Control&quot;}, &quot;c&quot;, &quot;Stop loading the current tab.&quot;,
</a><a href="#h0-401" id="h0-401" class="i">+        function (w) w.view:stop() end),
</a><a href="#h0-402" id="h0-402" class="i">+
</a><a href="#h0-403" id="h0-403" class="i">+    key({&quot;Control&quot;, &quot;Shift&quot;}, &quot;R&quot;, &quot;Restart luakit (reloading configs).&quot;,
</a><a href="#h0-404" id="h0-404" class="i">+        function (w) w:restart() end),
</a><a href="#h0-405" id="h0-405" class="i">+
</a><a href="#h0-406" id="h0-406" class="i">+    -- Window
</a><a href="#h0-407" id="h0-407" class="i">+    buf(&quot;^ZZ$&quot;, &quot;Quit and save the session.&quot;,
</a><a href="#h0-408" id="h0-408" class="i">+        function (w) w:save_session() w:close_win() end),
</a><a href="#h0-409" id="h0-409" class="i">+
</a><a href="#h0-410" id="h0-410" class="i">+    buf(&quot;^ZQ$&quot;, &quot;Quit and don&apos;t save the session.&quot;,
</a><a href="#h0-411" id="h0-411" class="i">+        function (w) w:close_win() end),
</a><a href="#h0-412" id="h0-412" class="i">+
</a><a href="#h0-413" id="h0-413" class="i">+    buf(&quot;^D$&quot;,  &quot;Quit and don&apos;t save the session.&quot;,
</a><a href="#h0-414" id="h0-414" class="i">+        function (w) w:close_win() end),
</a><a href="#h0-415" id="h0-415" class="i">+
</a><a href="#h0-416" id="h0-416" class="i">+    -- Enter passthrough mode
</a><a href="#h0-417" id="h0-417" class="i">+    key({&quot;Control&quot;}, &quot;z&quot;,
</a><a href="#h0-418" id="h0-418" class="i">+        &quot;Enter `passthrough` mode, ignores all luakit keybindings.&quot;,
</a><a href="#h0-419" id="h0-419" class="i">+        function (w) w:set_mode(&quot;passthrough&quot;) end),
</a><a href="#h0-420" id="h0-420" class="i">+})
</a><a href="#h0-421" id="h0-421" class="i">+
</a><a href="#h0-422" id="h0-422" class="i">+add_binds(&quot;insert&quot;, {
</a><a href="#h0-423" id="h0-423" class="i">+    key({&quot;Control&quot;}, &quot;z&quot;,
</a><a href="#h0-424" id="h0-424" class="i">+        &quot;Enter `passthrough` mode, ignores all luakit keybindings.&quot;,
</a><a href="#h0-425" id="h0-425" class="i">+        function (w) w:set_mode(&quot;passthrough&quot;) end),
</a><a href="#h0-426" id="h0-426" class="i">+})
</a><a href="#h0-427" id="h0-427" class="i">+
</a><a href="#h0-428" id="h0-428" class="i">+readline_bindings = {
</a><a href="#h0-429" id="h0-429" class="i">+    key({&quot;Shift&quot;}, &quot;Insert&quot;,
</a><a href="#h0-430" id="h0-430" class="i">+        &quot;Insert contents of primary selection at cursor position.&quot;,
</a><a href="#h0-431" id="h0-431" class="i">+        function (w) w:insert_cmd(luakit.selection.primary) end),
</a><a href="#h0-432" id="h0-432" class="i">+
</a><a href="#h0-433" id="h0-433" class="i">+    key({&quot;Control&quot;}, &quot;w&quot;, &quot;Delete previous word.&quot;,
</a><a href="#h0-434" id="h0-434" class="i">+        function (w) w:del_word() end),
</a><a href="#h0-435" id="h0-435" class="i">+
</a><a href="#h0-436" id="h0-436" class="i">+    key({&quot;Control&quot;}, &quot;u&quot;, &quot;Delete until beginning of current line.&quot;,
</a><a href="#h0-437" id="h0-437" class="i">+        function (w) w:del_line() end),
</a><a href="#h0-438" id="h0-438" class="i">+
</a><a href="#h0-439" id="h0-439" class="i">+    key({&quot;Control&quot;}, &quot;h&quot;, &quot;Delete character to the left.&quot;,
</a><a href="#h0-440" id="h0-440" class="i">+        function (w) w:del_backward_char() end),
</a><a href="#h0-441" id="h0-441" class="i">+
</a><a href="#h0-442" id="h0-442" class="i">+    key({&quot;Control&quot;}, &quot;d&quot;, &quot;Delete character to the right.&quot;,
</a><a href="#h0-443" id="h0-443" class="i">+        function (w) w:del_forward_char() end),
</a><a href="#h0-444" id="h0-444" class="i">+
</a><a href="#h0-445" id="h0-445" class="i">+    key({&quot;Control&quot;}, &quot;a&quot;, &quot;Move cursor to beginning of current line.&quot;,
</a><a href="#h0-446" id="h0-446" class="i">+        function (w) w:beg_line() end),
</a><a href="#h0-447" id="h0-447" class="i">+
</a><a href="#h0-448" id="h0-448" class="i">+    key({&quot;Control&quot;}, &quot;e&quot;, &quot;Move cursor to end of current line.&quot;,
</a><a href="#h0-449" id="h0-449" class="i">+        function (w) w:end_line() end),
</a><a href="#h0-450" id="h0-450" class="i">+
</a><a href="#h0-451" id="h0-451" class="i">+    key({&quot;Control&quot;}, &quot;f&quot;, &quot;Move cursor forward one character.&quot;,
</a><a href="#h0-452" id="h0-452" class="i">+        function (w) w:forward_char() end),
</a><a href="#h0-453" id="h0-453" class="i">+
</a><a href="#h0-454" id="h0-454" class="i">+    key({&quot;Control&quot;}, &quot;b&quot;, &quot;Move cursor backward one character.&quot;,
</a><a href="#h0-455" id="h0-455" class="i">+        function (w) w:backward_char() end),
</a><a href="#h0-456" id="h0-456" class="i">+
</a><a href="#h0-457" id="h0-457" class="i">+    key({&quot;Mod1&quot;}, &quot;f&quot;, &quot;Move cursor forward one word.&quot;,
</a><a href="#h0-458" id="h0-458" class="i">+        function (w) w:forward_word() end),
</a><a href="#h0-459" id="h0-459" class="i">+
</a><a href="#h0-460" id="h0-460" class="i">+    key({&quot;Mod1&quot;}, &quot;b&quot;, &quot;Move cursor backward one word.&quot;,
</a><a href="#h0-461" id="h0-461" class="i">+        function (w) w:backward_word() end),
</a><a href="#h0-462" id="h0-462" class="i">+}
</a><a href="#h0-463" id="h0-463" class="i">+
</a><a href="#h0-464" id="h0-464" class="i">+add_binds({&quot;command&quot;, &quot;search&quot;}, readline_bindings)
</a><a href="#h0-465" id="h0-465" class="i">+
</a><a href="#h0-466" id="h0-466" class="i">+-- Switching tabs with Mod1+{1,2,3,...}
</a><a href="#h0-467" id="h0-467" class="i">+mod1binds = {}
</a><a href="#h0-468" id="h0-468" class="i">+for i=1,10 do
</a><a href="#h0-469" id="h0-469" class="i">+    table.insert(mod1binds,
</a><a href="#h0-470" id="h0-470" class="i">+        key({&quot;Mod1&quot;}, tostring(i % 10), &quot;Jump to tab at index &quot;..i..&quot;.&quot;,
</a><a href="#h0-471" id="h0-471" class="i">+            function (w) w.tabs:switch(i) end))
</a><a href="#h0-472" id="h0-472" class="i">+end
</a><a href="#h0-473" id="h0-473" class="i">+add_binds(&quot;normal&quot;, mod1binds)
</a><a href="#h0-474" id="h0-474" class="i">+
</a><a href="#h0-475" id="h0-475" class="i">+-- Command bindings which are matched in the &quot;command&quot; mode from text
</a><a href="#h0-476" id="h0-476" class="i">+-- entered into the input bar.
</a><a href="#h0-477" id="h0-477" class="i">+add_cmds({
</a><a href="#h0-478" id="h0-478" class="i">+    buf(&quot;^%S+!&quot;,
</a><a href="#h0-479" id="h0-479" class="i">+        [[Detect bang syntax in `:command!` and recursively calls
</a><a href="#h0-480" id="h0-480" class="i">+        `lousy.bind.match_cmd(..)` removing the bang from the command string
</a><a href="#h0-481" id="h0-481" class="i">+        and setting `bang = true` in the bind opts table.]],
</a><a href="#h0-482" id="h0-482" class="i">+        function (w, cmd, opts)
</a><a href="#h0-483" id="h0-483" class="i">+            local cmd, args = string.match(cmd, &quot;^(%S+)!+(.*)&quot;)
</a><a href="#h0-484" id="h0-484" class="i">+            if cmd then
</a><a href="#h0-485" id="h0-485" class="i">+                opts = join(opts, { bang = true })
</a><a href="#h0-486" id="h0-486" class="i">+                return lousy.bind.match_cmd(w, opts.binds, cmd .. args, opts)
</a><a href="#h0-487" id="h0-487" class="i">+            end
</a><a href="#h0-488" id="h0-488" class="i">+        end),
</a><a href="#h0-489" id="h0-489" class="i">+
</a><a href="#h0-490" id="h0-490" class="i">+    cmd(&quot;c[lose]&quot;, &quot;Close current tab.&quot;,
</a><a href="#h0-491" id="h0-491" class="i">+        function (w) w:close_tab() end),
</a><a href="#h0-492" id="h0-492" class="i">+
</a><a href="#h0-493" id="h0-493" class="i">+    cmd(&quot;print&quot;, &quot;Print current page.&quot;,
</a><a href="#h0-494" id="h0-494" class="i">+        function (w) w.view:eval_js(&quot;print()&quot;) end),
</a><a href="#h0-495" id="h0-495" class="i">+
</a><a href="#h0-496" id="h0-496" class="i">+    cmd(&quot;stop&quot;, &quot;Stop loading.&quot;,
</a><a href="#h0-497" id="h0-497" class="i">+        function (w) w.view:stop() end),
</a><a href="#h0-498" id="h0-498" class="i">+
</a><a href="#h0-499" id="h0-499" class="i">+    cmd(&quot;reload&quot;, &quot;Reload page&quot;,
</a><a href="#h0-500" id="h0-500" class="i">+        function (w) w:reload() end),
</a><a href="#h0-501" id="h0-501" class="i">+
</a><a href="#h0-502" id="h0-502" class="i">+    cmd(&quot;restart&quot;, &quot;Restart browser (reload config files).&quot;,
</a><a href="#h0-503" id="h0-503" class="i">+        function (w) w:restart() end),
</a><a href="#h0-504" id="h0-504" class="i">+
</a><a href="#h0-505" id="h0-505" class="i">+    cmd(&quot;write&quot;, &quot;Save current session.&quot;,
</a><a href="#h0-506" id="h0-506" class="i">+        function (w) w:save_session() end),
</a><a href="#h0-507" id="h0-507" class="i">+
</a><a href="#h0-508" id="h0-508" class="i">+    cmd(&quot;noh[lsearch]&quot;, &quot;Clear search highlighting.&quot;,
</a><a href="#h0-509" id="h0-509" class="i">+        function (w) w:clear_search() end),
</a><a href="#h0-510" id="h0-510" class="i">+
</a><a href="#h0-511" id="h0-511" class="i">+    cmd(&quot;back&quot;, &quot;Go back in the browser history `[count=1]` items.&quot;,
</a><a href="#h0-512" id="h0-512" class="i">+        function (w, a) w:back(tonumber(a) or 1) end),
</a><a href="#h0-513" id="h0-513" class="i">+
</a><a href="#h0-514" id="h0-514" class="i">+    cmd(&quot;f[orward]&quot;, &quot;Go forward in the browser history `[count=1]` items.&quot;,
</a><a href="#h0-515" id="h0-515" class="i">+        function (w, a) w:forward(tonumber(a) or 1) end),
</a><a href="#h0-516" id="h0-516" class="i">+
</a><a href="#h0-517" id="h0-517" class="i">+    cmd(&quot;inc[rease]&quot;, &quot;Increment last number in URL.&quot;,
</a><a href="#h0-518" id="h0-518" class="i">+        function (w, a) w:navigate(w:inc_uri(tonumber(a) or 1)) end),
</a><a href="#h0-519" id="h0-519" class="i">+
</a><a href="#h0-520" id="h0-520" class="i">+    cmd(&quot;o[pen]&quot;, &quot;Open one or more URLs.&quot;,
</a><a href="#h0-521" id="h0-521" class="i">+        function (w, a) w:navigate(w:search_open(a)) end),
</a><a href="#h0-522" id="h0-522" class="i">+
</a><a href="#h0-523" id="h0-523" class="i">+    cmd(&quot;t[abopen]&quot;, &quot;Open one or more URLs in a new tab.&quot;,
</a><a href="#h0-524" id="h0-524" class="i">+        function (w, a) w:new_tab(w:search_open(a)) end),
</a><a href="#h0-525" id="h0-525" class="i">+
</a><a href="#h0-526" id="h0-526" class="i">+    cmd(&quot;w[inopen]&quot;, &quot;Open one or more URLs in a new window.&quot;,
</a><a href="#h0-527" id="h0-527" class="i">+        function (w, a) window.new{w:search_open(a)} end),
</a><a href="#h0-528" id="h0-528" class="i">+
</a><a href="#h0-529" id="h0-529" class="i">+    cmd({&quot;javascript&quot;, &quot;js&quot;}, &quot;Evaluate JavaScript snippet.&quot;,
</a><a href="#h0-530" id="h0-530" class="i">+        function (w, a) w.view:eval_js(a) end),
</a><a href="#h0-531" id="h0-531" class="i">+
</a><a href="#h0-532" id="h0-532" class="i">+    -- Tab manipulation commands
</a><a href="#h0-533" id="h0-533" class="i">+    cmd(&quot;tab&quot;, &quot;Execute command and open result in new tab.&quot;,
</a><a href="#h0-534" id="h0-534" class="i">+        function (w, a) w:new_tab() w:run_cmd(&quot;:&quot; .. a) end),
</a><a href="#h0-535" id="h0-535" class="i">+
</a><a href="#h0-536" id="h0-536" class="i">+    cmd(&quot;tabd[o]&quot;, &quot;Execute command in each tab.&quot;,
</a><a href="#h0-537" id="h0-537" class="i">+        function (w, a) w:each_tab(function (v) w:run_cmd(&quot;:&quot; .. a) end) end),
</a><a href="#h0-538" id="h0-538" class="i">+
</a><a href="#h0-539" id="h0-539" class="i">+    cmd(&quot;tabdu[plicate]&quot;, &quot;Duplicate current tab.&quot;,
</a><a href="#h0-540" id="h0-540" class="i">+        function (w) w:new_tab(w.view.history) end),
</a><a href="#h0-541" id="h0-541" class="i">+
</a><a href="#h0-542" id="h0-542" class="i">+    cmd(&quot;tabfir[st]&quot;, &quot;Switch to first tab.&quot;,
</a><a href="#h0-543" id="h0-543" class="i">+        function (w) w:goto_tab(1) end),
</a><a href="#h0-544" id="h0-544" class="i">+
</a><a href="#h0-545" id="h0-545" class="i">+    cmd(&quot;tabl[ast]&quot;, &quot;Switch to last tab.&quot;,
</a><a href="#h0-546" id="h0-546" class="i">+        function (w) w:goto_tab(-1) end),
</a><a href="#h0-547" id="h0-547" class="i">+
</a><a href="#h0-548" id="h0-548" class="i">+    cmd(&quot;tabn[ext]&quot;, &quot;Switch to the next tab.&quot;,
</a><a href="#h0-549" id="h0-549" class="i">+        function (w) w:next_tab() end),
</a><a href="#h0-550" id="h0-550" class="i">+
</a><a href="#h0-551" id="h0-551" class="i">+    cmd(&quot;tabp[revious]&quot;, &quot;Switch to the previous tab.&quot;,
</a><a href="#h0-552" id="h0-552" class="i">+        function (w) w:prev_tab() end),
</a><a href="#h0-553" id="h0-553" class="i">+
</a><a href="#h0-554" id="h0-554" class="i">+    cmd(&quot;q[uit]&quot;, &quot;Close the current window.&quot;,
</a><a href="#h0-555" id="h0-555" class="i">+        function (w, a, o) w:close_win(o.bang) end),
</a><a href="#h0-556" id="h0-556" class="i">+
</a><a href="#h0-557" id="h0-557" class="i">+    cmd({&quot;viewsource&quot;, &quot;vs&quot;}, &quot;View the source code of the current document.&quot;,
</a><a href="#h0-558" id="h0-558" class="i">+        function (w, a, o) w:toggle_source(not o.bang and true or nil) end),
</a><a href="#h0-559" id="h0-559" class="i">+
</a><a href="#h0-560" id="h0-560" class="i">+    cmd({&quot;wqall&quot;, &quot;wq&quot;}, &quot;Save the session and quit.&quot;,
</a><a href="#h0-561" id="h0-561" class="i">+        function (w, a, o) w:save_session() w:close_win(o.bang) end),
</a><a href="#h0-562" id="h0-562" class="i">+
</a><a href="#h0-563" id="h0-563" class="i">+    cmd(&quot;lua&quot;, &quot;Evaluate Lua snippet.&quot;, function (w, a)
</a><a href="#h0-564" id="h0-564" class="i">+        if a then
</a><a href="#h0-565" id="h0-565" class="i">+            local ret = assert(
</a><a href="#h0-566" id="h0-566" class="i">+                loadstring(&quot;return function(w) return &quot;..a..&quot; end&quot;))()(w)
</a><a href="#h0-567" id="h0-567" class="i">+            if ret then print(ret) end
</a><a href="#h0-568" id="h0-568" class="i">+        else
</a><a href="#h0-569" id="h0-569" class="i">+            w:set_mode(&quot;lua&quot;)
</a><a href="#h0-570" id="h0-570" class="i">+        end
</a><a href="#h0-571" id="h0-571" class="i">+    end),
</a><a href="#h0-572" id="h0-572" class="i">+
</a><a href="#h0-573" id="h0-573" class="i">+    cmd(&quot;dump&quot;, &quot;Dump current tabs html to file.&quot;,
</a><a href="#h0-574" id="h0-574" class="i">+        function (w, a)
</a><a href="#h0-575" id="h0-575" class="i">+            local fname = string.gsub(w.win.title, &apos;[^%w%.%-]&apos;, &apos;_&apos;)..&apos;.html&apos; -- sanitize filename
</a><a href="#h0-576" id="h0-576" class="i">+            local file = a or luakit.save_file(&quot;Save file&quot;, w.win, xdg.download_dir or &apos;.&apos;, fname)
</a><a href="#h0-577" id="h0-577" class="i">+            if file then
</a><a href="#h0-578" id="h0-578" class="i">+                local fd = assert(io.open(file, &quot;w&quot;), &quot;failed to open: &quot; .. file)
</a><a href="#h0-579" id="h0-579" class="i">+                local html = assert(w.view:eval_js(&quot;document.documentElement.outerHTML&quot;), &quot;Unable to get HTML&quot;)
</a><a href="#h0-580" id="h0-580" class="i">+                assert(fd:write(html), &quot;unable to save html&quot;)
</a><a href="#h0-581" id="h0-581" class="i">+                io.close(fd)
</a><a href="#h0-582" id="h0-582" class="i">+                w:notify(&quot;Dumped HTML to: &quot; .. file)
</a><a href="#h0-583" id="h0-583" class="i">+            end
</a><a href="#h0-584" id="h0-584" class="i">+        end),
</a><a href="#h0-585" id="h0-585" class="i">+})
</a><a href="#h0-586" id="h0-586" class="i">+
</a><a href="#h0-587" id="h0-587" class="i">+-- vim: et:sw=4:ts=8:sts=4:tw=80
</a><b>diff --git a/<a href="../file/home/.config/luakit/globals.lua.html">home/.config/luakit/globals.lua</a> b/<a href="../file/home/.config/luakit/globals.lua.html">home/.config/luakit/globals.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,83 @@
</a><a href="#h0-0" id="h0-0" class="i">+-- Global variables for luakit
</a><a href="#h0-1" id="h0-1" class="i">+globals = {
</a><a href="#h0-2" id="h0-2" class="i">+    homepage            = &quot;about:blank/&quot;,
</a><a href="#h0-3" id="h0-3" class="i">+    scroll_step         = 40,
</a><a href="#h0-4" id="h0-4" class="i">+    zoom_step           = 0.1,
</a><a href="#h0-5" id="h0-5" class="i">+    max_cmd_history     = 100,
</a><a href="#h0-6" id="h0-6" class="i">+    max_srch_history    = 100,
</a><a href="#h0-7" id="h0-7" class="i">+    default_window_size = &quot;800x600&quot;,
</a><a href="#h0-8" id="h0-8" class="i">+
</a><a href="#h0-9" id="h0-9" class="i">+ -- Disables loading of hostnames from /etc/hosts (for large host files)
</a><a href="#h0-10" id="h0-10" class="i">+ -- load_etc_hosts      = false,
</a><a href="#h0-11" id="h0-11" class="i">+ -- Disables checking if a filepath exists in search_open function
</a><a href="#h0-12" id="h0-12" class="i">+ -- check_filepath      = false,
</a><a href="#h0-13" id="h0-13" class="i">+}
</a><a href="#h0-14" id="h0-14" class="i">+
</a><a href="#h0-15" id="h0-15" class="i">+-- Make useragent
</a><a href="#h0-16" id="h0-16" class="i">+local _, arch = luakit.spawn_sync(&quot;uname -sm&quot;)
</a><a href="#h0-17" id="h0-17" class="i">+-- Only use the luakit version if in date format (reduces identifiability)
</a><a href="#h0-18" id="h0-18" class="i">+local lkv = string.match(luakit.version, &quot;^(%d+.%d+.%d+)&quot;)
</a><a href="#h0-19" id="h0-19" class="i">+globals.useragent = string.format(&quot;Mozilla/5.0 (%s) AppleWebKit/%s+ (KHTML, like Gecko) Chrome/24 WebKitGTK+/%s luakit%s&quot;, -- Notice the Chrome hack
</a><a href="#h0-20" id="h0-20" class="i">+    string.sub(arch, 1, -2), luakit.webkit_user_agent_version,
</a><a href="#h0-21" id="h0-21" class="i">+    luakit.webkit_version, (lkv and (&quot;/&quot; .. lkv)) or &quot;&quot;)
</a><a href="#h0-22" id="h0-22" class="i">+
</a><a href="#h0-23" id="h0-23" class="i">+-- Search common locations for a ca file which is used for ssl connection validation.
</a><a href="#h0-24" id="h0-24" class="i">+local ca_files = {
</a><a href="#h0-25" id="h0-25" class="i">+    -- $XDG_DATA_HOME/luakit/ca-certificates.crt
</a><a href="#h0-26" id="h0-26" class="i">+    luakit.data_dir .. &quot;/ca-certificates.crt&quot;,
</a><a href="#h0-27" id="h0-27" class="i">+    &quot;/etc/certs/ca-certificates.crt&quot;,
</a><a href="#h0-28" id="h0-28" class="i">+    &quot;/etc/ssl/certs/ca-certificates.crt&quot;,
</a><a href="#h0-29" id="h0-29" class="i">+}
</a><a href="#h0-30" id="h0-30" class="i">+-- Use the first ca-file found
</a><a href="#h0-31" id="h0-31" class="i">+for _, ca_file in ipairs(ca_files) do
</a><a href="#h0-32" id="h0-32" class="i">+    if os.exists(ca_file) then
</a><a href="#h0-33" id="h0-33" class="i">+        soup.ssl_ca_file = ca_file
</a><a href="#h0-34" id="h0-34" class="i">+        break
</a><a href="#h0-35" id="h0-35" class="i">+    end
</a><a href="#h0-36" id="h0-36" class="i">+end
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+-- Change to stop navigation sites with invalid or expired ssl certificates
</a><a href="#h0-39" id="h0-39" class="i">+soup.ssl_strict = false
</a><a href="#h0-40" id="h0-40" class="i">+
</a><a href="#h0-41" id="h0-41" class="i">+-- Set cookie acceptance policy
</a><a href="#h0-42" id="h0-42" class="i">+cookie_policy = { always = 0, never = 1, no_third_party = 2 }
</a><a href="#h0-43" id="h0-43" class="i">+soup.accept_policy = cookie_policy.always
</a><a href="#h0-44" id="h0-44" class="i">+
</a><a href="#h0-45" id="h0-45" class="i">+-- List of search engines. Each item must contain a single %s which is
</a><a href="#h0-46" id="h0-46" class="i">+-- replaced by URI encoded search terms. All other occurances of the percent
</a><a href="#h0-47" id="h0-47" class="i">+-- character (%) may need to be escaped by placing another % before or after
</a><a href="#h0-48" id="h0-48" class="i">+-- it to avoid collisions with lua&apos;s string.format characters.
</a><a href="#h0-49" id="h0-49" class="i">+-- See: http://www.lua.org/manual/5.1/manual.html#pdf-string.format
</a><a href="#h0-50" id="h0-50" class="i">+search_engines = {
</a><a href="#h0-51" id="h0-51" class="i">+    duckduckgo  = &quot;https://duckduckgo.com/?q=%s&quot;,
</a><a href="#h0-52" id="h0-52" class="i">+    github      = &quot;https://github.com/search?q=%s&quot;,
</a><a href="#h0-53" id="h0-53" class="i">+    google      = &quot;https://google.com/search?q=%s&quot;,
</a><a href="#h0-54" id="h0-54" class="i">+    imdb        = &quot;http://www.imdb.com/find?s=all&amp;q=%s&quot;,
</a><a href="#h0-55" id="h0-55" class="i">+    wikipedia   = &quot;https://en.wikipedia.org/wiki/Special:Search?search=%s&quot;,
</a><a href="#h0-56" id="h0-56" class="i">+}
</a><a href="#h0-57" id="h0-57" class="i">+
</a><a href="#h0-58" id="h0-58" class="i">+-- Set google as fallback search engine
</a><a href="#h0-59" id="h0-59" class="i">+search_engines.default = search_engines.duckduckgo
</a><a href="#h0-60" id="h0-60" class="i">+-- Use this instead to disable auto-searching
</a><a href="#h0-61" id="h0-61" class="i">+--search_engines.default = &quot;%s&quot;
</a><a href="#h0-62" id="h0-62" class="i">+
</a><a href="#h0-63" id="h0-63" class="i">+-- Per-domain webview properties
</a><a href="#h0-64" id="h0-64" class="i">+-- See http://webkitgtk.org/reference/webkitgtk/stable/WebKitWebSettings.html
</a><a href="#h0-65" id="h0-65" class="i">+domain_props = { --[[
</a><a href="#h0-66" id="h0-66" class="i">+    [&quot;all&quot;] = {
</a><a href="#h0-67" id="h0-67" class="i">+        enable_scripts          = false,
</a><a href="#h0-68" id="h0-68" class="i">+        enable_plugins          = false,
</a><a href="#h0-69" id="h0-69" class="i">+        enable_private_browsing = false,
</a><a href="#h0-70" id="h0-70" class="i">+        user_stylesheet_uri     = &quot;&quot;,
</a><a href="#h0-71" id="h0-71" class="i">+    },
</a><a href="#h0-72" id="h0-72" class="i">+    [&quot;youtube.com&quot;] = {
</a><a href="#h0-73" id="h0-73" class="i">+        enable_scripts = true,
</a><a href="#h0-74" id="h0-74" class="i">+        enable_plugins = true,
</a><a href="#h0-75" id="h0-75" class="i">+    },
</a><a href="#h0-76" id="h0-76" class="i">+    [&quot;bbs.archlinux.org&quot;] = {
</a><a href="#h0-77" id="h0-77" class="i">+        user_stylesheet_uri     = &quot;file://&quot; .. luakit.data_dir .. &quot;/styles/dark.css&quot;,
</a><a href="#h0-78" id="h0-78" class="i">+        enable_private_browsing = true,
</a><a href="#h0-79" id="h0-79" class="i">+    }, ]]
</a><a href="#h0-80" id="h0-80" class="i">+}
</a><a href="#h0-81" id="h0-81" class="i">+
</a><a href="#h0-82" id="h0-82" class="i">+-- vim: et:sw=4:ts=8:sts=4:tw=80
</a><b>diff --git a/<a href="../file/home/.config/luakit/luakit-adblock.html">home/.config/luakit/luakit-adblock</a> b/<a href="../file/home/.config/luakit/luakit-adblock.html">home/.config/luakit/luakit-adblock</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1 @@
</a><a href="#h0-0" id="h0-0" class="i">+Subproject commit 865340c70921cccb1f3c490c2d4dd09bef269f16
</a><b>diff --git a/<a href="../file/home/.config/luakit/modes.lua.html">home/.config/luakit/modes.lua</a> b/<a href="../file/home/.config/luakit/modes.lua.html">home/.config/luakit/modes.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,163 @@
</a><a href="#h0-0" id="h0-0" class="i">+-------------------------------
</a><a href="#h0-1" id="h0-1" class="i">+-- luakit mode configuration --
</a><a href="#h0-2" id="h0-2" class="i">+-------------------------------
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+-- Table of modes and their callback hooks
</a><a href="#h0-5" id="h0-5" class="i">+local modes = {}
</a><a href="#h0-6" id="h0-6" class="i">+local lousy = require &quot;lousy&quot;
</a><a href="#h0-7" id="h0-7" class="i">+local join = lousy.util.table.join
</a><a href="#h0-8" id="h0-8" class="i">+local order = 0
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+-- Add new mode table (optionally merges with original mode)
</a><a href="#h0-11" id="h0-11" class="i">+function new_mode(name, desc, mode, replace)
</a><a href="#h0-12" id="h0-12" class="i">+    assert(string.match(name, &quot;^[%w-_]+$&quot;), &quot;invalid mode name: &quot; .. name)
</a><a href="#h0-13" id="h0-13" class="i">+    -- Detect optional description
</a><a href="#h0-14" id="h0-14" class="i">+    if type(desc) == &quot;table&quot; then
</a><a href="#h0-15" id="h0-15" class="i">+        desc, mode, replace = nil, desc, mode
</a><a href="#h0-16" id="h0-16" class="i">+    end
</a><a href="#h0-17" id="h0-17" class="i">+    local traceback = debug.traceback(&quot;Creation traceback:&quot;, 2)
</a><a href="#h0-18" id="h0-18" class="i">+    order = order + 1
</a><a href="#h0-19" id="h0-19" class="i">+    modes[name] = join({ order = order, traceback = traceback },
</a><a href="#h0-20" id="h0-20" class="i">+        (not replace and modes[name]) or {}, mode or {},
</a><a href="#h0-21" id="h0-21" class="i">+        { name = name, desc = desc })
</a><a href="#h0-22" id="h0-22" class="i">+end
</a><a href="#h0-23" id="h0-23" class="i">+
</a><a href="#h0-24" id="h0-24" class="i">+-- Get mode table
</a><a href="#h0-25" id="h0-25" class="i">+function get_mode(name) return modes[name] end
</a><a href="#h0-26" id="h0-26" class="i">+
</a><a href="#h0-27" id="h0-27" class="i">+function get_modes() return lousy.util.table.clone(modes) end
</a><a href="#h0-28" id="h0-28" class="i">+
</a><a href="#h0-29" id="h0-29" class="i">+-- Attach window &amp; input bar signals for mode hooks
</a><a href="#h0-30" id="h0-30" class="i">+window.init_funcs.modes_setup = function (w)
</a><a href="#h0-31" id="h0-31" class="i">+    -- Calls the `enter` and `leave` mode hooks.
</a><a href="#h0-32" id="h0-32" class="i">+    w:add_signal(&quot;mode-changed&quot;, function (_, name, ...)
</a><a href="#h0-33" id="h0-33" class="i">+        local leave = (w.mode or {}).leave
</a><a href="#h0-34" id="h0-34" class="i">+
</a><a href="#h0-35" id="h0-35" class="i">+        -- Get new modes functions/hooks/data
</a><a href="#h0-36" id="h0-36" class="i">+        local mode = assert(modes[name], &quot;invalid mode: &quot; .. name)
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+        -- Call last modes leave hook.
</a><a href="#h0-39" id="h0-39" class="i">+        if leave then leave(w) end
</a><a href="#h0-40" id="h0-40" class="i">+
</a><a href="#h0-41" id="h0-41" class="i">+        -- Create w.mode object
</a><a href="#h0-42" id="h0-42" class="i">+        w.mode = mode
</a><a href="#h0-43" id="h0-43" class="i">+
</a><a href="#h0-44" id="h0-44" class="i">+        -- Update window binds
</a><a href="#h0-45" id="h0-45" class="i">+        w:update_binds(name)
</a><a href="#h0-46" id="h0-46" class="i">+
</a><a href="#h0-47" id="h0-47" class="i">+        -- Call new modes enter hook.
</a><a href="#h0-48" id="h0-48" class="i">+        if mode.enter then mode.enter(w, ...) end
</a><a href="#h0-49" id="h0-49" class="i">+
</a><a href="#h0-50" id="h0-50" class="i">+        w:emit_signal(&quot;mode-entered&quot;, mode)
</a><a href="#h0-51" id="h0-51" class="i">+    end)
</a><a href="#h0-52" id="h0-52" class="i">+
</a><a href="#h0-53" id="h0-53" class="i">+    local input = w.ibar.input
</a><a href="#h0-54" id="h0-54" class="i">+
</a><a href="#h0-55" id="h0-55" class="i">+    -- Calls the changed hook on input widget changed.
</a><a href="#h0-56" id="h0-56" class="i">+    input:add_signal(&quot;changed&quot;, function ()
</a><a href="#h0-57" id="h0-57" class="i">+        local changed = w.mode.changed
</a><a href="#h0-58" id="h0-58" class="i">+        if changed then changed(w, input.text) end
</a><a href="#h0-59" id="h0-59" class="i">+    end)
</a><a href="#h0-60" id="h0-60" class="i">+
</a><a href="#h0-61" id="h0-61" class="i">+    input:add_signal(&quot;property::position&quot;, function ()
</a><a href="#h0-62" id="h0-62" class="i">+        local move_cursor = w.mode.move_cursor
</a><a href="#h0-63" id="h0-63" class="i">+        if move_cursor then move_cursor(w, input.position) end
</a><a href="#h0-64" id="h0-64" class="i">+    end)
</a><a href="#h0-65" id="h0-65" class="i">+
</a><a href="#h0-66" id="h0-66" class="i">+    -- Calls the `activate` hook on input widget activate.
</a><a href="#h0-67" id="h0-67" class="i">+    input:add_signal(&quot;activate&quot;, function ()
</a><a href="#h0-68" id="h0-68" class="i">+        local mode = w.mode
</a><a href="#h0-69" id="h0-69" class="i">+        if mode and mode.activate then
</a><a href="#h0-70" id="h0-70" class="i">+            local text, hist = input.text, mode.history
</a><a href="#h0-71" id="h0-71" class="i">+            if mode.activate(w, text) == false then return end
</a><a href="#h0-72" id="h0-72" class="i">+            -- Check if last history item is identical
</a><a href="#h0-73" id="h0-73" class="i">+            if hist and hist.items and hist.items[hist.len or -1] ~= text then
</a><a href="#h0-74" id="h0-74" class="i">+                table.insert(hist.items, text)
</a><a href="#h0-75" id="h0-75" class="i">+            end
</a><a href="#h0-76" id="h0-76" class="i">+        end
</a><a href="#h0-77" id="h0-77" class="i">+    end)
</a><a href="#h0-78" id="h0-78" class="i">+end
</a><a href="#h0-79" id="h0-79" class="i">+
</a><a href="#h0-80" id="h0-80" class="i">+-- Add mode related window methods
</a><a href="#h0-81" id="h0-81" class="i">+window.methods.set_mode = lousy.mode.set
</a><a href="#h0-82" id="h0-82" class="i">+local mget = lousy.mode.get
</a><a href="#h0-83" id="h0-83" class="i">+window.methods.is_mode = function (w, name) return name == mget(w) end
</a><a href="#h0-84" id="h0-84" class="i">+
</a><a href="#h0-85" id="h0-85" class="i">+-- Setup normal mode
</a><a href="#h0-86" id="h0-86" class="i">+new_mode(&quot;normal&quot;, [[When luakit first starts you will find yourself in this
</a><a href="#h0-87" id="h0-87" class="i">+    mode.]], {
</a><a href="#h0-88" id="h0-88" class="i">+    enter = function (w)
</a><a href="#h0-89" id="h0-89" class="i">+        w:set_prompt()
</a><a href="#h0-90" id="h0-90" class="i">+        w:set_input()
</a><a href="#h0-91" id="h0-91" class="i">+    end,
</a><a href="#h0-92" id="h0-92" class="i">+})
</a><a href="#h0-93" id="h0-93" class="i">+
</a><a href="#h0-94" id="h0-94" class="i">+new_mode(&quot;all&quot;, [[Special meta-mode in which the bindings for this mode are
</a><a href="#h0-95" id="h0-95" class="i">+    present in all modes.]])
</a><a href="#h0-96" id="h0-96" class="i">+
</a><a href="#h0-97" id="h0-97" class="i">+-- Setup insert mode
</a><a href="#h0-98" id="h0-98" class="i">+new_mode(&quot;insert&quot;, [[When clicking on form fields luakit will enter the insert
</a><a href="#h0-99" id="h0-99" class="i">+    mode which allows you to enter text in form fields without accidentally
</a><a href="#h0-100" id="h0-100" class="i">+    triggering normal mode bindings.]], {
</a><a href="#h0-101" id="h0-101" class="i">+    enter = function (w)
</a><a href="#h0-102" id="h0-102" class="i">+        w:set_prompt(&quot;-- INSERT --&quot;)
</a><a href="#h0-103" id="h0-103" class="i">+        w:set_input()
</a><a href="#h0-104" id="h0-104" class="i">+        w.view:focus()
</a><a href="#h0-105" id="h0-105" class="i">+    end,
</a><a href="#h0-106" id="h0-106" class="i">+    -- Send key events to webview
</a><a href="#h0-107" id="h0-107" class="i">+    passthrough = true,
</a><a href="#h0-108" id="h0-108" class="i">+})
</a><a href="#h0-109" id="h0-109" class="i">+
</a><a href="#h0-110" id="h0-110" class="i">+new_mode(&quot;passthrough&quot;, [[Luakit will pass every key event to the WebView
</a><a href="#h0-111" id="h0-111" class="i">+    until the user presses Escape.]], {
</a><a href="#h0-112" id="h0-112" class="i">+    enter = function (w)
</a><a href="#h0-113" id="h0-113" class="i">+        w:set_prompt(&quot;-- PASS THROUGH --&quot;)
</a><a href="#h0-114" id="h0-114" class="i">+        w:set_input()
</a><a href="#h0-115" id="h0-115" class="i">+    end,
</a><a href="#h0-116" id="h0-116" class="i">+    -- Send key events to webview
</a><a href="#h0-117" id="h0-117" class="i">+    passthrough = true,
</a><a href="#h0-118" id="h0-118" class="i">+    -- Don&apos;t exit mode when clicking outside of form fields
</a><a href="#h0-119" id="h0-119" class="i">+    reset_on_focus = false,
</a><a href="#h0-120" id="h0-120" class="i">+    -- Don&apos;t exit mode on navigation
</a><a href="#h0-121" id="h0-121" class="i">+    reset_on_navigation = false,
</a><a href="#h0-122" id="h0-122" class="i">+})
</a><a href="#h0-123" id="h0-123" class="i">+
</a><a href="#h0-124" id="h0-124" class="i">+-- Setup command mode
</a><a href="#h0-125" id="h0-125" class="i">+new_mode(&quot;command&quot;, [[Enter commands.]], {
</a><a href="#h0-126" id="h0-126" class="i">+    enter = function (w)
</a><a href="#h0-127" id="h0-127" class="i">+        w:set_prompt()
</a><a href="#h0-128" id="h0-128" class="i">+        w:set_input(&quot;:&quot;)
</a><a href="#h0-129" id="h0-129" class="i">+    end,
</a><a href="#h0-130" id="h0-130" class="i">+    changed = function (w, text)
</a><a href="#h0-131" id="h0-131" class="i">+        -- Auto-exit command mode if user backspaces &quot;:&quot; in the input bar.
</a><a href="#h0-132" id="h0-132" class="i">+        if not string.match(text, &quot;^:&quot;) then w:set_mode() end
</a><a href="#h0-133" id="h0-133" class="i">+    end,
</a><a href="#h0-134" id="h0-134" class="i">+    activate = function (w, text)
</a><a href="#h0-135" id="h0-135" class="i">+        w:set_mode()
</a><a href="#h0-136" id="h0-136" class="i">+        local cmd = string.sub(text, 2)
</a><a href="#h0-137" id="h0-137" class="i">+        if not string.find(cmd, &quot;%S&quot;) then return end
</a><a href="#h0-138" id="h0-138" class="i">+
</a><a href="#h0-139" id="h0-139" class="i">+        local success, match = xpcall(
</a><a href="#h0-140" id="h0-140" class="i">+            function () return w:match_cmd(cmd) end,
</a><a href="#h0-141" id="h0-141" class="i">+            function (err) w:error(debug.traceback(err, 3)) end)
</a><a href="#h0-142" id="h0-142" class="i">+
</a><a href="#h0-143" id="h0-143" class="i">+        if success and not match then
</a><a href="#h0-144" id="h0-144" class="i">+            w:error(string.format(&quot;Not a browser command: %q&quot;, cmd))
</a><a href="#h0-145" id="h0-145" class="i">+        end
</a><a href="#h0-146" id="h0-146" class="i">+    end,
</a><a href="#h0-147" id="h0-147" class="i">+    history = {maxlen = 50},
</a><a href="#h0-148" id="h0-148" class="i">+})
</a><a href="#h0-149" id="h0-149" class="i">+
</a><a href="#h0-150" id="h0-150" class="i">+new_mode(&quot;lua&quot;, [[Execute arbitrary Lua commands within the luakit
</a><a href="#h0-151" id="h0-151" class="i">+    environment.]], {
</a><a href="#h0-152" id="h0-152" class="i">+    enter = function (w)
</a><a href="#h0-153" id="h0-153" class="i">+        w:set_prompt(&quot;&gt;&quot;)
</a><a href="#h0-154" id="h0-154" class="i">+        w:set_input(&quot;&quot;)
</a><a href="#h0-155" id="h0-155" class="i">+    end,
</a><a href="#h0-156" id="h0-156" class="i">+    activate = function (w, text)
</a><a href="#h0-157" id="h0-157" class="i">+        w:set_input(&quot;&quot;)
</a><a href="#h0-158" id="h0-158" class="i">+        local ret = assert(loadstring(&quot;return function(w) return &quot;..text..&quot; end&quot;))()(w)
</a><a href="#h0-159" id="h0-159" class="i">+        if ret then print(ret) end
</a><a href="#h0-160" id="h0-160" class="i">+    end,
</a><a href="#h0-161" id="h0-161" class="i">+    history = {maxlen = 50},
</a><a href="#h0-162" id="h0-162" class="i">+})
</a><b>diff --git a/<a href="../file/home/.config/luakit/rc.lua.html">home/.config/luakit/rc.lua</a> b/<a href="../file/home/.config/luakit/rc.lua.html">home/.config/luakit/rc.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,184 @@
</a><a href="#h0-0" id="h0-0" class="i">+-----------------------------------------------------------------------
</a><a href="#h0-1" id="h0-1" class="i">+-- luakit configuration file, more information at http://luakit.org/ --
</a><a href="#h0-2" id="h0-2" class="i">+-----------------------------------------------------------------------
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+require &quot;lfs&quot;
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+if unique then
</a><a href="#h0-7" id="h0-7" class="i">+    unique.new(&quot;org.luakit&quot;)
</a><a href="#h0-8" id="h0-8" class="i">+    -- Check for a running luakit instance
</a><a href="#h0-9" id="h0-9" class="i">+    if unique.is_running() then
</a><a href="#h0-10" id="h0-10" class="i">+        if uris[1] then
</a><a href="#h0-11" id="h0-11" class="i">+            for _, uri in ipairs(uris) do
</a><a href="#h0-12" id="h0-12" class="i">+                if lfs.attributes(uri) then uri = os.abspath(uri) end
</a><a href="#h0-13" id="h0-13" class="i">+                unique.send_message(&quot;tabopen &quot; .. uri)
</a><a href="#h0-14" id="h0-14" class="i">+            end
</a><a href="#h0-15" id="h0-15" class="i">+        else
</a><a href="#h0-16" id="h0-16" class="i">+            unique.send_message(&quot;winopen&quot;)
</a><a href="#h0-17" id="h0-17" class="i">+        end
</a><a href="#h0-18" id="h0-18" class="i">+        luakit.quit()
</a><a href="#h0-19" id="h0-19" class="i">+    end
</a><a href="#h0-20" id="h0-20" class="i">+end
</a><a href="#h0-21" id="h0-21" class="i">+
</a><a href="#h0-22" id="h0-22" class="i">+-- Load library of useful functions for luakit
</a><a href="#h0-23" id="h0-23" class="i">+require &quot;lousy&quot;
</a><a href="#h0-24" id="h0-24" class="i">+
</a><a href="#h0-25" id="h0-25" class="i">+-- Small util functions to print output (info prints only when luakit.verbose is true)
</a><a href="#h0-26" id="h0-26" class="i">+function warn(...) io.stderr:write(string.format(...) .. &quot;\n&quot;) end
</a><a href="#h0-27" id="h0-27" class="i">+function info(...) if luakit.verbose then io.stdout:write(string.format(...) .. &quot;\n&quot;) end end
</a><a href="#h0-28" id="h0-28" class="i">+
</a><a href="#h0-29" id="h0-29" class="i">+-- Load users global config
</a><a href="#h0-30" id="h0-30" class="i">+-- (&quot;$XDG_CONFIG_HOME/luakit/globals.lua&quot; or &quot;/etc/xdg/luakit/globals.lua&quot;)
</a><a href="#h0-31" id="h0-31" class="i">+require &quot;globals&quot;
</a><a href="#h0-32" id="h0-32" class="i">+
</a><a href="#h0-33" id="h0-33" class="i">+-- Load users theme
</a><a href="#h0-34" id="h0-34" class="i">+-- (&quot;$XDG_CONFIG_HOME/luakit/theme.lua&quot; or &quot;/etc/xdg/luakit/theme.lua&quot;)
</a><a href="#h0-35" id="h0-35" class="i">+lousy.theme.init(lousy.util.find_config(&quot;theme.lua&quot;))
</a><a href="#h0-36" id="h0-36" class="i">+theme = assert(lousy.theme.get(), &quot;failed to load theme&quot;)
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+-- Load users window class
</a><a href="#h0-39" id="h0-39" class="i">+-- (&quot;$XDG_CONFIG_HOME/luakit/window.lua&quot; or &quot;/etc/xdg/luakit/window.lua&quot;)
</a><a href="#h0-40" id="h0-40" class="i">+require &quot;window&quot;
</a><a href="#h0-41" id="h0-41" class="i">+
</a><a href="#h0-42" id="h0-42" class="i">+-- Load users webview class
</a><a href="#h0-43" id="h0-43" class="i">+-- (&quot;$XDG_CONFIG_HOME/luakit/webview.lua&quot; or &quot;/etc/xdg/luakit/webview.lua&quot;)
</a><a href="#h0-44" id="h0-44" class="i">+require &quot;webview&quot;
</a><a href="#h0-45" id="h0-45" class="i">+
</a><a href="#h0-46" id="h0-46" class="i">+-- Load users mode configuration
</a><a href="#h0-47" id="h0-47" class="i">+-- (&quot;$XDG_CONFIG_HOME/luakit/modes.lua&quot; or &quot;/etc/xdg/luakit/modes.lua&quot;)
</a><a href="#h0-48" id="h0-48" class="i">+require &quot;modes&quot;
</a><a href="#h0-49" id="h0-49" class="i">+
</a><a href="#h0-50" id="h0-50" class="i">+-- Load users keybindings
</a><a href="#h0-51" id="h0-51" class="i">+-- (&quot;$XDG_CONFIG_HOME/luakit/binds.lua&quot; or &quot;/etc/xdg/luakit/binds.lua&quot;)
</a><a href="#h0-52" id="h0-52" class="i">+require &quot;binds&quot;
</a><a href="#h0-53" id="h0-53" class="i">+
</a><a href="#h0-54" id="h0-54" class="i">+----------------------------------
</a><a href="#h0-55" id="h0-55" class="i">+-- Optional user script loading --
</a><a href="#h0-56" id="h0-56" class="i">+----------------------------------
</a><a href="#h0-57" id="h0-57" class="i">+
</a><a href="#h0-58" id="h0-58" class="i">+require &quot;webinspector&quot;
</a><a href="#h0-59" id="h0-59" class="i">+
</a><a href="#h0-60" id="h0-60" class="i">+-- Add sqlite3 cookiejar
</a><a href="#h0-61" id="h0-61" class="i">+require &quot;cookies&quot;
</a><a href="#h0-62" id="h0-62" class="i">+
</a><a href="#h0-63" id="h0-63" class="i">+-- Cookie blocking by domain (extends cookies module)
</a><a href="#h0-64" id="h0-64" class="i">+-- Add domains to the whitelist at &quot;$XDG_CONFIG_HOME/luakit/cookie.whitelist&quot;
</a><a href="#h0-65" id="h0-65" class="i">+-- and blacklist at &quot;$XDG_CONFIG_HOME/luakit/cookie.blacklist&quot;.
</a><a href="#h0-66" id="h0-66" class="i">+-- Each domain must be on it&apos;s own line and you may use &quot;*&quot; as a
</a><a href="#h0-67" id="h0-67" class="i">+-- wildcard character (I.e. &quot;*google.com&quot;)
</a><a href="#h0-68" id="h0-68" class="i">+--require &quot;cookie_blocking&quot;
</a><a href="#h0-69" id="h0-69" class="i">+
</a><a href="#h0-70" id="h0-70" class="i">+-- Block all cookies by default (unless whitelisted)
</a><a href="#h0-71" id="h0-71" class="i">+--cookies.default_allow = false
</a><a href="#h0-72" id="h0-72" class="i">+
</a><a href="#h0-73" id="h0-73" class="i">+-- Add uzbl-like form filling
</a><a href="#h0-74" id="h0-74" class="i">+require &quot;formfiller&quot;
</a><a href="#h0-75" id="h0-75" class="i">+
</a><a href="#h0-76" id="h0-76" class="i">+-- Add proxy support &amp; manager
</a><a href="#h0-77" id="h0-77" class="i">+require &quot;proxy&quot;
</a><a href="#h0-78" id="h0-78" class="i">+
</a><a href="#h0-79" id="h0-79" class="i">+-- Add quickmarks support &amp; manager
</a><a href="#h0-80" id="h0-80" class="i">+require &quot;quickmarks&quot;
</a><a href="#h0-81" id="h0-81" class="i">+
</a><a href="#h0-82" id="h0-82" class="i">+-- Add session saving/loading support
</a><a href="#h0-83" id="h0-83" class="i">+require &quot;session&quot;
</a><a href="#h0-84" id="h0-84" class="i">+
</a><a href="#h0-85" id="h0-85" class="i">+-- Add command to list closed tabs &amp; bind to open closed tabs
</a><a href="#h0-86" id="h0-86" class="i">+require &quot;undoclose&quot;
</a><a href="#h0-87" id="h0-87" class="i">+
</a><a href="#h0-88" id="h0-88" class="i">+-- Add command to list tab history items
</a><a href="#h0-89" id="h0-89" class="i">+require &quot;tabhistory&quot;
</a><a href="#h0-90" id="h0-90" class="i">+
</a><a href="#h0-91" id="h0-91" class="i">+-- Add greasemonkey-like javascript userscript support
</a><a href="#h0-92" id="h0-92" class="i">+require &quot;userscripts&quot;
</a><a href="#h0-93" id="h0-93" class="i">+
</a><a href="#h0-94" id="h0-94" class="i">+-- Add bookmarks support
</a><a href="#h0-95" id="h0-95" class="i">+require &quot;bookmarks&quot;
</a><a href="#h0-96" id="h0-96" class="i">+require &quot;bookmarks_chrome&quot;
</a><a href="#h0-97" id="h0-97" class="i">+
</a><a href="#h0-98" id="h0-98" class="i">+-- Add download support
</a><a href="#h0-99" id="h0-99" class="i">+require &quot;downloads&quot;
</a><a href="#h0-100" id="h0-100" class="i">+require &quot;downloads_chrome&quot;
</a><a href="#h0-101" id="h0-101" class="i">+
</a><a href="#h0-102" id="h0-102" class="i">+-- Example using xdg-open for opening downloads / showing download folders
</a><a href="#h0-103" id="h0-103" class="i">+downloads.add_signal(&quot;open-file&quot;, function (file, mime)
</a><a href="#h0-104" id="h0-104" class="i">+    luakit.spawn(string.format(&quot;xdg-open %q&quot;, file))
</a><a href="#h0-105" id="h0-105" class="i">+    return true
</a><a href="#h0-106" id="h0-106" class="i">+end)
</a><a href="#h0-107" id="h0-107" class="i">+
</a><a href="#h0-108" id="h0-108" class="i">+-- Add vimperator-like link hinting &amp; following
</a><a href="#h0-109" id="h0-109" class="i">+require &quot;follow&quot;
</a><a href="#h0-110" id="h0-110" class="i">+
</a><a href="#h0-111" id="h0-111" class="i">+-- Use a custom charater set for hint labels
</a><a href="#h0-112" id="h0-112" class="i">+--local s = follow.label_styles
</a><a href="#h0-113" id="h0-113" class="i">+--follow.label_maker = s.sort(s.reverse(s.charset(&quot;asdfqwerzxcv&quot;)))
</a><a href="#h0-114" id="h0-114" class="i">+
</a><a href="#h0-115" id="h0-115" class="i">+-- Match only hint labels
</a><a href="#h0-116" id="h0-116" class="i">+--follow.pattern_maker = follow.pattern_styles.match_label
</a><a href="#h0-117" id="h0-117" class="i">+
</a><a href="#h0-118" id="h0-118" class="i">+-- Add command history
</a><a href="#h0-119" id="h0-119" class="i">+require &quot;cmdhist&quot;
</a><a href="#h0-120" id="h0-120" class="i">+
</a><a href="#h0-121" id="h0-121" class="i">+-- Add search mode &amp; binds
</a><a href="#h0-122" id="h0-122" class="i">+require &quot;search&quot;
</a><a href="#h0-123" id="h0-123" class="i">+
</a><a href="#h0-124" id="h0-124" class="i">+-- Add ordering of new tabs
</a><a href="#h0-125" id="h0-125" class="i">+require &quot;taborder&quot;
</a><a href="#h0-126" id="h0-126" class="i">+
</a><a href="#h0-127" id="h0-127" class="i">+-- Save web history
</a><a href="#h0-128" id="h0-128" class="i">+require &quot;history&quot;
</a><a href="#h0-129" id="h0-129" class="i">+require &quot;history_chrome&quot;
</a><a href="#h0-130" id="h0-130" class="i">+
</a><a href="#h0-131" id="h0-131" class="i">+require &quot;introspector&quot;
</a><a href="#h0-132" id="h0-132" class="i">+
</a><a href="#h0-133" id="h0-133" class="i">+-- Add command completion
</a><a href="#h0-134" id="h0-134" class="i">+require &quot;completion&quot;
</a><a href="#h0-135" id="h0-135" class="i">+
</a><a href="#h0-136" id="h0-136" class="i">+-- NoScript plugin, toggle scripts and or plugins on a per-domain basis.
</a><a href="#h0-137" id="h0-137" class="i">+-- `,ts` to toggle scripts, `,tp` to toggle plugins, `,tr` to reset.
</a><a href="#h0-138" id="h0-138" class="i">+-- Remove all &quot;enable_scripts&quot; &amp; &quot;enable_plugins&quot; lines from your
</a><a href="#h0-139" id="h0-139" class="i">+-- domain_props table (in config/globals.lua) as this module will conflict.
</a><a href="#h0-140" id="h0-140" class="i">+--require &quot;noscript&quot;
</a><a href="#h0-141" id="h0-141" class="i">+
</a><a href="#h0-142" id="h0-142" class="i">+require &quot;./luakit-adblock/adblock&quot;
</a><a href="#h0-143" id="h0-143" class="i">+require &quot;./luakit-adblock/adblock_chrome&quot;
</a><a href="#h0-144" id="h0-144" class="i">+
</a><a href="#h0-145" id="h0-145" class="i">+require &quot;follow_selected&quot;
</a><a href="#h0-146" id="h0-146" class="i">+require &quot;go_input&quot;
</a><a href="#h0-147" id="h0-147" class="i">+require &quot;go_next_prev&quot;
</a><a href="#h0-148" id="h0-148" class="i">+require &quot;go_up&quot;
</a><a href="#h0-149" id="h0-149" class="i">+
</a><a href="#h0-150" id="h0-150" class="i">+-----------------------------
</a><a href="#h0-151" id="h0-151" class="i">+-- End user script loading --
</a><a href="#h0-152" id="h0-152" class="i">+-----------------------------
</a><a href="#h0-153" id="h0-153" class="i">+
</a><a href="#h0-154" id="h0-154" class="i">+-- Restore last saved session
</a><a href="#h0-155" id="h0-155" class="i">+local w = (session and session.restore())
</a><a href="#h0-156" id="h0-156" class="i">+if w then
</a><a href="#h0-157" id="h0-157" class="i">+    for i, uri in ipairs(uris) do
</a><a href="#h0-158" id="h0-158" class="i">+        w:new_tab(uri, i == 1)
</a><a href="#h0-159" id="h0-159" class="i">+    end
</a><a href="#h0-160" id="h0-160" class="i">+else
</a><a href="#h0-161" id="h0-161" class="i">+    -- Or open new window
</a><a href="#h0-162" id="h0-162" class="i">+    window.new(uris)
</a><a href="#h0-163" id="h0-163" class="i">+end
</a><a href="#h0-164" id="h0-164" class="i">+
</a><a href="#h0-165" id="h0-165" class="i">+-------------------------------------------
</a><a href="#h0-166" id="h0-166" class="i">+-- Open URIs from other luakit instances --
</a><a href="#h0-167" id="h0-167" class="i">+-------------------------------------------
</a><a href="#h0-168" id="h0-168" class="i">+
</a><a href="#h0-169" id="h0-169" class="i">+if unique then
</a><a href="#h0-170" id="h0-170" class="i">+    unique.add_signal(&quot;message&quot;, function (msg, screen)
</a><a href="#h0-171" id="h0-171" class="i">+        local cmd, arg = string.match(msg, &quot;^(%S+)%s*(.*)&quot;)
</a><a href="#h0-172" id="h0-172" class="i">+        local w = lousy.util.table.values(window.bywidget)[1]
</a><a href="#h0-173" id="h0-173" class="i">+        if cmd == &quot;tabopen&quot; then
</a><a href="#h0-174" id="h0-174" class="i">+            w:new_tab(arg)
</a><a href="#h0-175" id="h0-175" class="i">+        elseif cmd == &quot;winopen&quot; then
</a><a href="#h0-176" id="h0-176" class="i">+            w = window.new((arg ~= &quot;&quot;) and { arg } or {})
</a><a href="#h0-177" id="h0-177" class="i">+        end
</a><a href="#h0-178" id="h0-178" class="i">+        w.win.screen = screen
</a><a href="#h0-179" id="h0-179" class="i">+        w.win.urgency_hint = true
</a><a href="#h0-180" id="h0-180" class="i">+    end)
</a><a href="#h0-181" id="h0-181" class="i">+end
</a><a href="#h0-182" id="h0-182" class="i">+
</a><a href="#h0-183" id="h0-183" class="i">+-- vim: et:sw=4:ts=8:sts=4:tw=80
</a><b>diff --git a/<a href="../file/home/.config/luakit/theme.lua.html">home/.config/luakit/theme.lua</a> b/<a href="../file/home/.config/luakit/theme.lua.html">home/.config/luakit/theme.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,69 @@
</a><a href="#h0-0" id="h0-0" class="i">+--------------------------
</a><a href="#h0-1" id="h0-1" class="i">+-- Default luakit theme --
</a><a href="#h0-2" id="h0-2" class="i">+--------------------------
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+local theme = {}
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+-- Default settings
</a><a href="#h0-7" id="h0-7" class="i">+theme.font = &quot;monospace normal 9&quot;
</a><a href="#h0-8" id="h0-8" class="i">+theme.fg   = &quot;#fff&quot;
</a><a href="#h0-9" id="h0-9" class="i">+theme.bg   = &quot;#000&quot;
</a><a href="#h0-10" id="h0-10" class="i">+
</a><a href="#h0-11" id="h0-11" class="i">+-- Genaral colours
</a><a href="#h0-12" id="h0-12" class="i">+theme.success_fg = &quot;#0f0&quot;
</a><a href="#h0-13" id="h0-13" class="i">+theme.loaded_fg  = &quot;#33AADD&quot;
</a><a href="#h0-14" id="h0-14" class="i">+theme.error_fg = &quot;#FFF&quot;
</a><a href="#h0-15" id="h0-15" class="i">+theme.error_bg = &quot;#F00&quot;
</a><a href="#h0-16" id="h0-16" class="i">+
</a><a href="#h0-17" id="h0-17" class="i">+-- Warning colours
</a><a href="#h0-18" id="h0-18" class="i">+theme.warning_fg = &quot;#F00&quot;
</a><a href="#h0-19" id="h0-19" class="i">+theme.warning_bg = &quot;#FFF&quot;
</a><a href="#h0-20" id="h0-20" class="i">+
</a><a href="#h0-21" id="h0-21" class="i">+-- Notification colours
</a><a href="#h0-22" id="h0-22" class="i">+theme.notif_fg = &quot;#444&quot;
</a><a href="#h0-23" id="h0-23" class="i">+theme.notif_bg = &quot;#FFF&quot;
</a><a href="#h0-24" id="h0-24" class="i">+
</a><a href="#h0-25" id="h0-25" class="i">+-- Menu colours
</a><a href="#h0-26" id="h0-26" class="i">+theme.menu_fg                   = &quot;#000&quot;
</a><a href="#h0-27" id="h0-27" class="i">+theme.menu_bg                   = &quot;#fff&quot;
</a><a href="#h0-28" id="h0-28" class="i">+theme.menu_selected_fg          = &quot;#000&quot;
</a><a href="#h0-29" id="h0-29" class="i">+theme.menu_selected_bg          = &quot;#FF0&quot;
</a><a href="#h0-30" id="h0-30" class="i">+theme.menu_title_bg             = &quot;#fff&quot;
</a><a href="#h0-31" id="h0-31" class="i">+theme.menu_primary_title_fg     = &quot;#f00&quot;
</a><a href="#h0-32" id="h0-32" class="i">+theme.menu_secondary_title_fg   = &quot;#666&quot;
</a><a href="#h0-33" id="h0-33" class="i">+
</a><a href="#h0-34" id="h0-34" class="i">+-- Proxy manager
</a><a href="#h0-35" id="h0-35" class="i">+theme.proxy_active_menu_fg      = &apos;#000&apos;
</a><a href="#h0-36" id="h0-36" class="i">+theme.proxy_active_menu_bg      = &apos;#FFF&apos;
</a><a href="#h0-37" id="h0-37" class="i">+theme.proxy_inactive_menu_fg    = &apos;#888&apos;
</a><a href="#h0-38" id="h0-38" class="i">+theme.proxy_inactive_menu_bg    = &apos;#FFF&apos;
</a><a href="#h0-39" id="h0-39" class="i">+
</a><a href="#h0-40" id="h0-40" class="i">+-- Statusbar specific
</a><a href="#h0-41" id="h0-41" class="i">+theme.sbar_fg         = &quot;#fff&quot;
</a><a href="#h0-42" id="h0-42" class="i">+theme.sbar_bg         = &quot;#000&quot;
</a><a href="#h0-43" id="h0-43" class="i">+
</a><a href="#h0-44" id="h0-44" class="i">+-- Downloadbar specific
</a><a href="#h0-45" id="h0-45" class="i">+theme.dbar_fg         = &quot;#fff&quot;
</a><a href="#h0-46" id="h0-46" class="i">+theme.dbar_bg         = &quot;#000&quot;
</a><a href="#h0-47" id="h0-47" class="i">+theme.dbar_error_fg   = &quot;#F00&quot;
</a><a href="#h0-48" id="h0-48" class="i">+
</a><a href="#h0-49" id="h0-49" class="i">+-- Input bar specific
</a><a href="#h0-50" id="h0-50" class="i">+theme.ibar_fg           = &quot;#000&quot;
</a><a href="#h0-51" id="h0-51" class="i">+theme.ibar_bg           = &quot;#fff&quot;
</a><a href="#h0-52" id="h0-52" class="i">+
</a><a href="#h0-53" id="h0-53" class="i">+-- Tab label
</a><a href="#h0-54" id="h0-54" class="i">+theme.tab_fg            = &quot;#888&quot;
</a><a href="#h0-55" id="h0-55" class="i">+theme.tab_bg            = &quot;#222&quot;
</a><a href="#h0-56" id="h0-56" class="i">+theme.tab_ntheme        = &quot;#ddd&quot;
</a><a href="#h0-57" id="h0-57" class="i">+theme.selected_fg       = &quot;#fff&quot;
</a><a href="#h0-58" id="h0-58" class="i">+theme.selected_bg       = &quot;#000&quot;
</a><a href="#h0-59" id="h0-59" class="i">+theme.selected_ntheme   = &quot;#ddd&quot;
</a><a href="#h0-60" id="h0-60" class="i">+theme.loading_fg        = &quot;#33AADD&quot;
</a><a href="#h0-61" id="h0-61" class="i">+theme.loading_bg        = &quot;#000&quot;
</a><a href="#h0-62" id="h0-62" class="i">+
</a><a href="#h0-63" id="h0-63" class="i">+-- Trusted/untrusted ssl colours
</a><a href="#h0-64" id="h0-64" class="i">+theme.trust_fg          = &quot;#0F0&quot;
</a><a href="#h0-65" id="h0-65" class="i">+theme.notrust_fg        = &quot;#F00&quot;
</a><a href="#h0-66" id="h0-66" class="i">+
</a><a href="#h0-67" id="h0-67" class="i">+return theme
</a><a href="#h0-68" id="h0-68" class="i">+-- vim: et:sw=4:ts=8:sts=4:tw=80
</a><b>diff --git a/<a href="../file/home/.config/luakit/webview.lua.html">home/.config/luakit/webview.lua</a> b/<a href="../file/home/.config/luakit/webview.lua.html">home/.config/luakit/webview.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,350 @@
</a><a href="#h0-0" id="h0-0" class="i">+--------------------------
</a><a href="#h0-1" id="h0-1" class="i">+-- WebKit WebView class --
</a><a href="#h0-2" id="h0-2" class="i">+--------------------------
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+-- Webview class table
</a><a href="#h0-5" id="h0-5" class="i">+webview = {}
</a><a href="#h0-6" id="h0-6" class="i">+
</a><a href="#h0-7" id="h0-7" class="i">+-- Table of functions which are called on new webview widgets.
</a><a href="#h0-8" id="h0-8" class="i">+webview.init_funcs = {
</a><a href="#h0-9" id="h0-9" class="i">+    -- Set useragent
</a><a href="#h0-10" id="h0-10" class="i">+    set_useragent = function (view, w)
</a><a href="#h0-11" id="h0-11" class="i">+        view.user_agent = globals.useragent
</a><a href="#h0-12" id="h0-12" class="i">+    end,
</a><a href="#h0-13" id="h0-13" class="i">+
</a><a href="#h0-14" id="h0-14" class="i">+    -- Check if checking ssl certificates
</a><a href="#h0-15" id="h0-15" class="i">+    checking_ssl = function (view, w)
</a><a href="#h0-16" id="h0-16" class="i">+        local ca_file = soup.ssl_ca_file
</a><a href="#h0-17" id="h0-17" class="i">+        if ca_file and os.exists(ca_file) then
</a><a href="#h0-18" id="h0-18" class="i">+            w.checking_ssl = true
</a><a href="#h0-19" id="h0-19" class="i">+        end
</a><a href="#h0-20" id="h0-20" class="i">+    end,
</a><a href="#h0-21" id="h0-21" class="i">+
</a><a href="#h0-22" id="h0-22" class="i">+    -- Update window and tab titles
</a><a href="#h0-23" id="h0-23" class="i">+    title_update = function (view, w)
</a><a href="#h0-24" id="h0-24" class="i">+        view:add_signal(&quot;property::title&quot;, function (v)
</a><a href="#h0-25" id="h0-25" class="i">+            w:update_tablist()
</a><a href="#h0-26" id="h0-26" class="i">+            if w.view == v then
</a><a href="#h0-27" id="h0-27" class="i">+                w:update_win_title()
</a><a href="#h0-28" id="h0-28" class="i">+            end
</a><a href="#h0-29" id="h0-29" class="i">+        end)
</a><a href="#h0-30" id="h0-30" class="i">+    end,
</a><a href="#h0-31" id="h0-31" class="i">+
</a><a href="#h0-32" id="h0-32" class="i">+    -- Update uri label in statusbar
</a><a href="#h0-33" id="h0-33" class="i">+    uri_update = function (view, w)
</a><a href="#h0-34" id="h0-34" class="i">+        view:add_signal(&quot;property::uri&quot;, function (v)
</a><a href="#h0-35" id="h0-35" class="i">+            w:update_tablist()
</a><a href="#h0-36" id="h0-36" class="i">+            if w.view == v then
</a><a href="#h0-37" id="h0-37" class="i">+                w:update_uri()
</a><a href="#h0-38" id="h0-38" class="i">+            end
</a><a href="#h0-39" id="h0-39" class="i">+        end)
</a><a href="#h0-40" id="h0-40" class="i">+    end,
</a><a href="#h0-41" id="h0-41" class="i">+
</a><a href="#h0-42" id="h0-42" class="i">+    -- Update history indicator
</a><a href="#h0-43" id="h0-43" class="i">+    hist_update = function (view, w)
</a><a href="#h0-44" id="h0-44" class="i">+        view:add_signal(&quot;load-status&quot;, function (v, status)
</a><a href="#h0-45" id="h0-45" class="i">+            if w.view == v then
</a><a href="#h0-46" id="h0-46" class="i">+                w:update_hist()
</a><a href="#h0-47" id="h0-47" class="i">+            end
</a><a href="#h0-48" id="h0-48" class="i">+        end)
</a><a href="#h0-49" id="h0-49" class="i">+    end,
</a><a href="#h0-50" id="h0-50" class="i">+
</a><a href="#h0-51" id="h0-51" class="i">+    -- Update tab titles
</a><a href="#h0-52" id="h0-52" class="i">+    tablist_update = function (view, w)
</a><a href="#h0-53" id="h0-53" class="i">+        view:add_signal(&quot;load-status&quot;, function (v, status)
</a><a href="#h0-54" id="h0-54" class="i">+            if status == &quot;provisional&quot; or status == &quot;finished&quot; or status == &quot;failed&quot; then
</a><a href="#h0-55" id="h0-55" class="i">+                w:update_tablist()
</a><a href="#h0-56" id="h0-56" class="i">+            end
</a><a href="#h0-57" id="h0-57" class="i">+        end)
</a><a href="#h0-58" id="h0-58" class="i">+    end,
</a><a href="#h0-59" id="h0-59" class="i">+
</a><a href="#h0-60" id="h0-60" class="i">+    -- Update scroll widget
</a><a href="#h0-61" id="h0-61" class="i">+    scroll_update = function (view, w)
</a><a href="#h0-62" id="h0-62" class="i">+        view:add_signal(&quot;expose&quot;, function (v)
</a><a href="#h0-63" id="h0-63" class="i">+            if w.view == v then
</a><a href="#h0-64" id="h0-64" class="i">+                w:update_scroll()
</a><a href="#h0-65" id="h0-65" class="i">+            end
</a><a href="#h0-66" id="h0-66" class="i">+        end)
</a><a href="#h0-67" id="h0-67" class="i">+    end,
</a><a href="#h0-68" id="h0-68" class="i">+
</a><a href="#h0-69" id="h0-69" class="i">+    -- Update progress widget
</a><a href="#h0-70" id="h0-70" class="i">+    progress_update = function (view, w)
</a><a href="#h0-71" id="h0-71" class="i">+        for _, sig in ipairs({&quot;load-status&quot;, &quot;property::progress&quot;}) do
</a><a href="#h0-72" id="h0-72" class="i">+            view:add_signal(sig, function (v)
</a><a href="#h0-73" id="h0-73" class="i">+                if w.view == v then
</a><a href="#h0-74" id="h0-74" class="i">+                    w:update_progress()
</a><a href="#h0-75" id="h0-75" class="i">+                    w:update_ssl()
</a><a href="#h0-76" id="h0-76" class="i">+                end
</a><a href="#h0-77" id="h0-77" class="i">+            end)
</a><a href="#h0-78" id="h0-78" class="i">+        end
</a><a href="#h0-79" id="h0-79" class="i">+    end,
</a><a href="#h0-80" id="h0-80" class="i">+
</a><a href="#h0-81" id="h0-81" class="i">+    -- Display hovered link in statusbar
</a><a href="#h0-82" id="h0-82" class="i">+    link_hover_display = function (view, w)
</a><a href="#h0-83" id="h0-83" class="i">+        view:add_signal(&quot;link-hover&quot;, function (v, link)
</a><a href="#h0-84" id="h0-84" class="i">+            if w.view == v and link then
</a><a href="#h0-85" id="h0-85" class="i">+                w:update_uri(link)
</a><a href="#h0-86" id="h0-86" class="i">+            end
</a><a href="#h0-87" id="h0-87" class="i">+        end)
</a><a href="#h0-88" id="h0-88" class="i">+        view:add_signal(&quot;link-unhover&quot;, function (v)
</a><a href="#h0-89" id="h0-89" class="i">+            if w.view == v then
</a><a href="#h0-90" id="h0-90" class="i">+                w:update_uri()
</a><a href="#h0-91" id="h0-91" class="i">+            end
</a><a href="#h0-92" id="h0-92" class="i">+        end)
</a><a href="#h0-93" id="h0-93" class="i">+    end,
</a><a href="#h0-94" id="h0-94" class="i">+
</a><a href="#h0-95" id="h0-95" class="i">+    -- Clicking a form field automatically enters insert mode.
</a><a href="#h0-96" id="h0-96" class="i">+    form_insert_mode = function (view, w)
</a><a href="#h0-97" id="h0-97" class="i">+        view:add_signal(&quot;button-press&quot;, function (v, mods, button, context)
</a><a href="#h0-98" id="h0-98" class="i">+            -- Clear start search marker
</a><a href="#h0-99" id="h0-99" class="i">+            (w.search_state or {}).marker = nil
</a><a href="#h0-100" id="h0-100" class="i">+
</a><a href="#h0-101" id="h0-101" class="i">+            if button == 1 and context.editable then
</a><a href="#h0-102" id="h0-102" class="i">+                view:emit_signal(&quot;form-active&quot;)
</a><a href="#h0-103" id="h0-103" class="i">+            end
</a><a href="#h0-104" id="h0-104" class="i">+        end)
</a><a href="#h0-105" id="h0-105" class="i">+        -- Emit root-active event in button release to prevent &quot;missing&quot;
</a><a href="#h0-106" id="h0-106" class="i">+        -- buttons or links when the input bar hides.
</a><a href="#h0-107" id="h0-107" class="i">+        view:add_signal(&quot;button-release&quot;, function (v, mods, button, context)
</a><a href="#h0-108" id="h0-108" class="i">+            if button == 1 and not context.editable then
</a><a href="#h0-109" id="h0-109" class="i">+                view:emit_signal(&quot;root-active&quot;)
</a><a href="#h0-110" id="h0-110" class="i">+            end
</a><a href="#h0-111" id="h0-111" class="i">+        end)
</a><a href="#h0-112" id="h0-112" class="i">+        view:add_signal(&quot;form-active&quot;, function ()
</a><a href="#h0-113" id="h0-113" class="i">+            if not w.mode.passthrough then
</a><a href="#h0-114" id="h0-114" class="i">+                w:set_mode(&quot;insert&quot;)
</a><a href="#h0-115" id="h0-115" class="i">+            end
</a><a href="#h0-116" id="h0-116" class="i">+        end)
</a><a href="#h0-117" id="h0-117" class="i">+        view:add_signal(&quot;root-active&quot;, function ()
</a><a href="#h0-118" id="h0-118" class="i">+            if w.mode.reset_on_focus ~= false then
</a><a href="#h0-119" id="h0-119" class="i">+                w:set_mode()
</a><a href="#h0-120" id="h0-120" class="i">+            end
</a><a href="#h0-121" id="h0-121" class="i">+        end)
</a><a href="#h0-122" id="h0-122" class="i">+    end,
</a><a href="#h0-123" id="h0-123" class="i">+
</a><a href="#h0-124" id="h0-124" class="i">+    -- Catch keys in non-passthrough modes
</a><a href="#h0-125" id="h0-125" class="i">+    mode_key_filter = function (view, w)
</a><a href="#h0-126" id="h0-126" class="i">+        view:add_signal(&quot;key-press&quot;, function ()
</a><a href="#h0-127" id="h0-127" class="i">+            if not w.mode.passthrough then
</a><a href="#h0-128" id="h0-128" class="i">+                return true
</a><a href="#h0-129" id="h0-129" class="i">+            end
</a><a href="#h0-130" id="h0-130" class="i">+        end)
</a><a href="#h0-131" id="h0-131" class="i">+    end,
</a><a href="#h0-132" id="h0-132" class="i">+
</a><a href="#h0-133" id="h0-133" class="i">+    -- Try to match a button event to a users button binding else let the
</a><a href="#h0-134" id="h0-134" class="i">+    -- press hit the webview.
</a><a href="#h0-135" id="h0-135" class="i">+    button_bind_match = function (view, w)
</a><a href="#h0-136" id="h0-136" class="i">+        view:add_signal(&quot;button-release&quot;, function (v, mods, button, context)
</a><a href="#h0-137" id="h0-137" class="i">+            (w.search_state or {}).marker = nil
</a><a href="#h0-138" id="h0-138" class="i">+            if w:hit(mods, button, { context = context }) then
</a><a href="#h0-139" id="h0-139" class="i">+                return true
</a><a href="#h0-140" id="h0-140" class="i">+            end
</a><a href="#h0-141" id="h0-141" class="i">+        end)
</a><a href="#h0-142" id="h0-142" class="i">+    end,
</a><a href="#h0-143" id="h0-143" class="i">+
</a><a href="#h0-144" id="h0-144" class="i">+    -- Reset the mode on navigation
</a><a href="#h0-145" id="h0-145" class="i">+    mode_reset_on_nav = function (view, w)
</a><a href="#h0-146" id="h0-146" class="i">+        view:add_signal(&quot;load-status&quot;, function (v, status)
</a><a href="#h0-147" id="h0-147" class="i">+            if status == &quot;provisional&quot; and w.view == v then
</a><a href="#h0-148" id="h0-148" class="i">+                if w.mode.reset_on_navigation ~= false then
</a><a href="#h0-149" id="h0-149" class="i">+                    w:set_mode()
</a><a href="#h0-150" id="h0-150" class="i">+                end
</a><a href="#h0-151" id="h0-151" class="i">+            end
</a><a href="#h0-152" id="h0-152" class="i">+        end)
</a><a href="#h0-153" id="h0-153" class="i">+    end,
</a><a href="#h0-154" id="h0-154" class="i">+
</a><a href="#h0-155" id="h0-155" class="i">+    -- Domain properties
</a><a href="#h0-156" id="h0-156" class="i">+    domain_properties = function (view, w)
</a><a href="#h0-157" id="h0-157" class="i">+        view:add_signal(&quot;load-status&quot;, function (v, status)
</a><a href="#h0-158" id="h0-158" class="i">+            if status ~= &quot;committed&quot; or v.uri == &quot;about:blank&quot; then return end
</a><a href="#h0-159" id="h0-159" class="i">+            -- Get domain
</a><a href="#h0-160" id="h0-160" class="i">+            local domain = lousy.uri.parse(v.uri).host
</a><a href="#h0-161" id="h0-161" class="i">+            -- Strip leading www.
</a><a href="#h0-162" id="h0-162" class="i">+            domain = string.match(domain or &quot;&quot;, &quot;^www%.(.+)&quot;) or domain or &quot;all&quot;
</a><a href="#h0-163" id="h0-163" class="i">+            -- Build list of domain props tables to join &amp; load.
</a><a href="#h0-164" id="h0-164" class="i">+            -- I.e. for luakit.org load .luakit.org, luakit.org, .org
</a><a href="#h0-165" id="h0-165" class="i">+            local props = {domain_props.all or {}, domain_props[domain] or {}}
</a><a href="#h0-166" id="h0-166" class="i">+            repeat
</a><a href="#h0-167" id="h0-167" class="i">+                table.insert(props, 2, domain_props[&quot;.&quot;..domain] or {})
</a><a href="#h0-168" id="h0-168" class="i">+                domain = string.match(domain, &quot;%.(.+)&quot;)
</a><a href="#h0-169" id="h0-169" class="i">+            until not domain
</a><a href="#h0-170" id="h0-170" class="i">+            -- Join all property tables
</a><a href="#h0-171" id="h0-171" class="i">+            for k, v in pairs(lousy.util.table.join(unpack(props))) do
</a><a href="#h0-172" id="h0-172" class="i">+                info(&quot;Domain prop: %s = %s (%s)&quot;, k, tostring(v), domain)
</a><a href="#h0-173" id="h0-173" class="i">+                view[k] = v
</a><a href="#h0-174" id="h0-174" class="i">+            end
</a><a href="#h0-175" id="h0-175" class="i">+        end)
</a><a href="#h0-176" id="h0-176" class="i">+    end,
</a><a href="#h0-177" id="h0-177" class="i">+
</a><a href="#h0-178" id="h0-178" class="i">+    -- Action to take on mime type decision request.
</a><a href="#h0-179" id="h0-179" class="i">+    mime_decision = function (view, w)
</a><a href="#h0-180" id="h0-180" class="i">+        -- Return true to accept or false to reject from this signal.
</a><a href="#h0-181" id="h0-181" class="i">+        view:add_signal(&quot;mime-type-decision&quot;, function (v, uri, mime)
</a><a href="#h0-182" id="h0-182" class="i">+            info(&quot;Requested link: %s (%s)&quot;, uri, mime)
</a><a href="#h0-183" id="h0-183" class="i">+            -- i.e. block binary files like *.exe
</a><a href="#h0-184" id="h0-184" class="i">+            --if mime == &quot;application/octet-stream&quot; then
</a><a href="#h0-185" id="h0-185" class="i">+            --    return false
</a><a href="#h0-186" id="h0-186" class="i">+            --end
</a><a href="#h0-187" id="h0-187" class="i">+        end)
</a><a href="#h0-188" id="h0-188" class="i">+    end,
</a><a href="#h0-189" id="h0-189" class="i">+
</a><a href="#h0-190" id="h0-190" class="i">+    -- Action to take on window open request.
</a><a href="#h0-191" id="h0-191" class="i">+    --window_decision = function (view, w)
</a><a href="#h0-192" id="h0-192" class="i">+    --    view:add_signal(&quot;new-window-decision&quot;, function (v, uri, reason)
</a><a href="#h0-193" id="h0-193" class="i">+    --        if reason == &quot;link-clicked&quot; then
</a><a href="#h0-194" id="h0-194" class="i">+    --            window.new({uri})
</a><a href="#h0-195" id="h0-195" class="i">+    --        else
</a><a href="#h0-196" id="h0-196" class="i">+    --            w:new_tab(uri)
</a><a href="#h0-197" id="h0-197" class="i">+    --        end
</a><a href="#h0-198" id="h0-198" class="i">+    --        return true
</a><a href="#h0-199" id="h0-199" class="i">+    --    end)
</a><a href="#h0-200" id="h0-200" class="i">+    --end,
</a><a href="#h0-201" id="h0-201" class="i">+
</a><a href="#h0-202" id="h0-202" class="i">+    create_webview = function (view, w)
</a><a href="#h0-203" id="h0-203" class="i">+        -- Return a newly created webview in a new tab
</a><a href="#h0-204" id="h0-204" class="i">+        view:add_signal(&quot;create-web-view&quot;, function (v)
</a><a href="#h0-205" id="h0-205" class="i">+            return w:new_tab()
</a><a href="#h0-206" id="h0-206" class="i">+        end)
</a><a href="#h0-207" id="h0-207" class="i">+    end,
</a><a href="#h0-208" id="h0-208" class="i">+
</a><a href="#h0-209" id="h0-209" class="i">+    -- Creates context menu popup from table (and nested tables).
</a><a href="#h0-210" id="h0-210" class="i">+    -- Use `true` for menu separators.
</a><a href="#h0-211" id="h0-211" class="i">+    --populate_popup = function (view, w)
</a><a href="#h0-212" id="h0-212" class="i">+    --    view:add_signal(&quot;populate-popup&quot;, function (v)
</a><a href="#h0-213" id="h0-213" class="i">+    --        return {
</a><a href="#h0-214" id="h0-214" class="i">+    --            true,
</a><a href="#h0-215" id="h0-215" class="i">+    --            { &quot;_Toggle Source&quot;, function () w:toggle_source() end },
</a><a href="#h0-216" id="h0-216" class="i">+    --            { &quot;_Zoom&quot;, {
</a><a href="#h0-217" id="h0-217" class="i">+    --                { &quot;Zoom _In&quot;,    function () w:zoom_in()  end },
</a><a href="#h0-218" id="h0-218" class="i">+    --                { &quot;Zoom _Out&quot;,   function () w:zoom_out() end },
</a><a href="#h0-219" id="h0-219" class="i">+    --                true,
</a><a href="#h0-220" id="h0-220" class="i">+    --                { &quot;Zoom _Reset&quot;, function () w:zoom_set() end }, }, },
</a><a href="#h0-221" id="h0-221" class="i">+    --        }
</a><a href="#h0-222" id="h0-222" class="i">+    --    end)
</a><a href="#h0-223" id="h0-223" class="i">+    --end,
</a><a href="#h0-224" id="h0-224" class="i">+
</a><a href="#h0-225" id="h0-225" class="i">+    -- Action to take on resource request.
</a><a href="#h0-226" id="h0-226" class="i">+    resource_request_decision = function (view, w)
</a><a href="#h0-227" id="h0-227" class="i">+        view:add_signal(&quot;resource-request-starting&quot;, function(v, uri)
</a><a href="#h0-228" id="h0-228" class="i">+            info(&quot;Requesting: %s&quot;, uri)
</a><a href="#h0-229" id="h0-229" class="i">+            -- Return false to cancel the request.
</a><a href="#h0-230" id="h0-230" class="i">+        end)
</a><a href="#h0-231" id="h0-231" class="i">+    end,
</a><a href="#h0-232" id="h0-232" class="i">+}
</a><a href="#h0-233" id="h0-233" class="i">+
</a><a href="#h0-234" id="h0-234" class="i">+-- These methods are present when you index a window instance and no window
</a><a href="#h0-235" id="h0-235" class="i">+-- method is found in `window.methods`. The window then checks if there is an
</a><a href="#h0-236" id="h0-236" class="i">+-- active webview and calls the following methods with the given view instance
</a><a href="#h0-237" id="h0-237" class="i">+-- as the first argument. All methods must take `view` &amp; `w` as the first two
</a><a href="#h0-238" id="h0-238" class="i">+-- arguments.
</a><a href="#h0-239" id="h0-239" class="i">+webview.methods = {
</a><a href="#h0-240" id="h0-240" class="i">+    -- Reload with or without ignoring cache
</a><a href="#h0-241" id="h0-241" class="i">+    reload = function (view, w, bypass_cache)
</a><a href="#h0-242" id="h0-242" class="i">+        if bypass_cache then
</a><a href="#h0-243" id="h0-243" class="i">+            view:reload_bypass_cache()
</a><a href="#h0-244" id="h0-244" class="i">+        else
</a><a href="#h0-245" id="h0-245" class="i">+            view:reload()
</a><a href="#h0-246" id="h0-246" class="i">+        end
</a><a href="#h0-247" id="h0-247" class="i">+    end,
</a><a href="#h0-248" id="h0-248" class="i">+
</a><a href="#h0-249" id="h0-249" class="i">+    -- Toggle source view
</a><a href="#h0-250" id="h0-250" class="i">+    toggle_source = function (view, w, show)
</a><a href="#h0-251" id="h0-251" class="i">+        if show == nil then
</a><a href="#h0-252" id="h0-252" class="i">+            view.view_source = not view.view_source
</a><a href="#h0-253" id="h0-253" class="i">+        else
</a><a href="#h0-254" id="h0-254" class="i">+            view.view_source = show
</a><a href="#h0-255" id="h0-255" class="i">+        end
</a><a href="#h0-256" id="h0-256" class="i">+        view:reload()
</a><a href="#h0-257" id="h0-257" class="i">+    end,
</a><a href="#h0-258" id="h0-258" class="i">+
</a><a href="#h0-259" id="h0-259" class="i">+    -- Zoom functions
</a><a href="#h0-260" id="h0-260" class="i">+    zoom_in = function (view, w, step, full_zoom)
</a><a href="#h0-261" id="h0-261" class="i">+        view.full_content_zoom = not not full_zoom
</a><a href="#h0-262" id="h0-262" class="i">+        step = step or globals.zoom_step or 0.1
</a><a href="#h0-263" id="h0-263" class="i">+        view.zoom_level = view.zoom_level + step
</a><a href="#h0-264" id="h0-264" class="i">+    end,
</a><a href="#h0-265" id="h0-265" class="i">+
</a><a href="#h0-266" id="h0-266" class="i">+    zoom_out = function (view, w, step, full_zoom)
</a><a href="#h0-267" id="h0-267" class="i">+        view.full_content_zoom = not not full_zoom
</a><a href="#h0-268" id="h0-268" class="i">+        step = step or globals.zoom_step or 0.1
</a><a href="#h0-269" id="h0-269" class="i">+        view.zoom_level = math.max(0.01, view.zoom_level) - step
</a><a href="#h0-270" id="h0-270" class="i">+    end,
</a><a href="#h0-271" id="h0-271" class="i">+
</a><a href="#h0-272" id="h0-272" class="i">+    zoom_set = function (view, w, level, full_zoom)
</a><a href="#h0-273" id="h0-273" class="i">+        view.full_content_zoom = not not full_zoom
</a><a href="#h0-274" id="h0-274" class="i">+        view.zoom_level = level or 1.0
</a><a href="#h0-275" id="h0-275" class="i">+    end,
</a><a href="#h0-276" id="h0-276" class="i">+
</a><a href="#h0-277" id="h0-277" class="i">+    -- History traversing functions
</a><a href="#h0-278" id="h0-278" class="i">+    back = function (view, w, n)
</a><a href="#h0-279" id="h0-279" class="i">+        view:go_back(n or 1)
</a><a href="#h0-280" id="h0-280" class="i">+    end,
</a><a href="#h0-281" id="h0-281" class="i">+
</a><a href="#h0-282" id="h0-282" class="i">+    forward = function (view, w, n)
</a><a href="#h0-283" id="h0-283" class="i">+        view:go_forward(n or 1)
</a><a href="#h0-284" id="h0-284" class="i">+    end,
</a><a href="#h0-285" id="h0-285" class="i">+}
</a><a href="#h0-286" id="h0-286" class="i">+
</a><a href="#h0-287" id="h0-287" class="i">+function webview.methods.scroll(view, w, new)
</a><a href="#h0-288" id="h0-288" class="i">+    local s = view.scroll
</a><a href="#h0-289" id="h0-289" class="i">+    for _, axis in ipairs{ &quot;x&quot;, &quot;y&quot; } do
</a><a href="#h0-290" id="h0-290" class="i">+        -- Relative px movement
</a><a href="#h0-291" id="h0-291" class="i">+        if rawget(new, axis..&quot;rel&quot;) then
</a><a href="#h0-292" id="h0-292" class="i">+            s[axis] = s[axis] + new[axis..&quot;rel&quot;]
</a><a href="#h0-293" id="h0-293" class="i">+
</a><a href="#h0-294" id="h0-294" class="i">+        -- Relative page movement
</a><a href="#h0-295" id="h0-295" class="i">+        elseif rawget(new, axis .. &quot;pagerel&quot;) then
</a><a href="#h0-296" id="h0-296" class="i">+            s[axis] = s[axis] + math.ceil(s[axis..&quot;page_size&quot;] * new[axis..&quot;pagerel&quot;])
</a><a href="#h0-297" id="h0-297" class="i">+
</a><a href="#h0-298" id="h0-298" class="i">+        -- Absolute px movement
</a><a href="#h0-299" id="h0-299" class="i">+        elseif rawget(new, axis) then
</a><a href="#h0-300" id="h0-300" class="i">+            local n = new[axis]
</a><a href="#h0-301" id="h0-301" class="i">+            if n == -1 then
</a><a href="#h0-302" id="h0-302" class="i">+                s[axis] = s[axis..&quot;max&quot;]
</a><a href="#h0-303" id="h0-303" class="i">+            else
</a><a href="#h0-304" id="h0-304" class="i">+                s[axis] = n
</a><a href="#h0-305" id="h0-305" class="i">+            end
</a><a href="#h0-306" id="h0-306" class="i">+
</a><a href="#h0-307" id="h0-307" class="i">+        -- Absolute page movement
</a><a href="#h0-308" id="h0-308" class="i">+        elseif rawget(new, axis..&quot;page&quot;) then
</a><a href="#h0-309" id="h0-309" class="i">+            s[axis] = math.ceil(s[axis..&quot;page_size&quot;] * new[axis..&quot;page&quot;])
</a><a href="#h0-310" id="h0-310" class="i">+
</a><a href="#h0-311" id="h0-311" class="i">+        -- Absolute percent movement
</a><a href="#h0-312" id="h0-312" class="i">+        elseif rawget(new, axis .. &quot;pct&quot;) then
</a><a href="#h0-313" id="h0-313" class="i">+            s[axis] = math.ceil(s[axis..&quot;max&quot;] * (new[axis..&quot;pct&quot;]/100))
</a><a href="#h0-314" id="h0-314" class="i">+        end
</a><a href="#h0-315" id="h0-315" class="i">+    end
</a><a href="#h0-316" id="h0-316" class="i">+end
</a><a href="#h0-317" id="h0-317" class="i">+
</a><a href="#h0-318" id="h0-318" class="i">+function webview.new(w)
</a><a href="#h0-319" id="h0-319" class="i">+    local view = widget{type = &quot;webview&quot;}
</a><a href="#h0-320" id="h0-320" class="i">+
</a><a href="#h0-321" id="h0-321" class="i">+    view.show_scrollbars = false
</a><a href="#h0-322" id="h0-322" class="i">+    view.enforce_96_dpi = false
</a><a href="#h0-323" id="h0-323" class="i">+
</a><a href="#h0-324" id="h0-324" class="i">+    -- Call webview init functions
</a><a href="#h0-325" id="h0-325" class="i">+    for k, func in pairs(webview.init_funcs) do
</a><a href="#h0-326" id="h0-326" class="i">+        func(view, w)
</a><a href="#h0-327" id="h0-327" class="i">+    end
</a><a href="#h0-328" id="h0-328" class="i">+    return view
</a><a href="#h0-329" id="h0-329" class="i">+end
</a><a href="#h0-330" id="h0-330" class="i">+
</a><a href="#h0-331" id="h0-331" class="i">+-- Insert webview method lookup on window structure
</a><a href="#h0-332" id="h0-332" class="i">+table.insert(window.indexes, 1, function (w, k)
</a><a href="#h0-333" id="h0-333" class="i">+    if k == &quot;view&quot; then
</a><a href="#h0-334" id="h0-334" class="i">+        local view = w.tabs[w.tabs:current()]
</a><a href="#h0-335" id="h0-335" class="i">+        if view and type(view) == &quot;widget&quot; and view.type == &quot;webview&quot; then
</a><a href="#h0-336" id="h0-336" class="i">+            w.view = view
</a><a href="#h0-337" id="h0-337" class="i">+            return view
</a><a href="#h0-338" id="h0-338" class="i">+        end
</a><a href="#h0-339" id="h0-339" class="i">+    end
</a><a href="#h0-340" id="h0-340" class="i">+    -- Lookup webview method
</a><a href="#h0-341" id="h0-341" class="i">+    local func = webview.methods[k]
</a><a href="#h0-342" id="h0-342" class="i">+    if not func then return end
</a><a href="#h0-343" id="h0-343" class="i">+    local view = w.view
</a><a href="#h0-344" id="h0-344" class="i">+    if view then
</a><a href="#h0-345" id="h0-345" class="i">+        return function (_, ...) return func(view, w, ...) end
</a><a href="#h0-346" id="h0-346" class="i">+    end
</a><a href="#h0-347" id="h0-347" class="i">+end)
</a><a href="#h0-348" id="h0-348" class="i">+
</a><a href="#h0-349" id="h0-349" class="i">+-- vim: et:sw=4:ts=8:sts=4:tw=80
</a><b>diff --git a/<a href="../file/home/.config/luakit/window.lua.html">home/.config/luakit/window.lua</a> b/<a href="../file/home/.config/luakit/window.lua.html">home/.config/luakit/window.lua</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,859 @@
</a><a href="#h0-0" id="h0-0" class="i">+------------------
</a><a href="#h0-1" id="h0-1" class="i">+-- Window class --
</a><a href="#h0-2" id="h0-2" class="i">+------------------
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+require &quot;lfs&quot;
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+-- Window class table
</a><a href="#h0-7" id="h0-7" class="i">+window = {}
</a><a href="#h0-8" id="h0-8" class="i">+
</a><a href="#h0-9" id="h0-9" class="i">+-- List of active windows by window widget
</a><a href="#h0-10" id="h0-10" class="i">+window.bywidget = setmetatable({}, { __mode = &quot;k&quot; })
</a><a href="#h0-11" id="h0-11" class="i">+
</a><a href="#h0-12" id="h0-12" class="i">+-- Widget construction aliases
</a><a href="#h0-13" id="h0-13" class="i">+local function entry()    return widget{type=&quot;entry&quot;}    end
</a><a href="#h0-14" id="h0-14" class="i">+local function eventbox() return widget{type=&quot;eventbox&quot;} end
</a><a href="#h0-15" id="h0-15" class="i">+local function hbox()     return widget{type=&quot;hbox&quot;}     end
</a><a href="#h0-16" id="h0-16" class="i">+local function label()    return widget{type=&quot;label&quot;}    end
</a><a href="#h0-17" id="h0-17" class="i">+local function notebook() return widget{type=&quot;notebook&quot;} end
</a><a href="#h0-18" id="h0-18" class="i">+local function vbox()     return widget{type=&quot;vbox&quot;}     end
</a><a href="#h0-19" id="h0-19" class="i">+
</a><a href="#h0-20" id="h0-20" class="i">+-- Build and pack window widgets
</a><a href="#h0-21" id="h0-21" class="i">+function window.build()
</a><a href="#h0-22" id="h0-22" class="i">+    -- Create a table for widgets and state variables for a window
</a><a href="#h0-23" id="h0-23" class="i">+    local w = {
</a><a href="#h0-24" id="h0-24" class="i">+        win    = widget{type=&quot;window&quot;},
</a><a href="#h0-25" id="h0-25" class="i">+        ebox   = eventbox(),
</a><a href="#h0-26" id="h0-26" class="i">+        layout = vbox(),
</a><a href="#h0-27" id="h0-27" class="i">+        paned  = widget{type=&quot;vpaned&quot;},
</a><a href="#h0-28" id="h0-28" class="i">+        tabs   = notebook(),
</a><a href="#h0-29" id="h0-29" class="i">+        -- Tablist widget
</a><a href="#h0-30" id="h0-30" class="i">+        tablist = lousy.widget.tablist(),
</a><a href="#h0-31" id="h0-31" class="i">+        -- Status bar widgets
</a><a href="#h0-32" id="h0-32" class="i">+        sbar = {
</a><a href="#h0-33" id="h0-33" class="i">+            layout = hbox(),
</a><a href="#h0-34" id="h0-34" class="i">+            ebox   = eventbox(),
</a><a href="#h0-35" id="h0-35" class="i">+            -- Left aligned widgets
</a><a href="#h0-36" id="h0-36" class="i">+            l = {
</a><a href="#h0-37" id="h0-37" class="i">+                layout = hbox(),
</a><a href="#h0-38" id="h0-38" class="i">+                ebox   = eventbox(),
</a><a href="#h0-39" id="h0-39" class="i">+                uri    = label(),
</a><a href="#h0-40" id="h0-40" class="i">+                hist   = label(),
</a><a href="#h0-41" id="h0-41" class="i">+                loaded = label(),
</a><a href="#h0-42" id="h0-42" class="i">+            },
</a><a href="#h0-43" id="h0-43" class="i">+            -- Fills space between the left and right aligned widgets
</a><a href="#h0-44" id="h0-44" class="i">+            sep = eventbox(),
</a><a href="#h0-45" id="h0-45" class="i">+            -- Right aligned widgets
</a><a href="#h0-46" id="h0-46" class="i">+            r = {
</a><a href="#h0-47" id="h0-47" class="i">+                layout = hbox(),
</a><a href="#h0-48" id="h0-48" class="i">+                ebox   = eventbox(),
</a><a href="#h0-49" id="h0-49" class="i">+                buf    = label(),
</a><a href="#h0-50" id="h0-50" class="i">+                ssl    = label(),
</a><a href="#h0-51" id="h0-51" class="i">+                tabi   = label(),
</a><a href="#h0-52" id="h0-52" class="i">+                scroll = label(),
</a><a href="#h0-53" id="h0-53" class="i">+            },
</a><a href="#h0-54" id="h0-54" class="i">+        },
</a><a href="#h0-55" id="h0-55" class="i">+
</a><a href="#h0-56" id="h0-56" class="i">+        -- Vertical menu window widget (completion results, bookmarks, qmarks, ..)
</a><a href="#h0-57" id="h0-57" class="i">+        menu = lousy.widget.menu(),
</a><a href="#h0-58" id="h0-58" class="i">+
</a><a href="#h0-59" id="h0-59" class="i">+        -- Input bar widgets
</a><a href="#h0-60" id="h0-60" class="i">+        ibar = {
</a><a href="#h0-61" id="h0-61" class="i">+            layout  = hbox(),
</a><a href="#h0-62" id="h0-62" class="i">+            ebox    = eventbox(),
</a><a href="#h0-63" id="h0-63" class="i">+            prompt  = label(),
</a><a href="#h0-64" id="h0-64" class="i">+            input   = entry(),
</a><a href="#h0-65" id="h0-65" class="i">+        },
</a><a href="#h0-66" id="h0-66" class="i">+        closed_tabs = {}
</a><a href="#h0-67" id="h0-67" class="i">+    }
</a><a href="#h0-68" id="h0-68" class="i">+
</a><a href="#h0-69" id="h0-69" class="i">+    -- Assemble window
</a><a href="#h0-70" id="h0-70" class="i">+    w.ebox.child = w.paned
</a><a href="#h0-71" id="h0-71" class="i">+    w.paned:pack1(w.layout)
</a><a href="#h0-72" id="h0-72" class="i">+    w.win.child = w.ebox
</a><a href="#h0-73" id="h0-73" class="i">+
</a><a href="#h0-74" id="h0-74" class="i">+    -- Pack tablist
</a><a href="#h0-75" id="h0-75" class="i">+    w.layout:pack(w.tablist.widget)
</a><a href="#h0-76" id="h0-76" class="i">+
</a><a href="#h0-77" id="h0-77" class="i">+    -- Pack notebook
</a><a href="#h0-78" id="h0-78" class="i">+    w.layout:pack(w.tabs, { expand = true, fill = true })
</a><a href="#h0-79" id="h0-79" class="i">+
</a><a href="#h0-80" id="h0-80" class="i">+    -- Pack left-aligned statusbar elements
</a><a href="#h0-81" id="h0-81" class="i">+    local l = w.sbar.l
</a><a href="#h0-82" id="h0-82" class="i">+    l.layout:pack(l.uri)
</a><a href="#h0-83" id="h0-83" class="i">+    l.layout:pack(l.hist)
</a><a href="#h0-84" id="h0-84" class="i">+    l.layout:pack(l.loaded)
</a><a href="#h0-85" id="h0-85" class="i">+    l.ebox.child = l.layout
</a><a href="#h0-86" id="h0-86" class="i">+
</a><a href="#h0-87" id="h0-87" class="i">+    -- Pack right-aligned statusbar elements
</a><a href="#h0-88" id="h0-88" class="i">+    local r = w.sbar.r
</a><a href="#h0-89" id="h0-89" class="i">+    r.layout:pack(r.buf)
</a><a href="#h0-90" id="h0-90" class="i">+    r.layout:pack(r.ssl)
</a><a href="#h0-91" id="h0-91" class="i">+    r.layout:pack(r.tabi)
</a><a href="#h0-92" id="h0-92" class="i">+    r.layout:pack(r.scroll)
</a><a href="#h0-93" id="h0-93" class="i">+    r.ebox.child = r.layout
</a><a href="#h0-94" id="h0-94" class="i">+
</a><a href="#h0-95" id="h0-95" class="i">+    -- Pack status bar elements
</a><a href="#h0-96" id="h0-96" class="i">+    local s = w.sbar
</a><a href="#h0-97" id="h0-97" class="i">+    s.layout:pack(l.ebox)
</a><a href="#h0-98" id="h0-98" class="i">+    s.layout:pack(s.sep, { expand = true, fill = true })
</a><a href="#h0-99" id="h0-99" class="i">+    s.layout:pack(r.ebox)
</a><a href="#h0-100" id="h0-100" class="i">+    s.ebox.child = s.layout
</a><a href="#h0-101" id="h0-101" class="i">+    w.layout:pack(s.ebox)
</a><a href="#h0-102" id="h0-102" class="i">+
</a><a href="#h0-103" id="h0-103" class="i">+    -- Pack menu widget
</a><a href="#h0-104" id="h0-104" class="i">+    w.layout:pack(w.menu.widget)
</a><a href="#h0-105" id="h0-105" class="i">+    w.menu:hide()
</a><a href="#h0-106" id="h0-106" class="i">+
</a><a href="#h0-107" id="h0-107" class="i">+    -- Pack input bar
</a><a href="#h0-108" id="h0-108" class="i">+    local i = w.ibar
</a><a href="#h0-109" id="h0-109" class="i">+    i.layout:pack(i.prompt)
</a><a href="#h0-110" id="h0-110" class="i">+    i.layout:pack(i.input, { expand = true, fill = true })
</a><a href="#h0-111" id="h0-111" class="i">+    i.ebox.child = i.layout
</a><a href="#h0-112" id="h0-112" class="i">+    w.layout:pack(i.ebox)
</a><a href="#h0-113" id="h0-113" class="i">+
</a><a href="#h0-114" id="h0-114" class="i">+    -- Other settings
</a><a href="#h0-115" id="h0-115" class="i">+    i.input.show_frame = false
</a><a href="#h0-116" id="h0-116" class="i">+    w.tabs.show_tabs = false
</a><a href="#h0-117" id="h0-117" class="i">+    l.loaded:hide()
</a><a href="#h0-118" id="h0-118" class="i">+    l.hist:hide()
</a><a href="#h0-119" id="h0-119" class="i">+    l.uri.selectable = true
</a><a href="#h0-120" id="h0-120" class="i">+    r.ssl:hide()
</a><a href="#h0-121" id="h0-121" class="i">+
</a><a href="#h0-122" id="h0-122" class="i">+    -- Allows indexing of window struct by window widget
</a><a href="#h0-123" id="h0-123" class="i">+    window.bywidget[w.win] = w
</a><a href="#h0-124" id="h0-124" class="i">+
</a><a href="#h0-125" id="h0-125" class="i">+    return w
</a><a href="#h0-126" id="h0-126" class="i">+end
</a><a href="#h0-127" id="h0-127" class="i">+
</a><a href="#h0-128" id="h0-128" class="i">+-- Table of functions to call on window creation. Normally used to add signal
</a><a href="#h0-129" id="h0-129" class="i">+-- handlers to the new windows widgets.
</a><a href="#h0-130" id="h0-130" class="i">+window.init_funcs = {
</a><a href="#h0-131" id="h0-131" class="i">+    -- Attach notebook widget signals
</a><a href="#h0-132" id="h0-132" class="i">+    notebook_signals = function (w)
</a><a href="#h0-133" id="h0-133" class="i">+        w.tabs:add_signal(&quot;page-added&quot;, function (nbook, view, idx)
</a><a href="#h0-134" id="h0-134" class="i">+            luakit.idle_add(function ()
</a><a href="#h0-135" id="h0-135" class="i">+                w:update_tab_count()
</a><a href="#h0-136" id="h0-136" class="i">+                w:update_tablist()
</a><a href="#h0-137" id="h0-137" class="i">+                return false
</a><a href="#h0-138" id="h0-138" class="i">+            end)
</a><a href="#h0-139" id="h0-139" class="i">+        end)
</a><a href="#h0-140" id="h0-140" class="i">+        w.tabs:add_signal(&quot;switch-page&quot;, function (nbook, view, idx)
</a><a href="#h0-141" id="h0-141" class="i">+            w.view = nil
</a><a href="#h0-142" id="h0-142" class="i">+            w:set_mode()
</a><a href="#h0-143" id="h0-143" class="i">+            -- Update widgets after tab switch
</a><a href="#h0-144" id="h0-144" class="i">+            luakit.idle_add(function ()
</a><a href="#h0-145" id="h0-145" class="i">+                w:update_tab_count()
</a><a href="#h0-146" id="h0-146" class="i">+                w:update_win_title()
</a><a href="#h0-147" id="h0-147" class="i">+                w:update_uri()
</a><a href="#h0-148" id="h0-148" class="i">+                w:update_progress()
</a><a href="#h0-149" id="h0-149" class="i">+                w:update_tablist()
</a><a href="#h0-150" id="h0-150" class="i">+                w:update_buf()
</a><a href="#h0-151" id="h0-151" class="i">+                w:update_ssl()
</a><a href="#h0-152" id="h0-152" class="i">+                w:update_hist()
</a><a href="#h0-153" id="h0-153" class="i">+                return false
</a><a href="#h0-154" id="h0-154" class="i">+            end)
</a><a href="#h0-155" id="h0-155" class="i">+        end)
</a><a href="#h0-156" id="h0-156" class="i">+        w.tabs:add_signal(&quot;page-reordered&quot;, function (nbook, view, idx)
</a><a href="#h0-157" id="h0-157" class="i">+            w:update_tab_count()
</a><a href="#h0-158" id="h0-158" class="i">+            w:update_tablist()
</a><a href="#h0-159" id="h0-159" class="i">+        end)
</a><a href="#h0-160" id="h0-160" class="i">+    end,
</a><a href="#h0-161" id="h0-161" class="i">+
</a><a href="#h0-162" id="h0-162" class="i">+    last_win_check = function (w)
</a><a href="#h0-163" id="h0-163" class="i">+        w.win:add_signal(&quot;destroy&quot;, function ()
</a><a href="#h0-164" id="h0-164" class="i">+            -- call the quit function if this was the last window left
</a><a href="#h0-165" id="h0-165" class="i">+            if #luakit.windows == 0 then luakit.quit() end
</a><a href="#h0-166" id="h0-166" class="i">+            if w.close_win then w:close_win() end
</a><a href="#h0-167" id="h0-167" class="i">+        end)
</a><a href="#h0-168" id="h0-168" class="i">+    end,
</a><a href="#h0-169" id="h0-169" class="i">+
</a><a href="#h0-170" id="h0-170" class="i">+    key_press_match = function (w)
</a><a href="#h0-171" id="h0-171" class="i">+        w.win:add_signal(&quot;key-press&quot;, function (_, mods, key)
</a><a href="#h0-172" id="h0-172" class="i">+            -- Match &amp; exec a bind
</a><a href="#h0-173" id="h0-173" class="i">+            local success, match = xpcall(
</a><a href="#h0-174" id="h0-174" class="i">+                function () return w:hit(mods, key) end,
</a><a href="#h0-175" id="h0-175" class="i">+                function (err) w:error(debug.traceback(err, 3)) end)
</a><a href="#h0-176" id="h0-176" class="i">+
</a><a href="#h0-177" id="h0-177" class="i">+            if success and match then
</a><a href="#h0-178" id="h0-178" class="i">+                return true
</a><a href="#h0-179" id="h0-179" class="i">+            end
</a><a href="#h0-180" id="h0-180" class="i">+        end)
</a><a href="#h0-181" id="h0-181" class="i">+    end,
</a><a href="#h0-182" id="h0-182" class="i">+
</a><a href="#h0-183" id="h0-183" class="i">+    tablist_tab_click = function (w)
</a><a href="#h0-184" id="h0-184" class="i">+        w.tablist:add_signal(&quot;tab-clicked&quot;, function (_, index, mods, button)
</a><a href="#h0-185" id="h0-185" class="i">+            if button == 1 then
</a><a href="#h0-186" id="h0-186" class="i">+                w.tabs:switch(index)
</a><a href="#h0-187" id="h0-187" class="i">+                return true
</a><a href="#h0-188" id="h0-188" class="i">+            elseif button == 2 then
</a><a href="#h0-189" id="h0-189" class="i">+                w:close_tab(w.tabs[index])
</a><a href="#h0-190" id="h0-190" class="i">+                return true
</a><a href="#h0-191" id="h0-191" class="i">+            end
</a><a href="#h0-192" id="h0-192" class="i">+        end)
</a><a href="#h0-193" id="h0-193" class="i">+    end,
</a><a href="#h0-194" id="h0-194" class="i">+
</a><a href="#h0-195" id="h0-195" class="i">+    apply_window_theme = function (w)
</a><a href="#h0-196" id="h0-196" class="i">+        local s, i = w.sbar, w.ibar
</a><a href="#h0-197" id="h0-197" class="i">+
</a><a href="#h0-198" id="h0-198" class="i">+        -- Set foregrounds
</a><a href="#h0-199" id="h0-199" class="i">+        for wi, v in pairs({
</a><a href="#h0-200" id="h0-200" class="i">+            [s.l.uri]    = theme.uri_sbar_fg,
</a><a href="#h0-201" id="h0-201" class="i">+            [s.l.hist]   = theme.hist_sbar_fg,
</a><a href="#h0-202" id="h0-202" class="i">+            [s.l.loaded] = theme.sbar_loaded_fg,
</a><a href="#h0-203" id="h0-203" class="i">+            [s.r.buf]    = theme.buf_sbar_fg,
</a><a href="#h0-204" id="h0-204" class="i">+            [s.r.tabi]   = theme.tabi_sbar_fg,
</a><a href="#h0-205" id="h0-205" class="i">+            [s.r.scroll] = theme.scroll_sbar_fg,
</a><a href="#h0-206" id="h0-206" class="i">+            [i.prompt]   = theme.prompt_ibar_fg,
</a><a href="#h0-207" id="h0-207" class="i">+            [i.input]    = theme.input_ibar_fg,
</a><a href="#h0-208" id="h0-208" class="i">+        }) do wi.fg = v end
</a><a href="#h0-209" id="h0-209" class="i">+
</a><a href="#h0-210" id="h0-210" class="i">+        -- Set backgrounds
</a><a href="#h0-211" id="h0-211" class="i">+        for wi, v in pairs({
</a><a href="#h0-212" id="h0-212" class="i">+            [s.l.ebox]   = theme.sbar_bg,
</a><a href="#h0-213" id="h0-213" class="i">+            [s.r.ebox]   = theme.sbar_bg,
</a><a href="#h0-214" id="h0-214" class="i">+            [s.sep]      = theme.sbar_bg,
</a><a href="#h0-215" id="h0-215" class="i">+            [s.ebox]     = theme.sbar_bg,
</a><a href="#h0-216" id="h0-216" class="i">+            [i.ebox]     = theme.ibar_bg,
</a><a href="#h0-217" id="h0-217" class="i">+            [i.input]    = theme.input_ibar_bg,
</a><a href="#h0-218" id="h0-218" class="i">+        }) do wi.bg = v end
</a><a href="#h0-219" id="h0-219" class="i">+
</a><a href="#h0-220" id="h0-220" class="i">+        -- Set fonts
</a><a href="#h0-221" id="h0-221" class="i">+        for wi, v in pairs({
</a><a href="#h0-222" id="h0-222" class="i">+            [s.l.uri]    = theme.uri_sbar_font,
</a><a href="#h0-223" id="h0-223" class="i">+            [s.l.hist]   = theme.hist_sbar_font,
</a><a href="#h0-224" id="h0-224" class="i">+            [s.l.loaded] = theme.sbar_loaded_font,
</a><a href="#h0-225" id="h0-225" class="i">+            [s.r.buf]    = theme.buf_sbar_font,
</a><a href="#h0-226" id="h0-226" class="i">+            [s.r.ssl]    = theme.ssl_sbar_font,
</a><a href="#h0-227" id="h0-227" class="i">+            [s.r.tabi]   = theme.tabi_sbar_font,
</a><a href="#h0-228" id="h0-228" class="i">+            [s.r.scroll] = theme.scroll_sbar_font,
</a><a href="#h0-229" id="h0-229" class="i">+            [i.prompt]   = theme.prompt_ibar_font,
</a><a href="#h0-230" id="h0-230" class="i">+            [i.input]    = theme.input_ibar_font,
</a><a href="#h0-231" id="h0-231" class="i">+        }) do wi.font = v end
</a><a href="#h0-232" id="h0-232" class="i">+    end,
</a><a href="#h0-233" id="h0-233" class="i">+
</a><a href="#h0-234" id="h0-234" class="i">+    set_default_size = function (w)
</a><a href="#h0-235" id="h0-235" class="i">+        local size = globals.default_window_size or &quot;800x600&quot;
</a><a href="#h0-236" id="h0-236" class="i">+        if string.match(size, &quot;^%d+x%d+$&quot;) then
</a><a href="#h0-237" id="h0-237" class="i">+            w.win:set_default_size(string.match(size, &quot;^(%d+)x(%d+)$&quot;))
</a><a href="#h0-238" id="h0-238" class="i">+        else
</a><a href="#h0-239" id="h0-239" class="i">+            warn(&quot;E: window.lua: invalid window size: %q&quot;, size)
</a><a href="#h0-240" id="h0-240" class="i">+        end
</a><a href="#h0-241" id="h0-241" class="i">+    end,
</a><a href="#h0-242" id="h0-242" class="i">+
</a><a href="#h0-243" id="h0-243" class="i">+    set_window_icon = function (w)
</a><a href="#h0-244" id="h0-244" class="i">+        local path = (luakit.dev_paths and os.exists(&quot;./extras/luakit.png&quot;)) or
</a><a href="#h0-245" id="h0-245" class="i">+            os.exists(&quot;/usr/share/pixmaps/luakit.png&quot;)
</a><a href="#h0-246" id="h0-246" class="i">+        if path then w.win.icon = path end
</a><a href="#h0-247" id="h0-247" class="i">+    end,
</a><a href="#h0-248" id="h0-248" class="i">+
</a><a href="#h0-249" id="h0-249" class="i">+    clear_urgency_hint = function (w)
</a><a href="#h0-250" id="h0-250" class="i">+        w.win:add_signal(&quot;focus&quot;, function ()
</a><a href="#h0-251" id="h0-251" class="i">+            w.win.urgency_hint = false
</a><a href="#h0-252" id="h0-252" class="i">+        end)
</a><a href="#h0-253" id="h0-253" class="i">+    end,
</a><a href="#h0-254" id="h0-254" class="i">+}
</a><a href="#h0-255" id="h0-255" class="i">+
</a><a href="#h0-256" id="h0-256" class="i">+-- Helper functions which operate on the window widgets or structure.
</a><a href="#h0-257" id="h0-257" class="i">+window.methods = {
</a><a href="#h0-258" id="h0-258" class="i">+    -- Wrapper around the bind plugin&apos;s hit method
</a><a href="#h0-259" id="h0-259" class="i">+    hit = function (w, mods, key, opts)
</a><a href="#h0-260" id="h0-260" class="i">+        local opts = lousy.util.table.join(opts or {}, {
</a><a href="#h0-261" id="h0-261" class="i">+            enable_buffer = w:is_mode(&quot;normal&quot;),
</a><a href="#h0-262" id="h0-262" class="i">+            buffer = w.buffer,
</a><a href="#h0-263" id="h0-263" class="i">+        })
</a><a href="#h0-264" id="h0-264" class="i">+
</a><a href="#h0-265" id="h0-265" class="i">+        local caught, newbuf = lousy.bind.hit(w, w.binds, mods, key, opts)
</a><a href="#h0-266" id="h0-266" class="i">+        if w.win then -- Check binding didn&apos;t cause window to exit
</a><a href="#h0-267" id="h0-267" class="i">+            w.buffer = newbuf
</a><a href="#h0-268" id="h0-268" class="i">+            w:update_buf()
</a><a href="#h0-269" id="h0-269" class="i">+        end
</a><a href="#h0-270" id="h0-270" class="i">+        return caught
</a><a href="#h0-271" id="h0-271" class="i">+    end,
</a><a href="#h0-272" id="h0-272" class="i">+
</a><a href="#h0-273" id="h0-273" class="i">+    -- Wrapper around the bind plugin&apos;s match_cmd method
</a><a href="#h0-274" id="h0-274" class="i">+    match_cmd = function (w, buffer)
</a><a href="#h0-275" id="h0-275" class="i">+        return lousy.bind.match_cmd(w, get_mode(&quot;command&quot;).binds, buffer)
</a><a href="#h0-276" id="h0-276" class="i">+    end,
</a><a href="#h0-277" id="h0-277" class="i">+
</a><a href="#h0-278" id="h0-278" class="i">+    -- enter command or characters into command line
</a><a href="#h0-279" id="h0-279" class="i">+    enter_cmd = function (w, cmd, opts)
</a><a href="#h0-280" id="h0-280" class="i">+        w:set_mode(&quot;command&quot;)
</a><a href="#h0-281" id="h0-281" class="i">+        w:set_input(cmd, opts)
</a><a href="#h0-282" id="h0-282" class="i">+    end,
</a><a href="#h0-283" id="h0-283" class="i">+
</a><a href="#h0-284" id="h0-284" class="i">+    -- run command as if typed into the command line
</a><a href="#h0-285" id="h0-285" class="i">+    run_cmd = function (w, cmd, opts)
</a><a href="#h0-286" id="h0-286" class="i">+        w:enter_cmd(cmd, opts)
</a><a href="#h0-287" id="h0-287" class="i">+        w:activate()
</a><a href="#h0-288" id="h0-288" class="i">+    end,
</a><a href="#h0-289" id="h0-289" class="i">+
</a><a href="#h0-290" id="h0-290" class="i">+    -- insert a string into the command line at the current cursor position
</a><a href="#h0-291" id="h0-291" class="i">+    insert_cmd = function (w, str)
</a><a href="#h0-292" id="h0-292" class="i">+        if not str then return end
</a><a href="#h0-293" id="h0-293" class="i">+        local i = w.ibar.input
</a><a href="#h0-294" id="h0-294" class="i">+        local text = i.text
</a><a href="#h0-295" id="h0-295" class="i">+        local pos = i.position
</a><a href="#h0-296" id="h0-296" class="i">+        local left, right = string.sub(text, 1, pos), string.sub(text, pos+1)
</a><a href="#h0-297" id="h0-297" class="i">+        i.text = left .. str .. right
</a><a href="#h0-298" id="h0-298" class="i">+        i.position = pos + #str
</a><a href="#h0-299" id="h0-299" class="i">+    end,
</a><a href="#h0-300" id="h0-300" class="i">+
</a><a href="#h0-301" id="h0-301" class="i">+    -- Emulates pressing the Return key in input field
</a><a href="#h0-302" id="h0-302" class="i">+    activate = function (w)
</a><a href="#h0-303" id="h0-303" class="i">+        w.ibar.input:emit_signal(&quot;activate&quot;)
</a><a href="#h0-304" id="h0-304" class="i">+    end,
</a><a href="#h0-305" id="h0-305" class="i">+
</a><a href="#h0-306" id="h0-306" class="i">+    del_word = function (w)
</a><a href="#h0-307" id="h0-307" class="i">+        local i = w.ibar.input
</a><a href="#h0-308" id="h0-308" class="i">+        local text = i.text
</a><a href="#h0-309" id="h0-309" class="i">+        local pos = i.position
</a><a href="#h0-310" id="h0-310" class="i">+        if text and #text &gt; 1 and pos &gt; 1 then
</a><a href="#h0-311" id="h0-311" class="i">+            local left, right = string.sub(text, 2, pos), string.sub(text, pos+1)
</a><a href="#h0-312" id="h0-312" class="i">+            if not string.find(left, &quot;%s&quot;) then
</a><a href="#h0-313" id="h0-313" class="i">+                left = &quot;&quot;
</a><a href="#h0-314" id="h0-314" class="i">+            elseif string.find(left, &quot;%w+%s*$&quot;) then
</a><a href="#h0-315" id="h0-315" class="i">+                left = string.sub(left, 0, string.find(left, &quot;%w+%s*$&quot;) - 1)
</a><a href="#h0-316" id="h0-316" class="i">+            elseif string.find(left, &quot;%W+%s*$&quot;) then
</a><a href="#h0-317" id="h0-317" class="i">+                left = string.sub(left, 0, string.find(left, &quot;%W+%s*$&quot;) - 1)
</a><a href="#h0-318" id="h0-318" class="i">+            end
</a><a href="#h0-319" id="h0-319" class="i">+            i.text =  string.sub(text, 1, 1) .. left .. right
</a><a href="#h0-320" id="h0-320" class="i">+            i.position = #left + 1
</a><a href="#h0-321" id="h0-321" class="i">+        end
</a><a href="#h0-322" id="h0-322" class="i">+    end,
</a><a href="#h0-323" id="h0-323" class="i">+
</a><a href="#h0-324" id="h0-324" class="i">+    del_line = function (w)
</a><a href="#h0-325" id="h0-325" class="i">+        local i = w.ibar.input
</a><a href="#h0-326" id="h0-326" class="i">+        if not string.match(i.text, &quot;^[:/?]$&quot;) then
</a><a href="#h0-327" id="h0-327" class="i">+            i.text = string.sub(i.text, 1, 1)
</a><a href="#h0-328" id="h0-328" class="i">+            i.position = -1
</a><a href="#h0-329" id="h0-329" class="i">+        end
</a><a href="#h0-330" id="h0-330" class="i">+    end,
</a><a href="#h0-331" id="h0-331" class="i">+
</a><a href="#h0-332" id="h0-332" class="i">+    del_backward_char = function (w)
</a><a href="#h0-333" id="h0-333" class="i">+        local i = w.ibar.input
</a><a href="#h0-334" id="h0-334" class="i">+        local text = i.text
</a><a href="#h0-335" id="h0-335" class="i">+        local pos = i.position
</a><a href="#h0-336" id="h0-336" class="i">+
</a><a href="#h0-337" id="h0-337" class="i">+        if pos &gt; 1 then
</a><a href="#h0-338" id="h0-338" class="i">+            i.text = string.sub(text, 0, pos - 1) .. string.sub(text, pos + 1)
</a><a href="#h0-339" id="h0-339" class="i">+            i.position = pos - 1
</a><a href="#h0-340" id="h0-340" class="i">+        end
</a><a href="#h0-341" id="h0-341" class="i">+    end,
</a><a href="#h0-342" id="h0-342" class="i">+
</a><a href="#h0-343" id="h0-343" class="i">+    del_forward_char = function (w)
</a><a href="#h0-344" id="h0-344" class="i">+        local i = w.ibar.input
</a><a href="#h0-345" id="h0-345" class="i">+        local text = i.text
</a><a href="#h0-346" id="h0-346" class="i">+        local pos = i.position
</a><a href="#h0-347" id="h0-347" class="i">+
</a><a href="#h0-348" id="h0-348" class="i">+        i.text = string.sub(text, 0, pos) .. string.sub(text, pos + 2)
</a><a href="#h0-349" id="h0-349" class="i">+        i.position = pos
</a><a href="#h0-350" id="h0-350" class="i">+    end,
</a><a href="#h0-351" id="h0-351" class="i">+
</a><a href="#h0-352" id="h0-352" class="i">+    beg_line = function (w)
</a><a href="#h0-353" id="h0-353" class="i">+        local i = w.ibar.input
</a><a href="#h0-354" id="h0-354" class="i">+        i.position = 1
</a><a href="#h0-355" id="h0-355" class="i">+    end,
</a><a href="#h0-356" id="h0-356" class="i">+
</a><a href="#h0-357" id="h0-357" class="i">+    end_line = function (w)
</a><a href="#h0-358" id="h0-358" class="i">+        local i = w.ibar.input
</a><a href="#h0-359" id="h0-359" class="i">+        i.position = -1
</a><a href="#h0-360" id="h0-360" class="i">+    end,
</a><a href="#h0-361" id="h0-361" class="i">+
</a><a href="#h0-362" id="h0-362" class="i">+    forward_char = function (w)
</a><a href="#h0-363" id="h0-363" class="i">+        local i = w.ibar.input
</a><a href="#h0-364" id="h0-364" class="i">+        i.position = i.position + 1
</a><a href="#h0-365" id="h0-365" class="i">+    end,
</a><a href="#h0-366" id="h0-366" class="i">+
</a><a href="#h0-367" id="h0-367" class="i">+    backward_char = function (w)
</a><a href="#h0-368" id="h0-368" class="i">+        local i = w.ibar.input
</a><a href="#h0-369" id="h0-369" class="i">+        local pos = i.position
</a><a href="#h0-370" id="h0-370" class="i">+        if pos &gt; 1 then
</a><a href="#h0-371" id="h0-371" class="i">+            i.position = pos - 1
</a><a href="#h0-372" id="h0-372" class="i">+        end
</a><a href="#h0-373" id="h0-373" class="i">+    end,
</a><a href="#h0-374" id="h0-374" class="i">+
</a><a href="#h0-375" id="h0-375" class="i">+    forward_word = function (w)
</a><a href="#h0-376" id="h0-376" class="i">+        local i = w.ibar.input
</a><a href="#h0-377" id="h0-377" class="i">+        local text = i.text
</a><a href="#h0-378" id="h0-378" class="i">+        local pos = i.position
</a><a href="#h0-379" id="h0-379" class="i">+        if text and #text &gt; 1 then
</a><a href="#h0-380" id="h0-380" class="i">+            local right = string.sub(text, pos+1)
</a><a href="#h0-381" id="h0-381" class="i">+            if string.find(right, &quot;%w+&quot;) then
</a><a href="#h0-382" id="h0-382" class="i">+                local _, move = string.find(right, &quot;%w+&quot;)
</a><a href="#h0-383" id="h0-383" class="i">+                i.position = pos + move
</a><a href="#h0-384" id="h0-384" class="i">+            end
</a><a href="#h0-385" id="h0-385" class="i">+        end
</a><a href="#h0-386" id="h0-386" class="i">+    end,
</a><a href="#h0-387" id="h0-387" class="i">+
</a><a href="#h0-388" id="h0-388" class="i">+    backward_word = function (w)
</a><a href="#h0-389" id="h0-389" class="i">+        local i = w.ibar.input
</a><a href="#h0-390" id="h0-390" class="i">+        local text = i.text
</a><a href="#h0-391" id="h0-391" class="i">+        local pos = i.position
</a><a href="#h0-392" id="h0-392" class="i">+        if text and #text &gt; 1 and pos &gt; 1 then
</a><a href="#h0-393" id="h0-393" class="i">+            local left = string.reverse(string.sub(text, 2, pos))
</a><a href="#h0-394" id="h0-394" class="i">+            if string.find(left, &quot;%w+&quot;) then
</a><a href="#h0-395" id="h0-395" class="i">+                local _, move = string.find(left, &quot;%w+&quot;)
</a><a href="#h0-396" id="h0-396" class="i">+                i.position = pos - move
</a><a href="#h0-397" id="h0-397" class="i">+            end
</a><a href="#h0-398" id="h0-398" class="i">+        end
</a><a href="#h0-399" id="h0-399" class="i">+    end,
</a><a href="#h0-400" id="h0-400" class="i">+
</a><a href="#h0-401" id="h0-401" class="i">+    -- Shows a notification until the next keypress of the user.
</a><a href="#h0-402" id="h0-402" class="i">+    notify = function (w, msg, set_mode)
</a><a href="#h0-403" id="h0-403" class="i">+        if set_mode ~= false then w:set_mode() end
</a><a href="#h0-404" id="h0-404" class="i">+        w:set_prompt(msg, { fg = theme.notif_fg, bg = theme.notif_bg })
</a><a href="#h0-405" id="h0-405" class="i">+    end,
</a><a href="#h0-406" id="h0-406" class="i">+
</a><a href="#h0-407" id="h0-407" class="i">+    warning = function (w, msg, set_mode)
</a><a href="#h0-408" id="h0-408" class="i">+        if set_mode ~= false then w:set_mode() end
</a><a href="#h0-409" id="h0-409" class="i">+        w:set_prompt(msg, { fg = theme.warning_fg, bg = theme.warning_bg })
</a><a href="#h0-410" id="h0-410" class="i">+    end,
</a><a href="#h0-411" id="h0-411" class="i">+
</a><a href="#h0-412" id="h0-412" class="i">+    error = function (w, msg, set_mode)
</a><a href="#h0-413" id="h0-413" class="i">+        if set_mode ~= false then w:set_mode() end
</a><a href="#h0-414" id="h0-414" class="i">+        w:set_prompt(&quot;Error: &quot;..msg, { fg = theme.error_fg, bg = theme.error_bg })
</a><a href="#h0-415" id="h0-415" class="i">+    end,
</a><a href="#h0-416" id="h0-416" class="i">+
</a><a href="#h0-417" id="h0-417" class="i">+    -- Set and display the prompt
</a><a href="#h0-418" id="h0-418" class="i">+    set_prompt = function (w, text, opts)
</a><a href="#h0-419" id="h0-419" class="i">+        local prompt, ebox, opts = w.ibar.prompt, w.ibar.ebox, opts or {}
</a><a href="#h0-420" id="h0-420" class="i">+        prompt:hide()
</a><a href="#h0-421" id="h0-421" class="i">+        -- Set theme
</a><a href="#h0-422" id="h0-422" class="i">+        fg, bg = opts.fg or theme.ibar_fg, opts.bg or theme.ibar_bg
</a><a href="#h0-423" id="h0-423" class="i">+        if prompt.fg ~= fg then prompt.fg = fg end
</a><a href="#h0-424" id="h0-424" class="i">+        if ebox.bg ~= bg then ebox.bg = bg end
</a><a href="#h0-425" id="h0-425" class="i">+        -- Set text or remain hidden
</a><a href="#h0-426" id="h0-426" class="i">+        if text then
</a><a href="#h0-427" id="h0-427" class="i">+            prompt.text = lousy.util.escape(text)
</a><a href="#h0-428" id="h0-428" class="i">+            prompt:show()
</a><a href="#h0-429" id="h0-429" class="i">+        end
</a><a href="#h0-430" id="h0-430" class="i">+    end,
</a><a href="#h0-431" id="h0-431" class="i">+
</a><a href="#h0-432" id="h0-432" class="i">+    -- Set display and focus the input bar
</a><a href="#h0-433" id="h0-433" class="i">+    set_input = function (w, text, opts)
</a><a href="#h0-434" id="h0-434" class="i">+        local input, opts = w.ibar.input, opts or {}
</a><a href="#h0-435" id="h0-435" class="i">+        input:hide()
</a><a href="#h0-436" id="h0-436" class="i">+        -- Set theme
</a><a href="#h0-437" id="h0-437" class="i">+        fg, bg = opts.fg or theme.ibar_fg, opts.bg or theme.ibar_bg
</a><a href="#h0-438" id="h0-438" class="i">+        if input.fg ~= fg then input.fg = fg end
</a><a href="#h0-439" id="h0-439" class="i">+        if input.bg ~= bg then input.bg = bg end
</a><a href="#h0-440" id="h0-440" class="i">+        -- Set text or remain hidden
</a><a href="#h0-441" id="h0-441" class="i">+        if text then
</a><a href="#h0-442" id="h0-442" class="i">+            input.text = &quot;&quot;
</a><a href="#h0-443" id="h0-443" class="i">+            input:show()
</a><a href="#h0-444" id="h0-444" class="i">+            input:focus()
</a><a href="#h0-445" id="h0-445" class="i">+            input.text = text
</a><a href="#h0-446" id="h0-446" class="i">+            input.position = opts.pos or -1
</a><a href="#h0-447" id="h0-447" class="i">+        end
</a><a href="#h0-448" id="h0-448" class="i">+    end,
</a><a href="#h0-449" id="h0-449" class="i">+
</a><a href="#h0-450" id="h0-450" class="i">+    -- GUI content update functions
</a><a href="#h0-451" id="h0-451" class="i">+    update_tab_count = function (w)
</a><a href="#h0-452" id="h0-452" class="i">+        w.sbar.r.tabi.text = string.format(&quot;[%d/%d]&quot;, w.tabs:current(), w.tabs:count())
</a><a href="#h0-453" id="h0-453" class="i">+    end,
</a><a href="#h0-454" id="h0-454" class="i">+
</a><a href="#h0-455" id="h0-455" class="i">+    update_win_title = function (w)
</a><a href="#h0-456" id="h0-456" class="i">+        local uri, title = w.view.uri, w.view.title
</a><a href="#h0-457" id="h0-457" class="i">+        title = (title or &quot;luakit&quot;) .. ((uri and &quot; - &quot; .. uri) or &quot;&quot;)
</a><a href="#h0-458" id="h0-458" class="i">+        local max = globals.max_title_len or 80
</a><a href="#h0-459" id="h0-459" class="i">+        if #title &gt; max then title = string.sub(title, 1, max) .. &quot;...&quot; end
</a><a href="#h0-460" id="h0-460" class="i">+        w.win.title = title
</a><a href="#h0-461" id="h0-461" class="i">+    end,
</a><a href="#h0-462" id="h0-462" class="i">+
</a><a href="#h0-463" id="h0-463" class="i">+    update_uri = function (w, link)
</a><a href="#h0-464" id="h0-464" class="i">+        w.sbar.l.uri.text = lousy.util.escape((link and &quot;Link: &quot; .. link)
</a><a href="#h0-465" id="h0-465" class="i">+            or (w.view and w.view.uri) or &quot;about:blank&quot;)
</a><a href="#h0-466" id="h0-466" class="i">+    end,
</a><a href="#h0-467" id="h0-467" class="i">+
</a><a href="#h0-468" id="h0-468" class="i">+    update_progress = function (w)
</a><a href="#h0-469" id="h0-469" class="i">+        local p = w.view.progress
</a><a href="#h0-470" id="h0-470" class="i">+        local loaded = w.sbar.l.loaded
</a><a href="#h0-471" id="h0-471" class="i">+        if not w.view:loading() or p == 1 then
</a><a href="#h0-472" id="h0-472" class="i">+            loaded:hide()
</a><a href="#h0-473" id="h0-473" class="i">+        else
</a><a href="#h0-474" id="h0-474" class="i">+            loaded:show()
</a><a href="#h0-475" id="h0-475" class="i">+            loaded.text = string.format(&quot;(%d%%)&quot;, p * 100)
</a><a href="#h0-476" id="h0-476" class="i">+        end
</a><a href="#h0-477" id="h0-477" class="i">+    end,
</a><a href="#h0-478" id="h0-478" class="i">+
</a><a href="#h0-479" id="h0-479" class="i">+    update_scroll = function (w)
</a><a href="#h0-480" id="h0-480" class="i">+        local scroll, label = w.view.scroll, w.sbar.r.scroll
</a><a href="#h0-481" id="h0-481" class="i">+        local y, max, text = scroll.y, scroll.ymax
</a><a href="#h0-482" id="h0-482" class="i">+        if     max == 0   then text = &quot;All&quot;
</a><a href="#h0-483" id="h0-483" class="i">+        elseif y   == 0   then text = &quot;Top&quot;
</a><a href="#h0-484" id="h0-484" class="i">+        elseif y   == max then text = &quot;Bot&quot;
</a><a href="#h0-485" id="h0-485" class="i">+        else text = string.format(&quot;%2d%%&quot;, (y / max) * 100)
</a><a href="#h0-486" id="h0-486" class="i">+        end
</a><a href="#h0-487" id="h0-487" class="i">+        if label.text ~= text then label.text = text end
</a><a href="#h0-488" id="h0-488" class="i">+    end,
</a><a href="#h0-489" id="h0-489" class="i">+
</a><a href="#h0-490" id="h0-490" class="i">+    update_ssl = function (w)
</a><a href="#h0-491" id="h0-491" class="i">+        local trusted = w.view:ssl_trusted()
</a><a href="#h0-492" id="h0-492" class="i">+        local ssl = w.sbar.r.ssl
</a><a href="#h0-493" id="h0-493" class="i">+        if trusted ~= nil and not w.checking_ssl then
</a><a href="#h0-494" id="h0-494" class="i">+            ssl.fg = theme.notrust_fg
</a><a href="#h0-495" id="h0-495" class="i">+            ssl.text = &quot;(nocheck)&quot;
</a><a href="#h0-496" id="h0-496" class="i">+            ssl:show()
</a><a href="#h0-497" id="h0-497" class="i">+        elseif trusted == true then
</a><a href="#h0-498" id="h0-498" class="i">+            ssl.fg = theme.trust_fg
</a><a href="#h0-499" id="h0-499" class="i">+            ssl.text = &quot;(trust)&quot;
</a><a href="#h0-500" id="h0-500" class="i">+            ssl:show()
</a><a href="#h0-501" id="h0-501" class="i">+        elseif trusted == false then
</a><a href="#h0-502" id="h0-502" class="i">+            ssl.fg = theme.notrust_fg
</a><a href="#h0-503" id="h0-503" class="i">+            ssl.text = &quot;(notrust)&quot;
</a><a href="#h0-504" id="h0-504" class="i">+            ssl:show()
</a><a href="#h0-505" id="h0-505" class="i">+        else
</a><a href="#h0-506" id="h0-506" class="i">+            ssl:hide()
</a><a href="#h0-507" id="h0-507" class="i">+        end
</a><a href="#h0-508" id="h0-508" class="i">+    end,
</a><a href="#h0-509" id="h0-509" class="i">+
</a><a href="#h0-510" id="h0-510" class="i">+    update_hist = function (w)
</a><a href="#h0-511" id="h0-511" class="i">+        local hist = w.sbar.l.hist
</a><a href="#h0-512" id="h0-512" class="i">+        local back, forward = w.view:can_go_back(), w.view:can_go_forward()
</a><a href="#h0-513" id="h0-513" class="i">+        local s = (back and &quot;+&quot; or &quot;&quot;) .. (forward and &quot;-&quot; or &quot;&quot;)
</a><a href="#h0-514" id="h0-514" class="i">+        if s ~= &quot;&quot; then
</a><a href="#h0-515" id="h0-515" class="i">+            hist.text = &apos;[&apos;..s..&apos;]&apos;
</a><a href="#h0-516" id="h0-516" class="i">+            hist:show()
</a><a href="#h0-517" id="h0-517" class="i">+        else
</a><a href="#h0-518" id="h0-518" class="i">+            hist:hide()
</a><a href="#h0-519" id="h0-519" class="i">+        end
</a><a href="#h0-520" id="h0-520" class="i">+    end,
</a><a href="#h0-521" id="h0-521" class="i">+
</a><a href="#h0-522" id="h0-522" class="i">+    update_buf = function (w)
</a><a href="#h0-523" id="h0-523" class="i">+        local buf = w.sbar.r.buf
</a><a href="#h0-524" id="h0-524" class="i">+        if w.buffer then
</a><a href="#h0-525" id="h0-525" class="i">+            buf.text = lousy.util.escape(string.format(&quot; %-3s&quot;, w.buffer))
</a><a href="#h0-526" id="h0-526" class="i">+            buf:show()
</a><a href="#h0-527" id="h0-527" class="i">+        else
</a><a href="#h0-528" id="h0-528" class="i">+            buf:hide()
</a><a href="#h0-529" id="h0-529" class="i">+        end
</a><a href="#h0-530" id="h0-530" class="i">+    end,
</a><a href="#h0-531" id="h0-531" class="i">+
</a><a href="#h0-532" id="h0-532" class="i">+    update_binds = function (w, mode)
</a><a href="#h0-533" id="h0-533" class="i">+        -- Generate the list of active key &amp; buffer binds for this mode
</a><a href="#h0-534" id="h0-534" class="i">+        w.binds = lousy.util.table.join((get_mode(mode) or {}).binds or {}, get_mode(&apos;all&apos;).binds or {})
</a><a href="#h0-535" id="h0-535" class="i">+        -- Clear &amp; hide buffer
</a><a href="#h0-536" id="h0-536" class="i">+        w.buffer = nil
</a><a href="#h0-537" id="h0-537" class="i">+        w:update_buf()
</a><a href="#h0-538" id="h0-538" class="i">+    end,
</a><a href="#h0-539" id="h0-539" class="i">+
</a><a href="#h0-540" id="h0-540" class="i">+    update_tablist = function (w)
</a><a href="#h0-541" id="h0-541" class="i">+        local current = w.tabs:current()
</a><a href="#h0-542" id="h0-542" class="i">+        local fg, bg, nfg, snfg = theme.tab_fg, theme.tab_bg, theme.tab_ntheme, theme.selected_ntheme
</a><a href="#h0-543" id="h0-543" class="i">+        local lfg, bfg, gfg = theme.tab_loading_fg, theme.tab_notrust_fg, theme.tab_trust_fg
</a><a href="#h0-544" id="h0-544" class="i">+        local escape = lousy.util.escape
</a><a href="#h0-545" id="h0-545" class="i">+        local tabs, tfmt = {}, &apos; &lt;span foreground=&quot;%s&quot;&gt;%s&lt;/span&gt; %s&apos;
</a><a href="#h0-546" id="h0-546" class="i">+
</a><a href="#h0-547" id="h0-547" class="i">+        for i, view in ipairs(w.tabs.children) do
</a><a href="#h0-548" id="h0-548" class="i">+            -- Get tab number theme
</a><a href="#h0-549" id="h0-549" class="i">+            local ntheme = nfg
</a><a href="#h0-550" id="h0-550" class="i">+            if view:loading() then -- Show loading on all tabs
</a><a href="#h0-551" id="h0-551" class="i">+                ntheme = lfg
</a><a href="#h0-552" id="h0-552" class="i">+            elseif current == i then -- Show ssl trusted/untrusted on current tab
</a><a href="#h0-553" id="h0-553" class="i">+                local trusted = view:ssl_trusted()
</a><a href="#h0-554" id="h0-554" class="i">+                ntheme = snfg
</a><a href="#h0-555" id="h0-555" class="i">+                if trusted == false or (trusted ~= nil and not w.checking_ssl) then
</a><a href="#h0-556" id="h0-556" class="i">+                    ntheme = bfg
</a><a href="#h0-557" id="h0-557" class="i">+                elseif trusted then
</a><a href="#h0-558" id="h0-558" class="i">+                    ntheme = gfg
</a><a href="#h0-559" id="h0-559" class="i">+                end
</a><a href="#h0-560" id="h0-560" class="i">+            end
</a><a href="#h0-561" id="h0-561" class="i">+            local title = view.title or view.uri or &quot;(Untitled)&quot;
</a><a href="#h0-562" id="h0-562" class="i">+            tabs[i] = {
</a><a href="#h0-563" id="h0-563" class="i">+                title = string.format(tfmt, ntheme or fg, i, escape(title)),
</a><a href="#h0-564" id="h0-564" class="i">+                fg = (current == i and theme.tab_selected_fg) or fg,
</a><a href="#h0-565" id="h0-565" class="i">+                bg = (current == i and theme.tab_selected_bg) or bg,
</a><a href="#h0-566" id="h0-566" class="i">+            }
</a><a href="#h0-567" id="h0-567" class="i">+        end
</a><a href="#h0-568" id="h0-568" class="i">+
</a><a href="#h0-569" id="h0-569" class="i">+        if #tabs &lt; 2 then tabs, current = {}, 0 end
</a><a href="#h0-570" id="h0-570" class="i">+        w.tablist:update(tabs, current)
</a><a href="#h0-571" id="h0-571" class="i">+    end,
</a><a href="#h0-572" id="h0-572" class="i">+
</a><a href="#h0-573" id="h0-573" class="i">+    new_tab = function (w, arg, switch, order)
</a><a href="#h0-574" id="h0-574" class="i">+        local view
</a><a href="#h0-575" id="h0-575" class="i">+        -- Use blank tab first
</a><a href="#h0-576" id="h0-576" class="i">+        if w.has_blank and w.tabs:count() == 1 and w.tabs[1].uri == &quot;about:blank&quot; then
</a><a href="#h0-577" id="h0-577" class="i">+            view = w.tabs[1]
</a><a href="#h0-578" id="h0-578" class="i">+        end
</a><a href="#h0-579" id="h0-579" class="i">+        w.has_blank = nil
</a><a href="#h0-580" id="h0-580" class="i">+        -- Make new webview widget
</a><a href="#h0-581" id="h0-581" class="i">+        if not view then
</a><a href="#h0-582" id="h0-582" class="i">+            view = webview.new(w)
</a><a href="#h0-583" id="h0-583" class="i">+            -- Get tab order function
</a><a href="#h0-584" id="h0-584" class="i">+            if not order and taborder then
</a><a href="#h0-585" id="h0-585" class="i">+                order = (switch == false and taborder.default_bg)
</a><a href="#h0-586" id="h0-586" class="i">+                    or taborder.default
</a><a href="#h0-587" id="h0-587" class="i">+            end
</a><a href="#h0-588" id="h0-588" class="i">+            pos = w.tabs:insert((order and order(w, view)) or -1, view)
</a><a href="#h0-589" id="h0-589" class="i">+            if switch ~= false then w.tabs:switch(pos) end
</a><a href="#h0-590" id="h0-590" class="i">+        end
</a><a href="#h0-591" id="h0-591" class="i">+        -- Load uri or webview history table
</a><a href="#h0-592" id="h0-592" class="i">+        if type(arg) == &quot;string&quot; then view.uri = arg
</a><a href="#h0-593" id="h0-593" class="i">+        elseif type(arg) == &quot;table&quot; then view.history = arg end
</a><a href="#h0-594" id="h0-594" class="i">+        -- Update statusbar widgets
</a><a href="#h0-595" id="h0-595" class="i">+        w:update_tab_count()
</a><a href="#h0-596" id="h0-596" class="i">+        w:update_tablist()
</a><a href="#h0-597" id="h0-597" class="i">+        return view
</a><a href="#h0-598" id="h0-598" class="i">+    end,
</a><a href="#h0-599" id="h0-599" class="i">+
</a><a href="#h0-600" id="h0-600" class="i">+    -- close the current tab
</a><a href="#h0-601" id="h0-601" class="i">+    close_tab = function (w, view, blank_last)
</a><a href="#h0-602" id="h0-602" class="i">+        view = view or w.view
</a><a href="#h0-603" id="h0-603" class="i">+        -- Treat a blank last tab as an empty notebook (if blank_last=true)
</a><a href="#h0-604" id="h0-604" class="i">+        if blank_last ~= false and w.tabs:count() == 1 then
</a><a href="#h0-605" id="h0-605" class="i">+            if not view:loading() and view.uri == &quot;about:blank&quot; then return end
</a><a href="#h0-606" id="h0-606" class="i">+            w:new_tab(&quot;about:blank&quot;, false)
</a><a href="#h0-607" id="h0-607" class="i">+            w.has_blank = true
</a><a href="#h0-608" id="h0-608" class="i">+        end
</a><a href="#h0-609" id="h0-609" class="i">+        -- Save tab history
</a><a href="#h0-610" id="h0-610" class="i">+        local tab = {hist = view.history,}
</a><a href="#h0-611" id="h0-611" class="i">+        -- And relative location
</a><a href="#h0-612" id="h0-612" class="i">+        local index = w.tabs:indexof(view)
</a><a href="#h0-613" id="h0-613" class="i">+        if index ~= 1 then tab.after = w.tabs[index-1] end
</a><a href="#h0-614" id="h0-614" class="i">+        table.insert(w.closed_tabs, tab)
</a><a href="#h0-615" id="h0-615" class="i">+        view:destroy()
</a><a href="#h0-616" id="h0-616" class="i">+        w:update_tab_count()
</a><a href="#h0-617" id="h0-617" class="i">+        w:update_tablist()
</a><a href="#h0-618" id="h0-618" class="i">+    end,
</a><a href="#h0-619" id="h0-619" class="i">+
</a><a href="#h0-620" id="h0-620" class="i">+    close_win = function (w, force)
</a><a href="#h0-621" id="h0-621" class="i">+        -- Ask plugins if it&apos;s OK to close last window
</a><a href="#h0-622" id="h0-622" class="i">+        if not force and (#luakit.windows == 1) then
</a><a href="#h0-623" id="h0-623" class="i">+            local emsg = luakit.emit_signal(&quot;can-close&quot;, w)
</a><a href="#h0-624" id="h0-624" class="i">+            if emsg then
</a><a href="#h0-625" id="h0-625" class="i">+                assert(type(emsg) == &quot;string&quot;, &quot;invalid exit error message&quot;)
</a><a href="#h0-626" id="h0-626" class="i">+                w:error(string.format(&quot;Can&apos;t close luakit: %s (force close &quot;
</a><a href="#h0-627" id="h0-627" class="i">+                    .. &quot;with :q! or :wq!)&quot;, emsg))
</a><a href="#h0-628" id="h0-628" class="i">+                return false
</a><a href="#h0-629" id="h0-629" class="i">+            end
</a><a href="#h0-630" id="h0-630" class="i">+        end
</a><a href="#h0-631" id="h0-631" class="i">+
</a><a href="#h0-632" id="h0-632" class="i">+        w:emit_signal(&quot;close&quot;)
</a><a href="#h0-633" id="h0-633" class="i">+
</a><a href="#h0-634" id="h0-634" class="i">+        -- Close all tabs
</a><a href="#h0-635" id="h0-635" class="i">+        while w.tabs:count() ~= 0 do
</a><a href="#h0-636" id="h0-636" class="i">+            w:close_tab(nil, false)
</a><a href="#h0-637" id="h0-637" class="i">+        end
</a><a href="#h0-638" id="h0-638" class="i">+
</a><a href="#h0-639" id="h0-639" class="i">+        -- Destroy tablist
</a><a href="#h0-640" id="h0-640" class="i">+        w.tablist:destroy()
</a><a href="#h0-641" id="h0-641" class="i">+
</a><a href="#h0-642" id="h0-642" class="i">+        -- Remove from window index
</a><a href="#h0-643" id="h0-643" class="i">+        window.bywidget[w.win] = nil
</a><a href="#h0-644" id="h0-644" class="i">+
</a><a href="#h0-645" id="h0-645" class="i">+        -- Clear window struct
</a><a href="#h0-646" id="h0-646" class="i">+        w = setmetatable(w, {})
</a><a href="#h0-647" id="h0-647" class="i">+
</a><a href="#h0-648" id="h0-648" class="i">+        -- Recursively remove widgets from window
</a><a href="#h0-649" id="h0-649" class="i">+        local children = lousy.util.recursive_remove(w.win)
</a><a href="#h0-650" id="h0-650" class="i">+        -- Destroy all widgets
</a><a href="#h0-651" id="h0-651" class="i">+        for i, c in ipairs(lousy.util.table.join(children, {w.win})) do
</a><a href="#h0-652" id="h0-652" class="i">+            if c.hide then c:hide() end
</a><a href="#h0-653" id="h0-653" class="i">+            c:destroy()
</a><a href="#h0-654" id="h0-654" class="i">+        end
</a><a href="#h0-655" id="h0-655" class="i">+
</a><a href="#h0-656" id="h0-656" class="i">+        -- Remove all window table vars
</a><a href="#h0-657" id="h0-657" class="i">+        for k, _ in pairs(w) do w[k] = nil end
</a><a href="#h0-658" id="h0-658" class="i">+
</a><a href="#h0-659" id="h0-659" class="i">+        -- Quit if closed last window
</a><a href="#h0-660" id="h0-660" class="i">+        if #luakit.windows == 0 then luakit.quit() end
</a><a href="#h0-661" id="h0-661" class="i">+    end,
</a><a href="#h0-662" id="h0-662" class="i">+
</a><a href="#h0-663" id="h0-663" class="i">+    -- Navigate current view or open new tab
</a><a href="#h0-664" id="h0-664" class="i">+    navigate = function (w, uri, view)
</a><a href="#h0-665" id="h0-665" class="i">+        view = view or w.view
</a><a href="#h0-666" id="h0-666" class="i">+        if view then
</a><a href="#h0-667" id="h0-667" class="i">+            local js = string.match(uri, &quot;^javascript:(.+)$&quot;)
</a><a href="#h0-668" id="h0-668" class="i">+            if js then
</a><a href="#h0-669" id="h0-669" class="i">+                return view:eval_js(luakit.uri_decode(js))
</a><a href="#h0-670" id="h0-670" class="i">+            end
</a><a href="#h0-671" id="h0-671" class="i">+            view.uri = uri
</a><a href="#h0-672" id="h0-672" class="i">+        else
</a><a href="#h0-673" id="h0-673" class="i">+            return w:new_tab(uri)
</a><a href="#h0-674" id="h0-674" class="i">+        end
</a><a href="#h0-675" id="h0-675" class="i">+    end,
</a><a href="#h0-676" id="h0-676" class="i">+
</a><a href="#h0-677" id="h0-677" class="i">+    -- Save, restart luakit and reload session.
</a><a href="#h0-678" id="h0-678" class="i">+    restart = function (w)
</a><a href="#h0-679" id="h0-679" class="i">+        -- Generate luakit launch command.
</a><a href="#h0-680" id="h0-680" class="i">+        local args = {({string.gsub(luakit.execpath, &quot; &quot;, &quot;\\ &quot;)})[1]}
</a><a href="#h0-681" id="h0-681" class="i">+        if luakit.verbose then table.insert(args, &quot;-v&quot;) end
</a><a href="#h0-682" id="h0-682" class="i">+        -- Relaunch without libunique bindings?
</a><a href="#h0-683" id="h0-683" class="i">+        if luakit.nounique then table.insert(args, &quot;-U&quot;) end
</a><a href="#h0-684" id="h0-684" class="i">+
</a><a href="#h0-685" id="h0-685" class="i">+        -- Get new config path
</a><a href="#h0-686" id="h0-686" class="i">+        local conf
</a><a href="#h0-687" id="h0-687" class="i">+        if luakit.confpath ~= &quot;/etc/xdg/luakit/rc.lua&quot; and os.exists(luakit.confpath) then
</a><a href="#h0-688" id="h0-688" class="i">+            conf = luakit.confpath
</a><a href="#h0-689" id="h0-689" class="i">+            table.insert(args, string.format(&quot;-c %q&quot;, conf))
</a><a href="#h0-690" id="h0-690" class="i">+        end
</a><a href="#h0-691" id="h0-691" class="i">+
</a><a href="#h0-692" id="h0-692" class="i">+        -- Check config has valid syntax
</a><a href="#h0-693" id="h0-693" class="i">+        local cmd = table.concat(args, &quot; &quot;)
</a><a href="#h0-694" id="h0-694" class="i">+        if luakit.spawn_sync(cmd .. &quot; -k&quot;) ~= 0 then
</a><a href="#h0-695" id="h0-695" class="i">+            return w:error(&quot;Cannot restart, syntax error in configuration file&quot;..((conf and &quot;: &quot;..conf) or &quot;.&quot;))
</a><a href="#h0-696" id="h0-696" class="i">+        end
</a><a href="#h0-697" id="h0-697" class="i">+
</a><a href="#h0-698" id="h0-698" class="i">+        -- Save session.
</a><a href="#h0-699" id="h0-699" class="i">+        local wins = {}
</a><a href="#h0-700" id="h0-700" class="i">+        for _, w in pairs(window.bywidget) do table.insert(wins, w) end
</a><a href="#h0-701" id="h0-701" class="i">+        session.save(wins)
</a><a href="#h0-702" id="h0-702" class="i">+
</a><a href="#h0-703" id="h0-703" class="i">+        -- Replace current process with new luakit instance.
</a><a href="#h0-704" id="h0-704" class="i">+        luakit.exec(cmd)
</a><a href="#h0-705" id="h0-705" class="i">+    end,
</a><a href="#h0-706" id="h0-706" class="i">+
</a><a href="#h0-707" id="h0-707" class="i">+    -- Intelligent open command which can detect a uri or search argument.
</a><a href="#h0-708" id="h0-708" class="i">+    search_open = function (w, arg)
</a><a href="#h0-709" id="h0-709" class="i">+        local lstring = lousy.util.string
</a><a href="#h0-710" id="h0-710" class="i">+        local match, find = string.match, string.find
</a><a href="#h0-711" id="h0-711" class="i">+
</a><a href="#h0-712" id="h0-712" class="i">+        -- Detect blank uris
</a><a href="#h0-713" id="h0-713" class="i">+        if not arg or match(arg, &quot;^%s*$&quot;) then return &quot;about:blank&quot; end
</a><a href="#h0-714" id="h0-714" class="i">+
</a><a href="#h0-715" id="h0-715" class="i">+        -- Strip whitespace and split by whitespace into args table
</a><a href="#h0-716" id="h0-716" class="i">+        local args = lstring.split(lstring.strip(arg))
</a><a href="#h0-717" id="h0-717" class="i">+
</a><a href="#h0-718" id="h0-718" class="i">+        -- Guess if first argument is an address, search engine, file
</a><a href="#h0-719" id="h0-719" class="i">+        if #args == 1 then
</a><a href="#h0-720" id="h0-720" class="i">+            local uri = args[1]
</a><a href="#h0-721" id="h0-721" class="i">+            if uri == &quot;about:blank&quot; then return uri end
</a><a href="#h0-722" id="h0-722" class="i">+
</a><a href="#h0-723" id="h0-723" class="i">+            -- Check if search engine name
</a><a href="#h0-724" id="h0-724" class="i">+            if search_engines[uri] then
</a><a href="#h0-725" id="h0-725" class="i">+                return string.format(search_engines[uri], &quot;&quot;)
</a><a href="#h0-726" id="h0-726" class="i">+            end
</a><a href="#h0-727" id="h0-727" class="i">+
</a><a href="#h0-728" id="h0-728" class="i">+            -- Navigate if . or / in uri (I.e. domains, IP&apos;s, scheme://)
</a><a href="#h0-729" id="h0-729" class="i">+            if find(uri, &quot;%.&quot;) or find(uri, &quot;/&quot;) then return uri end
</a><a href="#h0-730" id="h0-730" class="i">+
</a><a href="#h0-731" id="h0-731" class="i">+            -- Navigate if this is a javascript-uri
</a><a href="#h0-732" id="h0-732" class="i">+            if find(uri, &quot;^javascript:&quot;) then return uri end
</a><a href="#h0-733" id="h0-733" class="i">+
</a><a href="#h0-734" id="h0-734" class="i">+            -- Valid hostnames to check
</a><a href="#h0-735" id="h0-735" class="i">+            local hosts = { &quot;localhost&quot; }
</a><a href="#h0-736" id="h0-736" class="i">+            if globals.load_etc_hosts ~= false then
</a><a href="#h0-737" id="h0-737" class="i">+                hosts = lousy.util.get_etc_hosts()
</a><a href="#h0-738" id="h0-738" class="i">+            end
</a><a href="#h0-739" id="h0-739" class="i">+
</a><a href="#h0-740" id="h0-740" class="i">+            -- Check hostnames
</a><a href="#h0-741" id="h0-741" class="i">+            for _, h in pairs(hosts) do
</a><a href="#h0-742" id="h0-742" class="i">+                if h == uri or match(uri, &quot;^&quot;..h..&quot;:%d+$&quot;) then return uri end
</a><a href="#h0-743" id="h0-743" class="i">+            end
</a><a href="#h0-744" id="h0-744" class="i">+
</a><a href="#h0-745" id="h0-745" class="i">+            -- Check for file in filesystem
</a><a href="#h0-746" id="h0-746" class="i">+            if globals.check_filepath ~= false then
</a><a href="#h0-747" id="h0-747" class="i">+                if lfs.attributes(uri) then return &quot;file://&quot; .. uri end
</a><a href="#h0-748" id="h0-748" class="i">+            end
</a><a href="#h0-749" id="h0-749" class="i">+        end
</a><a href="#h0-750" id="h0-750" class="i">+
</a><a href="#h0-751" id="h0-751" class="i">+        -- Find search engine (or use search_engines.default)
</a><a href="#h0-752" id="h0-752" class="i">+        local engine = &quot;default&quot;
</a><a href="#h0-753" id="h0-753" class="i">+        if args[1] and search_engines[args[1]] then
</a><a href="#h0-754" id="h0-754" class="i">+            engine = args[1]
</a><a href="#h0-755" id="h0-755" class="i">+            table.remove(args, 1)
</a><a href="#h0-756" id="h0-756" class="i">+        end
</a><a href="#h0-757" id="h0-757" class="i">+
</a><a href="#h0-758" id="h0-758" class="i">+        -- URI encode search terms
</a><a href="#h0-759" id="h0-759" class="i">+        local terms = luakit.uri_encode(table.concat(args, &quot; &quot;))
</a><a href="#h0-760" id="h0-760" class="i">+        return string.format(search_engines[engine], terms)
</a><a href="#h0-761" id="h0-761" class="i">+    end,
</a><a href="#h0-762" id="h0-762" class="i">+
</a><a href="#h0-763" id="h0-763" class="i">+    -- Increase (or decrease) the last found number in the current uri
</a><a href="#h0-764" id="h0-764" class="i">+    inc_uri = function (w, arg)
</a><a href="#h0-765" id="h0-765" class="i">+        local uri = string.gsub(w.view.uri, &quot;(%d+)([^0-9]*)$&quot;, function (num, rest)
</a><a href="#h0-766" id="h0-766" class="i">+            return string.format(&quot;%0&quot;..#num..&quot;d&quot;, tonumber(num) + (arg or 1)) .. rest
</a><a href="#h0-767" id="h0-767" class="i">+        end)
</a><a href="#h0-768" id="h0-768" class="i">+        return uri
</a><a href="#h0-769" id="h0-769" class="i">+    end,
</a><a href="#h0-770" id="h0-770" class="i">+
</a><a href="#h0-771" id="h0-771" class="i">+    -- Tab traversing functions
</a><a href="#h0-772" id="h0-772" class="i">+    next_tab = function (w, n)
</a><a href="#h0-773" id="h0-773" class="i">+        w.tabs:switch((((n or 1) + w.tabs:current() -1) % w.tabs:count()) + 1)
</a><a href="#h0-774" id="h0-774" class="i">+    end,
</a><a href="#h0-775" id="h0-775" class="i">+
</a><a href="#h0-776" id="h0-776" class="i">+    prev_tab = function (w, n)
</a><a href="#h0-777" id="h0-777" class="i">+        w.tabs:switch(((w.tabs:current() - (n or 1) -1) % w.tabs:count()) + 1)
</a><a href="#h0-778" id="h0-778" class="i">+    end,
</a><a href="#h0-779" id="h0-779" class="i">+
</a><a href="#h0-780" id="h0-780" class="i">+    goto_tab = function (w, n)
</a><a href="#h0-781" id="h0-781" class="i">+        if n and (n == -1 or n &gt; 0) then
</a><a href="#h0-782" id="h0-782" class="i">+            return w.tabs:switch((n &lt;= w.tabs:count() and n) or -1)
</a><a href="#h0-783" id="h0-783" class="i">+        end
</a><a href="#h0-784" id="h0-784" class="i">+    end,
</a><a href="#h0-785" id="h0-785" class="i">+
</a><a href="#h0-786" id="h0-786" class="i">+    -- For each tab, switches to that tab and calls the given function passing
</a><a href="#h0-787" id="h0-787" class="i">+    -- it the view contained in the tab.
</a><a href="#h0-788" id="h0-788" class="i">+    each_tab = function (w, fn)
</a><a href="#h0-789" id="h0-789" class="i">+        for index = 1, w.tabs:count() do
</a><a href="#h0-790" id="h0-790" class="i">+            w:goto_tab(index)
</a><a href="#h0-791" id="h0-791" class="i">+            fn(w.tabs[index])
</a><a href="#h0-792" id="h0-792" class="i">+        end
</a><a href="#h0-793" id="h0-793" class="i">+    end,
</a><a href="#h0-794" id="h0-794" class="i">+
</a><a href="#h0-795" id="h0-795" class="i">+    -- If argument is form-active or root-active, emits signal. Ignores all
</a><a href="#h0-796" id="h0-796" class="i">+    -- other signals.
</a><a href="#h0-797" id="h0-797" class="i">+    emit_form_root_active_signal = function (w, s)
</a><a href="#h0-798" id="h0-798" class="i">+        if s == &quot;form-active&quot; then
</a><a href="#h0-799" id="h0-799" class="i">+            w.view:emit_signal(&quot;form-active&quot;)
</a><a href="#h0-800" id="h0-800" class="i">+        elseif s == &quot;root-active&quot; then
</a><a href="#h0-801" id="h0-801" class="i">+            w.view:emit_signal(&quot;root-active&quot;)
</a><a href="#h0-802" id="h0-802" class="i">+        end
</a><a href="#h0-803" id="h0-803" class="i">+    end,
</a><a href="#h0-804" id="h0-804" class="i">+}
</a><a href="#h0-805" id="h0-805" class="i">+
</a><a href="#h0-806" id="h0-806" class="i">+-- Ordered list of class index functions. Other classes (E.g. webview) are able
</a><a href="#h0-807" id="h0-807" class="i">+-- to add their own index functions to this list.
</a><a href="#h0-808" id="h0-808" class="i">+window.indexes = {
</a><a href="#h0-809" id="h0-809" class="i">+    -- Find function in window.methods first
</a><a href="#h0-810" id="h0-810" class="i">+    function (w, k) return window.methods[k] end
</a><a href="#h0-811" id="h0-811" class="i">+}
</a><a href="#h0-812" id="h0-812" class="i">+
</a><a href="#h0-813" id="h0-813" class="i">+-- Create new window
</a><a href="#h0-814" id="h0-814" class="i">+function window.new(uris)
</a><a href="#h0-815" id="h0-815" class="i">+    local w = window.build()
</a><a href="#h0-816" id="h0-816" class="i">+
</a><a href="#h0-817" id="h0-817" class="i">+    -- Set window metatable
</a><a href="#h0-818" id="h0-818" class="i">+    setmetatable(w, {
</a><a href="#h0-819" id="h0-819" class="i">+        __index = function (_, k)
</a><a href="#h0-820" id="h0-820" class="i">+            -- Check widget structure first
</a><a href="#h0-821" id="h0-821" class="i">+            local v = rawget(w, k)
</a><a href="#h0-822" id="h0-822" class="i">+            if v then return v end
</a><a href="#h0-823" id="h0-823" class="i">+            -- Call each window index function
</a><a href="#h0-824" id="h0-824" class="i">+            for _, index in ipairs(window.indexes) do
</a><a href="#h0-825" id="h0-825" class="i">+                v = index(w, k)
</a><a href="#h0-826" id="h0-826" class="i">+                if v then return v end
</a><a href="#h0-827" id="h0-827" class="i">+            end
</a><a href="#h0-828" id="h0-828" class="i">+        end,
</a><a href="#h0-829" id="h0-829" class="i">+    })
</a><a href="#h0-830" id="h0-830" class="i">+
</a><a href="#h0-831" id="h0-831" class="i">+    -- Setup window widget for signals
</a><a href="#h0-832" id="h0-832" class="i">+    lousy.signal.setup(w)
</a><a href="#h0-833" id="h0-833" class="i">+
</a><a href="#h0-834" id="h0-834" class="i">+    -- Call window init functions
</a><a href="#h0-835" id="h0-835" class="i">+    for _, func in pairs(window.init_funcs) do
</a><a href="#h0-836" id="h0-836" class="i">+        func(w)
</a><a href="#h0-837" id="h0-837" class="i">+    end
</a><a href="#h0-838" id="h0-838" class="i">+
</a><a href="#h0-839" id="h0-839" class="i">+    -- Populate notebook with tabs
</a><a href="#h0-840" id="h0-840" class="i">+    for _, uri in ipairs(uris or {}) do
</a><a href="#h0-841" id="h0-841" class="i">+        w:new_tab(w:search_open(uri), false)
</a><a href="#h0-842" id="h0-842" class="i">+    end
</a><a href="#h0-843" id="h0-843" class="i">+
</a><a href="#h0-844" id="h0-844" class="i">+    -- Make sure something is loaded
</a><a href="#h0-845" id="h0-845" class="i">+    if w.tabs:count() == 0 then
</a><a href="#h0-846" id="h0-846" class="i">+        w:new_tab(w:search_open(globals.homepage), false)
</a><a href="#h0-847" id="h0-847" class="i">+    end
</a><a href="#h0-848" id="h0-848" class="i">+
</a><a href="#h0-849" id="h0-849" class="i">+    -- Set initial mode
</a><a href="#h0-850" id="h0-850" class="i">+    w:set_mode()
</a><a href="#h0-851" id="h0-851" class="i">+
</a><a href="#h0-852" id="h0-852" class="i">+    -- Show window
</a><a href="#h0-853" id="h0-853" class="i">+    w.win:show()
</a><a href="#h0-854" id="h0-854" class="i">+
</a><a href="#h0-855" id="h0-855" class="i">+    return w
</a><a href="#h0-856" id="h0-856" class="i">+end
</a><a href="#h0-857" id="h0-857" class="i">+
</a><a href="#h0-858" id="h0-858" class="i">+-- vim: et:sw=4:ts=8:sts=4:tw=80
</a></pre>
</div>
</body>
</html>
