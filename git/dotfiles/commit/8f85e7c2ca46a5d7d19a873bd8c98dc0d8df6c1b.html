<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>Swtiching to st. - dotfiles - My small load of configuration files and scripts.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="dotfiles.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>dotfiles</h1><span class="desc">My small load of configuration files and scripts.
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/dotfiles.git">git://thetudor.ddns.net/dotfiles.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/8f85e7c2ca46a5d7d19a873bd8c98dc0d8df6c1b.html">8f85e7c2ca46a5d7d19a873bd8c98dc0d8df6c1b</a>
<b>parent</b> <a href="../commit/2bce0f56bdff1305004a4debaa3351cf6c6c17c7.html">2bce0f56bdff1305004a4debaa3351cf6c6c17c7</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Tue Mar 22 14:57:54 2016

Swtiching to st.

<b>Diffstat:</b>
 README.md                   |    4 +-
 mksh/.crosssh.sh            |   65 +-
 mksh/.mkshrc                |   40 +-
 mksh/.profile               |    5 +-
 shell/.bashrc               |    1 +-
 shell/.crosssh.sh           |   63 +-
 shell/.mkshrc               |   39 +-
 shell/.profile              |    5 +-
 st/FAQ                      |  167 ++-
 st/LEGACY                   |   17 +-
 st/LICENSE                  |   31 +-
 st/Makefile                 |   60 +-
 st/README                   |   34 +-
 st/TODO                     |   28 +-
 st/arg.h                    |   63 +-
 st/colors/cloudy.h          |   50 +-
 st/config.def.h             |  384 ++++-
 st/config.h                 |  342 ++++-
 st/config.mk                |   28 +-
 st/st                       | Bin 0 -&gt; 161312 bytes
 st/st-0.6-externalpipe.diff |   75 +-
 st/st.1                     |  151 ++-
 st/st.c                     | 4171 ++++++++++++++++++++++++++++++++++++++++++++-
 st/st.info                  |  213 ++-
 st/st.o                     | Bin 0 -&gt; 315464 bytes
 x/.Xresources               |    1 +-
 x/.xres/st                  |    3 +-
 27 files changed, 5925 insertions(+), 115 deletions(-)
<hr/><b>diff --git a/<a href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h0" id="h0" class="h">@@ -91,7 +91,9 @@ TODO
</a> Screenshots
 -----------
 
<a href="#h0-3" id="h0-3" class="d">-### [Current state](http://pub.iotek.org/p/9DIdJjP.png)
</a><a href="#h0-4" id="h0-4" class="i">+### [Current state](http://pub.iotek.org/p/YdrGGvR.png)
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+### [First wmutils screenie](http://pub.iotek.org/p/9DIdJjP.png)
</a> 
 ### [Previous BSPWM desktop](http://goo.gl/2vj5Yk)
 
<b>diff --git a/<a href="../file/mksh/.crosssh.sh.html">mksh/.crosssh.sh</a> b/<a href="../file/mksh/.crosssh.sh.html">mksh/.crosssh.sh</a></b>
<a href="#h0" id="h0" class="h">@@ -1,65 +0,0 @@
</a><a href="#h0-0" id="h0-0" class="d">-# ┏━╸┏━┓┏━┓┏━┓┏━┓┏━┓╻ ╻
</a><a href="#h0-1" id="h0-1" class="d">-# ┃  ┣┳┛┃ ┃┗━┓┗━┓┗━┓┣━┫
</a><a href="#h0-2" id="h0-2" class="d">-# ┗━╸╹┗╸┗━┛┗━┛┗━┛┗━┛╹ ╹
</a><a href="#h0-3" id="h0-3" class="d">-# by tudurom
</a><a href="#h0-4" id="h0-4" class="d">-# bits shared between different shells (bash, mksh, zsh)
</a><a href="#h0-5" id="h0-5" class="d">-
</a><a href="#h0-6" id="h0-6" class="d">-if [[ $- == *i* ]] &amp;&amp; [[ -z &quot;$TMUX&quot; ]]; then
</a><a href="#h0-7" id="h0-7" class="d">-  if [[ $(tmux ls | grep -v &quot;attached&quot; | wc -l) -gt 0 ]]; then
</a><a href="#h0-8" id="h0-8" class="d">-    # Auto-attach to the first detached one
</a><a href="#h0-9" id="h0-9" class="d">-    exec tmux a -t $(tmux ls | grep -v &quot;attached&quot; | head -n 1 | cut -d: -f1)
</a><a href="#h0-10" id="h0-10" class="d">-  else
</a><a href="#h0-11" id="h0-11" class="d">-    exec tmux
</a><a href="#h0-12" id="h0-12" class="d">-  fi
</a><a href="#h0-13" id="h0-13" class="d">-fi
</a><a href="#h0-14" id="h0-14" class="d">-
</a><a href="#h0-15" id="h0-15" class="d">-export EDITOR=nvim
</a><a href="#h0-16" id="h0-16" class="d">-export VISUAL=nvim
</a><a href="#h0-17" id="h0-17" class="d">-export GOPATH=$HOME/Go
</a><a href="#h0-18" id="h0-18" class="d">-export PATH=&quot;$(ruby -e &apos;print Gem.user_dir&apos;)/bin:$HOME/.scripts:.scripts/clint:$GOPATH/bin:$PATH&quot;
</a><a href="#h0-19" id="h0-19" class="d">-export PATH=$HOME/.node/bin:$PATH
</a><a href="#h0-20" id="h0-20" class="d">-
</a><a href="#h0-21" id="h0-21" class="d">-# Aliases aka hacks
</a><a href="#h0-22" id="h0-22" class="d">-alias :q=exit
</a><a href="#h0-23" id="h0-23" class="d">-alias irb=pry
</a><a href="#h0-24" id="h0-24" class="d">-alias ccat=pygmentize
</a><a href="#h0-25" id="h0-25" class="d">-alias problemhelper=&quot;time problemhelper&quot;
</a><a href="#h0-26" id="h0-26" class="d">-alias ph=problemhelper
</a><a href="#h0-27" id="h0-27" class="d">-alias tls=&quot;tmux ls&quot;
</a><a href="#h0-28" id="h0-28" class="d">-alias tswitch=&quot;tmux switch -t&quot;
</a><a href="#h0-29" id="h0-29" class="d">-alias tkill=&quot;tmux kill-session -t&quot;
</a><a href="#h0-30" id="h0-30" class="d">-alias rm=&quot;rm -i&quot;
</a><a href="#h0-31" id="h0-31" class="d">-alias fkh=&quot;fortune khaled&quot;
</a><a href="#h0-32" id="h0-32" class="d">-alias ls=&quot;ls -N&quot;
</a><a href="#h0-33" id="h0-33" class="d">-export LESS=&apos;-F -g -i -M -R -S -w -X -z-4&apos;
</a><a href="#h0-34" id="h0-34" class="d">-
</a><a href="#h0-35" id="h0-35" class="d">-# The Fuck is real
</a><a href="#h0-36" id="h0-36" class="d">-eval $(thefuck --alias)
</a><a href="#h0-37" id="h0-37" class="d">-
</a><a href="#h0-38" id="h0-38" class="d">-# Remove unnecessary packages
</a><a href="#h0-39" id="h0-39" class="d">-pclean() {
</a><a href="#h0-40" id="h0-40" class="d">-  sudo pacman -Rns $(pacman -Qdtq)
</a><a href="#h0-41" id="h0-41" class="d">-}
</a><a href="#h0-42" id="h0-42" class="d">-
</a><a href="#h0-43" id="h0-43" class="d">-testnet() {
</a><a href="#h0-44" id="h0-44" class="d">-  ping duckduckgo.com
</a><a href="#h0-45" id="h0-45" class="d">-}
</a><a href="#h0-46" id="h0-46" class="d">-
</a><a href="#h0-47" id="h0-47" class="d">-cless() {
</a><a href="#h0-48" id="h0-48" class="d">-  pygmentize -f terminal &quot;$1&quot; | less -R
</a><a href="#h0-49" id="h0-49" class="d">-}
</a><a href="#h0-50" id="h0-50" class="d">-
</a><a href="#h0-51" id="h0-51" class="d">-ghclone() {
</a><a href="#h0-52" id="h0-52" class="d">-  git clone https://github.com/${1}.git
</a><a href="#h0-53" id="h0-53" class="d">-}
</a><a href="#h0-54" id="h0-54" class="d">-
</a><a href="#h0-55" id="h0-55" class="d">-transfer() {
</a><a href="#h0-56" id="h0-56" class="d">-  local tmpfile=&quot;$(mktemp -t tranferXXX)&quot;
</a><a href="#h0-57" id="h0-57" class="d">-  curl --progress-bar --upload-file $1 &quot;https://transfer.sh/$(basename $1)&quot; &gt;&gt; $tmpfile
</a><a href="#h0-58" id="h0-58" class="d">-  cat $tmpfile
</a><a href="#h0-59" id="h0-59" class="d">-  rm -rf $tmpfile
</a><a href="#h0-60" id="h0-60" class="d">-  unset tmpfile
</a><a href="#h0-61" id="h0-61" class="d">-}
</a><a href="#h0-62" id="h0-62" class="d">-
</a><a href="#h0-63" id="h0-63" class="d">-# This is pretty old black magic I did. And it works!
</a><a href="#h0-64" id="h0-64" class="d">-fortune khaled | echo &quot;$(toilet -f term --gay)\n&quot;
</a><b>diff --git a/<a href="../file/mksh/.mkshrc.html">mksh/.mkshrc</a> b/<a href="../file/mksh/.mkshrc.html">mksh/.mkshrc</a></b>
<a href="#h0" id="h0" class="h">@@ -1,40 +0,0 @@
</a><a href="#h0-0" id="h0-0" class="d">-# ┏┳┓╻┏ ┏━┓╻ ╻
</a><a href="#h0-1" id="h0-1" class="d">-# ┃┃┃┣┻┓┗━┓┣━┫
</a><a href="#h0-2" id="h0-2" class="d">-# ╹ ╹╹ ╹┗━┛╹ ╹
</a><a href="#h0-3" id="h0-3" class="d">-# by tudurom
</a><a href="#h0-4" id="h0-4" class="d">-# not sucking since forever
</a><a href="#h0-5" id="h0-5" class="d">-
</a><a href="#h0-6" id="h0-6" class="d">-source ~/.crosssh.sh
</a><a href="#h0-7" id="h0-7" class="d">-
</a><a href="#h0-8" id="h0-8" class="d">-HISTFILE=&quot;$HOME/.mksh_history&quot;
</a><a href="#h0-9" id="h0-9" class="d">-typeset ret_code
</a><a href="#h0-10" id="h0-10" class="d">-set -o bgnice
</a><a href="#h0-11" id="h0-11" class="d">-alias rename=&quot;/usr/bin/rename&quot;
</a><a href="#h0-12" id="h0-12" class="d">-
</a><a href="#h0-13" id="h0-13" class="d">-prompt () {
</a><a href="#h0-14" id="h0-14" class="d">-  _ERR=$?
</a><a href="#h0-15" id="h0-15" class="d">-  exit_color=4
</a><a href="#h0-16" id="h0-16" class="d">-  if [[ $_ERR -ne 0 ]]; then
</a><a href="#h0-17" id="h0-17" class="d">-    exit_color=1
</a><a href="#h0-18" id="h0-18" class="d">-  fi
</a><a href="#h0-19" id="h0-19" class="d">-  prename=&quot;tud$(tput setaf $exit_color)||&quot;
</a><a href="#h0-20" id="h0-20" class="d">-  arrow=&quot;$(tput setaf 6)&gt;&quot;
</a><a href="#h0-21" id="h0-21" class="d">-  dir=&quot;$(tput setaf 7)$(pwd | sed -e &quot;s/\/home\/$USER/~/&quot;)&quot;
</a><a href="#h0-22" id="h0-22" class="d">-  echo -n &quot;${prename} ${dir} ${arrow}$(tput sgr0) &quot;
</a><a href="#h0-23" id="h0-23" class="d">-}
</a><a href="#h0-24" id="h0-24" class="d">-
</a><a href="#h0-25" id="h0-25" class="d">-PS1=&apos;$(prompt)&apos;
</a><a href="#h0-26" id="h0-26" class="d">-
</a><a href="#h0-27" id="h0-27" class="d">-# Colored man pages
</a><a href="#h0-28" id="h0-28" class="d">-man() {
</a><a href="#h0-29" id="h0-29" class="d">-    env LESS_TERMCAP_mb=$&apos;\E[01;31m&apos; \
</a><a href="#h0-30" id="h0-30" class="d">-    LESS_TERMCAP_md=$&apos;\E[01;38;5;74m&apos; \
</a><a href="#h0-31" id="h0-31" class="d">-    LESS_TERMCAP_me=$&apos;\E[0m&apos; \
</a><a href="#h0-32" id="h0-32" class="d">-    LESS_TERMCAP_se=$&apos;\E[0m&apos; \
</a><a href="#h0-33" id="h0-33" class="d">-    LESS_TERMCAP_so=$&apos;\E[38;5;246m&apos; \
</a><a href="#h0-34" id="h0-34" class="d">-    LESS_TERMCAP_ue=$&apos;\E[0m&apos; \
</a><a href="#h0-35" id="h0-35" class="d">-    LESS_TERMCAP_us=$&apos;\E[04;38;5;146m&apos; \
</a><a href="#h0-36" id="h0-36" class="d">-    man &quot;$@&quot;
</a><a href="#h0-37" id="h0-37" class="d">-}
</a><a href="#h0-38" id="h0-38" class="d">-
</a><a href="#h0-39" id="h0-39" class="d">-# vim: set syntax=sh :
</a><b>diff --git a/<a href="../file/mksh/.profile.html">mksh/.profile</a> b/<a href="../file/mksh/.profile.html">mksh/.profile</a></b>
<a href="#h0" id="h0" class="h">@@ -1,5 +0,0 @@
</a><a href="#h0-0" id="h0-0" class="d">-export PATH=&quot;$PATH:$HOME/.scripts&quot;
</a><a href="#h0-1" id="h0-1" class="d">-export BSPWM_STATE=&quot;/tmp/bspwm-state.json&quot;
</a><a href="#h0-2" id="h0-2" class="d">-export PANEL_FIFO=&quot;/tmp/panel-fifo&quot;
</a><a href="#h0-3" id="h0-3" class="d">-export IOUP_TOKEN=&quot;$(cat ~/.iotoken)&quot;
</a><a href="#h0-4" id="h0-4" class="d">-[[ -z $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]] &amp;&amp; exec startx
</a><b>diff --git a/<a href="../file/shell/.bashrc.html">shell/.bashrc</a> b/<a href="../file/shell/.bashrc.html">shell/.bashrc</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1 @@
</a><a href="#h0-0" id="h0-0" class="i">+. .crosssh.sh
</a><b>diff --git a/<a href="../file/shell/.crosssh.sh.html">shell/.crosssh.sh</a> b/<a href="../file/shell/.crosssh.sh.html">shell/.crosssh.sh</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,63 @@
</a><a href="#h0-0" id="h0-0" class="i">+# ┏━╸┏━┓┏━┓┏━┓┏━┓┏━┓╻ ╻
</a><a href="#h0-1" id="h0-1" class="i">+# ┃  ┣┳┛┃ ┃┗━┓┗━┓┗━┓┣━┫
</a><a href="#h0-2" id="h0-2" class="i">+# ┗━╸╹┗╸┗━┛┗━┛┗━┛┗━┛╹ ╹
</a><a href="#h0-3" id="h0-3" class="i">+# by tudurom
</a><a href="#h0-4" id="h0-4" class="i">+# bits shared between different shells (bash, mksh, zsh)
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+if [[ $- == *i* ]] &amp;&amp; [[ -z &quot;$TMUX&quot; ]]; then
</a><a href="#h0-7" id="h0-7" class="i">+  if [[ $(tmux ls | grep -v &quot;attached&quot; | wc -l) -gt 0 ]]; then
</a><a href="#h0-8" id="h0-8" class="i">+    # Auto-attach to the first detached one
</a><a href="#h0-9" id="h0-9" class="i">+    exec tmux a -t $(tmux ls | grep -v &quot;attached&quot; | head -n 1 | cut -d: -f1)
</a><a href="#h0-10" id="h0-10" class="i">+  else
</a><a href="#h0-11" id="h0-11" class="i">+    exec tmux
</a><a href="#h0-12" id="h0-12" class="i">+  fi
</a><a href="#h0-13" id="h0-13" class="i">+fi
</a><a href="#h0-14" id="h0-14" class="i">+
</a><a href="#h0-15" id="h0-15" class="i">+export EDITOR=nvim
</a><a href="#h0-16" id="h0-16" class="i">+export VISUAL=nvim
</a><a href="#h0-17" id="h0-17" class="i">+export GOPATH=$HOME/Go
</a><a href="#h0-18" id="h0-18" class="i">+export PATH=&quot;$(ruby -e &apos;print Gem.user_dir&apos;)/bin:$HOME/.scripts:.scripts/clint:$GOPATH/bin:$PATH&quot;
</a><a href="#h0-19" id="h0-19" class="i">+export PATH=$HOME/.node/bin:$PATH
</a><a href="#h0-20" id="h0-20" class="i">+
</a><a href="#h0-21" id="h0-21" class="i">+# Aliases aka hacks
</a><a href="#h0-22" id="h0-22" class="i">+alias :q=exit
</a><a href="#h0-23" id="h0-23" class="i">+alias irb=pry
</a><a href="#h0-24" id="h0-24" class="i">+alias ccat=pygmentize
</a><a href="#h0-25" id="h0-25" class="i">+alias problemhelper=&quot;time problemhelper&quot;
</a><a href="#h0-26" id="h0-26" class="i">+alias ph=problemhelper
</a><a href="#h0-27" id="h0-27" class="i">+alias tls=&quot;tmux ls&quot;
</a><a href="#h0-28" id="h0-28" class="i">+alias tswitch=&quot;tmux switch -t&quot;
</a><a href="#h0-29" id="h0-29" class="i">+alias tkill=&quot;tmux kill-session -t&quot;
</a><a href="#h0-30" id="h0-30" class="i">+alias rm=&quot;rm -i&quot;
</a><a href="#h0-31" id="h0-31" class="i">+alias fkh=&quot;fortune khaled&quot;
</a><a href="#h0-32" id="h0-32" class="i">+alias ls=&quot;ls -N&quot;
</a><a href="#h0-33" id="h0-33" class="i">+export LESS=&apos;-F -g -i -M -R -S -w -X -z-4&apos;
</a><a href="#h0-34" id="h0-34" class="i">+
</a><a href="#h0-35" id="h0-35" class="i">+# The Fuck is real
</a><a href="#h0-36" id="h0-36" class="i">+eval $(thefuck --alias)
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+# Remove unnecessary packages
</a><a href="#h0-39" id="h0-39" class="i">+pclean() {
</a><a href="#h0-40" id="h0-40" class="i">+  sudo pacman -Rns $(pacman -Qdtq)
</a><a href="#h0-41" id="h0-41" class="i">+}
</a><a href="#h0-42" id="h0-42" class="i">+
</a><a href="#h0-43" id="h0-43" class="i">+testnet() {
</a><a href="#h0-44" id="h0-44" class="i">+  ping duckduckgo.com
</a><a href="#h0-45" id="h0-45" class="i">+}
</a><a href="#h0-46" id="h0-46" class="i">+
</a><a href="#h0-47" id="h0-47" class="i">+cless() {
</a><a href="#h0-48" id="h0-48" class="i">+  pygmentize -f terminal &quot;$1&quot; | less -R
</a><a href="#h0-49" id="h0-49" class="i">+}
</a><a href="#h0-50" id="h0-50" class="i">+
</a><a href="#h0-51" id="h0-51" class="i">+ghclone() {
</a><a href="#h0-52" id="h0-52" class="i">+  git clone https://github.com/${1}.git
</a><a href="#h0-53" id="h0-53" class="i">+}
</a><a href="#h0-54" id="h0-54" class="i">+
</a><a href="#h0-55" id="h0-55" class="i">+transfer() {
</a><a href="#h0-56" id="h0-56" class="i">+  local tmpfile=&quot;$(mktemp -t tranferXXX)&quot;
</a><a href="#h0-57" id="h0-57" class="i">+  curl --progress-bar --upload-file $1 &quot;https://transfer.sh/$(basename $1)&quot; &gt;&gt; $tmpfile
</a><a href="#h0-58" id="h0-58" class="i">+  cat $tmpfile
</a><a href="#h0-59" id="h0-59" class="i">+  rm -rf $tmpfile
</a><a href="#h0-60" id="h0-60" class="i">+  unset tmpfile
</a><a href="#h0-61" id="h0-61" class="i">+}
</a><a href="#h0-62" id="h0-62" class="i">+
</a><b>diff --git a/<a href="../file/shell/.mkshrc.html">shell/.mkshrc</a> b/<a href="../file/shell/.mkshrc.html">shell/.mkshrc</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,39 @@
</a><a href="#h0-0" id="h0-0" class="i">+# ┏┳┓╻┏ ┏━┓╻ ╻
</a><a href="#h0-1" id="h0-1" class="i">+# ┃┃┃┣┻┓┗━┓┣━┫
</a><a href="#h0-2" id="h0-2" class="i">+# ╹ ╹╹ ╹┗━┛╹ ╹
</a><a href="#h0-3" id="h0-3" class="i">+# by tudurom
</a><a href="#h0-4" id="h0-4" class="i">+# not sucking since forever
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+source ~/.crosssh.sh
</a><a href="#h0-7" id="h0-7" class="i">+
</a><a href="#h0-8" id="h0-8" class="i">+HISTFILE=&quot;$HOME/.mksh_history&quot;
</a><a href="#h0-9" id="h0-9" class="i">+typeset ret_code
</a><a href="#h0-10" id="h0-10" class="i">+set -o bgnice
</a><a href="#h0-11" id="h0-11" class="i">+alias rename=&quot;/usr/bin/rename&quot;
</a><a href="#h0-12" id="h0-12" class="i">+
</a><a href="#h0-13" id="h0-13" class="i">+prompt () {
</a><a href="#h0-14" id="h0-14" class="i">+  _ERR=$?
</a><a href="#h0-15" id="h0-15" class="i">+  exit_color=6
</a><a href="#h0-16" id="h0-16" class="i">+  if [[ $_ERR -ne 0 ]]; then
</a><a href="#h0-17" id="h0-17" class="i">+    exit_color=1
</a><a href="#h0-18" id="h0-18" class="i">+  fi
</a><a href="#h0-19" id="h0-19" class="i">+  dir=&quot;$(tput setaf 8)$(pwd | sed -e &quot;s/\/home\/$USER/~/&quot;)&quot;
</a><a href="#h0-20" id="h0-20" class="i">+  arrow=&quot;$(tput setaf $exit_color)───&quot;
</a><a href="#h0-21" id="h0-21" class="i">+  echo -n &quot;${dir}\n${arrow}$(tput sgr0) &quot;
</a><a href="#h0-22" id="h0-22" class="i">+}
</a><a href="#h0-23" id="h0-23" class="i">+
</a><a href="#h0-24" id="h0-24" class="i">+PS1=&apos;$(prompt)&apos;
</a><a href="#h0-25" id="h0-25" class="i">+
</a><a href="#h0-26" id="h0-26" class="i">+# Colored man pages
</a><a href="#h0-27" id="h0-27" class="i">+man() {
</a><a href="#h0-28" id="h0-28" class="i">+    env LESS_TERMCAP_mb=$&apos;\E[01;31m&apos; \
</a><a href="#h0-29" id="h0-29" class="i">+    LESS_TERMCAP_md=$&apos;\E[01;38;5;74m&apos; \
</a><a href="#h0-30" id="h0-30" class="i">+    LESS_TERMCAP_me=$&apos;\E[0m&apos; \
</a><a href="#h0-31" id="h0-31" class="i">+    LESS_TERMCAP_se=$&apos;\E[0m&apos; \
</a><a href="#h0-32" id="h0-32" class="i">+    LESS_TERMCAP_so=$&apos;\E[38;5;246m&apos; \
</a><a href="#h0-33" id="h0-33" class="i">+    LESS_TERMCAP_ue=$&apos;\E[0m&apos; \
</a><a href="#h0-34" id="h0-34" class="i">+    LESS_TERMCAP_us=$&apos;\E[04;38;5;146m&apos; \
</a><a href="#h0-35" id="h0-35" class="i">+    man &quot;$@&quot;
</a><a href="#h0-36" id="h0-36" class="i">+}
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+# vim: set syntax=sh :
</a><b>diff --git a/<a href="../file/shell/.profile.html">shell/.profile</a> b/<a href="../file/shell/.profile.html">shell/.profile</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,5 @@
</a><a href="#h0-0" id="h0-0" class="i">+export PATH=&quot;$PATH:$HOME/.scripts&quot;
</a><a href="#h0-1" id="h0-1" class="i">+export BSPWM_STATE=&quot;/tmp/bspwm-state.json&quot;
</a><a href="#h0-2" id="h0-2" class="i">+export PANEL_FIFO=&quot;/tmp/panel-fifo&quot;
</a><a href="#h0-3" id="h0-3" class="i">+export IOUP_TOKEN=&quot;$(cat ~/.iotoken)&quot;
</a><a href="#h0-4" id="h0-4" class="i">+[[ -z $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]] &amp;&amp; exec startx
</a><b>diff --git a/<a href="../file/st/FAQ.html">st/FAQ</a> b/<a href="../file/st/FAQ.html">st/FAQ</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,167 @@
</a><a href="#h0-0" id="h0-0" class="i">+## Why does st not handle utmp entries?
</a><a href="#h0-1" id="h0-1" class="i">+
</a><a href="#h0-2" id="h0-2" class="i">+Use the excellent tool of [utmp](http://git.suckless.org/utmp/) for this task.
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+## Some _random program_ complains that st is unknown/not recognised/unsupported/whatever!
</a><a href="#h0-5" id="h0-5" class="i">+
</a><a href="#h0-6" id="h0-6" class="i">+It means that st doesn’t have any terminfo entry on your system. Chances are
</a><a href="#h0-7" id="h0-7" class="i">+you did not `make install`. If you just want to test it without installing it,
</a><a href="#h0-8" id="h0-8" class="i">+you can manualy run `tic -s st.info`.
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+## Nothing works, and nothing is said about an unknown terminal!
</a><a href="#h0-11" id="h0-11" class="i">+
</a><a href="#h0-12" id="h0-12" class="i">+* Some programs just assume they’re running in xterm i.e. they don’t rely on
</a><a href="#h0-13" id="h0-13" class="i">+  terminfo. What you see is the current state of the “xterm compliance”.
</a><a href="#h0-14" id="h0-14" class="i">+* Some programs don’t complain about the lacking st description and default to
</a><a href="#h0-15" id="h0-15" class="i">+  another terminal. In that case see the question about terminfo.
</a><a href="#h0-16" id="h0-16" class="i">+
</a><a href="#h0-17" id="h0-17" class="i">+## I get some weird glitches/visual bug on _random program_!
</a><a href="#h0-18" id="h0-18" class="i">+
</a><a href="#h0-19" id="h0-19" class="i">+Try launching it with a different TERM: $ TERM=xterm myapp. toe(1) will give
</a><a href="#h0-20" id="h0-20" class="i">+you a list of available terminals, but you’ll most likely switch between xterm,
</a><a href="#h0-21" id="h0-21" class="i">+st or st-256color. The default value for TERM can be changed in config.h
</a><a href="#h0-22" id="h0-22" class="i">+(TNAME).
</a><a href="#h0-23" id="h0-23" class="i">+
</a><a href="#h0-24" id="h0-24" class="i">+## How do I scroll back up?
</a><a href="#h0-25" id="h0-25" class="i">+
</a><a href="#h0-26" id="h0-26" class="i">+Using a terminal multiplexer.
</a><a href="#h0-27" id="h0-27" class="i">+
</a><a href="#h0-28" id="h0-28" class="i">+* `st -e tmux` using C-b [
</a><a href="#h0-29" id="h0-29" class="i">+* `st -e screen` using C-a ESC
</a><a href="#h0-30" id="h0-30" class="i">+
</a><a href="#h0-31" id="h0-31" class="i">+## Why doesn&apos;t the Del key work in some programs?
</a><a href="#h0-32" id="h0-32" class="i">+
</a><a href="#h0-33" id="h0-33" class="i">+Taken from the terminfo manpage:
</a><a href="#h0-34" id="h0-34" class="i">+
</a><a href="#h0-35" id="h0-35" class="i">+	If the terminal has a keypad that transmits codes when the keys
</a><a href="#h0-36" id="h0-36" class="i">+	are pressed, this information can be given. Note that it is not
</a><a href="#h0-37" id="h0-37" class="i">+	possible to handle terminals where the keypad only works in
</a><a href="#h0-38" id="h0-38" class="i">+	local (this applies, for example, to the unshifted HP 2621 keys).
</a><a href="#h0-39" id="h0-39" class="i">+	If the keypad can be set to transmit or not transmit, give these
</a><a href="#h0-40" id="h0-40" class="i">+	codes as smkx and rmkx. Otherwise the keypad is assumed to
</a><a href="#h0-41" id="h0-41" class="i">+	always transmit.
</a><a href="#h0-42" id="h0-42" class="i">+
</a><a href="#h0-43" id="h0-43" class="i">+In the st case smkx=E[?1hE= and rmkx=E[?1lE&gt;, so it is mandatory that
</a><a href="#h0-44" id="h0-44" class="i">+applications which want to test against keypad keys send these
</a><a href="#h0-45" id="h0-45" class="i">+sequences.
</a><a href="#h0-46" id="h0-46" class="i">+
</a><a href="#h0-47" id="h0-47" class="i">+But buggy applications (like bash and irssi, for example) don&apos;t do this. A fast
</a><a href="#h0-48" id="h0-48" class="i">+solution for them is to use the following command:
</a><a href="#h0-49" id="h0-49" class="i">+
</a><a href="#h0-50" id="h0-50" class="i">+	$ printf &apos;\033[?1h\033=&apos; &gt;/dev/tty
</a><a href="#h0-51" id="h0-51" class="i">+
</a><a href="#h0-52" id="h0-52" class="i">+or
</a><a href="#h0-53" id="h0-53" class="i">+	$ tput smkx
</a><a href="#h0-54" id="h0-54" class="i">+
</a><a href="#h0-55" id="h0-55" class="i">+In the case of bash, readline is used. Readline has a different note in its
</a><a href="#h0-56" id="h0-56" class="i">+manpage about this issue:
</a><a href="#h0-57" id="h0-57" class="i">+
</a><a href="#h0-58" id="h0-58" class="i">+	enable-keypad (Off)
</a><a href="#h0-59" id="h0-59" class="i">+		When set to On, readline will try to enable the
</a><a href="#h0-60" id="h0-60" class="i">+		application keypad when it is called. Some systems
</a><a href="#h0-61" id="h0-61" class="i">+		need this to enable arrow keys.
</a><a href="#h0-62" id="h0-62" class="i">+
</a><a href="#h0-63" id="h0-63" class="i">+Adding this option to your .inputrc will fix the keypad problem for all
</a><a href="#h0-64" id="h0-64" class="i">+applications using readline.
</a><a href="#h0-65" id="h0-65" class="i">+
</a><a href="#h0-66" id="h0-66" class="i">+If you are using zsh, then read the zsh FAQ
</a><a href="#h0-67" id="h0-67" class="i">+&lt;http://zsh.sourceforge.net/FAQ/zshfaq03.html#l25&gt;:
</a><a href="#h0-68" id="h0-68" class="i">+
</a><a href="#h0-69" id="h0-69" class="i">+	It should be noted that the O / [ confusion can occur with other keys
</a><a href="#h0-70" id="h0-70" class="i">+	such as Home and End. Some systems let you query the key sequences
</a><a href="#h0-71" id="h0-71" class="i">+	sent by these keys from the system&apos;s terminal database, terminfo.
</a><a href="#h0-72" id="h0-72" class="i">+	Unfortunately, the key sequences given there typically apply to the
</a><a href="#h0-73" id="h0-73" class="i">+	mode that is not the one zsh uses by default (it&apos;s the &quot;application&quot;
</a><a href="#h0-74" id="h0-74" class="i">+	mode rather than the &quot;raw&quot; mode). Explaining the use of terminfo is
</a><a href="#h0-75" id="h0-75" class="i">+	outside of the scope of this FAQ, but if you wish to use the key
</a><a href="#h0-76" id="h0-76" class="i">+	sequences given there you can tell the line editor to turn on
</a><a href="#h0-77" id="h0-77" class="i">+	&quot;application&quot; mode when it starts and turn it off when it stops:
</a><a href="#h0-78" id="h0-78" class="i">+
</a><a href="#h0-79" id="h0-79" class="i">+		function zle-line-init () { echoti smkx }
</a><a href="#h0-80" id="h0-80" class="i">+		function zle-line-finish () { echoti rmkx }
</a><a href="#h0-81" id="h0-81" class="i">+		zle -N zle-line-init
</a><a href="#h0-82" id="h0-82" class="i">+		zle -N zle-line-finish
</a><a href="#h0-83" id="h0-83" class="i">+
</a><a href="#h0-84" id="h0-84" class="i">+Putting these lines into your .zshrc will fix the problems.
</a><a href="#h0-85" id="h0-85" class="i">+
</a><a href="#h0-86" id="h0-86" class="i">+## How can I use meta in 8bit mode?
</a><a href="#h0-87" id="h0-87" class="i">+
</a><a href="#h0-88" id="h0-88" class="i">+St supports meta in 8bit mode, but the default terminfo entry doesn&apos;t
</a><a href="#h0-89" id="h0-89" class="i">+use this capability. If you want it, you have to use the &apos;st-meta&apos; value
</a><a href="#h0-90" id="h0-90" class="i">+in TERM.
</a><a href="#h0-91" id="h0-91" class="i">+
</a><a href="#h0-92" id="h0-92" class="i">+## I cannot compile st in OpenBSD
</a><a href="#h0-93" id="h0-93" class="i">+
</a><a href="#h0-94" id="h0-94" class="i">+OpenBSD lacks librt, despite it being mandatory in POSIX
</a><a href="#h0-95" id="h0-95" class="i">+&lt;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/c99.html#tag_20_11_13&gt;.
</a><a href="#h0-96" id="h0-96" class="i">+If you want to compile st for OpenBSD you have to remove -lrt from config.mk, and
</a><a href="#h0-97" id="h0-97" class="i">+st will compile without any loss of functionality, because all the functions are
</a><a href="#h0-98" id="h0-98" class="i">+included in libc on this platform.
</a><a href="#h0-99" id="h0-99" class="i">+
</a><a href="#h0-100" id="h0-100" class="i">+## The Backspace Case
</a><a href="#h0-101" id="h0-101" class="i">+
</a><a href="#h0-102" id="h0-102" class="i">+St is emulating the Linux way of handling backspace being delete and delete being
</a><a href="#h0-103" id="h0-103" class="i">+backspace.
</a><a href="#h0-104" id="h0-104" class="i">+
</a><a href="#h0-105" id="h0-105" class="i">+This is an issue that was discussed in suckless mailing list
</a><a href="#h0-106" id="h0-106" class="i">+&lt;http://lists.suckless.org/dev/1404/20697.html&gt;. Here is why some old grumpy
</a><a href="#h0-107" id="h0-107" class="i">+terminal users wants its backspace to be how he feels it:
</a><a href="#h0-108" id="h0-108" class="i">+
</a><a href="#h0-109" id="h0-109" class="i">+	Well, I am going to comment why I want to change the behaviour
</a><a href="#h0-110" id="h0-110" class="i">+	of this key. When ASCII was defined in 1968, communication
</a><a href="#h0-111" id="h0-111" class="i">+	with computers was done using punched cards, or hardcopy
</a><a href="#h0-112" id="h0-112" class="i">+	terminals (basically a typewriter machine connected with the
</a><a href="#h0-113" id="h0-113" class="i">+	computer using a serial port).  ASCII defines DELETE as 7F,
</a><a href="#h0-114" id="h0-114" class="i">+	because, in punched-card terms, it means all the holes of the
</a><a href="#h0-115" id="h0-115" class="i">+	card punched; it is thus a kind of &apos;physical delete&apos;. In the
</a><a href="#h0-116" id="h0-116" class="i">+	same way, the BACKSPACE key was a non-destructive backspace,
</a><a href="#h0-117" id="h0-117" class="i">+	as on a typewriter.  So, if you wanted to delete a character,
</a><a href="#h0-118" id="h0-118" class="i">+	you had to BACKSPACE and then DELETE.  Another use of BACKSPACE
</a><a href="#h0-119" id="h0-119" class="i">+	was to type accented characters, for example &apos;a BACKSPACE `&apos;.
</a><a href="#h0-120" id="h0-120" class="i">+	The VT100 had no BACKSPACE key; it was generated using the
</a><a href="#h0-121" id="h0-121" class="i">+	CONTROL key as another control character (CONTROL key sets to
</a><a href="#h0-122" id="h0-122" class="i">+	0 b7 b6 b5, so it converts H (code 0x48) into BACKSPACE (code
</a><a href="#h0-123" id="h0-123" class="i">+	0x08)), but it had a DELETE key in a similar position where
</a><a href="#h0-124" id="h0-124" class="i">+	the BACKSPACE key is located today on common PC keyboards.
</a><a href="#h0-125" id="h0-125" class="i">+	All the terminal emulators emulated the difference between
</a><a href="#h0-126" id="h0-126" class="i">+	these keys correctly: the backspace key generated a BACKSPACE
</a><a href="#h0-127" id="h0-127" class="i">+	(^H) and delete key generated a DELETE (^?).
</a><a href="#h0-128" id="h0-128" class="i">+
</a><a href="#h0-129" id="h0-129" class="i">+	But a problem arose when Linus Torvalds wrote Linux. Unlike
</a><a href="#h0-130" id="h0-130" class="i">+	earlier terminals, the Linux virtual terminal (the terminal
</a><a href="#h0-131" id="h0-131" class="i">+	emulator integrated in the kernel) returned a DELETE when
</a><a href="#h0-132" id="h0-132" class="i">+	backspace was pressed, due to the VT100 having a DELETE key in
</a><a href="#h0-133" id="h0-133" class="i">+	the same position.  This created a lot of problems (see [1]
</a><a href="#h0-134" id="h0-134" class="i">+	and [2]). Since Linux has become the king, a lot of terminal
</a><a href="#h0-135" id="h0-135" class="i">+	emulators today generate a DELETE when the backspace key is
</a><a href="#h0-136" id="h0-136" class="i">+	pressed in order to avoid problems with Linux. The result is
</a><a href="#h0-137" id="h0-137" class="i">+	that the only way of generating a BACKSPACE on these systems
</a><a href="#h0-138" id="h0-138" class="i">+	is by using CONTROL + H. (I also think that emacs had an
</a><a href="#h0-139" id="h0-139" class="i">+	important point here because the CONTROL + H prefix is used
</a><a href="#h0-140" id="h0-140" class="i">+	in emacs in some commands (help commands).)
</a><a href="#h0-141" id="h0-141" class="i">+
</a><a href="#h0-142" id="h0-142" class="i">+	From point of view of the kernel, you can change the key
</a><a href="#h0-143" id="h0-143" class="i">+	for deleting a previous character with stty erase. When you
</a><a href="#h0-144" id="h0-144" class="i">+	connect a real terminal into a machine you describe the type
</a><a href="#h0-145" id="h0-145" class="i">+	of terminal, so getty configures the correct value of stty
</a><a href="#h0-146" id="h0-146" class="i">+	erase for this terminal. In the case of terminal emulators,
</a><a href="#h0-147" id="h0-147" class="i">+	however, you don&apos;t have any getty that can set the correct
</a><a href="#h0-148" id="h0-148" class="i">+	value of stty erase, so you always get the default value.
</a><a href="#h0-149" id="h0-149" class="i">+	For this reason, it is necessary to add &apos;stty erase ^H&apos; to your
</a><a href="#h0-150" id="h0-150" class="i">+	profile if you have changed the value of the backspace key.
</a><a href="#h0-151" id="h0-151" class="i">+	Of course, another solution is for st itself to modify the
</a><a href="#h0-152" id="h0-152" class="i">+	value of stty erase.  I usually have the inverse problem:
</a><a href="#h0-153" id="h0-153" class="i">+	when I connect to non-Unix machines, I have to press CONTROL +
</a><a href="#h0-154" id="h0-154" class="i">+	h to get a BACKSPACE. The inverse problem occurs when a user
</a><a href="#h0-155" id="h0-155" class="i">+	connects to my Unix machines from a different system with a
</a><a href="#h0-156" id="h0-156" class="i">+	correct backspace key.
</a><a href="#h0-157" id="h0-157" class="i">+
</a><a href="#h0-158" id="h0-158" class="i">+	[1] http://www.ibb.net/~anne/keyboard.html
</a><a href="#h0-159" id="h0-159" class="i">+	[2] http://www.tldp.org/HOWTO/Keyboard-and-Console-HOWTO-5.html
</a><a href="#h0-160" id="h0-160" class="i">+
</a><a href="#h0-161" id="h0-161" class="i">+## But I really want the old grumpy behaviour of my terminal
</a><a href="#h0-162" id="h0-162" class="i">+
</a><a href="#h0-163" id="h0-163" class="i">+Apply [1].
</a><a href="#h0-164" id="h0-164" class="i">+
</a><a href="#h0-165" id="h0-165" class="i">+[1] http://st.suckless.org/patches/delkey
</a><a href="#h0-166" id="h0-166" class="i">+
</a><b>diff --git a/<a href="../file/st/LEGACY.html">st/LEGACY</a> b/<a href="../file/st/LEGACY.html">st/LEGACY</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h0-0" id="h0-0" class="i">+A STATEMENT ON LEGACY SUPPORT
</a><a href="#h0-1" id="h0-1" class="i">+
</a><a href="#h0-2" id="h0-2" class="i">+In the terminal world there is much cruft that comes from old and unsup‐
</a><a href="#h0-3" id="h0-3" class="i">+ported terminals that inherit incompatible modes  and  escape  sequences
</a><a href="#h0-4" id="h0-4" class="i">+which noone is able to know, except when he/she comes from that time and
</a><a href="#h0-5" id="h0-5" class="i">+developed a graphical vt100 emulator at that time.
</a><a href="#h0-6" id="h0-6" class="i">+
</a><a href="#h0-7" id="h0-7" class="i">+One  goal  of  st is to only support what is really needed. When you en‐
</a><a href="#h0-8" id="h0-8" class="i">+counter a sequence which you really need, implement it.  But  while  you
</a><a href="#h0-9" id="h0-9" class="i">+are  at it,  do not add the other cruft you might encounter while sneek‐
</a><a href="#h0-10" id="h0-10" class="i">+ing at other terminal emulators. History has bloated them and  there  is
</a><a href="#h0-11" id="h0-11" class="i">+no real evidence that most of the sequences are used today.
</a><a href="#h0-12" id="h0-12" class="i">+
</a><a href="#h0-13" id="h0-13" class="i">+
</a><a href="#h0-14" id="h0-14" class="i">+Christoph Lohmann &lt;20h@r-36.net&gt;
</a><a href="#h0-15" id="h0-15" class="i">+2012-09-13T07:00:36.081271045+02:00
</a><a href="#h0-16" id="h0-16" class="i">+
</a><b>diff --git a/<a href="../file/st/LICENSE.html">st/LICENSE</a> b/<a href="../file/st/LICENSE.html">st/LICENSE</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,31 @@
</a><a href="#h0-0" id="h0-0" class="i">+MIT/X Consortium License
</a><a href="#h0-1" id="h0-1" class="i">+
</a><a href="#h0-2" id="h0-2" class="i">+© 2009-2012 Aurélien APTEL &lt;aurelien dot aptel at gmail dot com&gt;
</a><a href="#h0-3" id="h0-3" class="i">+© 2009 Anselm R Garbe &lt;garbeam at gmail dot com&gt;
</a><a href="#h0-4" id="h0-4" class="i">+© 2012-2015 Roberto E. Vargas Caballero &lt;k0ga at shike2 dot com&gt;
</a><a href="#h0-5" id="h0-5" class="i">+© 2012-2015 Christoph Lohmann &lt;20h at r-36 dot net&gt;
</a><a href="#h0-6" id="h0-6" class="i">+© 2013 Eon S. Jeon &lt;esjeon at hyunmu dot am&gt;
</a><a href="#h0-7" id="h0-7" class="i">+© 2013 Alexander Sedov &lt;alex0player at gmail dot com&gt;
</a><a href="#h0-8" id="h0-8" class="i">+© 2013 Mark Edgar &lt;medgar123 at gmail dot com&gt;
</a><a href="#h0-9" id="h0-9" class="i">+© 2013 Eric Pruitt &lt;eric.pruitt at gmail dot com&gt;
</a><a href="#h0-10" id="h0-10" class="i">+© 2013 Michael Forney &lt;mforney at mforney dot org&gt;
</a><a href="#h0-11" id="h0-11" class="i">+© 2013-2014 Markus Teich &lt;markus dot teich at stusta dot mhn dot de&gt;
</a><a href="#h0-12" id="h0-12" class="i">+© 2014 Laslo Hunhold &lt;dev at frign dot de&gt;
</a><a href="#h0-13" id="h0-13" class="i">+
</a><a href="#h0-14" id="h0-14" class="i">+Permission is hereby granted, free of charge, to any person obtaining a
</a><a href="#h0-15" id="h0-15" class="i">+copy of this software and associated documentation files (the &quot;Software&quot;),
</a><a href="#h0-16" id="h0-16" class="i">+to deal in the Software without restriction, including without limitation
</a><a href="#h0-17" id="h0-17" class="i">+the rights to use, copy, modify, merge, publish, distribute, sublicense,
</a><a href="#h0-18" id="h0-18" class="i">+and/or sell copies of the Software, and to permit persons to whom the
</a><a href="#h0-19" id="h0-19" class="i">+Software is furnished to do so, subject to the following conditions:
</a><a href="#h0-20" id="h0-20" class="i">+
</a><a href="#h0-21" id="h0-21" class="i">+The above copyright notice and this permission notice shall be included in
</a><a href="#h0-22" id="h0-22" class="i">+all copies or substantial portions of the Software.
</a><a href="#h0-23" id="h0-23" class="i">+
</a><a href="#h0-24" id="h0-24" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</a><a href="#h0-25" id="h0-25" class="i">+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</a><a href="#h0-26" id="h0-26" class="i">+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL
</a><a href="#h0-27" id="h0-27" class="i">+THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</a><a href="#h0-28" id="h0-28" class="i">+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
</a><a href="#h0-29" id="h0-29" class="i">+FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
</a><a href="#h0-30" id="h0-30" class="i">+DEALINGS IN THE SOFTWARE.
</a><b>diff --git a/<a href="../file/st/Makefile.html">st/Makefile</a> b/<a href="../file/st/Makefile.html">st/Makefile</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,60 @@
</a><a href="#h0-0" id="h0-0" class="i">+# st - simple terminal
</a><a href="#h0-1" id="h0-1" class="i">+# See LICENSE file for copyright and license details.
</a><a href="#h0-2" id="h0-2" class="i">+
</a><a href="#h0-3" id="h0-3" class="i">+include config.mk
</a><a href="#h0-4" id="h0-4" class="i">+
</a><a href="#h0-5" id="h0-5" class="i">+SRC = st.c
</a><a href="#h0-6" id="h0-6" class="i">+OBJ = ${SRC:.c=.o}
</a><a href="#h0-7" id="h0-7" class="i">+
</a><a href="#h0-8" id="h0-8" class="i">+all: options st
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+options:
</a><a href="#h0-11" id="h0-11" class="i">+	@echo st build options:
</a><a href="#h0-12" id="h0-12" class="i">+	@echo &quot;CFLAGS   = ${CFLAGS}&quot;
</a><a href="#h0-13" id="h0-13" class="i">+	@echo &quot;LDFLAGS  = ${LDFLAGS}&quot;
</a><a href="#h0-14" id="h0-14" class="i">+	@echo &quot;CC       = ${CC}&quot;
</a><a href="#h0-15" id="h0-15" class="i">+
</a><a href="#h0-16" id="h0-16" class="i">+config.h:
</a><a href="#h0-17" id="h0-17" class="i">+	cp config.def.h config.h
</a><a href="#h0-18" id="h0-18" class="i">+
</a><a href="#h0-19" id="h0-19" class="i">+.c.o:
</a><a href="#h0-20" id="h0-20" class="i">+	@echo CC $&lt;
</a><a href="#h0-21" id="h0-21" class="i">+	@${CC} -c ${CFLAGS} $&lt;
</a><a href="#h0-22" id="h0-22" class="i">+
</a><a href="#h0-23" id="h0-23" class="i">+${OBJ}: config.h config.mk
</a><a href="#h0-24" id="h0-24" class="i">+
</a><a href="#h0-25" id="h0-25" class="i">+st: ${OBJ}
</a><a href="#h0-26" id="h0-26" class="i">+	@echo CC -o $@
</a><a href="#h0-27" id="h0-27" class="i">+	@${CC} -o $@ ${OBJ} ${LDFLAGS}
</a><a href="#h0-28" id="h0-28" class="i">+
</a><a href="#h0-29" id="h0-29" class="i">+clean:
</a><a href="#h0-30" id="h0-30" class="i">+	@echo cleaning
</a><a href="#h0-31" id="h0-31" class="i">+	@rm -f st ${OBJ} st-${VERSION}.tar.gz
</a><a href="#h0-32" id="h0-32" class="i">+
</a><a href="#h0-33" id="h0-33" class="i">+dist: clean
</a><a href="#h0-34" id="h0-34" class="i">+	@echo creating dist tarball
</a><a href="#h0-35" id="h0-35" class="i">+	@mkdir -p st-${VERSION}
</a><a href="#h0-36" id="h0-36" class="i">+	@cp -R LICENSE Makefile README config.mk config.def.h st.info st.1 arg.h ${SRC} st-${VERSION}
</a><a href="#h0-37" id="h0-37" class="i">+	@tar -cf st-${VERSION}.tar st-${VERSION}
</a><a href="#h0-38" id="h0-38" class="i">+	@gzip st-${VERSION}.tar
</a><a href="#h0-39" id="h0-39" class="i">+	@rm -rf st-${VERSION}
</a><a href="#h0-40" id="h0-40" class="i">+
</a><a href="#h0-41" id="h0-41" class="i">+install: all
</a><a href="#h0-42" id="h0-42" class="i">+	@echo installing executable file to ${DESTDIR}${PREFIX}/bin
</a><a href="#h0-43" id="h0-43" class="i">+	@mkdir -p ${DESTDIR}${PREFIX}/bin
</a><a href="#h0-44" id="h0-44" class="i">+	@cp -f st ${DESTDIR}${PREFIX}/bin
</a><a href="#h0-45" id="h0-45" class="i">+	@chmod 755 ${DESTDIR}${PREFIX}/bin/st
</a><a href="#h0-46" id="h0-46" class="i">+	@echo installing manual page to ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h0-47" id="h0-47" class="i">+	@mkdir -p ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h0-48" id="h0-48" class="i">+	@sed &quot;s/VERSION/${VERSION}/g&quot; &lt; st.1 &gt; ${DESTDIR}${MANPREFIX}/man1/st.1
</a><a href="#h0-49" id="h0-49" class="i">+	@chmod 644 ${DESTDIR}${MANPREFIX}/man1/st.1
</a><a href="#h0-50" id="h0-50" class="i">+	@echo Please see the README file regarding the terminfo entry of st.
</a><a href="#h0-51" id="h0-51" class="i">+	@tic -s st.info
</a><a href="#h0-52" id="h0-52" class="i">+
</a><a href="#h0-53" id="h0-53" class="i">+uninstall:
</a><a href="#h0-54" id="h0-54" class="i">+	@echo removing executable file from ${DESTDIR}${PREFIX}/bin
</a><a href="#h0-55" id="h0-55" class="i">+	@rm -f ${DESTDIR}${PREFIX}/bin/st
</a><a href="#h0-56" id="h0-56" class="i">+	@echo removing manual page from ${DESTDIR}${MANPREFIX}/man1
</a><a href="#h0-57" id="h0-57" class="i">+	@rm -f ${DESTDIR}${MANPREFIX}/man1/st.1
</a><a href="#h0-58" id="h0-58" class="i">+
</a><a href="#h0-59" id="h0-59" class="i">+.PHONY: all options clean dist install uninstall
</a><b>diff --git a/<a href="../file/st/README.html">st/README</a> b/<a href="../file/st/README.html">st/README</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h0-0" id="h0-0" class="i">+st - simple terminal
</a><a href="#h0-1" id="h0-1" class="i">+--------------------
</a><a href="#h0-2" id="h0-2" class="i">+st is a simple terminal emulator for X which sucks less.
</a><a href="#h0-3" id="h0-3" class="i">+
</a><a href="#h0-4" id="h0-4" class="i">+
</a><a href="#h0-5" id="h0-5" class="i">+Requirements
</a><a href="#h0-6" id="h0-6" class="i">+------------
</a><a href="#h0-7" id="h0-7" class="i">+In order to build st you need the Xlib header files.
</a><a href="#h0-8" id="h0-8" class="i">+
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+Installation
</a><a href="#h0-11" id="h0-11" class="i">+------------
</a><a href="#h0-12" id="h0-12" class="i">+Edit config.mk to match your local setup (st is installed into
</a><a href="#h0-13" id="h0-13" class="i">+the /usr/local namespace by default).
</a><a href="#h0-14" id="h0-14" class="i">+
</a><a href="#h0-15" id="h0-15" class="i">+Afterwards enter the following command to build and install st (if
</a><a href="#h0-16" id="h0-16" class="i">+necessary as root):
</a><a href="#h0-17" id="h0-17" class="i">+
</a><a href="#h0-18" id="h0-18" class="i">+    make clean install
</a><a href="#h0-19" id="h0-19" class="i">+
</a><a href="#h0-20" id="h0-20" class="i">+
</a><a href="#h0-21" id="h0-21" class="i">+Running st
</a><a href="#h0-22" id="h0-22" class="i">+----------
</a><a href="#h0-23" id="h0-23" class="i">+If you did not install st with make clean install, you must compile
</a><a href="#h0-24" id="h0-24" class="i">+the st terminfo entry with the following command:
</a><a href="#h0-25" id="h0-25" class="i">+
</a><a href="#h0-26" id="h0-26" class="i">+    tic -s st.info
</a><a href="#h0-27" id="h0-27" class="i">+
</a><a href="#h0-28" id="h0-28" class="i">+See the man page for additional details.
</a><a href="#h0-29" id="h0-29" class="i">+
</a><a href="#h0-30" id="h0-30" class="i">+Credits
</a><a href="#h0-31" id="h0-31" class="i">+-------
</a><a href="#h0-32" id="h0-32" class="i">+Based on Aurélien APTEL &lt;aurelien dot aptel at gmail dot com&gt; bt source code.
</a><a href="#h0-33" id="h0-33" class="i">+
</a><b>diff --git a/<a href="../file/st/TODO.html">st/TODO</a> b/<a href="../file/st/TODO.html">st/TODO</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,28 @@
</a><a href="#h0-0" id="h0-0" class="i">+vt emulation
</a><a href="#h0-1" id="h0-1" class="i">+------------
</a><a href="#h0-2" id="h0-2" class="i">+
</a><a href="#h0-3" id="h0-3" class="i">+* double-height support
</a><a href="#h0-4" id="h0-4" class="i">+
</a><a href="#h0-5" id="h0-5" class="i">+code &amp; interface
</a><a href="#h0-6" id="h0-6" class="i">+----------------
</a><a href="#h0-7" id="h0-7" class="i">+
</a><a href="#h0-8" id="h0-8" class="i">+* add a simple way to do multiplexing
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+drawing
</a><a href="#h0-11" id="h0-11" class="i">+-------
</a><a href="#h0-12" id="h0-12" class="i">+* add diacritics support to xdraws()
</a><a href="#h0-13" id="h0-13" class="i">+	* switch to a suckless font drawing library
</a><a href="#h0-14" id="h0-14" class="i">+* make the font cache simpler
</a><a href="#h0-15" id="h0-15" class="i">+* add better support for brightening of the upper colors
</a><a href="#h0-16" id="h0-16" class="i">+
</a><a href="#h0-17" id="h0-17" class="i">+bugs
</a><a href="#h0-18" id="h0-18" class="i">+----
</a><a href="#h0-19" id="h0-19" class="i">+
</a><a href="#h0-20" id="h0-20" class="i">+* fix shift up/down (shift selection in emacs)
</a><a href="#h0-21" id="h0-21" class="i">+* remove DEC test sequence when appropriate
</a><a href="#h0-22" id="h0-22" class="i">+
</a><a href="#h0-23" id="h0-23" class="i">+misc
</a><a href="#h0-24" id="h0-24" class="i">+----
</a><a href="#h0-25" id="h0-25" class="i">+
</a><a href="#h0-26" id="h0-26" class="i">+    $ grep -nE &apos;XXX|TODO&apos; st.c
</a><a href="#h0-27" id="h0-27" class="i">+
</a><b>diff --git a/<a href="../file/st/arg.h.html">st/arg.h</a> b/<a href="../file/st/arg.h.html">st/arg.h</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,63 @@
</a><a href="#h0-0" id="h0-0" class="i">+/*
</a><a href="#h0-1" id="h0-1" class="i">+ * Copy me if you can.
</a><a href="#h0-2" id="h0-2" class="i">+ * by 20h
</a><a href="#h0-3" id="h0-3" class="i">+ */
</a><a href="#h0-4" id="h0-4" class="i">+
</a><a href="#h0-5" id="h0-5" class="i">+#ifndef ARG_H__
</a><a href="#h0-6" id="h0-6" class="i">+#define ARG_H__
</a><a href="#h0-7" id="h0-7" class="i">+
</a><a href="#h0-8" id="h0-8" class="i">+extern char *argv0;
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+/* use main(int argc, char *argv[]) */
</a><a href="#h0-11" id="h0-11" class="i">+#define ARGBEGIN	for (argv0 = *argv, argv++, argc--;\
</a><a href="#h0-12" id="h0-12" class="i">+					argv[0] &amp;&amp; argv[0][1]\
</a><a href="#h0-13" id="h0-13" class="i">+					&amp;&amp; argv[0][0] == &apos;-&apos;;\
</a><a href="#h0-14" id="h0-14" class="i">+					argc--, argv++) {\
</a><a href="#h0-15" id="h0-15" class="i">+				char argc_;\
</a><a href="#h0-16" id="h0-16" class="i">+				char **argv_;\
</a><a href="#h0-17" id="h0-17" class="i">+				int brk_;\
</a><a href="#h0-18" id="h0-18" class="i">+				if (argv[0][1] == &apos;-&apos; &amp;&amp; argv[0][2] == &apos;\0&apos;) {\
</a><a href="#h0-19" id="h0-19" class="i">+					argv++;\
</a><a href="#h0-20" id="h0-20" class="i">+					argc--;\
</a><a href="#h0-21" id="h0-21" class="i">+					break;\
</a><a href="#h0-22" id="h0-22" class="i">+				}\
</a><a href="#h0-23" id="h0-23" class="i">+				for (brk_ = 0, argv[0]++, argv_ = argv;\
</a><a href="#h0-24" id="h0-24" class="i">+						argv[0][0] &amp;&amp; !brk_;\
</a><a href="#h0-25" id="h0-25" class="i">+						argv[0]++) {\
</a><a href="#h0-26" id="h0-26" class="i">+					if (argv_ != argv)\
</a><a href="#h0-27" id="h0-27" class="i">+						break;\
</a><a href="#h0-28" id="h0-28" class="i">+					argc_ = argv[0][0];\
</a><a href="#h0-29" id="h0-29" class="i">+					switch (argc_)
</a><a href="#h0-30" id="h0-30" class="i">+
</a><a href="#h0-31" id="h0-31" class="i">+/* Handles obsolete -NUM syntax */
</a><a href="#h0-32" id="h0-32" class="i">+#define ARGNUM				case &apos;0&apos;:\
</a><a href="#h0-33" id="h0-33" class="i">+					case &apos;1&apos;:\
</a><a href="#h0-34" id="h0-34" class="i">+					case &apos;2&apos;:\
</a><a href="#h0-35" id="h0-35" class="i">+					case &apos;3&apos;:\
</a><a href="#h0-36" id="h0-36" class="i">+					case &apos;4&apos;:\
</a><a href="#h0-37" id="h0-37" class="i">+					case &apos;5&apos;:\
</a><a href="#h0-38" id="h0-38" class="i">+					case &apos;6&apos;:\
</a><a href="#h0-39" id="h0-39" class="i">+					case &apos;7&apos;:\
</a><a href="#h0-40" id="h0-40" class="i">+					case &apos;8&apos;:\
</a><a href="#h0-41" id="h0-41" class="i">+					case &apos;9&apos;
</a><a href="#h0-42" id="h0-42" class="i">+
</a><a href="#h0-43" id="h0-43" class="i">+#define ARGEND			}\
</a><a href="#h0-44" id="h0-44" class="i">+			}
</a><a href="#h0-45" id="h0-45" class="i">+
</a><a href="#h0-46" id="h0-46" class="i">+#define ARGC()		argc_
</a><a href="#h0-47" id="h0-47" class="i">+
</a><a href="#h0-48" id="h0-48" class="i">+#define ARGNUMF(base)	(brk_ = 1, estrtol(argv[0], (base)))
</a><a href="#h0-49" id="h0-49" class="i">+
</a><a href="#h0-50" id="h0-50" class="i">+#define EARGF(x)	((argv[0][1] == &apos;\0&apos; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h0-51" id="h0-51" class="i">+				((x), abort(), (char *)0) :\
</a><a href="#h0-52" id="h0-52" class="i">+				(brk_ = 1, (argv[0][1] != &apos;\0&apos;)?\
</a><a href="#h0-53" id="h0-53" class="i">+					(&amp;argv[0][1]) :\
</a><a href="#h0-54" id="h0-54" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h0-55" id="h0-55" class="i">+
</a><a href="#h0-56" id="h0-56" class="i">+#define ARGF()		((argv[0][1] == &apos;\0&apos; &amp;&amp; argv[1] == NULL)?\
</a><a href="#h0-57" id="h0-57" class="i">+				(char *)0 :\
</a><a href="#h0-58" id="h0-58" class="i">+				(brk_ = 1, (argv[0][1] != &apos;\0&apos;)?\
</a><a href="#h0-59" id="h0-59" class="i">+					(&amp;argv[0][1]) :\
</a><a href="#h0-60" id="h0-60" class="i">+					(argc--, argv++, argv[0])))
</a><a href="#h0-61" id="h0-61" class="i">+
</a><a href="#h0-62" id="h0-62" class="i">+#endif
</a><b>diff --git a/<a href="../file/st/colors/cloudy.h.html">st/colors/cloudy.h</a> b/<a href="../file/st/colors/cloudy.h.html">st/colors/cloudy.h</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,50 @@
</a><a href="#h0-0" id="h0-0" class="i">+/*
</a><a href="#h0-1" id="h0-1" class="i">+
</a><a href="#h0-2" id="h0-2" class="i">+┏━╸╻  ┏━┓╻ ╻╺┳┓╻ ╻
</a><a href="#h0-3" id="h0-3" class="i">+┃  ┃  ┃ ┃┃ ┃ ┃┃┗┳┛
</a><a href="#h0-4" id="h0-4" class="i">+┗━╸┗━╸┗━┛┗━┛╺┻┛ ╹
</a><a href="#h0-5" id="h0-5" class="i">+by tudurom.
</a><a href="#h0-6" id="h0-6" class="i">+
</a><a href="#h0-7" id="h0-7" class="i">+*/
</a><a href="#h0-8" id="h0-8" class="i">+
</a><a href="#h0-9" id="h0-9" class="i">+/* Terminal colors (16 first used in escape sequence) */
</a><a href="#h0-10" id="h0-10" class="i">+static const char *colorname[] = {
</a><a href="#h0-11" id="h0-11" class="i">+	/* 8 normal colors */
</a><a href="#h0-12" id="h0-12" class="i">+	&quot;#273941&quot;,
</a><a href="#h0-13" id="h0-13" class="i">+	&quot;#a66363&quot;,
</a><a href="#h0-14" id="h0-14" class="i">+	&quot;#63a690&quot;,
</a><a href="#h0-15" id="h0-15" class="i">+	&quot;#a6a663&quot;,
</a><a href="#h0-16" id="h0-16" class="i">+	&quot;#6385a6&quot;,
</a><a href="#h0-17" id="h0-17" class="i">+	&quot;#bf9c86&quot;,
</a><a href="#h0-18" id="h0-18" class="i">+	&quot;#63a69b&quot;,
</a><a href="#h0-19" id="h0-19" class="i">+	&quot;#c0c5ce&quot;,
</a><a href="#h0-20" id="h0-20" class="i">+
</a><a href="#h0-21" id="h0-21" class="i">+	/* 8 bright colors */
</a><a href="#h0-22" id="h0-22" class="i">+	&quot;#456472&quot;,
</a><a href="#h0-23" id="h0-23" class="i">+	&quot;#c27171&quot;,
</a><a href="#h0-24" id="h0-24" class="i">+	&quot;#6dc2a3&quot;,
</a><a href="#h0-25" id="h0-25" class="i">+	&quot;#bfc271&quot;,
</a><a href="#h0-26" id="h0-26" class="i">+	&quot;#719bc2&quot;,
</a><a href="#h0-27" id="h0-27" class="i">+	&quot;#bf9c86&quot;,
</a><a href="#h0-28" id="h0-28" class="i">+	&quot;#71c2af&quot;,
</a><a href="#h0-29" id="h0-29" class="i">+	&quot;#eff1f5&quot;,
</a><a href="#h0-30" id="h0-30" class="i">+
</a><a href="#h0-31" id="h0-31" class="i">+	[255] = 0,
</a><a href="#h0-32" id="h0-32" class="i">+};
</a><a href="#h0-33" id="h0-33" class="i">+
</a><a href="#h0-34" id="h0-34" class="i">+
</a><a href="#h0-35" id="h0-35" class="i">+/*
</a><a href="#h0-36" id="h0-36" class="i">+ * Default colors (colorname index)
</a><a href="#h0-37" id="h0-37" class="i">+ * foreground, background, cursor
</a><a href="#h0-38" id="h0-38" class="i">+ */
</a><a href="#h0-39" id="h0-39" class="i">+static unsigned int defaultfg = 7;
</a><a href="#h0-40" id="h0-40" class="i">+static unsigned int defaultbg = 0;
</a><a href="#h0-41" id="h0-41" class="i">+static unsigned int defaultcs = 7;
</a><a href="#h0-42" id="h0-42" class="i">+
</a><a href="#h0-43" id="h0-43" class="i">+/*
</a><a href="#h0-44" id="h0-44" class="i">+ * Colors used, when the specific fg == defaultfg. So in reverse mode this
</a><a href="#h0-45" id="h0-45" class="i">+ * will reverse too. Another logic would only make the simple feature too
</a><a href="#h0-46" id="h0-46" class="i">+ * complex.
</a><a href="#h0-47" id="h0-47" class="i">+ */
</a><a href="#h0-48" id="h0-48" class="i">+static unsigned int defaultitalic = 11;
</a><a href="#h0-49" id="h0-49" class="i">+static unsigned int defaultunderline = 7;
</a><b>diff --git a/<a href="../file/st/config.def.h.html">st/config.def.h</a> b/<a href="../file/st/config.def.h.html">st/config.def.h</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,384 @@
</a><a href="#h0-0" id="h0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h0-1" id="h0-1" class="i">+
</a><a href="#h0-2" id="h0-2" class="i">+/*
</a><a href="#h0-3" id="h0-3" class="i">+ * appearance
</a><a href="#h0-4" id="h0-4" class="i">+ *
</a><a href="#h0-5" id="h0-5" class="i">+ * font: see http://freedesktop.org/software/fontconfig/fontconfig-user.html
</a><a href="#h0-6" id="h0-6" class="i">+ */
</a><a href="#h0-7" id="h0-7" class="i">+static char font[] = &quot;Liberation Mono:pixelsize=12:antialias=false:autohint=false&quot;;
</a><a href="#h0-8" id="h0-8" class="i">+static int borderpx = 2;
</a><a href="#h0-9" id="h0-9" class="i">+static char shell[] = &quot;/bin/sh&quot;;
</a><a href="#h0-10" id="h0-10" class="i">+static char *utmp = NULL;
</a><a href="#h0-11" id="h0-11" class="i">+static char stty_args[] = &quot;stty raw -echo -iexten echonl&quot;;
</a><a href="#h0-12" id="h0-12" class="i">+
</a><a href="#h0-13" id="h0-13" class="i">+/* identification sequence returned in DA and DECID */
</a><a href="#h0-14" id="h0-14" class="i">+static char vtiden[] = &quot;\033[?6c&quot;;
</a><a href="#h0-15" id="h0-15" class="i">+
</a><a href="#h0-16" id="h0-16" class="i">+/* Kerning / character bounding-box multipliers */
</a><a href="#h0-17" id="h0-17" class="i">+static float cwscale = 1.0;
</a><a href="#h0-18" id="h0-18" class="i">+static float chscale = 1.0;
</a><a href="#h0-19" id="h0-19" class="i">+
</a><a href="#h0-20" id="h0-20" class="i">+/*
</a><a href="#h0-21" id="h0-21" class="i">+ * word delimiter string
</a><a href="#h0-22" id="h0-22" class="i">+ *
</a><a href="#h0-23" id="h0-23" class="i">+ * More advanced example: &quot; `&apos;\&quot;()[]{}&quot;
</a><a href="#h0-24" id="h0-24" class="i">+ */
</a><a href="#h0-25" id="h0-25" class="i">+static char worddelimiters[] = &quot; &quot;;
</a><a href="#h0-26" id="h0-26" class="i">+
</a><a href="#h0-27" id="h0-27" class="i">+/* selection timeouts (in milliseconds) */
</a><a href="#h0-28" id="h0-28" class="i">+static unsigned int doubleclicktimeout = 300;
</a><a href="#h0-29" id="h0-29" class="i">+static unsigned int tripleclicktimeout = 600;
</a><a href="#h0-30" id="h0-30" class="i">+
</a><a href="#h0-31" id="h0-31" class="i">+/* alt screens */
</a><a href="#h0-32" id="h0-32" class="i">+static bool allowaltscreen = true;
</a><a href="#h0-33" id="h0-33" class="i">+
</a><a href="#h0-34" id="h0-34" class="i">+/* frames per second st should at maximum draw to the screen */
</a><a href="#h0-35" id="h0-35" class="i">+static unsigned int xfps = 120;
</a><a href="#h0-36" id="h0-36" class="i">+static unsigned int actionfps = 30;
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+/*
</a><a href="#h0-39" id="h0-39" class="i">+ * blinking timeout (set to 0 to disable blinking) for the terminal blinking
</a><a href="#h0-40" id="h0-40" class="i">+ * attribute.
</a><a href="#h0-41" id="h0-41" class="i">+ */
</a><a href="#h0-42" id="h0-42" class="i">+static unsigned int blinktimeout = 800;
</a><a href="#h0-43" id="h0-43" class="i">+
</a><a href="#h0-44" id="h0-44" class="i">+/*
</a><a href="#h0-45" id="h0-45" class="i">+ * thickness of underline and bar cursors
</a><a href="#h0-46" id="h0-46" class="i">+ */
</a><a href="#h0-47" id="h0-47" class="i">+static unsigned int cursorthickness = 2;
</a><a href="#h0-48" id="h0-48" class="i">+
</a><a href="#h0-49" id="h0-49" class="i">+/*
</a><a href="#h0-50" id="h0-50" class="i">+ * bell volume. It must be a value between -100 and 100. Use 0 for disabling
</a><a href="#h0-51" id="h0-51" class="i">+ * it
</a><a href="#h0-52" id="h0-52" class="i">+ */
</a><a href="#h0-53" id="h0-53" class="i">+static int bellvolume = 0;
</a><a href="#h0-54" id="h0-54" class="i">+
</a><a href="#h0-55" id="h0-55" class="i">+/* TERM value */
</a><a href="#h0-56" id="h0-56" class="i">+static char termname[] = &quot;st-256color&quot;;
</a><a href="#h0-57" id="h0-57" class="i">+
</a><a href="#h0-58" id="h0-58" class="i">+static unsigned int tabspaces = 8;
</a><a href="#h0-59" id="h0-59" class="i">+
</a><a href="#h0-60" id="h0-60" class="i">+
</a><a href="#h0-61" id="h0-61" class="i">+/* Terminal colors (16 first used in escape sequence) */
</a><a href="#h0-62" id="h0-62" class="i">+static const char *colorname[] = {
</a><a href="#h0-63" id="h0-63" class="i">+	/* 8 normal colors */
</a><a href="#h0-64" id="h0-64" class="i">+	&quot;black&quot;,
</a><a href="#h0-65" id="h0-65" class="i">+	&quot;red3&quot;,
</a><a href="#h0-66" id="h0-66" class="i">+	&quot;green3&quot;,
</a><a href="#h0-67" id="h0-67" class="i">+	&quot;yellow3&quot;,
</a><a href="#h0-68" id="h0-68" class="i">+	&quot;blue2&quot;,
</a><a href="#h0-69" id="h0-69" class="i">+	&quot;magenta3&quot;,
</a><a href="#h0-70" id="h0-70" class="i">+	&quot;cyan3&quot;,
</a><a href="#h0-71" id="h0-71" class="i">+	&quot;gray90&quot;,
</a><a href="#h0-72" id="h0-72" class="i">+
</a><a href="#h0-73" id="h0-73" class="i">+	/* 8 bright colors */
</a><a href="#h0-74" id="h0-74" class="i">+	&quot;gray50&quot;,
</a><a href="#h0-75" id="h0-75" class="i">+	&quot;red&quot;,
</a><a href="#h0-76" id="h0-76" class="i">+	&quot;green&quot;,
</a><a href="#h0-77" id="h0-77" class="i">+	&quot;yellow&quot;,
</a><a href="#h0-78" id="h0-78" class="i">+	&quot;#5c5cff&quot;,
</a><a href="#h0-79" id="h0-79" class="i">+	&quot;magenta&quot;,
</a><a href="#h0-80" id="h0-80" class="i">+	&quot;cyan&quot;,
</a><a href="#h0-81" id="h0-81" class="i">+	&quot;white&quot;,
</a><a href="#h0-82" id="h0-82" class="i">+
</a><a href="#h0-83" id="h0-83" class="i">+	[255] = 0,
</a><a href="#h0-84" id="h0-84" class="i">+
</a><a href="#h0-85" id="h0-85" class="i">+	/* more colors can be added after 255 to use with DefaultXX */
</a><a href="#h0-86" id="h0-86" class="i">+	&quot;#cccccc&quot;,
</a><a href="#h0-87" id="h0-87" class="i">+};
</a><a href="#h0-88" id="h0-88" class="i">+
</a><a href="#h0-89" id="h0-89" class="i">+
</a><a href="#h0-90" id="h0-90" class="i">+/*
</a><a href="#h0-91" id="h0-91" class="i">+ * Default colors (colorname index)
</a><a href="#h0-92" id="h0-92" class="i">+ * foreground, background, cursor
</a><a href="#h0-93" id="h0-93" class="i">+ */
</a><a href="#h0-94" id="h0-94" class="i">+static unsigned int defaultfg = 7;
</a><a href="#h0-95" id="h0-95" class="i">+static unsigned int defaultbg = 0;
</a><a href="#h0-96" id="h0-96" class="i">+static unsigned int defaultcs = 256;
</a><a href="#h0-97" id="h0-97" class="i">+
</a><a href="#h0-98" id="h0-98" class="i">+/*
</a><a href="#h0-99" id="h0-99" class="i">+ * Colors used, when the specific fg == defaultfg. So in reverse mode this
</a><a href="#h0-100" id="h0-100" class="i">+ * will reverse too. Another logic would only make the simple feature too
</a><a href="#h0-101" id="h0-101" class="i">+ * complex.
</a><a href="#h0-102" id="h0-102" class="i">+ */
</a><a href="#h0-103" id="h0-103" class="i">+static unsigned int defaultitalic = 11;
</a><a href="#h0-104" id="h0-104" class="i">+static unsigned int defaultunderline = 7;
</a><a href="#h0-105" id="h0-105" class="i">+
</a><a href="#h0-106" id="h0-106" class="i">+/* Internal mouse shortcuts. */
</a><a href="#h0-107" id="h0-107" class="i">+/* Beware that overloading Button1 will disable the selection. */
</a><a href="#h0-108" id="h0-108" class="i">+static Mousekey mshortcuts[] = {
</a><a href="#h0-109" id="h0-109" class="i">+	/* button               mask            string */
</a><a href="#h0-110" id="h0-110" class="i">+	{ Button4,              XK_ANY_MOD,     &quot;\031&quot; },
</a><a href="#h0-111" id="h0-111" class="i">+	{ Button5,              XK_ANY_MOD,     &quot;\005&quot; },
</a><a href="#h0-112" id="h0-112" class="i">+};
</a><a href="#h0-113" id="h0-113" class="i">+
</a><a href="#h0-114" id="h0-114" class="i">+/* Internal keyboard shortcuts. */
</a><a href="#h0-115" id="h0-115" class="i">+#define MODKEY Mod1Mask
</a><a href="#h0-116" id="h0-116" class="i">+
</a><a href="#h0-117" id="h0-117" class="i">+static Shortcut shortcuts[] = {
</a><a href="#h0-118" id="h0-118" class="i">+	/* mask                 keysym          function        argument */
</a><a href="#h0-119" id="h0-119" class="i">+	{ ControlMask,          XK_Print,       toggleprinter,  {.i =  0} },
</a><a href="#h0-120" id="h0-120" class="i">+	{ ShiftMask,            XK_Print,       printscreen,    {.i =  0} },
</a><a href="#h0-121" id="h0-121" class="i">+	{ XK_ANY_MOD,           XK_Print,       printsel,       {.i =  0} },
</a><a href="#h0-122" id="h0-122" class="i">+	{ MODKEY|ShiftMask,     XK_Prior,       xzoom,          {.f = +1} },
</a><a href="#h0-123" id="h0-123" class="i">+	{ MODKEY|ShiftMask,     XK_Next,        xzoom,          {.f = -1} },
</a><a href="#h0-124" id="h0-124" class="i">+	{ MODKEY|ShiftMask,     XK_Home,        xzoomreset,     {.f =  0} },
</a><a href="#h0-125" id="h0-125" class="i">+	{ ShiftMask,            XK_Insert,      selpaste,       {.i =  0} },
</a><a href="#h0-126" id="h0-126" class="i">+	{ MODKEY|ShiftMask,     XK_Insert,      clippaste,      {.i =  0} },
</a><a href="#h0-127" id="h0-127" class="i">+	{ MODKEY|ShiftMask,     XK_C,           clipcopy,       {.i =  0} },
</a><a href="#h0-128" id="h0-128" class="i">+	{ MODKEY|ShiftMask,     XK_V,           clippaste,      {.i =  0} },
</a><a href="#h0-129" id="h0-129" class="i">+	{ MODKEY,               XK_Num_Lock,    numlock,        {.i =  0} },
</a><a href="#h0-130" id="h0-130" class="i">+};
</a><a href="#h0-131" id="h0-131" class="i">+
</a><a href="#h0-132" id="h0-132" class="i">+/*
</a><a href="#h0-133" id="h0-133" class="i">+ * Special keys (change &amp; recompile st.info accordingly)
</a><a href="#h0-134" id="h0-134" class="i">+ *
</a><a href="#h0-135" id="h0-135" class="i">+ * Mask value:
</a><a href="#h0-136" id="h0-136" class="i">+ * * Use XK_ANY_MOD to match the key no matter modifiers state
</a><a href="#h0-137" id="h0-137" class="i">+ * * Use XK_NO_MOD to match the key alone (no modifiers)
</a><a href="#h0-138" id="h0-138" class="i">+ * appkey value:
</a><a href="#h0-139" id="h0-139" class="i">+ * * 0: no value
</a><a href="#h0-140" id="h0-140" class="i">+ * * &gt; 0: keypad application mode enabled
</a><a href="#h0-141" id="h0-141" class="i">+ * *   = 2: term.numlock = 1
</a><a href="#h0-142" id="h0-142" class="i">+ * * &lt; 0: keypad application mode disabled
</a><a href="#h0-143" id="h0-143" class="i">+ * appcursor value:
</a><a href="#h0-144" id="h0-144" class="i">+ * * 0: no value
</a><a href="#h0-145" id="h0-145" class="i">+ * * &gt; 0: cursor application mode enabled
</a><a href="#h0-146" id="h0-146" class="i">+ * * &lt; 0: cursor application mode disabled
</a><a href="#h0-147" id="h0-147" class="i">+ * crlf value
</a><a href="#h0-148" id="h0-148" class="i">+ * * 0: no value
</a><a href="#h0-149" id="h0-149" class="i">+ * * &gt; 0: crlf mode is enabled
</a><a href="#h0-150" id="h0-150" class="i">+ * * &lt; 0: crlf mode is disabled
</a><a href="#h0-151" id="h0-151" class="i">+ *
</a><a href="#h0-152" id="h0-152" class="i">+ * Be careful with the order of the definitions because st searches in
</a><a href="#h0-153" id="h0-153" class="i">+ * this table sequentially, so any XK_ANY_MOD must be in the last
</a><a href="#h0-154" id="h0-154" class="i">+ * position for a key.
</a><a href="#h0-155" id="h0-155" class="i">+ */
</a><a href="#h0-156" id="h0-156" class="i">+
</a><a href="#h0-157" id="h0-157" class="i">+/*
</a><a href="#h0-158" id="h0-158" class="i">+ * If you want keys other than the X11 function keys (0xFD00 - 0xFFFF)
</a><a href="#h0-159" id="h0-159" class="i">+ * to be mapped below, add them to this array.
</a><a href="#h0-160" id="h0-160" class="i">+ */
</a><a href="#h0-161" id="h0-161" class="i">+static KeySym mappedkeys[] = { -1 };
</a><a href="#h0-162" id="h0-162" class="i">+
</a><a href="#h0-163" id="h0-163" class="i">+/*
</a><a href="#h0-164" id="h0-164" class="i">+ * State bits to ignore when matching key or button events.  By default,
</a><a href="#h0-165" id="h0-165" class="i">+ * numlock (Mod2Mask) and keyboard layout (XK_SWITCH_MOD) are ignored.
</a><a href="#h0-166" id="h0-166" class="i">+ */
</a><a href="#h0-167" id="h0-167" class="i">+static uint ignoremod = Mod2Mask|XK_SWITCH_MOD;
</a><a href="#h0-168" id="h0-168" class="i">+
</a><a href="#h0-169" id="h0-169" class="i">+/* Override mouse-select while mask is active (when MODE_MOUSE is set).
</a><a href="#h0-170" id="h0-170" class="i">+ * Note that if you want to use ShiftMask with selmasks, set this to an other
</a><a href="#h0-171" id="h0-171" class="i">+ * modifier, set to 0 to not use it. */
</a><a href="#h0-172" id="h0-172" class="i">+static uint forceselmod = ShiftMask;
</a><a href="#h0-173" id="h0-173" class="i">+
</a><a href="#h0-174" id="h0-174" class="i">+static Key key[] = {
</a><a href="#h0-175" id="h0-175" class="i">+	/* keysym           mask            string      appkey appcursor crlf */
</a><a href="#h0-176" id="h0-176" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[2J&quot;,       0,   -1,    0},
</a><a href="#h0-177" id="h0-177" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1,    0},
</a><a href="#h0-178" id="h0-178" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1,    0},
</a><a href="#h0-179" id="h0-179" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1,    0},
</a><a href="#h0-180" id="h0-180" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033Ox&quot;,       +1,    0,    0},
</a><a href="#h0-181" id="h0-181" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1,    0},
</a><a href="#h0-182" id="h0-182" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1,    0},
</a><a href="#h0-183" id="h0-183" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033Or&quot;,       +1,    0,    0},
</a><a href="#h0-184" id="h0-184" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1,    0},
</a><a href="#h0-185" id="h0-185" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1,    0},
</a><a href="#h0-186" id="h0-186" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033Ot&quot;,       +1,    0,    0},
</a><a href="#h0-187" id="h0-187" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1,    0},
</a><a href="#h0-188" id="h0-188" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1,    0},
</a><a href="#h0-189" id="h0-189" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033Ov&quot;,       +1,    0,    0},
</a><a href="#h0-190" id="h0-190" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1,    0},
</a><a href="#h0-191" id="h0-191" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1,    0},
</a><a href="#h0-192" id="h0-192" class="i">+	{ XK_KP_Prior,      ShiftMask,      &quot;\033[5;2~&quot;,     0,    0,    0},
</a><a href="#h0-193" id="h0-193" class="i">+	{ XK_KP_Prior,      XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0,    0},
</a><a href="#h0-194" id="h0-194" class="i">+	{ XK_KP_Begin,      XK_ANY_MOD,     &quot;\033[E&quot;,        0,    0,    0},
</a><a href="#h0-195" id="h0-195" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[J&quot;,       -1,    0,    0},
</a><a href="#h0-196" id="h0-196" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[1;5F&quot;,    +1,    0,    0},
</a><a href="#h0-197" id="h0-197" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[K&quot;,       -1,    0,    0},
</a><a href="#h0-198" id="h0-198" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0,    0},
</a><a href="#h0-199" id="h0-199" class="i">+	{ XK_KP_End,        XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0,    0},
</a><a href="#h0-200" id="h0-200" class="i">+	{ XK_KP_Next,       ShiftMask,      &quot;\033[6;2~&quot;,     0,    0,    0},
</a><a href="#h0-201" id="h0-201" class="i">+	{ XK_KP_Next,       XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0,    0},
</a><a href="#h0-202" id="h0-202" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0,    0},
</a><a href="#h0-203" id="h0-203" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[4l&quot;,      -1,    0,    0},
</a><a href="#h0-204" id="h0-204" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[L&quot;,       -1,    0,    0},
</a><a href="#h0-205" id="h0-205" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[2;5~&quot;,    +1,    0,    0},
</a><a href="#h0-206" id="h0-206" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0,    0},
</a><a href="#h0-207" id="h0-207" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0,    0},
</a><a href="#h0-208" id="h0-208" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[M&quot;,       -1,    0,    0},
</a><a href="#h0-209" id="h0-209" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[3;5~&quot;,    +1,    0,    0},
</a><a href="#h0-210" id="h0-210" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[2K&quot;,      -1,    0,    0},
</a><a href="#h0-211" id="h0-211" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0,    0},
</a><a href="#h0-212" id="h0-212" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0,    0},
</a><a href="#h0-213" id="h0-213" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0,    0},
</a><a href="#h0-214" id="h0-214" class="i">+	{ XK_KP_Multiply,   XK_ANY_MOD,     &quot;\033Oj&quot;,       +2,    0,    0},
</a><a href="#h0-215" id="h0-215" class="i">+	{ XK_KP_Add,        XK_ANY_MOD,     &quot;\033Ok&quot;,       +2,    0,    0},
</a><a href="#h0-216" id="h0-216" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\033OM&quot;,       +2,    0,    0},
</a><a href="#h0-217" id="h0-217" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\r&quot;,           -1,    0,   -1},
</a><a href="#h0-218" id="h0-218" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\r\n&quot;,         -1,    0,   +1},
</a><a href="#h0-219" id="h0-219" class="i">+	{ XK_KP_Subtract,   XK_ANY_MOD,     &quot;\033Om&quot;,       +2,    0,    0},
</a><a href="#h0-220" id="h0-220" class="i">+	{ XK_KP_Decimal,    XK_ANY_MOD,     &quot;\033On&quot;,       +2,    0,    0},
</a><a href="#h0-221" id="h0-221" class="i">+	{ XK_KP_Divide,     XK_ANY_MOD,     &quot;\033Oo&quot;,       +2,    0,    0},
</a><a href="#h0-222" id="h0-222" class="i">+	{ XK_KP_0,          XK_ANY_MOD,     &quot;\033Op&quot;,       +2,    0,    0},
</a><a href="#h0-223" id="h0-223" class="i">+	{ XK_KP_1,          XK_ANY_MOD,     &quot;\033Oq&quot;,       +2,    0,    0},
</a><a href="#h0-224" id="h0-224" class="i">+	{ XK_KP_2,          XK_ANY_MOD,     &quot;\033Or&quot;,       +2,    0,    0},
</a><a href="#h0-225" id="h0-225" class="i">+	{ XK_KP_3,          XK_ANY_MOD,     &quot;\033Os&quot;,       +2,    0,    0},
</a><a href="#h0-226" id="h0-226" class="i">+	{ XK_KP_4,          XK_ANY_MOD,     &quot;\033Ot&quot;,       +2,    0,    0},
</a><a href="#h0-227" id="h0-227" class="i">+	{ XK_KP_5,          XK_ANY_MOD,     &quot;\033Ou&quot;,       +2,    0,    0},
</a><a href="#h0-228" id="h0-228" class="i">+	{ XK_KP_6,          XK_ANY_MOD,     &quot;\033Ov&quot;,       +2,    0,    0},
</a><a href="#h0-229" id="h0-229" class="i">+	{ XK_KP_7,          XK_ANY_MOD,     &quot;\033Ow&quot;,       +2,    0,    0},
</a><a href="#h0-230" id="h0-230" class="i">+	{ XK_KP_8,          XK_ANY_MOD,     &quot;\033Ox&quot;,       +2,    0,    0},
</a><a href="#h0-231" id="h0-231" class="i">+	{ XK_KP_9,          XK_ANY_MOD,     &quot;\033Oy&quot;,       +2,    0,    0},
</a><a href="#h0-232" id="h0-232" class="i">+	{ XK_Up,            ShiftMask,      &quot;\033[1;2A&quot;,     0,    0,    0},
</a><a href="#h0-233" id="h0-233" class="i">+	{ XK_Up,            ControlMask,    &quot;\033[1;5A&quot;,     0,    0,    0},
</a><a href="#h0-234" id="h0-234" class="i">+	{ XK_Up,            Mod1Mask,       &quot;\033[1;3A&quot;,     0,    0,    0},
</a><a href="#h0-235" id="h0-235" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1,    0},
</a><a href="#h0-236" id="h0-236" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1,    0},
</a><a href="#h0-237" id="h0-237" class="i">+	{ XK_Down,          ShiftMask,      &quot;\033[1;2B&quot;,     0,    0,    0},
</a><a href="#h0-238" id="h0-238" class="i">+	{ XK_Down,          ControlMask,    &quot;\033[1;5B&quot;,     0,    0,    0},
</a><a href="#h0-239" id="h0-239" class="i">+	{ XK_Down,          Mod1Mask,       &quot;\033[1;3B&quot;,     0,    0,    0},
</a><a href="#h0-240" id="h0-240" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1,    0},
</a><a href="#h0-241" id="h0-241" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1,    0},
</a><a href="#h0-242" id="h0-242" class="i">+	{ XK_Left,          ShiftMask,      &quot;\033[1;2D&quot;,     0,    0,    0},
</a><a href="#h0-243" id="h0-243" class="i">+	{ XK_Left,          ControlMask,    &quot;\033[1;5D&quot;,     0,    0,    0},
</a><a href="#h0-244" id="h0-244" class="i">+	{ XK_Left,          Mod1Mask,       &quot;\033[1;3D&quot;,     0,    0,    0},
</a><a href="#h0-245" id="h0-245" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1,    0},
</a><a href="#h0-246" id="h0-246" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1,    0},
</a><a href="#h0-247" id="h0-247" class="i">+	{ XK_Right,         ShiftMask,      &quot;\033[1;2C&quot;,     0,    0,    0},
</a><a href="#h0-248" id="h0-248" class="i">+	{ XK_Right,         ControlMask,    &quot;\033[1;5C&quot;,     0,    0,    0},
</a><a href="#h0-249" id="h0-249" class="i">+	{ XK_Right,         Mod1Mask,       &quot;\033[1;3C&quot;,     0,    0,    0},
</a><a href="#h0-250" id="h0-250" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1,    0},
</a><a href="#h0-251" id="h0-251" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1,    0},
</a><a href="#h0-252" id="h0-252" class="i">+	{ XK_ISO_Left_Tab,  ShiftMask,      &quot;\033[Z&quot;,        0,    0,    0},
</a><a href="#h0-253" id="h0-253" class="i">+	{ XK_Return,        Mod1Mask,       &quot;\033\r&quot;,        0,    0,   -1},
</a><a href="#h0-254" id="h0-254" class="i">+	{ XK_Return,        Mod1Mask,       &quot;\033\r\n&quot;,      0,    0,   +1},
</a><a href="#h0-255" id="h0-255" class="i">+	{ XK_Return,        XK_ANY_MOD,     &quot;\r&quot;,            0,    0,   -1},
</a><a href="#h0-256" id="h0-256" class="i">+	{ XK_Return,        XK_ANY_MOD,     &quot;\r\n&quot;,          0,    0,   +1},
</a><a href="#h0-257" id="h0-257" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[4l&quot;,      -1,    0,    0},
</a><a href="#h0-258" id="h0-258" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0,    0},
</a><a href="#h0-259" id="h0-259" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[L&quot;,       -1,    0,    0},
</a><a href="#h0-260" id="h0-260" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[2;5~&quot;,    +1,    0,    0},
</a><a href="#h0-261" id="h0-261" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0,    0},
</a><a href="#h0-262" id="h0-262" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0,    0},
</a><a href="#h0-263" id="h0-263" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[M&quot;,       -1,    0,    0},
</a><a href="#h0-264" id="h0-264" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[3;5~&quot;,    +1,    0,    0},
</a><a href="#h0-265" id="h0-265" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[2K&quot;,      -1,    0,    0},
</a><a href="#h0-266" id="h0-266" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0,    0},
</a><a href="#h0-267" id="h0-267" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0,    0},
</a><a href="#h0-268" id="h0-268" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0,    0},
</a><a href="#h0-269" id="h0-269" class="i">+	{ XK_BackSpace,     XK_NO_MOD,      &quot;\177&quot;,          0,    0,    0},
</a><a href="#h0-270" id="h0-270" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[2J&quot;,       0,   -1,    0},
</a><a href="#h0-271" id="h0-271" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1,    0},
</a><a href="#h0-272" id="h0-272" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1,    0},
</a><a href="#h0-273" id="h0-273" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1,    0},
</a><a href="#h0-274" id="h0-274" class="i">+	{ XK_End,           ControlMask,    &quot;\033[J&quot;,       -1,    0,    0},
</a><a href="#h0-275" id="h0-275" class="i">+	{ XK_End,           ControlMask,    &quot;\033[1;5F&quot;,    +1,    0,    0},
</a><a href="#h0-276" id="h0-276" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[K&quot;,       -1,    0,    0},
</a><a href="#h0-277" id="h0-277" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0,    0},
</a><a href="#h0-278" id="h0-278" class="i">+	{ XK_End,           XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0,    0},
</a><a href="#h0-279" id="h0-279" class="i">+	{ XK_Prior,         ControlMask,    &quot;\033[5;5~&quot;,     0,    0,    0},
</a><a href="#h0-280" id="h0-280" class="i">+	{ XK_Prior,         ShiftMask,      &quot;\033[5;2~&quot;,     0,    0,    0},
</a><a href="#h0-281" id="h0-281" class="i">+	{ XK_Prior,         XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0,    0},
</a><a href="#h0-282" id="h0-282" class="i">+	{ XK_Next,          ControlMask,    &quot;\033[6;5~&quot;,     0,    0,    0},
</a><a href="#h0-283" id="h0-283" class="i">+	{ XK_Next,          ShiftMask,      &quot;\033[6;2~&quot;,     0,    0,    0},
</a><a href="#h0-284" id="h0-284" class="i">+	{ XK_Next,          XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0,    0},
</a><a href="#h0-285" id="h0-285" class="i">+	{ XK_F1,            XK_NO_MOD,      &quot;\033OP&quot; ,       0,    0,    0},
</a><a href="#h0-286" id="h0-286" class="i">+	{ XK_F1, /* F13 */  ShiftMask,      &quot;\033[1;2P&quot;,     0,    0,    0},
</a><a href="#h0-287" id="h0-287" class="i">+	{ XK_F1, /* F25 */  ControlMask,    &quot;\033[1;5P&quot;,     0,    0,    0},
</a><a href="#h0-288" id="h0-288" class="i">+	{ XK_F1, /* F37 */  Mod4Mask,       &quot;\033[1;6P&quot;,     0,    0,    0},
</a><a href="#h0-289" id="h0-289" class="i">+	{ XK_F1, /* F49 */  Mod1Mask,       &quot;\033[1;3P&quot;,     0,    0,    0},
</a><a href="#h0-290" id="h0-290" class="i">+	{ XK_F1, /* F61 */  Mod3Mask,       &quot;\033[1;4P&quot;,     0,    0,    0},
</a><a href="#h0-291" id="h0-291" class="i">+	{ XK_F2,            XK_NO_MOD,      &quot;\033OQ&quot; ,       0,    0,    0},
</a><a href="#h0-292" id="h0-292" class="i">+	{ XK_F2, /* F14 */  ShiftMask,      &quot;\033[1;2Q&quot;,     0,    0,    0},
</a><a href="#h0-293" id="h0-293" class="i">+	{ XK_F2, /* F26 */  ControlMask,    &quot;\033[1;5Q&quot;,     0,    0,    0},
</a><a href="#h0-294" id="h0-294" class="i">+	{ XK_F2, /* F38 */  Mod4Mask,       &quot;\033[1;6Q&quot;,     0,    0,    0},
</a><a href="#h0-295" id="h0-295" class="i">+	{ XK_F2, /* F50 */  Mod1Mask,       &quot;\033[1;3Q&quot;,     0,    0,    0},
</a><a href="#h0-296" id="h0-296" class="i">+	{ XK_F2, /* F62 */  Mod3Mask,       &quot;\033[1;4Q&quot;,     0,    0,    0},
</a><a href="#h0-297" id="h0-297" class="i">+	{ XK_F3,            XK_NO_MOD,      &quot;\033OR&quot; ,       0,    0,    0},
</a><a href="#h0-298" id="h0-298" class="i">+	{ XK_F3, /* F15 */  ShiftMask,      &quot;\033[1;2R&quot;,     0,    0,    0},
</a><a href="#h0-299" id="h0-299" class="i">+	{ XK_F3, /* F27 */  ControlMask,    &quot;\033[1;5R&quot;,     0,    0,    0},
</a><a href="#h0-300" id="h0-300" class="i">+	{ XK_F3, /* F39 */  Mod4Mask,       &quot;\033[1;6R&quot;,     0,    0,    0},
</a><a href="#h0-301" id="h0-301" class="i">+	{ XK_F3, /* F51 */  Mod1Mask,       &quot;\033[1;3R&quot;,     0,    0,    0},
</a><a href="#h0-302" id="h0-302" class="i">+	{ XK_F3, /* F63 */  Mod3Mask,       &quot;\033[1;4R&quot;,     0,    0,    0},
</a><a href="#h0-303" id="h0-303" class="i">+	{ XK_F4,            XK_NO_MOD,      &quot;\033OS&quot; ,       0,    0,    0},
</a><a href="#h0-304" id="h0-304" class="i">+	{ XK_F4, /* F16 */  ShiftMask,      &quot;\033[1;2S&quot;,     0,    0,    0},
</a><a href="#h0-305" id="h0-305" class="i">+	{ XK_F4, /* F28 */  ControlMask,    &quot;\033[1;5S&quot;,     0,    0,    0},
</a><a href="#h0-306" id="h0-306" class="i">+	{ XK_F4, /* F40 */  Mod4Mask,       &quot;\033[1;6S&quot;,     0,    0,    0},
</a><a href="#h0-307" id="h0-307" class="i">+	{ XK_F4, /* F52 */  Mod1Mask,       &quot;\033[1;3S&quot;,     0,    0,    0},
</a><a href="#h0-308" id="h0-308" class="i">+	{ XK_F5,            XK_NO_MOD,      &quot;\033[15~&quot;,      0,    0,    0},
</a><a href="#h0-309" id="h0-309" class="i">+	{ XK_F5, /* F17 */  ShiftMask,      &quot;\033[15;2~&quot;,    0,    0,    0},
</a><a href="#h0-310" id="h0-310" class="i">+	{ XK_F5, /* F29 */  ControlMask,    &quot;\033[15;5~&quot;,    0,    0,    0},
</a><a href="#h0-311" id="h0-311" class="i">+	{ XK_F5, /* F41 */  Mod4Mask,       &quot;\033[15;6~&quot;,    0,    0,    0},
</a><a href="#h0-312" id="h0-312" class="i">+	{ XK_F5, /* F53 */  Mod1Mask,       &quot;\033[15;3~&quot;,    0,    0,    0},
</a><a href="#h0-313" id="h0-313" class="i">+	{ XK_F6,            XK_NO_MOD,      &quot;\033[17~&quot;,      0,    0,    0},
</a><a href="#h0-314" id="h0-314" class="i">+	{ XK_F6, /* F18 */  ShiftMask,      &quot;\033[17;2~&quot;,    0,    0,    0},
</a><a href="#h0-315" id="h0-315" class="i">+	{ XK_F6, /* F30 */  ControlMask,    &quot;\033[17;5~&quot;,    0,    0,    0},
</a><a href="#h0-316" id="h0-316" class="i">+	{ XK_F6, /* F42 */  Mod4Mask,       &quot;\033[17;6~&quot;,    0,    0,    0},
</a><a href="#h0-317" id="h0-317" class="i">+	{ XK_F6, /* F54 */  Mod1Mask,       &quot;\033[17;3~&quot;,    0,    0,    0},
</a><a href="#h0-318" id="h0-318" class="i">+	{ XK_F7,            XK_NO_MOD,      &quot;\033[18~&quot;,      0,    0,    0},
</a><a href="#h0-319" id="h0-319" class="i">+	{ XK_F7, /* F19 */  ShiftMask,      &quot;\033[18;2~&quot;,    0,    0,    0},
</a><a href="#h0-320" id="h0-320" class="i">+	{ XK_F7, /* F31 */  ControlMask,    &quot;\033[18;5~&quot;,    0,    0,    0},
</a><a href="#h0-321" id="h0-321" class="i">+	{ XK_F7, /* F43 */  Mod4Mask,       &quot;\033[18;6~&quot;,    0,    0,    0},
</a><a href="#h0-322" id="h0-322" class="i">+	{ XK_F7, /* F55 */  Mod1Mask,       &quot;\033[18;3~&quot;,    0,    0,    0},
</a><a href="#h0-323" id="h0-323" class="i">+	{ XK_F8,            XK_NO_MOD,      &quot;\033[19~&quot;,      0,    0,    0},
</a><a href="#h0-324" id="h0-324" class="i">+	{ XK_F8, /* F20 */  ShiftMask,      &quot;\033[19;2~&quot;,    0,    0,    0},
</a><a href="#h0-325" id="h0-325" class="i">+	{ XK_F8, /* F32 */  ControlMask,    &quot;\033[19;5~&quot;,    0,    0,    0},
</a><a href="#h0-326" id="h0-326" class="i">+	{ XK_F8, /* F44 */  Mod4Mask,       &quot;\033[19;6~&quot;,    0,    0,    0},
</a><a href="#h0-327" id="h0-327" class="i">+	{ XK_F8, /* F56 */  Mod1Mask,       &quot;\033[19;3~&quot;,    0,    0,    0},
</a><a href="#h0-328" id="h0-328" class="i">+	{ XK_F9,            XK_NO_MOD,      &quot;\033[20~&quot;,      0,    0,    0},
</a><a href="#h0-329" id="h0-329" class="i">+	{ XK_F9, /* F21 */  ShiftMask,      &quot;\033[20;2~&quot;,    0,    0,    0},
</a><a href="#h0-330" id="h0-330" class="i">+	{ XK_F9, /* F33 */  ControlMask,    &quot;\033[20;5~&quot;,    0,    0,    0},
</a><a href="#h0-331" id="h0-331" class="i">+	{ XK_F9, /* F45 */  Mod4Mask,       &quot;\033[20;6~&quot;,    0,    0,    0},
</a><a href="#h0-332" id="h0-332" class="i">+	{ XK_F9, /* F57 */  Mod1Mask,       &quot;\033[20;3~&quot;,    0,    0,    0},
</a><a href="#h0-333" id="h0-333" class="i">+	{ XK_F10,           XK_NO_MOD,      &quot;\033[21~&quot;,      0,    0,    0},
</a><a href="#h0-334" id="h0-334" class="i">+	{ XK_F10, /* F22 */ ShiftMask,      &quot;\033[21;2~&quot;,    0,    0,    0},
</a><a href="#h0-335" id="h0-335" class="i">+	{ XK_F10, /* F34 */ ControlMask,    &quot;\033[21;5~&quot;,    0,    0,    0},
</a><a href="#h0-336" id="h0-336" class="i">+	{ XK_F10, /* F46 */ Mod4Mask,       &quot;\033[21;6~&quot;,    0,    0,    0},
</a><a href="#h0-337" id="h0-337" class="i">+	{ XK_F10, /* F58 */ Mod1Mask,       &quot;\033[21;3~&quot;,    0,    0,    0},
</a><a href="#h0-338" id="h0-338" class="i">+	{ XK_F11,           XK_NO_MOD,      &quot;\033[23~&quot;,      0,    0,    0},
</a><a href="#h0-339" id="h0-339" class="i">+	{ XK_F11, /* F23 */ ShiftMask,      &quot;\033[23;2~&quot;,    0,    0,    0},
</a><a href="#h0-340" id="h0-340" class="i">+	{ XK_F11, /* F35 */ ControlMask,    &quot;\033[23;5~&quot;,    0,    0,    0},
</a><a href="#h0-341" id="h0-341" class="i">+	{ XK_F11, /* F47 */ Mod4Mask,       &quot;\033[23;6~&quot;,    0,    0,    0},
</a><a href="#h0-342" id="h0-342" class="i">+	{ XK_F11, /* F59 */ Mod1Mask,       &quot;\033[23;3~&quot;,    0,    0,    0},
</a><a href="#h0-343" id="h0-343" class="i">+	{ XK_F12,           XK_NO_MOD,      &quot;\033[24~&quot;,      0,    0,    0},
</a><a href="#h0-344" id="h0-344" class="i">+	{ XK_F12, /* F24 */ ShiftMask,      &quot;\033[24;2~&quot;,    0,    0,    0},
</a><a href="#h0-345" id="h0-345" class="i">+	{ XK_F12, /* F36 */ ControlMask,    &quot;\033[24;5~&quot;,    0,    0,    0},
</a><a href="#h0-346" id="h0-346" class="i">+	{ XK_F12, /* F48 */ Mod4Mask,       &quot;\033[24;6~&quot;,    0,    0,    0},
</a><a href="#h0-347" id="h0-347" class="i">+	{ XK_F12, /* F60 */ Mod1Mask,       &quot;\033[24;3~&quot;,    0,    0,    0},
</a><a href="#h0-348" id="h0-348" class="i">+	{ XK_F13,           XK_NO_MOD,      &quot;\033[1;2P&quot;,     0,    0,    0},
</a><a href="#h0-349" id="h0-349" class="i">+	{ XK_F14,           XK_NO_MOD,      &quot;\033[1;2Q&quot;,     0,    0,    0},
</a><a href="#h0-350" id="h0-350" class="i">+	{ XK_F15,           XK_NO_MOD,      &quot;\033[1;2R&quot;,     0,    0,    0},
</a><a href="#h0-351" id="h0-351" class="i">+	{ XK_F16,           XK_NO_MOD,      &quot;\033[1;2S&quot;,     0,    0,    0},
</a><a href="#h0-352" id="h0-352" class="i">+	{ XK_F17,           XK_NO_MOD,      &quot;\033[15;2~&quot;,    0,    0,    0},
</a><a href="#h0-353" id="h0-353" class="i">+	{ XK_F18,           XK_NO_MOD,      &quot;\033[17;2~&quot;,    0,    0,    0},
</a><a href="#h0-354" id="h0-354" class="i">+	{ XK_F19,           XK_NO_MOD,      &quot;\033[18;2~&quot;,    0,    0,    0},
</a><a href="#h0-355" id="h0-355" class="i">+	{ XK_F20,           XK_NO_MOD,      &quot;\033[19;2~&quot;,    0,    0,    0},
</a><a href="#h0-356" id="h0-356" class="i">+	{ XK_F21,           XK_NO_MOD,      &quot;\033[20;2~&quot;,    0,    0,    0},
</a><a href="#h0-357" id="h0-357" class="i">+	{ XK_F22,           XK_NO_MOD,      &quot;\033[21;2~&quot;,    0,    0,    0},
</a><a href="#h0-358" id="h0-358" class="i">+	{ XK_F23,           XK_NO_MOD,      &quot;\033[23;2~&quot;,    0,    0,    0},
</a><a href="#h0-359" id="h0-359" class="i">+	{ XK_F24,           XK_NO_MOD,      &quot;\033[24;2~&quot;,    0,    0,    0},
</a><a href="#h0-360" id="h0-360" class="i">+	{ XK_F25,           XK_NO_MOD,      &quot;\033[1;5P&quot;,     0,    0,    0},
</a><a href="#h0-361" id="h0-361" class="i">+	{ XK_F26,           XK_NO_MOD,      &quot;\033[1;5Q&quot;,     0,    0,    0},
</a><a href="#h0-362" id="h0-362" class="i">+	{ XK_F27,           XK_NO_MOD,      &quot;\033[1;5R&quot;,     0,    0,    0},
</a><a href="#h0-363" id="h0-363" class="i">+	{ XK_F28,           XK_NO_MOD,      &quot;\033[1;5S&quot;,     0,    0,    0},
</a><a href="#h0-364" id="h0-364" class="i">+	{ XK_F29,           XK_NO_MOD,      &quot;\033[15;5~&quot;,    0,    0,    0},
</a><a href="#h0-365" id="h0-365" class="i">+	{ XK_F30,           XK_NO_MOD,      &quot;\033[17;5~&quot;,    0,    0,    0},
</a><a href="#h0-366" id="h0-366" class="i">+	{ XK_F31,           XK_NO_MOD,      &quot;\033[18;5~&quot;,    0,    0,    0},
</a><a href="#h0-367" id="h0-367" class="i">+	{ XK_F32,           XK_NO_MOD,      &quot;\033[19;5~&quot;,    0,    0,    0},
</a><a href="#h0-368" id="h0-368" class="i">+	{ XK_F33,           XK_NO_MOD,      &quot;\033[20;5~&quot;,    0,    0,    0},
</a><a href="#h0-369" id="h0-369" class="i">+	{ XK_F34,           XK_NO_MOD,      &quot;\033[21;5~&quot;,    0,    0,    0},
</a><a href="#h0-370" id="h0-370" class="i">+	{ XK_F35,           XK_NO_MOD,      &quot;\033[23;5~&quot;,    0,    0,    0},
</a><a href="#h0-371" id="h0-371" class="i">+};
</a><a href="#h0-372" id="h0-372" class="i">+
</a><a href="#h0-373" id="h0-373" class="i">+/*
</a><a href="#h0-374" id="h0-374" class="i">+ * Selection types&apos; masks.
</a><a href="#h0-375" id="h0-375" class="i">+ * Use the same masks as usual.
</a><a href="#h0-376" id="h0-376" class="i">+ * Button1Mask is always unset, to make masks match between ButtonPress.
</a><a href="#h0-377" id="h0-377" class="i">+ * ButtonRelease and MotionNotify.
</a><a href="#h0-378" id="h0-378" class="i">+ * If no match is found, regular selection is used.
</a><a href="#h0-379" id="h0-379" class="i">+ */
</a><a href="#h0-380" id="h0-380" class="i">+static uint selmasks[] = {
</a><a href="#h0-381" id="h0-381" class="i">+	[SEL_RECTANGULAR] = Mod1Mask,
</a><a href="#h0-382" id="h0-382" class="i">+};
</a><a href="#h0-383" id="h0-383" class="i">+
</a><b>diff --git a/<a href="../file/st/config.h.html">st/config.h</a> b/<a href="../file/st/config.h.html">st/config.h</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,342 @@
</a><a href="#h0-0" id="h0-0" class="i">+/* See LICENSE file for copyright and license details. */
</a><a href="#h0-1" id="h0-1" class="i">+
</a><a href="#h0-2" id="h0-2" class="i">+/*
</a><a href="#h0-3" id="h0-3" class="i">+ * appearance
</a><a href="#h0-4" id="h0-4" class="i">+ *
</a><a href="#h0-5" id="h0-5" class="i">+ * font: see http://freedesktop.org/software/fontconfig/fontconfig-user.html
</a><a href="#h0-6" id="h0-6" class="i">+ */
</a><a href="#h0-7" id="h0-7" class="i">+
</a><a href="#h0-8" id="h0-8" class="i">+#include &quot;colors/cloudy.h&quot;
</a><a href="#h0-9" id="h0-9" class="i">+
</a><a href="#h0-10" id="h0-10" class="i">+static char font[] = &quot;Metis&quot;;
</a><a href="#h0-11" id="h0-11" class="i">+static int bold_font = 0;
</a><a href="#h0-12" id="h0-12" class="i">+static int borderpx = 15;
</a><a href="#h0-13" id="h0-13" class="i">+static char shell[] = &quot;/bin/mksh&quot;;
</a><a href="#h0-14" id="h0-14" class="i">+static char *utmp = NULL;
</a><a href="#h0-15" id="h0-15" class="i">+static char stty_args[] = &quot;stty raw -echo -iexten echonl&quot;;
</a><a href="#h0-16" id="h0-16" class="i">+
</a><a href="#h0-17" id="h0-17" class="i">+/* identification sequence returned in DA and DECID */
</a><a href="#h0-18" id="h0-18" class="i">+static char vtiden[] = &quot;\033[?6c&quot;;
</a><a href="#h0-19" id="h0-19" class="i">+
</a><a href="#h0-20" id="h0-20" class="i">+/* Kerning / character bounding-box multipliers */
</a><a href="#h0-21" id="h0-21" class="i">+static float cwscale = 0.4;
</a><a href="#h0-22" id="h0-22" class="i">+static float chscale = 1;
</a><a href="#h0-23" id="h0-23" class="i">+
</a><a href="#h0-24" id="h0-24" class="i">+/*
</a><a href="#h0-25" id="h0-25" class="i">+ * word delimiter string
</a><a href="#h0-26" id="h0-26" class="i">+ *
</a><a href="#h0-27" id="h0-27" class="i">+ * More advanced example: &quot; `&apos;\&quot;()[]{}&quot;
</a><a href="#h0-28" id="h0-28" class="i">+ */
</a><a href="#h0-29" id="h0-29" class="i">+static char worddelimiters[] = &quot; &quot;;
</a><a href="#h0-30" id="h0-30" class="i">+
</a><a href="#h0-31" id="h0-31" class="i">+/* selection timeouts (in milliseconds) */
</a><a href="#h0-32" id="h0-32" class="i">+static unsigned int doubleclicktimeout = 300;
</a><a href="#h0-33" id="h0-33" class="i">+static unsigned int tripleclicktimeout = 600;
</a><a href="#h0-34" id="h0-34" class="i">+
</a><a href="#h0-35" id="h0-35" class="i">+/* alt screens */
</a><a href="#h0-36" id="h0-36" class="i">+static bool allowaltscreen = true;
</a><a href="#h0-37" id="h0-37" class="i">+
</a><a href="#h0-38" id="h0-38" class="i">+/* frames per second st should at maximum draw to the screen */
</a><a href="#h0-39" id="h0-39" class="i">+static unsigned int xfps = 3000;
</a><a href="#h0-40" id="h0-40" class="i">+static unsigned int actionfps = 360;
</a><a href="#h0-41" id="h0-41" class="i">+
</a><a href="#h0-42" id="h0-42" class="i">+/*
</a><a href="#h0-43" id="h0-43" class="i">+ * blinking timeout (set to 0 to disable blinking) for the terminal blinking
</a><a href="#h0-44" id="h0-44" class="i">+ * attribute.
</a><a href="#h0-45" id="h0-45" class="i">+ */
</a><a href="#h0-46" id="h0-46" class="i">+static unsigned int blinktimeout = 800;
</a><a href="#h0-47" id="h0-47" class="i">+
</a><a href="#h0-48" id="h0-48" class="i">+/*
</a><a href="#h0-49" id="h0-49" class="i">+ * thickness of underline and bar cursors
</a><a href="#h0-50" id="h0-50" class="i">+ */
</a><a href="#h0-51" id="h0-51" class="i">+static unsigned int cursorthickness = 2;
</a><a href="#h0-52" id="h0-52" class="i">+
</a><a href="#h0-53" id="h0-53" class="i">+/*
</a><a href="#h0-54" id="h0-54" class="i">+ * bell volume. It must be a value between -100 and 100. Use 0 for disabling
</a><a href="#h0-55" id="h0-55" class="i">+ * it
</a><a href="#h0-56" id="h0-56" class="i">+ */
</a><a href="#h0-57" id="h0-57" class="i">+static int bellvolume = 0;
</a><a href="#h0-58" id="h0-58" class="i">+
</a><a href="#h0-59" id="h0-59" class="i">+/* TERM value */
</a><a href="#h0-60" id="h0-60" class="i">+static char termname[] = &quot;st-256color&quot;;
</a><a href="#h0-61" id="h0-61" class="i">+
</a><a href="#h0-62" id="h0-62" class="i">+static unsigned int tabspaces = 8;
</a><a href="#h0-63" id="h0-63" class="i">+
</a><a href="#h0-64" id="h0-64" class="i">+/* Internal mouse shortcuts. */
</a><a href="#h0-65" id="h0-65" class="i">+/* Beware that overloading Button1 will disable the selection. */
</a><a href="#h0-66" id="h0-66" class="i">+static Mousekey mshortcuts[] = {
</a><a href="#h0-67" id="h0-67" class="i">+	/* button               mask            string */
</a><a href="#h0-68" id="h0-68" class="i">+	{ Button4,              XK_ANY_MOD,     &quot;\031&quot; },
</a><a href="#h0-69" id="h0-69" class="i">+	{ Button5,              XK_ANY_MOD,     &quot;\005&quot; },
</a><a href="#h0-70" id="h0-70" class="i">+};
</a><a href="#h0-71" id="h0-71" class="i">+
</a><a href="#h0-72" id="h0-72" class="i">+/* Internal keyboard shortcuts. */
</a><a href="#h0-73" id="h0-73" class="i">+#define MODKEY Mod1Mask
</a><a href="#h0-74" id="h0-74" class="i">+
</a><a href="#h0-75" id="h0-75" class="i">+static Shortcut shortcuts[] = {
</a><a href="#h0-76" id="h0-76" class="i">+	/* mask                 keysym          function        argument */
</a><a href="#h0-77" id="h0-77" class="i">+	{ ControlMask,          XK_Print,       toggleprinter,  {.i =  0} },
</a><a href="#h0-78" id="h0-78" class="i">+	{ ShiftMask,            XK_Print,       printscreen,    {.i =  0} },
</a><a href="#h0-79" id="h0-79" class="i">+	{ XK_ANY_MOD,           XK_Print,       printsel,       {.i =  0} },
</a><a href="#h0-80" id="h0-80" class="i">+	{ MODKEY|ShiftMask,     XK_Prior,       xzoom,          {.f = +1} },
</a><a href="#h0-81" id="h0-81" class="i">+	{ MODKEY|ShiftMask,     XK_Next,        xzoom,          {.f = -1} },
</a><a href="#h0-82" id="h0-82" class="i">+	{ MODKEY|ShiftMask,     XK_Home,        xzoomreset,     {.f =  0} },
</a><a href="#h0-83" id="h0-83" class="i">+	{ ShiftMask,            XK_Insert,      selpaste,       {.i =  0} },
</a><a href="#h0-84" id="h0-84" class="i">+	{ MODKEY|ShiftMask,     XK_Insert,      clippaste,      {.i =  0} },
</a><a href="#h0-85" id="h0-85" class="i">+	{ MODKEY|ShiftMask,     XK_C,           clipcopy,       {.i =  0} },
</a><a href="#h0-86" id="h0-86" class="i">+	{ MODKEY|ShiftMask,     XK_V,           clippaste,      {.i =  0} },
</a><a href="#h0-87" id="h0-87" class="i">+	{ MODKEY,               XK_Num_Lock,    numlock,        {.i =  0} },
</a><a href="#h0-88" id="h0-88" class="i">+  { MODKEY,               XK_u,           externalpipe,   {.v = &quot;xurls | menu -l 5 -p &apos;url&apos; | xargs -r open&quot; } },
</a><a href="#h0-89" id="h0-89" class="i">+};
</a><a href="#h0-90" id="h0-90" class="i">+
</a><a href="#h0-91" id="h0-91" class="i">+/*
</a><a href="#h0-92" id="h0-92" class="i">+ * Special keys (change &amp; recompile st.info accordingly)
</a><a href="#h0-93" id="h0-93" class="i">+ *
</a><a href="#h0-94" id="h0-94" class="i">+ * Mask value:
</a><a href="#h0-95" id="h0-95" class="i">+ * * Use XK_ANY_MOD to match the key no matter modifiers state
</a><a href="#h0-96" id="h0-96" class="i">+ * * Use XK_NO_MOD to match the key alone (no modifiers)
</a><a href="#h0-97" id="h0-97" class="i">+ * appkey value:
</a><a href="#h0-98" id="h0-98" class="i">+ * * 0: no value
</a><a href="#h0-99" id="h0-99" class="i">+ * * &gt; 0: keypad application mode enabled
</a><a href="#h0-100" id="h0-100" class="i">+ * *   = 2: term.numlock = 1
</a><a href="#h0-101" id="h0-101" class="i">+ * * &lt; 0: keypad application mode disabled
</a><a href="#h0-102" id="h0-102" class="i">+ * appcursor value:
</a><a href="#h0-103" id="h0-103" class="i">+ * * 0: no value
</a><a href="#h0-104" id="h0-104" class="i">+ * * &gt; 0: cursor application mode enabled
</a><a href="#h0-105" id="h0-105" class="i">+ * * &lt; 0: cursor application mode disabled
</a><a href="#h0-106" id="h0-106" class="i">+ * crlf value
</a><a href="#h0-107" id="h0-107" class="i">+ * * 0: no value
</a><a href="#h0-108" id="h0-108" class="i">+ * * &gt; 0: crlf mode is enabled
</a><a href="#h0-109" id="h0-109" class="i">+ * * &lt; 0: crlf mode is disabled
</a><a href="#h0-110" id="h0-110" class="i">+ *
</a><a href="#h0-111" id="h0-111" class="i">+ * Be careful with the order of the definitions because st searches in
</a><a href="#h0-112" id="h0-112" class="i">+ * this table sequentially, so any XK_ANY_MOD must be in the last
</a><a href="#h0-113" id="h0-113" class="i">+ * position for a key.
</a><a href="#h0-114" id="h0-114" class="i">+ */
</a><a href="#h0-115" id="h0-115" class="i">+
</a><a href="#h0-116" id="h0-116" class="i">+/*
</a><a href="#h0-117" id="h0-117" class="i">+ * If you want keys other than the X11 function keys (0xFD00 - 0xFFFF)
</a><a href="#h0-118" id="h0-118" class="i">+ * to be mapped below, add them to this array.
</a><a href="#h0-119" id="h0-119" class="i">+ */
</a><a href="#h0-120" id="h0-120" class="i">+static KeySym mappedkeys[] = { -1 };
</a><a href="#h0-121" id="h0-121" class="i">+
</a><a href="#h0-122" id="h0-122" class="i">+/*
</a><a href="#h0-123" id="h0-123" class="i">+ * State bits to ignore when matching key or button events.  By default,
</a><a href="#h0-124" id="h0-124" class="i">+ * numlock (Mod2Mask) and keyboard layout (XK_SWITCH_MOD) are ignored.
</a><a href="#h0-125" id="h0-125" class="i">+ */
</a><a href="#h0-126" id="h0-126" class="i">+static uint ignoremod = Mod2Mask|XK_SWITCH_MOD;
</a><a href="#h0-127" id="h0-127" class="i">+
</a><a href="#h0-128" id="h0-128" class="i">+/* Override mouse-select while mask is active (when MODE_MOUSE is set).
</a><a href="#h0-129" id="h0-129" class="i">+ * Note that if you want to use ShiftMask with selmasks, set this to an other
</a><a href="#h0-130" id="h0-130" class="i">+ * modifier, set to 0 to not use it. */
</a><a href="#h0-131" id="h0-131" class="i">+static uint forceselmod = ShiftMask;
</a><a href="#h0-132" id="h0-132" class="i">+
</a><a href="#h0-133" id="h0-133" class="i">+static Key key[] = {
</a><a href="#h0-134" id="h0-134" class="i">+	/* keysym           mask            string      appkey appcursor crlf */
</a><a href="#h0-135" id="h0-135" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[2J&quot;,       0,   -1,    0},
</a><a href="#h0-136" id="h0-136" class="i">+	{ XK_KP_Home,       ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1,    0},
</a><a href="#h0-137" id="h0-137" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1,    0},
</a><a href="#h0-138" id="h0-138" class="i">+	{ XK_KP_Home,       XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1,    0},
</a><a href="#h0-139" id="h0-139" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033Ox&quot;,       +1,    0,    0},
</a><a href="#h0-140" id="h0-140" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1,    0},
</a><a href="#h0-141" id="h0-141" class="i">+	{ XK_KP_Up,         XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1,    0},
</a><a href="#h0-142" id="h0-142" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033Or&quot;,       +1,    0,    0},
</a><a href="#h0-143" id="h0-143" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1,    0},
</a><a href="#h0-144" id="h0-144" class="i">+	{ XK_KP_Down,       XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1,    0},
</a><a href="#h0-145" id="h0-145" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033Ot&quot;,       +1,    0,    0},
</a><a href="#h0-146" id="h0-146" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1,    0},
</a><a href="#h0-147" id="h0-147" class="i">+	{ XK_KP_Left,       XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1,    0},
</a><a href="#h0-148" id="h0-148" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033Ov&quot;,       +1,    0,    0},
</a><a href="#h0-149" id="h0-149" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1,    0},
</a><a href="#h0-150" id="h0-150" class="i">+	{ XK_KP_Right,      XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1,    0},
</a><a href="#h0-151" id="h0-151" class="i">+	{ XK_KP_Prior,      ShiftMask,      &quot;\033[5;2~&quot;,     0,    0,    0},
</a><a href="#h0-152" id="h0-152" class="i">+	{ XK_KP_Prior,      XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0,    0},
</a><a href="#h0-153" id="h0-153" class="i">+	{ XK_KP_Begin,      XK_ANY_MOD,     &quot;\033[E&quot;,        0,    0,    0},
</a><a href="#h0-154" id="h0-154" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[J&quot;,       -1,    0,    0},
</a><a href="#h0-155" id="h0-155" class="i">+	{ XK_KP_End,        ControlMask,    &quot;\033[1;5F&quot;,    +1,    0,    0},
</a><a href="#h0-156" id="h0-156" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[K&quot;,       -1,    0,    0},
</a><a href="#h0-157" id="h0-157" class="i">+	{ XK_KP_End,        ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0,    0},
</a><a href="#h0-158" id="h0-158" class="i">+	{ XK_KP_End,        XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0,    0},
</a><a href="#h0-159" id="h0-159" class="i">+	{ XK_KP_Next,       ShiftMask,      &quot;\033[6;2~&quot;,     0,    0,    0},
</a><a href="#h0-160" id="h0-160" class="i">+	{ XK_KP_Next,       XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0,    0},
</a><a href="#h0-161" id="h0-161" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0,    0},
</a><a href="#h0-162" id="h0-162" class="i">+	{ XK_KP_Insert,     ShiftMask,      &quot;\033[4l&quot;,      -1,    0,    0},
</a><a href="#h0-163" id="h0-163" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[L&quot;,       -1,    0,    0},
</a><a href="#h0-164" id="h0-164" class="i">+	{ XK_KP_Insert,     ControlMask,    &quot;\033[2;5~&quot;,    +1,    0,    0},
</a><a href="#h0-165" id="h0-165" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0,    0},
</a><a href="#h0-166" id="h0-166" class="i">+	{ XK_KP_Insert,     XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0,    0},
</a><a href="#h0-167" id="h0-167" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[M&quot;,       -1,    0,    0},
</a><a href="#h0-168" id="h0-168" class="i">+	{ XK_KP_Delete,     ControlMask,    &quot;\033[3;5~&quot;,    +1,    0,    0},
</a><a href="#h0-169" id="h0-169" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[2K&quot;,      -1,    0,    0},
</a><a href="#h0-170" id="h0-170" class="i">+	{ XK_KP_Delete,     ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0,    0},
</a><a href="#h0-171" id="h0-171" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0,    0},
</a><a href="#h0-172" id="h0-172" class="i">+	{ XK_KP_Delete,     XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0,    0},
</a><a href="#h0-173" id="h0-173" class="i">+	{ XK_KP_Multiply,   XK_ANY_MOD,     &quot;\033Oj&quot;,       +2,    0,    0},
</a><a href="#h0-174" id="h0-174" class="i">+	{ XK_KP_Add,        XK_ANY_MOD,     &quot;\033Ok&quot;,       +2,    0,    0},
</a><a href="#h0-175" id="h0-175" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\033OM&quot;,       +2,    0,    0},
</a><a href="#h0-176" id="h0-176" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\r&quot;,           -1,    0,   -1},
</a><a href="#h0-177" id="h0-177" class="i">+	{ XK_KP_Enter,      XK_ANY_MOD,     &quot;\r\n&quot;,         -1,    0,   +1},
</a><a href="#h0-178" id="h0-178" class="i">+	{ XK_KP_Subtract,   XK_ANY_MOD,     &quot;\033Om&quot;,       +2,    0,    0},
</a><a href="#h0-179" id="h0-179" class="i">+	{ XK_KP_Decimal,    XK_ANY_MOD,     &quot;\033On&quot;,       +2,    0,    0},
</a><a href="#h0-180" id="h0-180" class="i">+	{ XK_KP_Divide,     XK_ANY_MOD,     &quot;\033Oo&quot;,       +2,    0,    0},
</a><a href="#h0-181" id="h0-181" class="i">+	{ XK_KP_0,          XK_ANY_MOD,     &quot;\033Op&quot;,       +2,    0,    0},
</a><a href="#h0-182" id="h0-182" class="i">+	{ XK_KP_1,          XK_ANY_MOD,     &quot;\033Oq&quot;,       +2,    0,    0},
</a><a href="#h0-183" id="h0-183" class="i">+	{ XK_KP_2,          XK_ANY_MOD,     &quot;\033Or&quot;,       +2,    0,    0},
</a><a href="#h0-184" id="h0-184" class="i">+	{ XK_KP_3,          XK_ANY_MOD,     &quot;\033Os&quot;,       +2,    0,    0},
</a><a href="#h0-185" id="h0-185" class="i">+	{ XK_KP_4,          XK_ANY_MOD,     &quot;\033Ot&quot;,       +2,    0,    0},
</a><a href="#h0-186" id="h0-186" class="i">+	{ XK_KP_5,          XK_ANY_MOD,     &quot;\033Ou&quot;,       +2,    0,    0},
</a><a href="#h0-187" id="h0-187" class="i">+	{ XK_KP_6,          XK_ANY_MOD,     &quot;\033Ov&quot;,       +2,    0,    0},
</a><a href="#h0-188" id="h0-188" class="i">+	{ XK_KP_7,          XK_ANY_MOD,     &quot;\033Ow&quot;,       +2,    0,    0},
</a><a href="#h0-189" id="h0-189" class="i">+	{ XK_KP_8,          XK_ANY_MOD,     &quot;\033Ox&quot;,       +2,    0,    0},
</a><a href="#h0-190" id="h0-190" class="i">+	{ XK_KP_9,          XK_ANY_MOD,     &quot;\033Oy&quot;,       +2,    0,    0},
</a><a href="#h0-191" id="h0-191" class="i">+	{ XK_Up,            ShiftMask,      &quot;\033[1;2A&quot;,     0,    0,    0},
</a><a href="#h0-192" id="h0-192" class="i">+	{ XK_Up,            ControlMask,    &quot;\033[1;5A&quot;,     0,    0,    0},
</a><a href="#h0-193" id="h0-193" class="i">+	{ XK_Up,            Mod1Mask,       &quot;\033[1;3A&quot;,     0,    0,    0},
</a><a href="#h0-194" id="h0-194" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033[A&quot;,        0,   -1,    0},
</a><a href="#h0-195" id="h0-195" class="i">+	{ XK_Up,            XK_ANY_MOD,     &quot;\033OA&quot;,        0,   +1,    0},
</a><a href="#h0-196" id="h0-196" class="i">+	{ XK_Down,          ShiftMask,      &quot;\033[1;2B&quot;,     0,    0,    0},
</a><a href="#h0-197" id="h0-197" class="i">+	{ XK_Down,          ControlMask,    &quot;\033[1;5B&quot;,     0,    0,    0},
</a><a href="#h0-198" id="h0-198" class="i">+	{ XK_Down,          Mod1Mask,       &quot;\033[1;3B&quot;,     0,    0,    0},
</a><a href="#h0-199" id="h0-199" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033[B&quot;,        0,   -1,    0},
</a><a href="#h0-200" id="h0-200" class="i">+	{ XK_Down,          XK_ANY_MOD,     &quot;\033OB&quot;,        0,   +1,    0},
</a><a href="#h0-201" id="h0-201" class="i">+	{ XK_Left,          ShiftMask,      &quot;\033[1;2D&quot;,     0,    0,    0},
</a><a href="#h0-202" id="h0-202" class="i">+	{ XK_Left,          ControlMask,    &quot;\033[1;5D&quot;,     0,    0,    0},
</a><a href="#h0-203" id="h0-203" class="i">+	{ XK_Left,          Mod1Mask,       &quot;\033[1;3D&quot;,     0,    0,    0},
</a><a href="#h0-204" id="h0-204" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033[D&quot;,        0,   -1,    0},
</a><a href="#h0-205" id="h0-205" class="i">+	{ XK_Left,          XK_ANY_MOD,     &quot;\033OD&quot;,        0,   +1,    0},
</a><a href="#h0-206" id="h0-206" class="i">+	{ XK_Right,         ShiftMask,      &quot;\033[1;2C&quot;,     0,    0,    0},
</a><a href="#h0-207" id="h0-207" class="i">+	{ XK_Right,         ControlMask,    &quot;\033[1;5C&quot;,     0,    0,    0},
</a><a href="#h0-208" id="h0-208" class="i">+	{ XK_Right,         Mod1Mask,       &quot;\033[1;3C&quot;,     0,    0,    0},
</a><a href="#h0-209" id="h0-209" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033[C&quot;,        0,   -1,    0},
</a><a href="#h0-210" id="h0-210" class="i">+	{ XK_Right,         XK_ANY_MOD,     &quot;\033OC&quot;,        0,   +1,    0},
</a><a href="#h0-211" id="h0-211" class="i">+	{ XK_ISO_Left_Tab,  ShiftMask,      &quot;\033[Z&quot;,        0,    0,    0},
</a><a href="#h0-212" id="h0-212" class="i">+	{ XK_Return,        Mod1Mask,       &quot;\033\r&quot;,        0,    0,   -1},
</a><a href="#h0-213" id="h0-213" class="i">+	{ XK_Return,        Mod1Mask,       &quot;\033\r\n&quot;,      0,    0,   +1},
</a><a href="#h0-214" id="h0-214" class="i">+	{ XK_Return,        XK_ANY_MOD,     &quot;\r&quot;,            0,    0,   -1},
</a><a href="#h0-215" id="h0-215" class="i">+	{ XK_Return,        XK_ANY_MOD,     &quot;\r\n&quot;,          0,    0,   +1},
</a><a href="#h0-216" id="h0-216" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[4l&quot;,      -1,    0,    0},
</a><a href="#h0-217" id="h0-217" class="i">+	{ XK_Insert,        ShiftMask,      &quot;\033[2;2~&quot;,    +1,    0,    0},
</a><a href="#h0-218" id="h0-218" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[L&quot;,       -1,    0,    0},
</a><a href="#h0-219" id="h0-219" class="i">+	{ XK_Insert,        ControlMask,    &quot;\033[2;5~&quot;,    +1,    0,    0},
</a><a href="#h0-220" id="h0-220" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[4h&quot;,      -1,    0,    0},
</a><a href="#h0-221" id="h0-221" class="i">+	{ XK_Insert,        XK_ANY_MOD,     &quot;\033[2~&quot;,      +1,    0,    0},
</a><a href="#h0-222" id="h0-222" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[M&quot;,       -1,    0,    0},
</a><a href="#h0-223" id="h0-223" class="i">+	{ XK_Delete,        ControlMask,    &quot;\033[3;5~&quot;,    +1,    0,    0},
</a><a href="#h0-224" id="h0-224" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[2K&quot;,      -1,    0,    0},
</a><a href="#h0-225" id="h0-225" class="i">+	{ XK_Delete,        ShiftMask,      &quot;\033[3;2~&quot;,    +1,    0,    0},
</a><a href="#h0-226" id="h0-226" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[P&quot;,       -1,    0,    0},
</a><a href="#h0-227" id="h0-227" class="i">+	{ XK_Delete,        XK_ANY_MOD,     &quot;\033[3~&quot;,      +1,    0,    0},
</a><a href="#h0-228" id="h0-228" class="i">+	{ XK_BackSpace,     XK_NO_MOD,      &quot;\177&quot;,          0,    0,    0},
</a><a href="#h0-229" id="h0-229" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[2J&quot;,       0,   -1,    0},
</a><a href="#h0-230" id="h0-230" class="i">+	{ XK_Home,          ShiftMask,      &quot;\033[1;2H&quot;,     0,   +1,    0},
</a><a href="#h0-231" id="h0-231" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[H&quot;,        0,   -1,    0},
</a><a href="#h0-232" id="h0-232" class="i">+	{ XK_Home,          XK_ANY_MOD,     &quot;\033[1~&quot;,       0,   +1,    0},
</a><a href="#h0-233" id="h0-233" class="i">+	{ XK_End,           ControlMask,    &quot;\033[J&quot;,       -1,    0,    0},
</a><a href="#h0-234" id="h0-234" class="i">+	{ XK_End,           ControlMask,    &quot;\033[1;5F&quot;,    +1,    0,    0},
</a><a href="#h0-235" id="h0-235" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[K&quot;,       -1,    0,    0},
</a><a href="#h0-236" id="h0-236" class="i">+	{ XK_End,           ShiftMask,      &quot;\033[1;2F&quot;,    +1,    0,    0},
</a><a href="#h0-237" id="h0-237" class="i">+	{ XK_End,           XK_ANY_MOD,     &quot;\033[4~&quot;,       0,    0,    0},
</a><a href="#h0-238" id="h0-238" class="i">+	{ XK_Prior,         ControlMask,    &quot;\033[5;5~&quot;,     0,    0,    0},
</a><a href="#h0-239" id="h0-239" class="i">+	{ XK_Prior,         ShiftMask,      &quot;\033[5;2~&quot;,     0,    0,    0},
</a><a href="#h0-240" id="h0-240" class="i">+	{ XK_Prior,         XK_ANY_MOD,     &quot;\033[5~&quot;,       0,    0,    0},
</a><a href="#h0-241" id="h0-241" class="i">+	{ XK_Next,          ControlMask,    &quot;\033[6;5~&quot;,     0,    0,    0},
</a><a href="#h0-242" id="h0-242" class="i">+	{ XK_Next,          ShiftMask,      &quot;\033[6;2~&quot;,     0,    0,    0},
</a><a href="#h0-243" id="h0-243" class="i">+	{ XK_Next,          XK_ANY_MOD,     &quot;\033[6~&quot;,       0,    0,    0},
</a><a href="#h0-244" id="h0-244" class="i">+	{ XK_F1,            XK_NO_MOD,      &quot;\033OP&quot; ,       0,    0,    0},
</a><a href="#h0-245" id="h0-245" class="i">+	{ XK_F1, /* F13 */  ShiftMask,      &quot;\033[1;2P&quot;,     0,    0,    0},
</a><a href="#h0-246" id="h0-246" class="i">+	{ XK_F1, /* F25 */  ControlMask,    &quot;\033[1;5P&quot;,     0,    0,    0},
</a><a href="#h0-247" id="h0-247" class="i">+	{ XK_F1, /* F37 */  Mod4Mask,       &quot;\033[1;6P&quot;,     0,    0,    0},
</a><a href="#h0-248" id="h0-248" class="i">+	{ XK_F1, /* F49 */  Mod1Mask,       &quot;\033[1;3P&quot;,     0,    0,    0},
</a><a href="#h0-249" id="h0-249" class="i">+	{ XK_F1, /* F61 */  Mod3Mask,       &quot;\033[1;4P&quot;,     0,    0,    0},
</a><a href="#h0-250" id="h0-250" class="i">+	{ XK_F2,            XK_NO_MOD,      &quot;\033OQ&quot; ,       0,    0,    0},
</a><a href="#h0-251" id="h0-251" class="i">+	{ XK_F2, /* F14 */  ShiftMask,      &quot;\033[1;2Q&quot;,     0,    0,    0},
</a><a href="#h0-252" id="h0-252" class="i">+	{ XK_F2, /* F26 */  ControlMask,    &quot;\033[1;5Q&quot;,     0,    0,    0},
</a><a href="#h0-253" id="h0-253" class="i">+	{ XK_F2, /* F38 */  Mod4Mask,       &quot;\033[1;6Q&quot;,     0,    0,    0},
</a><a href="#h0-254" id="h0-254" class="i">+	{ XK_F2, /* F50 */  Mod1Mask,       &quot;\033[1;3Q&quot;,     0,    0,    0},
</a><a href="#h0-255" id="h0-255" class="i">+	{ XK_F2, /* F62 */  Mod3Mask,       &quot;\033[1;4Q&quot;,     0,    0,    0},
</a><a href="#h0-256" id="h0-256" class="i">+	{ XK_F3,            XK_NO_MOD,      &quot;\033OR&quot; ,       0,    0,    0},
</a><a href="#h0-257" id="h0-257" class="i">+	{ XK_F3, /* F15 */  ShiftMask,      &quot;\033[1;2R&quot;,     0,    0,    0},
</a><a href="#h0-258" id="h0-258" class="i">+	{ XK_F3, /* F27 */  ControlMask,    &quot;\033[1;5R&quot;,     0,    0,    0},
</a><a href="#h0-259" id="h0-259" class="i">+	{ XK_F3, /* F39 */  Mod4Mask,       &quot;\033[1;6R&quot;,     0,    0,    0},
</a><a href="#h0-260" id="h0-260" class="i">+	{ XK_F3, /* F51 */  Mod1Mask,       &quot;\033[1;3R&quot;,     0,    0,    0},
</a><a href="#h0-261" id="h0-261" class="i">+	{ XK_F3, /* F63 */  Mod3Mask,       &quot;\033[1;4R&quot;,     0,    0,    0},
</a><a href="#h0-262" id="h0-262" class="i">+	{ XK_F4,            XK_NO_MOD,      &quot;\033OS&quot; ,       0,    0,    0},
</a><a href="#h0-263" id="h0-263" class="i">+	{ XK_F4, /* F16 */  ShiftMask,      &quot;\033[1;2S&quot;,     0,    0,    0},
</a><a href="#h0-264" id="h0-264" class="i">+	{ XK_F4, /* F28 */  ControlMask,    &quot;\033[1;5S&quot;,     0,    0,    0},
</a><a href="#h0-265" id="h0-265" class="i">+	{ XK_F4, /* F40 */  Mod4Mask,       &quot;\033[1;6S&quot;,     0,    0,    0},
</a><a href="#h0-266" id="h0-266" class="i">+	{ XK_F4, /* F52 */  Mod1Mask,       &quot;\033[1;3S&quot;,     0,    0,    0},
</a><a href="#h0-267" id="h0-267" class="i">+	{ XK_F5,            XK_NO_MOD,      &quot;\033[15~&quot;,      0,    0,    0},
</a><a href="#h0-268" id="h0-268" class="i">+	{ XK_F5, /* F17 */  ShiftMask,      &quot;\033[15;2~&quot;,    0,    0,    0},
</a><a href="#h0-269" id="h0-269" class="i">+	{ XK_F5, /* F29 */  ControlMask,    &quot;\033[15;5~&quot;,    0,    0,    0},
</a><a href="#h0-270" id="h0-270" class="i">+	{ XK_F5, /* F41 */  Mod4Mask,       &quot;\033[15;6~&quot;,    0,    0,    0},
</a><a href="#h0-271" id="h0-271" class="i">+	{ XK_F5, /* F53 */  Mod1Mask,       &quot;\033[15;3~&quot;,    0,    0,    0},
</a><a href="#h0-272" id="h0-272" class="i">+	{ XK_F6,            XK_NO_MOD,      &quot;\033[17~&quot;,      0,    0,    0},
</a><a href="#h0-273" id="h0-273" class="i">+	{ XK_F6, /* F18 */  ShiftMask,      &quot;\033[17;2~&quot;,    0,    0,    0},
</a><a href="#h0-274" id="h0-274" class="i">+	{ XK_F6, /* F30 */  ControlMask,    &quot;\033[17;5~&quot;,    0,    0,    0},
</a><a href="#h0-275" id="h0-275" class="i">+	{ XK_F6, /* F42 */  Mod4Mask,       &quot;\033[17;6~&quot;,    0,    0,    0},
</a><a href="#h0-276" id="h0-276" class="i">+	{ XK_F6, /* F54 */  Mod1Mask,       &quot;\033[17;3~&quot;,    0,    0,    0},
</a><a href="#h0-277" id="h0-277" class="i">+	{ XK_F7,            XK_NO_MOD,      &quot;\033[18~&quot;,      0,    0,    0},
</a><a href="#h0-278" id="h0-278" class="i">+	{ XK_F7, /* F19 */  ShiftMask,      &quot;\033[18;2~&quot;,    0,    0,    0},
</a><a href="#h0-279" id="h0-279" class="i">+	{ XK_F7, /* F31 */  ControlMask,    &quot;\033[18;5~&quot;,    0,    0,    0},
</a><a href="#h0-280" id="h0-280" class="i">+	{ XK_F7, /* F43 */  Mod4Mask,       &quot;\033[18;6~&quot;,    0,    0,    0},
</a><a href="#h0-281" id="h0-281" class="i">+	{ XK_F7, /* F55 */  Mod1Mask,       &quot;\033[18;3~&quot;,    0,    0,    0},
</a><a href="#h0-282" id="h0-282" class="i">+	{ XK_F8,            XK_NO_MOD,      &quot;\033[19~&quot;,      0,    0,    0},
</a><a href="#h0-283" id="h0-283" class="i">+	{ XK_F8, /* F20 */  ShiftMask,      &quot;\033[19;2~&quot;,    0,    0,    0},
</a><a href="#h0-284" id="h0-284" class="i">+	{ XK_F8, /* F32 */  ControlMask,    &quot;\033[19;5~&quot;,    0,    0,    0},
</a><a href="#h0-285" id="h0-285" class="i">+	{ XK_F8, /* F44 */  Mod4Mask,       &quot;\033[19;6~&quot;,    0,    0,    0},
</a><a href="#h0-286" id="h0-286" class="i">+	{ XK_F8, /* F56 */  Mod1Mask,       &quot;\033[19;3~&quot;,    0,    0,    0},
</a><a href="#h0-287" id="h0-287" class="i">+	{ XK_F9,            XK_NO_MOD,      &quot;\033[20~&quot;,      0,    0,    0},
</a><a href="#h0-288" id="h0-288" class="i">+	{ XK_F9, /* F21 */  ShiftMask,      &quot;\033[20;2~&quot;,    0,    0,    0},
</a><a href="#h0-289" id="h0-289" class="i">+	{ XK_F9, /* F33 */  ControlMask,    &quot;\033[20;5~&quot;,    0,    0,    0},
</a><a href="#h0-290" id="h0-290" class="i">+	{ XK_F9, /* F45 */  Mod4Mask,       &quot;\033[20;6~&quot;,    0,    0,    0},
</a><a href="#h0-291" id="h0-291" class="i">+	{ XK_F9, /* F57 */  Mod1Mask,       &quot;\033[20;3~&quot;,    0,    0,    0},
</a><a href="#h0-292" id="h0-292" class="i">+	{ XK_F10,           XK_NO_MOD,      &quot;\033[21~&quot;,      0,    0,    0},
</a><a href="#h0-293" id="h0-293" class="i">+	{ XK_F10, /* F22 */ ShiftMask,      &quot;\033[21;2~&quot;,    0,    0,    0},
</a><a href="#h0-294" id="h0-294" class="i">+	{ XK_F10, /* F34 */ ControlMask,    &quot;\033[21;5~&quot;,    0,    0,    0},
</a><a href="#h0-295" id="h0-295" class="i">+	{ XK_F10, /* F46 */ Mod4Mask,       &quot;\033[21;6~&quot;,    0,    0,    0},
</a><a href="#h0-296" id="h0-296" class="i">+	{ XK_F10, /* F58 */ Mod1Mask,       &quot;\033[21;3~&quot;,    0,    0,    0},
</a><a href="#h0-297" id="h0-297" class="i">+	{ XK_F11,           XK_NO_MOD,      &quot;\033[23~&quot;,      0,    0,    0},
</a><a href="#h0-298" id="h0-298" class="i">+	{ XK_F11, /* F23 */ ShiftMask,      &quot;\033[23;2~&quot;,    0,    0,    0},
</a><a href="#h0-299" id="h0-299" class="i">+	{ XK_F11, /* F35 */ ControlMask,    &quot;\033[23;5~&quot;,    0,    0,    0},
</a><a href="#h0-300" id="h0-300" class="i">+	{ XK_F11, /* F47 */ Mod4Mask,       &quot;\033[23;6~&quot;,    0,    0,    0},
</a><a href="#h0-301" id="h0-301" class="i">+	{ XK_F11, /* F59 */ Mod1Mask,       &quot;\033[23;3~&quot;,    0,    0,    0},
</a><a href="#h0-302" id="h0-302" class="i">+	{ XK_F12,           XK_NO_MOD,      &quot;\033[24~&quot;,      0,    0,    0},
</a><a href="#h0-303" id="h0-303" class="i">+	{ XK_F12, /* F24 */ ShiftMask,      &quot;\033[24;2~&quot;,    0,    0,    0},
</a><a href="#h0-304" id="h0-304" class="i">+	{ XK_F12, /* F36 */ ControlMask,    &quot;\033[24;5~&quot;,    0,    0,    0},
</a><a href="#h0-305" id="h0-305" class="i">+	{ XK_F12, /* F48 */ Mod4Mask,       &quot;\033[24;6~&quot;,    0,    0,    0},
</a><a href="#h0-306" id="h0-306" class="i">+	{ XK_F12, /* F60 */ Mod1Mask,       &quot;\033[24;3~&quot;,    0,    0,    0},
</a><a href="#h0-307" id="h0-307" class="i">+	{ XK_F13,           XK_NO_MOD,      &quot;\033[1;2P&quot;,     0,    0,    0},
</a><a href="#h0-308" id="h0-308" class="i">+	{ XK_F14,           XK_NO_MOD,      &quot;\033[1;2Q&quot;,     0,    0,    0},
</a><a href="#h0-309" id="h0-309" class="i">+	{ XK_F15,           XK_NO_MOD,      &quot;\033[1;2R&quot;,     0,    0,    0},
</a><a href="#h0-310" id="h0-310" class="i">+	{ XK_F16,           XK_NO_MOD,      &quot;\033[1;2S&quot;,     0,    0,    0},
</a><a href="#h0-311" id="h0-311" class="i">+	{ XK_F17,           XK_NO_MOD,      &quot;\033[15;2~&quot;,    0,    0,    0},
</a><a href="#h0-312" id="h0-312" class="i">+	{ XK_F18,           XK_NO_MOD,      &quot;\033[17;2~&quot;,    0,    0,    0},
</a><a href="#h0-313" id="h0-313" class="i">+	{ XK_F19,           XK_NO_MOD,      &quot;\033[18;2~&quot;,    0,    0,    0},
</a><a href="#h0-314" id="h0-314" class="i">+	{ XK_F20,           XK_NO_MOD,      &quot;\033[19;2~&quot;,    0,    0,    0},
</a><a href="#h0-315" id="h0-315" class="i">+	{ XK_F21,           XK_NO_MOD,      &quot;\033[20;2~&quot;,    0,    0,    0},
</a><a href="#h0-316" id="h0-316" class="i">+	{ XK_F22,           XK_NO_MOD,      &quot;\033[21;2~&quot;,    0,    0,    0},
</a><a href="#h0-317" id="h0-317" class="i">+	{ XK_F23,           XK_NO_MOD,      &quot;\033[23;2~&quot;,    0,    0,    0},
</a><a href="#h0-318" id="h0-318" class="i">+	{ XK_F24,           XK_NO_MOD,      &quot;\033[24;2~&quot;,    0,    0,    0},
</a><a href="#h0-319" id="h0-319" class="i">+	{ XK_F25,           XK_NO_MOD,      &quot;\033[1;5P&quot;,     0,    0,    0},
</a><a href="#h0-320" id="h0-320" class="i">+	{ XK_F26,           XK_NO_MOD,      &quot;\033[1;5Q&quot;,     0,    0,    0},
</a><a href="#h0-321" id="h0-321" class="i">+	{ XK_F27,           XK_NO_MOD,      &quot;\033[1;5R&quot;,     0,    0,    0},
</a><a href="#h0-322" id="h0-322" class="i">+	{ XK_F28,           XK_NO_MOD,      &quot;\033[1;5S&quot;,     0,    0,    0},
</a><a href="#h0-323" id="h0-323" class="i">+	{ XK_F29,           XK_NO_MOD,      &quot;\033[15;5~&quot;,    0,    0,    0},
</a><a href="#h0-324" id="h0-324" class="i">+	{ XK_F30,           XK_NO_MOD,      &quot;\033[17;5~&quot;,    0,    0,    0},
</a><a href="#h0-325" id="h0-325" class="i">+	{ XK_F31,           XK_NO_MOD,      &quot;\033[18;5~&quot;,    0,    0,    0},
</a><a href="#h0-326" id="h0-326" class="i">+	{ XK_F32,           XK_NO_MOD,      &quot;\033[19;5~&quot;,    0,    0,    0},
</a><a href="#h0-327" id="h0-327" class="i">+	{ XK_F33,           XK_NO_MOD,      &quot;\033[20;5~&quot;,    0,    0,    0},
</a><a href="#h0-328" id="h0-328" class="i">+	{ XK_F34,           XK_NO_MOD,      &quot;\033[21;5~&quot;,    0,    0,    0},
</a><a href="#h0-329" id="h0-329" class="i">+	{ XK_F35,           XK_NO_MOD,      &quot;\033[23;5~&quot;,    0,    0,    0},
</a><a href="#h0-330" id="h0-330" class="i">+};
</a><a href="#h0-331" id="h0-331" class="i">+
</a><a href="#h0-332" id="h0-332" class="i">+/*
</a><a href="#h0-333" id="h0-333" class="i">+ * Selection types&apos; masks.
</a><a href="#h0-334" id="h0-334" class="i">+ * Use the same masks as usual.
</a><a href="#h0-335" id="h0-335" class="i">+ * Button1Mask is always unset, to make masks match between ButtonPress.
</a><a href="#h0-336" id="h0-336" class="i">+ * ButtonRelease and MotionNotify.
</a><a href="#h0-337" id="h0-337" class="i">+ * If no match is found, regular selection is used.
</a><a href="#h0-338" id="h0-338" class="i">+ */
</a><a href="#h0-339" id="h0-339" class="i">+static uint selmasks[] = {
</a><a href="#h0-340" id="h0-340" class="i">+	[SEL_RECTANGULAR] = Mod1Mask,
</a><a href="#h0-341" id="h0-341" class="i">+};
</a><b>diff --git a/<a href="../file/st/config.mk.html">st/config.mk</a> b/<a href="../file/st/config.mk.html">st/config.mk</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,28 @@
</a><a href="#h0-0" id="h0-0" class="i">+# st version
</a><a href="#h0-1" id="h0-1" class="i">+VERSION = 0.6
</a><a href="#h0-2" id="h0-2" class="i">+
</a><a href="#h0-3" id="h0-3" class="i">+# Customize below to fit your system
</a><a href="#h0-4" id="h0-4" class="i">+
</a><a href="#h0-5" id="h0-5" class="i">+# paths
</a><a href="#h0-6" id="h0-6" class="i">+PREFIX = /usr/local
</a><a href="#h0-7" id="h0-7" class="i">+MANPREFIX = ${PREFIX}/share/man
</a><a href="#h0-8" id="h0-8" class="i">+
</a><a href="#h0-9" id="h0-9" class="i">+X11INC = /usr/X11R6/include
</a><a href="#h0-10" id="h0-10" class="i">+X11LIB = /usr/X11R6/lib
</a><a href="#h0-11" id="h0-11" class="i">+
</a><a href="#h0-12" id="h0-12" class="i">+# includes and libs
</a><a href="#h0-13" id="h0-13" class="i">+INCS = -I. -I/usr/include -I${X11INC} \
</a><a href="#h0-14" id="h0-14" class="i">+       `pkg-config --cflags fontconfig` \
</a><a href="#h0-15" id="h0-15" class="i">+       `pkg-config --cflags freetype2`
</a><a href="#h0-16" id="h0-16" class="i">+LIBS = -L/usr/lib -lc -L${X11LIB} -lm -lrt -lX11 -lutil -lXext -lXft \
</a><a href="#h0-17" id="h0-17" class="i">+       `pkg-config --libs fontconfig`  \
</a><a href="#h0-18" id="h0-18" class="i">+       `pkg-config --libs freetype2`
</a><a href="#h0-19" id="h0-19" class="i">+
</a><a href="#h0-20" id="h0-20" class="i">+# flags
</a><a href="#h0-21" id="h0-21" class="i">+CPPFLAGS = -DVERSION=\&quot;${VERSION}\&quot; -D_XOPEN_SOURCE=600
</a><a href="#h0-22" id="h0-22" class="i">+CFLAGS += -g -std=c99 -pedantic -Wall -Wvariadic-macros -Os ${INCS} ${CPPFLAGS}
</a><a href="#h0-23" id="h0-23" class="i">+LDFLAGS += -g ${LIBS}
</a><a href="#h0-24" id="h0-24" class="i">+
</a><a href="#h0-25" id="h0-25" class="i">+# compiler and linker
</a><a href="#h0-26" id="h0-26" class="i">+# CC = cc
</a><a href="#h0-27" id="h0-27" class="i">+
</a><b>diff --git a/<a href="../file/st/st.html">st/st</a> b/<a href="../file/st/st.html">st/st</a></b>
Binary files differ
<b>diff --git a/<a href="../file/st/st-0.6-externalpipe.diff.html">st/st-0.6-externalpipe.diff</a> b/<a href="../file/st/st-0.6-externalpipe.diff.html">st/st-0.6-externalpipe.diff</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,75 @@
</a><a href="#h0-0" id="h0-0" class="i">+diff --git a/st.c b/st.c
</a><a href="#h0-1" id="h0-1" class="i">+index b89d094..124ed16 100644
</a><a href="#h0-2" id="h0-2" class="i">+--- a/st.c
</a><a href="#h0-3" id="h0-3" class="i">++++ b/st.c
</a><a href="#h0-4" id="h0-4" class="i">+@@ -326,6 +326,7 @@ static void clipcopy(const Arg *);
</a><a href="#h0-5" id="h0-5" class="i">+ static void clippaste(const Arg *);
</a><a href="#h0-6" id="h0-6" class="i">+ static void numlock(const Arg *);
</a><a href="#h0-7" id="h0-7" class="i">+ static void selpaste(const Arg *);
</a><a href="#h0-8" id="h0-8" class="i">++static void externalpipe(const Arg *);
</a><a href="#h0-9" id="h0-9" class="i">+ static void xzoom(const Arg *);
</a><a href="#h0-10" id="h0-10" class="i">+ static void xzoomabs(const Arg *);
</a><a href="#h0-11" id="h0-11" class="i">+ static void xzoomreset(const Arg *);
</a><a href="#h0-12" id="h0-12" class="i">+@@ -2684,6 +2685,62 @@ eschandle(uchar ascii) {
</a><a href="#h0-13" id="h0-13" class="i">+ }
</a><a href="#h0-14" id="h0-14" class="i">+ 
</a><a href="#h0-15" id="h0-15" class="i">+ void
</a><a href="#h0-16" id="h0-16" class="i">++externalpipe(const Arg *arg)
</a><a href="#h0-17" id="h0-17" class="i">++{
</a><a href="#h0-18" id="h0-18" class="i">++	int to[2]; /* 0 = read, 1 = write */
</a><a href="#h0-19" id="h0-19" class="i">++	pid_t child;
</a><a href="#h0-20" id="h0-20" class="i">++	int n;
</a><a href="#h0-21" id="h0-21" class="i">++	void (*oldsigpipe)(int);
</a><a href="#h0-22" id="h0-22" class="i">++	char buf[UTF_SIZ];
</a><a href="#h0-23" id="h0-23" class="i">++	Glyph *bp, *end;
</a><a href="#h0-24" id="h0-24" class="i">++
</a><a href="#h0-25" id="h0-25" class="i">++	if(pipe(to) == -1)
</a><a href="#h0-26" id="h0-26" class="i">++		return;
</a><a href="#h0-27" id="h0-27" class="i">++
</a><a href="#h0-28" id="h0-28" class="i">++	/* sigchld() handles this */
</a><a href="#h0-29" id="h0-29" class="i">++	switch(child = fork()){
</a><a href="#h0-30" id="h0-30" class="i">++		case -1:
</a><a href="#h0-31" id="h0-31" class="i">++			close(to[0]), close(to[1]);
</a><a href="#h0-32" id="h0-32" class="i">++			return;
</a><a href="#h0-33" id="h0-33" class="i">++		case 0:
</a><a href="#h0-34" id="h0-34" class="i">++			/* child */
</a><a href="#h0-35" id="h0-35" class="i">++			close(to[1]);
</a><a href="#h0-36" id="h0-36" class="i">++			dup2(to[0], STDIN_FILENO); /* 0&lt;&amp;to */
</a><a href="#h0-37" id="h0-37" class="i">++			close(to[0]);
</a><a href="#h0-38" id="h0-38" class="i">++			execvp(
</a><a href="#h0-39" id="h0-39" class="i">++					&quot;sh&quot;,
</a><a href="#h0-40" id="h0-40" class="i">++					(char *const []){
</a><a href="#h0-41" id="h0-41" class="i">++						&quot;/bin/sh&quot;,
</a><a href="#h0-42" id="h0-42" class="i">++						&quot;-c&quot;,
</a><a href="#h0-43" id="h0-43" class="i">++						(char *)arg-&gt;v,
</a><a href="#h0-44" id="h0-44" class="i">++						0
</a><a href="#h0-45" id="h0-45" class="i">++					});
</a><a href="#h0-46" id="h0-46" class="i">++			exit(127);
</a><a href="#h0-47" id="h0-47" class="i">++	}
</a><a href="#h0-48" id="h0-48" class="i">++
</a><a href="#h0-49" id="h0-49" class="i">++	/* parent */
</a><a href="#h0-50" id="h0-50" class="i">++	close(to[0]);
</a><a href="#h0-51" id="h0-51" class="i">++	/* ignore sigpipe for now, in case child exits early */
</a><a href="#h0-52" id="h0-52" class="i">++	oldsigpipe = signal(SIGPIPE, SIG_IGN);
</a><a href="#h0-53" id="h0-53" class="i">++
</a><a href="#h0-54" id="h0-54" class="i">++	for(n = 0; n &lt; term.row; n++){
</a><a href="#h0-55" id="h0-55" class="i">++		bp = &amp;term.line[n][0];
</a><a href="#h0-56" id="h0-56" class="i">++		end = &amp;bp[MIN(tlinelen(n), term.col) - 1];
</a><a href="#h0-57" id="h0-57" class="i">++		if(bp != end || bp-&gt;u != &apos; &apos;)
</a><a href="#h0-58" id="h0-58" class="i">++			for(; bp &lt;= end; ++bp)
</a><a href="#h0-59" id="h0-59" class="i">++				if(xwrite(to[1], buf, utf8encode(bp-&gt;u, buf)) &lt; 0)
</a><a href="#h0-60" id="h0-60" class="i">++					break;
</a><a href="#h0-61" id="h0-61" class="i">++		if(xwrite(to[1], &quot;\n&quot;, 1) &lt; 0)
</a><a href="#h0-62" id="h0-62" class="i">++			break;
</a><a href="#h0-63" id="h0-63" class="i">++	}
</a><a href="#h0-64" id="h0-64" class="i">++
</a><a href="#h0-65" id="h0-65" class="i">++	close(to[1]);
</a><a href="#h0-66" id="h0-66" class="i">++
</a><a href="#h0-67" id="h0-67" class="i">++	/* restore */
</a><a href="#h0-68" id="h0-68" class="i">++	signal(SIGPIPE, oldsigpipe);
</a><a href="#h0-69" id="h0-69" class="i">++}
</a><a href="#h0-70" id="h0-70" class="i">++
</a><a href="#h0-71" id="h0-71" class="i">++void
</a><a href="#h0-72" id="h0-72" class="i">+ tputc(Rune u) {
</a><a href="#h0-73" id="h0-73" class="i">+ 	char c[UTF_SIZ];
</a><a href="#h0-74" id="h0-74" class="i">+ 	bool control;
</a><b>diff --git a/<a href="../file/st/st.1.html">st/st.1</a> b/<a href="../file/st/st.1.html">st/st.1</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,151 @@
</a><a href="#h0-0" id="h0-0" class="i">+.TH ST 1 st\-VERSION
</a><a href="#h0-1" id="h0-1" class="i">+.SH NAME
</a><a href="#h0-2" id="h0-2" class="i">+st \- simple terminal
</a><a href="#h0-3" id="h0-3" class="i">+.SH SYNOPSIS
</a><a href="#h0-4" id="h0-4" class="i">+.B st
</a><a href="#h0-5" id="h0-5" class="i">+.RB [ \-a ]
</a><a href="#h0-6" id="h0-6" class="i">+.RB [ \-c
</a><a href="#h0-7" id="h0-7" class="i">+.IR class ]
</a><a href="#h0-8" id="h0-8" class="i">+.RB [ \-f
</a><a href="#h0-9" id="h0-9" class="i">+.IR font ]
</a><a href="#h0-10" id="h0-10" class="i">+.RB [ \-g
</a><a href="#h0-11" id="h0-11" class="i">+.IR geometry ]
</a><a href="#h0-12" id="h0-12" class="i">+.RB [ \-i ]
</a><a href="#h0-13" id="h0-13" class="i">+.RB [ \-o
</a><a href="#h0-14" id="h0-14" class="i">+.IR file ]
</a><a href="#h0-15" id="h0-15" class="i">+.RB [ \-t 
</a><a href="#h0-16" id="h0-16" class="i">+.IR title ]
</a><a href="#h0-17" id="h0-17" class="i">+.RB [ \-l
</a><a href="#h0-18" id="h0-18" class="i">+.IR line ]
</a><a href="#h0-19" id="h0-19" class="i">+.RB [ \-w 
</a><a href="#h0-20" id="h0-20" class="i">+.IR windowid ]
</a><a href="#h0-21" id="h0-21" class="i">+.RB [ \-v ]
</a><a href="#h0-22" id="h0-22" class="i">+.RB [ \-e
</a><a href="#h0-23" id="h0-23" class="i">+.IR command ...]
</a><a href="#h0-24" id="h0-24" class="i">+.RI [ commands ...]
</a><a href="#h0-25" id="h0-25" class="i">+.PP
</a><a href="#h0-26" id="h0-26" class="i">+.B st
</a><a href="#h0-27" id="h0-27" class="i">+.RB [ \-a ]
</a><a href="#h0-28" id="h0-28" class="i">+.RB [ \-c
</a><a href="#h0-29" id="h0-29" class="i">+.IR class ]
</a><a href="#h0-30" id="h0-30" class="i">+.RB [ \-f
</a><a href="#h0-31" id="h0-31" class="i">+.IR font ]
</a><a href="#h0-32" id="h0-32" class="i">+.RB [ \-g
</a><a href="#h0-33" id="h0-33" class="i">+.IR geometry ]
</a><a href="#h0-34" id="h0-34" class="i">+.RB [ \-i ]
</a><a href="#h0-35" id="h0-35" class="i">+.RB [ \-o
</a><a href="#h0-36" id="h0-36" class="i">+.IR file ]
</a><a href="#h0-37" id="h0-37" class="i">+.RB [ \-t
</a><a href="#h0-38" id="h0-38" class="i">+.IR title ]
</a><a href="#h0-39" id="h0-39" class="i">+.RB [ \-l
</a><a href="#h0-40" id="h0-40" class="i">+.IR line ]
</a><a href="#h0-41" id="h0-41" class="i">+.RB [ \-w
</a><a href="#h0-42" id="h0-42" class="i">+.IR windowid ]
</a><a href="#h0-43" id="h0-43" class="i">+.RB [ \-v ]
</a><a href="#h0-44" id="h0-44" class="i">+.RB [ \-l
</a><a href="#h0-45" id="h0-45" class="i">+.IR line ]
</a><a href="#h0-46" id="h0-46" class="i">+.RI [ stty_args ...]
</a><a href="#h0-47" id="h0-47" class="i">+.SH DESCRIPTION
</a><a href="#h0-48" id="h0-48" class="i">+.B st
</a><a href="#h0-49" id="h0-49" class="i">+is a simple terminal emulator.
</a><a href="#h0-50" id="h0-50" class="i">+.SH OPTIONS
</a><a href="#h0-51" id="h0-51" class="i">+.TP
</a><a href="#h0-52" id="h0-52" class="i">+.B \-a
</a><a href="#h0-53" id="h0-53" class="i">+disable alternate screens in terminal
</a><a href="#h0-54" id="h0-54" class="i">+.TP
</a><a href="#h0-55" id="h0-55" class="i">+.BI \-c &quot; class&quot;
</a><a href="#h0-56" id="h0-56" class="i">+defines the window class (default $TERM).
</a><a href="#h0-57" id="h0-57" class="i">+.TP
</a><a href="#h0-58" id="h0-58" class="i">+.BI \-f &quot; font&quot;
</a><a href="#h0-59" id="h0-59" class="i">+defines the
</a><a href="#h0-60" id="h0-60" class="i">+.I font
</a><a href="#h0-61" id="h0-61" class="i">+to use when st is run.
</a><a href="#h0-62" id="h0-62" class="i">+.TP
</a><a href="#h0-63" id="h0-63" class="i">+.BI \-g &quot; geometry&quot;
</a><a href="#h0-64" id="h0-64" class="i">+defines the X11 geometry string.
</a><a href="#h0-65" id="h0-65" class="i">+The form is [=][&lt;cols&gt;{xX}&lt;rows&gt;][{+-}&lt;xoffset&gt;{+-}&lt;yoffset&gt;]. See
</a><a href="#h0-66" id="h0-66" class="i">+.BR XParseGeometry (3)
</a><a href="#h0-67" id="h0-67" class="i">+for further details.
</a><a href="#h0-68" id="h0-68" class="i">+.TP
</a><a href="#h0-69" id="h0-69" class="i">+.B \-i
</a><a href="#h0-70" id="h0-70" class="i">+will fixate the position given with the -g option.
</a><a href="#h0-71" id="h0-71" class="i">+.TP
</a><a href="#h0-72" id="h0-72" class="i">+.BI \-o &quot; iofile&quot;
</a><a href="#h0-73" id="h0-73" class="i">+writes all the I/O to
</a><a href="#h0-74" id="h0-74" class="i">+.I iofile.
</a><a href="#h0-75" id="h0-75" class="i">+This feature is useful when recording st sessions. A value of &quot;-&quot; means
</a><a href="#h0-76" id="h0-76" class="i">+standard output.
</a><a href="#h0-77" id="h0-77" class="i">+.TP
</a><a href="#h0-78" id="h0-78" class="i">+.BI \-t &quot; title&quot;
</a><a href="#h0-79" id="h0-79" class="i">+defines the window title (default &apos;st&apos;).
</a><a href="#h0-80" id="h0-80" class="i">+.TP
</a><a href="#h0-81" id="h0-81" class="i">+.BI \-w &quot; windowid&quot;
</a><a href="#h0-82" id="h0-82" class="i">+embeds st within the window identified by 
</a><a href="#h0-83" id="h0-83" class="i">+.I windowid
</a><a href="#h0-84" id="h0-84" class="i">+.TP
</a><a href="#h0-85" id="h0-85" class="i">+.BI \-l &quot; line&quot;
</a><a href="#h0-86" id="h0-86" class="i">+use a tty line instead of a pseudo terminal.
</a><a href="#h0-87" id="h0-87" class="i">+When this flag is used
</a><a href="#h0-88" id="h0-88" class="i">+remaining arguments are used as flags for stty.
</a><a href="#h0-89" id="h0-89" class="i">+.TP
</a><a href="#h0-90" id="h0-90" class="i">+.B \-v
</a><a href="#h0-91" id="h0-91" class="i">+prints version information to stderr, then exits.
</a><a href="#h0-92" id="h0-92" class="i">+.TP
</a><a href="#h0-93" id="h0-93" class="i">+.BI \-e &quot; program &quot; [ &quot; arguments &quot; &quot;... ]&quot;
</a><a href="#h0-94" id="h0-94" class="i">+st executes
</a><a href="#h0-95" id="h0-95" class="i">+.I program
</a><a href="#h0-96" id="h0-96" class="i">+instead of the shell.  If this is used it
</a><a href="#h0-97" id="h0-97" class="i">+.B must be the last option
</a><a href="#h0-98" id="h0-98" class="i">+on the command line, as in xterm / rxvt.
</a><a href="#h0-99" id="h0-99" class="i">+This option is only intended for compability,
</a><a href="#h0-100" id="h0-100" class="i">+and all the remaining arguments are used as a command
</a><a href="#h0-101" id="h0-101" class="i">+even without it.
</a><a href="#h0-102" id="h0-102" class="i">+.SH SHORTCUTS
</a><a href="#h0-103" id="h0-103" class="i">+.TP
</a><a href="#h0-104" id="h0-104" class="i">+.B Ctrl-Print Screen
</a><a href="#h0-105" id="h0-105" class="i">+Toggle if st should print to the
</a><a href="#h0-106" id="h0-106" class="i">+.I iofile.
</a><a href="#h0-107" id="h0-107" class="i">+.TP
</a><a href="#h0-108" id="h0-108" class="i">+.B Shift-Print Screen
</a><a href="#h0-109" id="h0-109" class="i">+Print the full screen to the
</a><a href="#h0-110" id="h0-110" class="i">+.I iofile.
</a><a href="#h0-111" id="h0-111" class="i">+.TP
</a><a href="#h0-112" id="h0-112" class="i">+.B Print Screen
</a><a href="#h0-113" id="h0-113" class="i">+Print the selection to the
</a><a href="#h0-114" id="h0-114" class="i">+.I iofile.
</a><a href="#h0-115" id="h0-115" class="i">+.TP
</a><a href="#h0-116" id="h0-116" class="i">+.B Alt-Shift-Page Up
</a><a href="#h0-117" id="h0-117" class="i">+Increase font size.
</a><a href="#h0-118" id="h0-118" class="i">+.TP
</a><a href="#h0-119" id="h0-119" class="i">+.B Alt-Shift-Page Down
</a><a href="#h0-120" id="h0-120" class="i">+Decrease font size.
</a><a href="#h0-121" id="h0-121" class="i">+.TP
</a><a href="#h0-122" id="h0-122" class="i">+.B Alt-Shift-Home
</a><a href="#h0-123" id="h0-123" class="i">+Reset to default font size.
</a><a href="#h0-124" id="h0-124" class="i">+.TP
</a><a href="#h0-125" id="h0-125" class="i">+.B Shift-Insert
</a><a href="#h0-126" id="h0-126" class="i">+Paste from primary selection (middle mouse button).
</a><a href="#h0-127" id="h0-127" class="i">+.TP
</a><a href="#h0-128" id="h0-128" class="i">+.B Alt-Shift-Insert
</a><a href="#h0-129" id="h0-129" class="i">+Paste from clipboard selection.
</a><a href="#h0-130" id="h0-130" class="i">+.TP
</a><a href="#h0-131" id="h0-131" class="i">+.B Alt-Shift-c
</a><a href="#h0-132" id="h0-132" class="i">+Copy the selected text to the clipboard selection.
</a><a href="#h0-133" id="h0-133" class="i">+.TP
</a><a href="#h0-134" id="h0-134" class="i">+.B Alt-Shift-v
</a><a href="#h0-135" id="h0-135" class="i">+Paste from the clipboard selection.
</a><a href="#h0-136" id="h0-136" class="i">+.SH CUSTOMIZATION
</a><a href="#h0-137" id="h0-137" class="i">+.B st
</a><a href="#h0-138" id="h0-138" class="i">+can be customized by creating a custom config.h and (re)compiling the source
</a><a href="#h0-139" id="h0-139" class="i">+code. This keeps it fast, secure and simple.
</a><a href="#h0-140" id="h0-140" class="i">+.SH AUTHORS
</a><a href="#h0-141" id="h0-141" class="i">+See the LICENSE file for the authors.
</a><a href="#h0-142" id="h0-142" class="i">+.SH LICENSE
</a><a href="#h0-143" id="h0-143" class="i">+See the LICENSE file for the terms of redistribution.
</a><a href="#h0-144" id="h0-144" class="i">+.SH SEE ALSO
</a><a href="#h0-145" id="h0-145" class="i">+.BR tabbed (1),
</a><a href="#h0-146" id="h0-146" class="i">+.BR utmp (1),
</a><a href="#h0-147" id="h0-147" class="i">+.BR stty (1)
</a><a href="#h0-148" id="h0-148" class="i">+.SH BUGS
</a><a href="#h0-149" id="h0-149" class="i">+See the TODO file in the distribution.
</a><a href="#h0-150" id="h0-150" class="i">+
</a><b>diff --git a/<a href="../file/st/st.c.html">st/st.c</a> b/<a href="../file/st/st.c.html">st/st.c</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,4171 @@
</a><a href="#h0-0" id="h0-0" class="i">+/* See LICENSE for license details. */
</a><a href="#h0-1" id="h0-1" class="i">+#include &lt;ctype.h&gt;
</a><a href="#h0-2" id="h0-2" class="i">+#include &lt;errno.h&gt;
</a><a href="#h0-3" id="h0-3" class="i">+#include &lt;fcntl.h&gt;
</a><a href="#h0-4" id="h0-4" class="i">+#include &lt;limits.h&gt;
</a><a href="#h0-5" id="h0-5" class="i">+#include &lt;locale.h&gt;
</a><a href="#h0-6" id="h0-6" class="i">+#include &lt;pwd.h&gt;
</a><a href="#h0-7" id="h0-7" class="i">+#include &lt;stdarg.h&gt;
</a><a href="#h0-8" id="h0-8" class="i">+#include &lt;stdbool.h&gt;
</a><a href="#h0-9" id="h0-9" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h0-10" id="h0-10" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h0-11" id="h0-11" class="i">+#include &lt;string.h&gt;
</a><a href="#h0-12" id="h0-12" class="i">+#include &lt;signal.h&gt;
</a><a href="#h0-13" id="h0-13" class="i">+#include &lt;stdint.h&gt;
</a><a href="#h0-14" id="h0-14" class="i">+#include &lt;sys/ioctl.h&gt;
</a><a href="#h0-15" id="h0-15" class="i">+#include &lt;sys/select.h&gt;
</a><a href="#h0-16" id="h0-16" class="i">+#include &lt;sys/stat.h&gt;
</a><a href="#h0-17" id="h0-17" class="i">+#include &lt;sys/time.h&gt;
</a><a href="#h0-18" id="h0-18" class="i">+#include &lt;sys/types.h&gt;
</a><a href="#h0-19" id="h0-19" class="i">+#include &lt;sys/wait.h&gt;
</a><a href="#h0-20" id="h0-20" class="i">+#include &lt;time.h&gt;
</a><a href="#h0-21" id="h0-21" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h0-22" id="h0-22" class="i">+#include &lt;libgen.h&gt;
</a><a href="#h0-23" id="h0-23" class="i">+#include &lt;X11/Xatom.h&gt;
</a><a href="#h0-24" id="h0-24" class="i">+#include &lt;X11/Xlib.h&gt;
</a><a href="#h0-25" id="h0-25" class="i">+#include &lt;X11/Xutil.h&gt;
</a><a href="#h0-26" id="h0-26" class="i">+#include &lt;X11/cursorfont.h&gt;
</a><a href="#h0-27" id="h0-27" class="i">+#include &lt;X11/keysym.h&gt;
</a><a href="#h0-28" id="h0-28" class="i">+#include &lt;X11/Xft/Xft.h&gt;
</a><a href="#h0-29" id="h0-29" class="i">+#include &lt;X11/XKBlib.h&gt;
</a><a href="#h0-30" id="h0-30" class="i">+#include &lt;fontconfig/fontconfig.h&gt;
</a><a href="#h0-31" id="h0-31" class="i">+#include &lt;wchar.h&gt;
</a><a href="#h0-32" id="h0-32" class="i">+
</a><a href="#h0-33" id="h0-33" class="i">+#include &quot;arg.h&quot;
</a><a href="#h0-34" id="h0-34" class="i">+
</a><a href="#h0-35" id="h0-35" class="i">+char *argv0;
</a><a href="#h0-36" id="h0-36" class="i">+
</a><a href="#h0-37" id="h0-37" class="i">+#define Glyph Glyph_
</a><a href="#h0-38" id="h0-38" class="i">+#define Font Font_
</a><a href="#h0-39" id="h0-39" class="i">+
</a><a href="#h0-40" id="h0-40" class="i">+#if   defined(__linux)
</a><a href="#h0-41" id="h0-41" class="i">+ #include &lt;pty.h&gt;
</a><a href="#h0-42" id="h0-42" class="i">+#elif defined(__OpenBSD__) || defined(__NetBSD__) || defined(__APPLE__)
</a><a href="#h0-43" id="h0-43" class="i">+ #include &lt;util.h&gt;
</a><a href="#h0-44" id="h0-44" class="i">+#elif defined(__FreeBSD__) || defined(__DragonFly__)
</a><a href="#h0-45" id="h0-45" class="i">+ #include &lt;libutil.h&gt;
</a><a href="#h0-46" id="h0-46" class="i">+#endif
</a><a href="#h0-47" id="h0-47" class="i">+
</a><a href="#h0-48" id="h0-48" class="i">+
</a><a href="#h0-49" id="h0-49" class="i">+/* XEMBED messages */
</a><a href="#h0-50" id="h0-50" class="i">+#define XEMBED_FOCUS_IN  4
</a><a href="#h0-51" id="h0-51" class="i">+#define XEMBED_FOCUS_OUT 5
</a><a href="#h0-52" id="h0-52" class="i">+
</a><a href="#h0-53" id="h0-53" class="i">+/* Arbitrary sizes */
</a><a href="#h0-54" id="h0-54" class="i">+#define UTF_INVALID   0xFFFD
</a><a href="#h0-55" id="h0-55" class="i">+#define UTF_SIZ       4
</a><a href="#h0-56" id="h0-56" class="i">+#define ESC_BUF_SIZ   (128*UTF_SIZ)
</a><a href="#h0-57" id="h0-57" class="i">+#define ESC_ARG_SIZ   16
</a><a href="#h0-58" id="h0-58" class="i">+#define STR_BUF_SIZ   ESC_BUF_SIZ
</a><a href="#h0-59" id="h0-59" class="i">+#define STR_ARG_SIZ   ESC_ARG_SIZ
</a><a href="#h0-60" id="h0-60" class="i">+#define XK_ANY_MOD    UINT_MAX
</a><a href="#h0-61" id="h0-61" class="i">+#define XK_NO_MOD     0
</a><a href="#h0-62" id="h0-62" class="i">+#define XK_SWITCH_MOD (1&lt;&lt;13)
</a><a href="#h0-63" id="h0-63" class="i">+
</a><a href="#h0-64" id="h0-64" class="i">+/* macros */
</a><a href="#h0-65" id="h0-65" class="i">+#define MIN(a, b)  ((a) &lt; (b) ? (a) : (b))
</a><a href="#h0-66" id="h0-66" class="i">+#define MAX(a, b)  ((a) &lt; (b) ? (b) : (a))
</a><a href="#h0-67" id="h0-67" class="i">+#define LEN(a)     (sizeof(a) / sizeof(a)[0])
</a><a href="#h0-68" id="h0-68" class="i">+#define DEFAULT(a, b)     (a) = (a) ? (a) : (b)
</a><a href="#h0-69" id="h0-69" class="i">+#define BETWEEN(x, a, b)  ((a) &lt;= (x) &amp;&amp; (x) &lt;= (b))
</a><a href="#h0-70" id="h0-70" class="i">+#define ISCONTROLC0(c) (BETWEEN(c, 0, 0x1f) || (c) == &apos;\177&apos;)
</a><a href="#h0-71" id="h0-71" class="i">+#define ISCONTROLC1(c) (BETWEEN(c, 0x80, 0x9f))
</a><a href="#h0-72" id="h0-72" class="i">+#define ISCONTROL(c) (ISCONTROLC0(c) || ISCONTROLC1(c))
</a><a href="#h0-73" id="h0-73" class="i">+#define ISDELIM(u) (utf8strchr(worddelimiters, u) != NULL)
</a><a href="#h0-74" id="h0-74" class="i">+#define LIMIT(x, a, b)    (x) = (x) &lt; (a) ? (a) : (x) &gt; (b) ? (b) : (x)
</a><a href="#h0-75" id="h0-75" class="i">+#define ATTRCMP(a, b) ((a).mode != (b).mode || (a).fg != (b).fg || (a).bg != (b).bg)
</a><a href="#h0-76" id="h0-76" class="i">+#define IS_SET(flag) ((term.mode &amp; (flag)) != 0)
</a><a href="#h0-77" id="h0-77" class="i">+#define TIMEDIFF(t1, t2) ((t1.tv_sec-t2.tv_sec)*1000 + (t1.tv_nsec-t2.tv_nsec)/1E6)
</a><a href="#h0-78" id="h0-78" class="i">+#define MODBIT(x, set, bit) ((set) ? ((x) |= (bit)) : ((x) &amp;= ~(bit)))
</a><a href="#h0-79" id="h0-79" class="i">+
</a><a href="#h0-80" id="h0-80" class="i">+#define TRUECOLOR(r,g,b) (1 &lt;&lt; 24 | (r) &lt;&lt; 16 | (g) &lt;&lt; 8 | (b))
</a><a href="#h0-81" id="h0-81" class="i">+#define IS_TRUECOL(x)    (1 &lt;&lt; 24 &amp; (x))
</a><a href="#h0-82" id="h0-82" class="i">+#define TRUERED(x)       (((x) &amp; 0xff0000) &gt;&gt; 8)
</a><a href="#h0-83" id="h0-83" class="i">+#define TRUEGREEN(x)     (((x) &amp; 0xff00))
</a><a href="#h0-84" id="h0-84" class="i">+#define TRUEBLUE(x)      (((x) &amp; 0xff) &lt;&lt; 8)
</a><a href="#h0-85" id="h0-85" class="i">+
</a><a href="#h0-86" id="h0-86" class="i">+
</a><a href="#h0-87" id="h0-87" class="i">+enum glyph_attribute {
</a><a href="#h0-88" id="h0-88" class="i">+	ATTR_NULL       = 0,
</a><a href="#h0-89" id="h0-89" class="i">+	ATTR_BOLD       = 1 &lt;&lt; 0,
</a><a href="#h0-90" id="h0-90" class="i">+	ATTR_FAINT      = 1 &lt;&lt; 1,
</a><a href="#h0-91" id="h0-91" class="i">+	ATTR_ITALIC     = 1 &lt;&lt; 2,
</a><a href="#h0-92" id="h0-92" class="i">+	ATTR_UNDERLINE  = 1 &lt;&lt; 3,
</a><a href="#h0-93" id="h0-93" class="i">+	ATTR_BLINK      = 1 &lt;&lt; 4,
</a><a href="#h0-94" id="h0-94" class="i">+	ATTR_REVERSE    = 1 &lt;&lt; 5,
</a><a href="#h0-95" id="h0-95" class="i">+	ATTR_INVISIBLE  = 1 &lt;&lt; 6,
</a><a href="#h0-96" id="h0-96" class="i">+	ATTR_STRUCK     = 1 &lt;&lt; 7,
</a><a href="#h0-97" id="h0-97" class="i">+	ATTR_WRAP       = 1 &lt;&lt; 8,
</a><a href="#h0-98" id="h0-98" class="i">+	ATTR_WIDE       = 1 &lt;&lt; 9,
</a><a href="#h0-99" id="h0-99" class="i">+	ATTR_WDUMMY     = 1 &lt;&lt; 10,
</a><a href="#h0-100" id="h0-100" class="i">+	ATTR_BOLD_FAINT = ATTR_BOLD | ATTR_FAINT,
</a><a href="#h0-101" id="h0-101" class="i">+};
</a><a href="#h0-102" id="h0-102" class="i">+
</a><a href="#h0-103" id="h0-103" class="i">+enum cursor_movement {
</a><a href="#h0-104" id="h0-104" class="i">+	CURSOR_SAVE,
</a><a href="#h0-105" id="h0-105" class="i">+	CURSOR_LOAD
</a><a href="#h0-106" id="h0-106" class="i">+};
</a><a href="#h0-107" id="h0-107" class="i">+
</a><a href="#h0-108" id="h0-108" class="i">+enum cursor_state {
</a><a href="#h0-109" id="h0-109" class="i">+	CURSOR_DEFAULT  = 0,
</a><a href="#h0-110" id="h0-110" class="i">+	CURSOR_WRAPNEXT = 1,
</a><a href="#h0-111" id="h0-111" class="i">+	CURSOR_ORIGIN   = 2
</a><a href="#h0-112" id="h0-112" class="i">+};
</a><a href="#h0-113" id="h0-113" class="i">+
</a><a href="#h0-114" id="h0-114" class="i">+enum term_mode {
</a><a href="#h0-115" id="h0-115" class="i">+	MODE_WRAP        = 1 &lt;&lt; 0,
</a><a href="#h0-116" id="h0-116" class="i">+	MODE_INSERT      = 1 &lt;&lt; 1,
</a><a href="#h0-117" id="h0-117" class="i">+	MODE_APPKEYPAD   = 1 &lt;&lt; 2,
</a><a href="#h0-118" id="h0-118" class="i">+	MODE_ALTSCREEN   = 1 &lt;&lt; 3,
</a><a href="#h0-119" id="h0-119" class="i">+	MODE_CRLF        = 1 &lt;&lt; 4,
</a><a href="#h0-120" id="h0-120" class="i">+	MODE_MOUSEBTN    = 1 &lt;&lt; 5,
</a><a href="#h0-121" id="h0-121" class="i">+	MODE_MOUSEMOTION = 1 &lt;&lt; 6,
</a><a href="#h0-122" id="h0-122" class="i">+	MODE_REVERSE     = 1 &lt;&lt; 7,
</a><a href="#h0-123" id="h0-123" class="i">+	MODE_KBDLOCK     = 1 &lt;&lt; 8,
</a><a href="#h0-124" id="h0-124" class="i">+	MODE_HIDE        = 1 &lt;&lt; 9,
</a><a href="#h0-125" id="h0-125" class="i">+	MODE_ECHO        = 1 &lt;&lt; 10,
</a><a href="#h0-126" id="h0-126" class="i">+	MODE_APPCURSOR   = 1 &lt;&lt; 11,
</a><a href="#h0-127" id="h0-127" class="i">+	MODE_MOUSESGR    = 1 &lt;&lt; 12,
</a><a href="#h0-128" id="h0-128" class="i">+	MODE_8BIT        = 1 &lt;&lt; 13,
</a><a href="#h0-129" id="h0-129" class="i">+	MODE_BLINK       = 1 &lt;&lt; 14,
</a><a href="#h0-130" id="h0-130" class="i">+	MODE_FBLINK      = 1 &lt;&lt; 15,
</a><a href="#h0-131" id="h0-131" class="i">+	MODE_FOCUS       = 1 &lt;&lt; 16,
</a><a href="#h0-132" id="h0-132" class="i">+	MODE_MOUSEX10    = 1 &lt;&lt; 17,
</a><a href="#h0-133" id="h0-133" class="i">+	MODE_MOUSEMANY   = 1 &lt;&lt; 18,
</a><a href="#h0-134" id="h0-134" class="i">+	MODE_BRCKTPASTE  = 1 &lt;&lt; 19,
</a><a href="#h0-135" id="h0-135" class="i">+	MODE_PRINT       = 1 &lt;&lt; 20,
</a><a href="#h0-136" id="h0-136" class="i">+	MODE_MOUSE       = MODE_MOUSEBTN|MODE_MOUSEMOTION|MODE_MOUSEX10\
</a><a href="#h0-137" id="h0-137" class="i">+	                  |MODE_MOUSEMANY,
</a><a href="#h0-138" id="h0-138" class="i">+};
</a><a href="#h0-139" id="h0-139" class="i">+
</a><a href="#h0-140" id="h0-140" class="i">+enum charset {
</a><a href="#h0-141" id="h0-141" class="i">+	CS_GRAPHIC0,
</a><a href="#h0-142" id="h0-142" class="i">+	CS_GRAPHIC1,
</a><a href="#h0-143" id="h0-143" class="i">+	CS_UK,
</a><a href="#h0-144" id="h0-144" class="i">+	CS_USA,
</a><a href="#h0-145" id="h0-145" class="i">+	CS_MULTI,
</a><a href="#h0-146" id="h0-146" class="i">+	CS_GER,
</a><a href="#h0-147" id="h0-147" class="i">+	CS_FIN
</a><a href="#h0-148" id="h0-148" class="i">+};
</a><a href="#h0-149" id="h0-149" class="i">+
</a><a href="#h0-150" id="h0-150" class="i">+enum escape_state {
</a><a href="#h0-151" id="h0-151" class="i">+	ESC_START      = 1,
</a><a href="#h0-152" id="h0-152" class="i">+	ESC_CSI        = 2,
</a><a href="#h0-153" id="h0-153" class="i">+	ESC_STR        = 4,  /* DCS, OSC, PM, APC */
</a><a href="#h0-154" id="h0-154" class="i">+	ESC_ALTCHARSET = 8,
</a><a href="#h0-155" id="h0-155" class="i">+	ESC_STR_END    = 16, /* a final string was encountered */
</a><a href="#h0-156" id="h0-156" class="i">+	ESC_TEST       = 32, /* Enter in test mode */
</a><a href="#h0-157" id="h0-157" class="i">+};
</a><a href="#h0-158" id="h0-158" class="i">+
</a><a href="#h0-159" id="h0-159" class="i">+enum window_state {
</a><a href="#h0-160" id="h0-160" class="i">+	WIN_VISIBLE = 1,
</a><a href="#h0-161" id="h0-161" class="i">+	WIN_FOCUSED = 2
</a><a href="#h0-162" id="h0-162" class="i">+};
</a><a href="#h0-163" id="h0-163" class="i">+
</a><a href="#h0-164" id="h0-164" class="i">+enum selection_mode {
</a><a href="#h0-165" id="h0-165" class="i">+	SEL_IDLE = 0,
</a><a href="#h0-166" id="h0-166" class="i">+	SEL_EMPTY = 1,
</a><a href="#h0-167" id="h0-167" class="i">+	SEL_READY = 2
</a><a href="#h0-168" id="h0-168" class="i">+};
</a><a href="#h0-169" id="h0-169" class="i">+
</a><a href="#h0-170" id="h0-170" class="i">+enum selection_type {
</a><a href="#h0-171" id="h0-171" class="i">+	SEL_REGULAR = 1,
</a><a href="#h0-172" id="h0-172" class="i">+	SEL_RECTANGULAR = 2
</a><a href="#h0-173" id="h0-173" class="i">+};
</a><a href="#h0-174" id="h0-174" class="i">+
</a><a href="#h0-175" id="h0-175" class="i">+enum selection_snap {
</a><a href="#h0-176" id="h0-176" class="i">+	SNAP_WORD = 1,
</a><a href="#h0-177" id="h0-177" class="i">+	SNAP_LINE = 2
</a><a href="#h0-178" id="h0-178" class="i">+};
</a><a href="#h0-179" id="h0-179" class="i">+
</a><a href="#h0-180" id="h0-180" class="i">+typedef unsigned char uchar;
</a><a href="#h0-181" id="h0-181" class="i">+typedef unsigned int uint;
</a><a href="#h0-182" id="h0-182" class="i">+typedef unsigned long ulong;
</a><a href="#h0-183" id="h0-183" class="i">+typedef unsigned short ushort;
</a><a href="#h0-184" id="h0-184" class="i">+
</a><a href="#h0-185" id="h0-185" class="i">+typedef uint_least32_t Rune;
</a><a href="#h0-186" id="h0-186" class="i">+
</a><a href="#h0-187" id="h0-187" class="i">+typedef XftDraw *Draw;
</a><a href="#h0-188" id="h0-188" class="i">+typedef XftColor Color;
</a><a href="#h0-189" id="h0-189" class="i">+
</a><a href="#h0-190" id="h0-190" class="i">+typedef struct {
</a><a href="#h0-191" id="h0-191" class="i">+	Rune u;           /* character code */
</a><a href="#h0-192" id="h0-192" class="i">+	ushort mode;      /* attribute flags */
</a><a href="#h0-193" id="h0-193" class="i">+	uint32_t fg;      /* foreground  */
</a><a href="#h0-194" id="h0-194" class="i">+	uint32_t bg;      /* background  */
</a><a href="#h0-195" id="h0-195" class="i">+} Glyph;
</a><a href="#h0-196" id="h0-196" class="i">+
</a><a href="#h0-197" id="h0-197" class="i">+typedef Glyph *Line;
</a><a href="#h0-198" id="h0-198" class="i">+
</a><a href="#h0-199" id="h0-199" class="i">+typedef struct {
</a><a href="#h0-200" id="h0-200" class="i">+	Glyph attr; /* current char attributes */
</a><a href="#h0-201" id="h0-201" class="i">+	int x;
</a><a href="#h0-202" id="h0-202" class="i">+	int y;
</a><a href="#h0-203" id="h0-203" class="i">+	char state;
</a><a href="#h0-204" id="h0-204" class="i">+} TCursor;
</a><a href="#h0-205" id="h0-205" class="i">+
</a><a href="#h0-206" id="h0-206" class="i">+/* CSI Escape sequence structs */
</a><a href="#h0-207" id="h0-207" class="i">+/* ESC &apos;[&apos; [[ [&lt;priv&gt;] &lt;arg&gt; [;]] &lt;mode&gt; [&lt;mode&gt;]] */
</a><a href="#h0-208" id="h0-208" class="i">+typedef struct {
</a><a href="#h0-209" id="h0-209" class="i">+	char buf[ESC_BUF_SIZ]; /* raw string */
</a><a href="#h0-210" id="h0-210" class="i">+	int len;               /* raw string length */
</a><a href="#h0-211" id="h0-211" class="i">+	char priv;
</a><a href="#h0-212" id="h0-212" class="i">+	int arg[ESC_ARG_SIZ];
</a><a href="#h0-213" id="h0-213" class="i">+	int narg;              /* nb of args */
</a><a href="#h0-214" id="h0-214" class="i">+	char mode[2];
</a><a href="#h0-215" id="h0-215" class="i">+} CSIEscape;
</a><a href="#h0-216" id="h0-216" class="i">+
</a><a href="#h0-217" id="h0-217" class="i">+/* STR Escape sequence structs */
</a><a href="#h0-218" id="h0-218" class="i">+/* ESC type [[ [&lt;priv&gt;] &lt;arg&gt; [;]] &lt;mode&gt;] ESC &apos;\&apos; */
</a><a href="#h0-219" id="h0-219" class="i">+typedef struct {
</a><a href="#h0-220" id="h0-220" class="i">+	char type;             /* ESC type ... */
</a><a href="#h0-221" id="h0-221" class="i">+	char buf[STR_BUF_SIZ]; /* raw string */
</a><a href="#h0-222" id="h0-222" class="i">+	int len;               /* raw string length */
</a><a href="#h0-223" id="h0-223" class="i">+	char *args[STR_ARG_SIZ];
</a><a href="#h0-224" id="h0-224" class="i">+	int narg;              /* nb of args */
</a><a href="#h0-225" id="h0-225" class="i">+} STREscape;
</a><a href="#h0-226" id="h0-226" class="i">+
</a><a href="#h0-227" id="h0-227" class="i">+/* Internal representation of the screen */
</a><a href="#h0-228" id="h0-228" class="i">+typedef struct {
</a><a href="#h0-229" id="h0-229" class="i">+	int row;      /* nb row */
</a><a href="#h0-230" id="h0-230" class="i">+	int col;      /* nb col */
</a><a href="#h0-231" id="h0-231" class="i">+	Line *line;   /* screen */
</a><a href="#h0-232" id="h0-232" class="i">+	Line *alt;    /* alternate screen */
</a><a href="#h0-233" id="h0-233" class="i">+	bool *dirty;  /* dirtyness of lines */
</a><a href="#h0-234" id="h0-234" class="i">+	XftGlyphFontSpec *specbuf; /* font spec buffer used for rendering */
</a><a href="#h0-235" id="h0-235" class="i">+	TCursor c;    /* cursor */
</a><a href="#h0-236" id="h0-236" class="i">+	int top;      /* top    scroll limit */
</a><a href="#h0-237" id="h0-237" class="i">+	int bot;      /* bottom scroll limit */
</a><a href="#h0-238" id="h0-238" class="i">+	int mode;     /* terminal mode flags */
</a><a href="#h0-239" id="h0-239" class="i">+	int esc;      /* escape state flags */
</a><a href="#h0-240" id="h0-240" class="i">+	char trantbl[4]; /* charset table translation */
</a><a href="#h0-241" id="h0-241" class="i">+	int charset;  /* current charset */
</a><a href="#h0-242" id="h0-242" class="i">+	int icharset; /* selected charset for sequence */
</a><a href="#h0-243" id="h0-243" class="i">+	bool numlock; /* lock numbers in keyboard */
</a><a href="#h0-244" id="h0-244" class="i">+	bool *tabs;
</a><a href="#h0-245" id="h0-245" class="i">+} Term;
</a><a href="#h0-246" id="h0-246" class="i">+
</a><a href="#h0-247" id="h0-247" class="i">+/* Purely graphic info */
</a><a href="#h0-248" id="h0-248" class="i">+typedef struct {
</a><a href="#h0-249" id="h0-249" class="i">+	Display *dpy;
</a><a href="#h0-250" id="h0-250" class="i">+	Colormap cmap;
</a><a href="#h0-251" id="h0-251" class="i">+	Window win;
</a><a href="#h0-252" id="h0-252" class="i">+	Drawable buf;
</a><a href="#h0-253" id="h0-253" class="i">+	Atom xembed, wmdeletewin, netwmname, netwmpid;
</a><a href="#h0-254" id="h0-254" class="i">+	XIM xim;
</a><a href="#h0-255" id="h0-255" class="i">+	XIC xic;
</a><a href="#h0-256" id="h0-256" class="i">+	Draw draw;
</a><a href="#h0-257" id="h0-257" class="i">+	Visual *vis;
</a><a href="#h0-258" id="h0-258" class="i">+	XSetWindowAttributes attrs;
</a><a href="#h0-259" id="h0-259" class="i">+  /* Here, we use the term *pointer* to differentiate the cursor
</a><a href="#h0-260" id="h0-260" class="i">+   * one sees when hovering the mouse ove the terminal from, e.g.,
</a><a href="#h0-261" id="h0-261" class="i">+   * a green rectangle where text would be entered. */
</a><a href="#h0-262" id="h0-262" class="i">+  Cursor vpointer, bpointer; /* visible and hidden pointers */
</a><a href="#h0-263" id="h0-263" class="i">+  bool pointerisvisible;
</a><a href="#h0-264" id="h0-264" class="i">+	int scr;
</a><a href="#h0-265" id="h0-265" class="i">+	bool isfixed; /* is fixed geometry? */
</a><a href="#h0-266" id="h0-266" class="i">+	int l, t; /* left and top offset */
</a><a href="#h0-267" id="h0-267" class="i">+	int gm; /* geometry mask */
</a><a href="#h0-268" id="h0-268" class="i">+	int tw, th; /* tty width and height */
</a><a href="#h0-269" id="h0-269" class="i">+	int w, h; /* window width and height */
</a><a href="#h0-270" id="h0-270" class="i">+	int ch; /* char height */
</a><a href="#h0-271" id="h0-271" class="i">+	int cw; /* char width  */
</a><a href="#h0-272" id="h0-272" class="i">+	char state; /* focus, redraw, visible */
</a><a href="#h0-273" id="h0-273" class="i">+	int cursor; /* cursor style */
</a><a href="#h0-274" id="h0-274" class="i">+} XWindow;
</a><a href="#h0-275" id="h0-275" class="i">+
</a><a href="#h0-276" id="h0-276" class="i">+typedef struct {
</a><a href="#h0-277" id="h0-277" class="i">+	uint b;
</a><a href="#h0-278" id="h0-278" class="i">+	uint mask;
</a><a href="#h0-279" id="h0-279" class="i">+	char *s;
</a><a href="#h0-280" id="h0-280" class="i">+} Mousekey;
</a><a href="#h0-281" id="h0-281" class="i">+
</a><a href="#h0-282" id="h0-282" class="i">+typedef struct {
</a><a href="#h0-283" id="h0-283" class="i">+	KeySym k;
</a><a href="#h0-284" id="h0-284" class="i">+	uint mask;
</a><a href="#h0-285" id="h0-285" class="i">+	char *s;
</a><a href="#h0-286" id="h0-286" class="i">+	/* three valued logic variables: 0 indifferent, 1 on, -1 off */
</a><a href="#h0-287" id="h0-287" class="i">+	signed char appkey;    /* application keypad */
</a><a href="#h0-288" id="h0-288" class="i">+	signed char appcursor; /* application cursor */
</a><a href="#h0-289" id="h0-289" class="i">+	signed char crlf;      /* crlf mode          */
</a><a href="#h0-290" id="h0-290" class="i">+} Key;
</a><a href="#h0-291" id="h0-291" class="i">+
</a><a href="#h0-292" id="h0-292" class="i">+typedef struct {
</a><a href="#h0-293" id="h0-293" class="i">+	int mode;
</a><a href="#h0-294" id="h0-294" class="i">+	int type;
</a><a href="#h0-295" id="h0-295" class="i">+	int snap;
</a><a href="#h0-296" id="h0-296" class="i">+	/*
</a><a href="#h0-297" id="h0-297" class="i">+	 * Selection variables:
</a><a href="#h0-298" id="h0-298" class="i">+	 * nb – normalized coordinates of the beginning of the selection
</a><a href="#h0-299" id="h0-299" class="i">+	 * ne – normalized coordinates of the end of the selection
</a><a href="#h0-300" id="h0-300" class="i">+	 * ob – original coordinates of the beginning of the selection
</a><a href="#h0-301" id="h0-301" class="i">+	 * oe – original coordinates of the end of the selection
</a><a href="#h0-302" id="h0-302" class="i">+	 */
</a><a href="#h0-303" id="h0-303" class="i">+	struct {
</a><a href="#h0-304" id="h0-304" class="i">+		int x, y;
</a><a href="#h0-305" id="h0-305" class="i">+	} nb, ne, ob, oe;
</a><a href="#h0-306" id="h0-306" class="i">+
</a><a href="#h0-307" id="h0-307" class="i">+	char *primary, *clipboard;
</a><a href="#h0-308" id="h0-308" class="i">+	Atom xtarget;
</a><a href="#h0-309" id="h0-309" class="i">+	bool alt;
</a><a href="#h0-310" id="h0-310" class="i">+	struct timespec tclick1;
</a><a href="#h0-311" id="h0-311" class="i">+	struct timespec tclick2;
</a><a href="#h0-312" id="h0-312" class="i">+} Selection;
</a><a href="#h0-313" id="h0-313" class="i">+
</a><a href="#h0-314" id="h0-314" class="i">+typedef union {
</a><a href="#h0-315" id="h0-315" class="i">+	int i;
</a><a href="#h0-316" id="h0-316" class="i">+	uint ui;
</a><a href="#h0-317" id="h0-317" class="i">+	float f;
</a><a href="#h0-318" id="h0-318" class="i">+	const void *v;
</a><a href="#h0-319" id="h0-319" class="i">+} Arg;
</a><a href="#h0-320" id="h0-320" class="i">+
</a><a href="#h0-321" id="h0-321" class="i">+typedef struct {
</a><a href="#h0-322" id="h0-322" class="i">+	uint mod;
</a><a href="#h0-323" id="h0-323" class="i">+	KeySym keysym;
</a><a href="#h0-324" id="h0-324" class="i">+	void (*func)(const Arg *);
</a><a href="#h0-325" id="h0-325" class="i">+	const Arg arg;
</a><a href="#h0-326" id="h0-326" class="i">+} Shortcut;
</a><a href="#h0-327" id="h0-327" class="i">+
</a><a href="#h0-328" id="h0-328" class="i">+/* function definitions used in config.h */
</a><a href="#h0-329" id="h0-329" class="i">+static void clipcopy(const Arg *);
</a><a href="#h0-330" id="h0-330" class="i">+static void clippaste(const Arg *);
</a><a href="#h0-331" id="h0-331" class="i">+static void numlock(const Arg *);
</a><a href="#h0-332" id="h0-332" class="i">+static void selpaste(const Arg *);
</a><a href="#h0-333" id="h0-333" class="i">+static void externalpipe(const Arg *);
</a><a href="#h0-334" id="h0-334" class="i">+static void xzoom(const Arg *);
</a><a href="#h0-335" id="h0-335" class="i">+static void xzoomabs(const Arg *);
</a><a href="#h0-336" id="h0-336" class="i">+static void xzoomreset(const Arg *);
</a><a href="#h0-337" id="h0-337" class="i">+static void printsel(const Arg *);
</a><a href="#h0-338" id="h0-338" class="i">+static void printscreen(const Arg *) ;
</a><a href="#h0-339" id="h0-339" class="i">+static void toggleprinter(const Arg *);
</a><a href="#h0-340" id="h0-340" class="i">+
</a><a href="#h0-341" id="h0-341" class="i">+/* Config.h for applying patches and the configuration. */
</a><a href="#h0-342" id="h0-342" class="i">+#include &quot;config.h&quot;
</a><a href="#h0-343" id="h0-343" class="i">+
</a><a href="#h0-344" id="h0-344" class="i">+/* Font structure */
</a><a href="#h0-345" id="h0-345" class="i">+typedef struct {
</a><a href="#h0-346" id="h0-346" class="i">+	int height;
</a><a href="#h0-347" id="h0-347" class="i">+	int width;
</a><a href="#h0-348" id="h0-348" class="i">+	int ascent;
</a><a href="#h0-349" id="h0-349" class="i">+	int descent;
</a><a href="#h0-350" id="h0-350" class="i">+	short lbearing;
</a><a href="#h0-351" id="h0-351" class="i">+	short rbearing;
</a><a href="#h0-352" id="h0-352" class="i">+	XftFont *match;
</a><a href="#h0-353" id="h0-353" class="i">+	FcFontSet *set;
</a><a href="#h0-354" id="h0-354" class="i">+	FcPattern *pattern;
</a><a href="#h0-355" id="h0-355" class="i">+} Font;
</a><a href="#h0-356" id="h0-356" class="i">+
</a><a href="#h0-357" id="h0-357" class="i">+/* Drawing Context */
</a><a href="#h0-358" id="h0-358" class="i">+typedef struct {
</a><a href="#h0-359" id="h0-359" class="i">+	Color col[MAX(LEN(colorname), 256)];
</a><a href="#h0-360" id="h0-360" class="i">+	Font font, bfont, ifont, ibfont;
</a><a href="#h0-361" id="h0-361" class="i">+	GC gc;
</a><a href="#h0-362" id="h0-362" class="i">+} DC;
</a><a href="#h0-363" id="h0-363" class="i">+
</a><a href="#h0-364" id="h0-364" class="i">+static void die(const char *, ...);
</a><a href="#h0-365" id="h0-365" class="i">+static void draw(void);
</a><a href="#h0-366" id="h0-366" class="i">+static void redraw(void);
</a><a href="#h0-367" id="h0-367" class="i">+static void drawregion(int, int, int, int);
</a><a href="#h0-368" id="h0-368" class="i">+static void execsh(void);
</a><a href="#h0-369" id="h0-369" class="i">+static void stty(void);
</a><a href="#h0-370" id="h0-370" class="i">+static void sigchld(int);
</a><a href="#h0-371" id="h0-371" class="i">+static void run(void);
</a><a href="#h0-372" id="h0-372" class="i">+
</a><a href="#h0-373" id="h0-373" class="i">+static void csidump(void);
</a><a href="#h0-374" id="h0-374" class="i">+static void csihandle(void);
</a><a href="#h0-375" id="h0-375" class="i">+static void csiparse(void);
</a><a href="#h0-376" id="h0-376" class="i">+static void csireset(void);
</a><a href="#h0-377" id="h0-377" class="i">+static int eschandle(uchar);
</a><a href="#h0-378" id="h0-378" class="i">+static void strdump(void);
</a><a href="#h0-379" id="h0-379" class="i">+static void strhandle(void);
</a><a href="#h0-380" id="h0-380" class="i">+static void strparse(void);
</a><a href="#h0-381" id="h0-381" class="i">+static void strreset(void);
</a><a href="#h0-382" id="h0-382" class="i">+
</a><a href="#h0-383" id="h0-383" class="i">+static int tattrset(int);
</a><a href="#h0-384" id="h0-384" class="i">+static void tprinter(char *, size_t);
</a><a href="#h0-385" id="h0-385" class="i">+static void tdumpsel(void);
</a><a href="#h0-386" id="h0-386" class="i">+static void tdumpline(int);
</a><a href="#h0-387" id="h0-387" class="i">+static void tdump(void);
</a><a href="#h0-388" id="h0-388" class="i">+static void tclearregion(int, int, int, int);
</a><a href="#h0-389" id="h0-389" class="i">+static void tcursor(int);
</a><a href="#h0-390" id="h0-390" class="i">+static void tdeletechar(int);
</a><a href="#h0-391" id="h0-391" class="i">+static void tdeleteline(int);
</a><a href="#h0-392" id="h0-392" class="i">+static void tinsertblank(int);
</a><a href="#h0-393" id="h0-393" class="i">+static void tinsertblankline(int);
</a><a href="#h0-394" id="h0-394" class="i">+static int tlinelen(int);
</a><a href="#h0-395" id="h0-395" class="i">+static void tmoveto(int, int);
</a><a href="#h0-396" id="h0-396" class="i">+static void tmoveato(int, int);
</a><a href="#h0-397" id="h0-397" class="i">+static void tnew(int, int);
</a><a href="#h0-398" id="h0-398" class="i">+static void tnewline(int);
</a><a href="#h0-399" id="h0-399" class="i">+static void tputtab(int);
</a><a href="#h0-400" id="h0-400" class="i">+static void tputc(Rune);
</a><a href="#h0-401" id="h0-401" class="i">+static void treset(void);
</a><a href="#h0-402" id="h0-402" class="i">+static void tresize(int, int);
</a><a href="#h0-403" id="h0-403" class="i">+static void tscrollup(int, int);
</a><a href="#h0-404" id="h0-404" class="i">+static void tscrolldown(int, int);
</a><a href="#h0-405" id="h0-405" class="i">+static void tsetattr(int *, int);
</a><a href="#h0-406" id="h0-406" class="i">+static void tsetchar(Rune, Glyph *, int, int);
</a><a href="#h0-407" id="h0-407" class="i">+static void tsetscroll(int, int);
</a><a href="#h0-408" id="h0-408" class="i">+static void tswapscreen(void);
</a><a href="#h0-409" id="h0-409" class="i">+static void tsetdirt(int, int);
</a><a href="#h0-410" id="h0-410" class="i">+static void tsetdirtattr(int);
</a><a href="#h0-411" id="h0-411" class="i">+static void tsetmode(bool, bool, int *, int);
</a><a href="#h0-412" id="h0-412" class="i">+static void tfulldirt(void);
</a><a href="#h0-413" id="h0-413" class="i">+static void techo(Rune);
</a><a href="#h0-414" id="h0-414" class="i">+static void tcontrolcode(uchar );
</a><a href="#h0-415" id="h0-415" class="i">+static void tdectest(char );
</a><a href="#h0-416" id="h0-416" class="i">+static int32_t tdefcolor(int *, int *, int);
</a><a href="#h0-417" id="h0-417" class="i">+static void tdeftran(char);
</a><a href="#h0-418" id="h0-418" class="i">+static inline bool match(uint, uint);
</a><a href="#h0-419" id="h0-419" class="i">+static void ttynew(void);
</a><a href="#h0-420" id="h0-420" class="i">+static void ttyread(void);
</a><a href="#h0-421" id="h0-421" class="i">+static void ttyresize(void);
</a><a href="#h0-422" id="h0-422" class="i">+static void ttysend(char *, size_t);
</a><a href="#h0-423" id="h0-423" class="i">+static void ttywrite(const char *, size_t);
</a><a href="#h0-424" id="h0-424" class="i">+static void tstrsequence(uchar);
</a><a href="#h0-425" id="h0-425" class="i">+
</a><a href="#h0-426" id="h0-426" class="i">+static inline ushort sixd_to_16bit(int);
</a><a href="#h0-427" id="h0-427" class="i">+static int xmakeglyphfontspecs(XftGlyphFontSpec *, const Glyph *, int, int, int);
</a><a href="#h0-428" id="h0-428" class="i">+static void xdrawglyphfontspecs(const XftGlyphFontSpec *, Glyph, int, int, int);
</a><a href="#h0-429" id="h0-429" class="i">+static void xdrawglyph(Glyph, int, int);
</a><a href="#h0-430" id="h0-430" class="i">+static void xhints(void);
</a><a href="#h0-431" id="h0-431" class="i">+static void xclear(int, int, int, int);
</a><a href="#h0-432" id="h0-432" class="i">+static void xdrawcursor(void);
</a><a href="#h0-433" id="h0-433" class="i">+static void xinit(void);
</a><a href="#h0-434" id="h0-434" class="i">+static void xloadcols(void);
</a><a href="#h0-435" id="h0-435" class="i">+static int xsetcolorname(int, const char *);
</a><a href="#h0-436" id="h0-436" class="i">+static int xgeommasktogravity(int);
</a><a href="#h0-437" id="h0-437" class="i">+static int xloadfont(Font *, FcPattern *);
</a><a href="#h0-438" id="h0-438" class="i">+static void xloadfonts(char *, double);
</a><a href="#h0-439" id="h0-439" class="i">+static void xsettitle(char *);
</a><a href="#h0-440" id="h0-440" class="i">+static void xresettitle(void);
</a><a href="#h0-441" id="h0-441" class="i">+static void xsetpointermotion(int);
</a><a href="#h0-442" id="h0-442" class="i">+static void xseturgency(int);
</a><a href="#h0-443" id="h0-443" class="i">+static void xsetsel(char *, Time);
</a><a href="#h0-444" id="h0-444" class="i">+static void xtermclear(int, int, int, int);
</a><a href="#h0-445" id="h0-445" class="i">+static void xunloadfont(Font *);
</a><a href="#h0-446" id="h0-446" class="i">+static void xunloadfonts(void);
</a><a href="#h0-447" id="h0-447" class="i">+static void xresize(int, int);
</a><a href="#h0-448" id="h0-448" class="i">+
</a><a href="#h0-449" id="h0-449" class="i">+static void expose(XEvent *);
</a><a href="#h0-450" id="h0-450" class="i">+static void visibility(XEvent *);
</a><a href="#h0-451" id="h0-451" class="i">+static void unmap(XEvent *);
</a><a href="#h0-452" id="h0-452" class="i">+static char *kmap(KeySym, uint);
</a><a href="#h0-453" id="h0-453" class="i">+static void kpress(XEvent *);
</a><a href="#h0-454" id="h0-454" class="i">+static void cmessage(XEvent *);
</a><a href="#h0-455" id="h0-455" class="i">+static void cresize(int, int);
</a><a href="#h0-456" id="h0-456" class="i">+static void resize(XEvent *);
</a><a href="#h0-457" id="h0-457" class="i">+static void focus(XEvent *);
</a><a href="#h0-458" id="h0-458" class="i">+static void brelease(XEvent *);
</a><a href="#h0-459" id="h0-459" class="i">+static void bpress(XEvent *);
</a><a href="#h0-460" id="h0-460" class="i">+static void bmotion(XEvent *);
</a><a href="#h0-461" id="h0-461" class="i">+static void selnotify(XEvent *);
</a><a href="#h0-462" id="h0-462" class="i">+static void selclear(XEvent *);
</a><a href="#h0-463" id="h0-463" class="i">+static void selrequest(XEvent *);
</a><a href="#h0-464" id="h0-464" class="i">+
</a><a href="#h0-465" id="h0-465" class="i">+static void selinit(void);
</a><a href="#h0-466" id="h0-466" class="i">+static void selnormalize(void);
</a><a href="#h0-467" id="h0-467" class="i">+static inline bool selected(int, int);
</a><a href="#h0-468" id="h0-468" class="i">+static char *getsel(void);
</a><a href="#h0-469" id="h0-469" class="i">+static void selcopy(Time);
</a><a href="#h0-470" id="h0-470" class="i">+static void selscroll(int, int);
</a><a href="#h0-471" id="h0-471" class="i">+static void selsnap(int *, int *, int);
</a><a href="#h0-472" id="h0-472" class="i">+static int x2col(int);
</a><a href="#h0-473" id="h0-473" class="i">+static int y2row(int);
</a><a href="#h0-474" id="h0-474" class="i">+static void getbuttoninfo(XEvent *);
</a><a href="#h0-475" id="h0-475" class="i">+static void mousereport(XEvent *);
</a><a href="#h0-476" id="h0-476" class="i">+
</a><a href="#h0-477" id="h0-477" class="i">+static size_t utf8decode(char *, Rune *, size_t);
</a><a href="#h0-478" id="h0-478" class="i">+static Rune utf8decodebyte(char, size_t *);
</a><a href="#h0-479" id="h0-479" class="i">+static size_t utf8encode(Rune, char *);
</a><a href="#h0-480" id="h0-480" class="i">+static char utf8encodebyte(Rune, size_t);
</a><a href="#h0-481" id="h0-481" class="i">+static char *utf8strchr(char *s, Rune u);
</a><a href="#h0-482" id="h0-482" class="i">+static size_t utf8validate(Rune *, size_t);
</a><a href="#h0-483" id="h0-483" class="i">+
</a><a href="#h0-484" id="h0-484" class="i">+static ssize_t xwrite(int, const char *, size_t);
</a><a href="#h0-485" id="h0-485" class="i">+static void *xmalloc(size_t);
</a><a href="#h0-486" id="h0-486" class="i">+static void *xrealloc(void *, size_t);
</a><a href="#h0-487" id="h0-487" class="i">+static char *xstrdup(char *);
</a><a href="#h0-488" id="h0-488" class="i">+
</a><a href="#h0-489" id="h0-489" class="i">+static void usage(void);
</a><a href="#h0-490" id="h0-490" class="i">+
</a><a href="#h0-491" id="h0-491" class="i">+static void (*handler[LASTEvent])(XEvent *) = {
</a><a href="#h0-492" id="h0-492" class="i">+	[KeyPress] = kpress,
</a><a href="#h0-493" id="h0-493" class="i">+	[ClientMessage] = cmessage,
</a><a href="#h0-494" id="h0-494" class="i">+	[ConfigureNotify] = resize,
</a><a href="#h0-495" id="h0-495" class="i">+	[VisibilityNotify] = visibility,
</a><a href="#h0-496" id="h0-496" class="i">+	[UnmapNotify] = unmap,
</a><a href="#h0-497" id="h0-497" class="i">+	[Expose] = expose,
</a><a href="#h0-498" id="h0-498" class="i">+	[FocusIn] = focus,
</a><a href="#h0-499" id="h0-499" class="i">+	[FocusOut] = focus,
</a><a href="#h0-500" id="h0-500" class="i">+	[MotionNotify] = bmotion,
</a><a href="#h0-501" id="h0-501" class="i">+	[ButtonPress] = bpress,
</a><a href="#h0-502" id="h0-502" class="i">+	[ButtonRelease] = brelease,
</a><a href="#h0-503" id="h0-503" class="i">+/*
</a><a href="#h0-504" id="h0-504" class="i">+ * Uncomment if you want the selection to disappear when you select something
</a><a href="#h0-505" id="h0-505" class="i">+ * different in another window.
</a><a href="#h0-506" id="h0-506" class="i">+ */
</a><a href="#h0-507" id="h0-507" class="i">+/*	[SelectionClear] = selclear, */
</a><a href="#h0-508" id="h0-508" class="i">+	[SelectionNotify] = selnotify,
</a><a href="#h0-509" id="h0-509" class="i">+	[SelectionRequest] = selrequest,
</a><a href="#h0-510" id="h0-510" class="i">+};
</a><a href="#h0-511" id="h0-511" class="i">+
</a><a href="#h0-512" id="h0-512" class="i">+/* Globals */
</a><a href="#h0-513" id="h0-513" class="i">+static DC dc;
</a><a href="#h0-514" id="h0-514" class="i">+static XWindow xw;
</a><a href="#h0-515" id="h0-515" class="i">+static Term term;
</a><a href="#h0-516" id="h0-516" class="i">+static CSIEscape csiescseq;
</a><a href="#h0-517" id="h0-517" class="i">+static STREscape strescseq;
</a><a href="#h0-518" id="h0-518" class="i">+static int cmdfd;
</a><a href="#h0-519" id="h0-519" class="i">+static pid_t pid;
</a><a href="#h0-520" id="h0-520" class="i">+static Selection sel;
</a><a href="#h0-521" id="h0-521" class="i">+static int iofd = STDOUT_FILENO;
</a><a href="#h0-522" id="h0-522" class="i">+static char **opt_cmd = NULL;
</a><a href="#h0-523" id="h0-523" class="i">+static char *opt_io = NULL;
</a><a href="#h0-524" id="h0-524" class="i">+static char *opt_title = NULL;
</a><a href="#h0-525" id="h0-525" class="i">+static char *opt_embed = NULL;
</a><a href="#h0-526" id="h0-526" class="i">+static char *opt_class = NULL;
</a><a href="#h0-527" id="h0-527" class="i">+static char *opt_font = NULL;
</a><a href="#h0-528" id="h0-528" class="i">+static char *opt_line = NULL;
</a><a href="#h0-529" id="h0-529" class="i">+static int oldbutton = 3; /* button event on startup: 3 = release */
</a><a href="#h0-530" id="h0-530" class="i">+
</a><a href="#h0-531" id="h0-531" class="i">+static char *usedfont = NULL;
</a><a href="#h0-532" id="h0-532" class="i">+static double usedfontsize = 0;
</a><a href="#h0-533" id="h0-533" class="i">+static double defaultfontsize = 0;
</a><a href="#h0-534" id="h0-534" class="i">+
</a><a href="#h0-535" id="h0-535" class="i">+static uchar utfbyte[UTF_SIZ + 1] = {0x80,    0, 0xC0, 0xE0, 0xF0};
</a><a href="#h0-536" id="h0-536" class="i">+static uchar utfmask[UTF_SIZ + 1] = {0xC0, 0x80, 0xE0, 0xF0, 0xF8};
</a><a href="#h0-537" id="h0-537" class="i">+static Rune utfmin[UTF_SIZ + 1] = {       0,    0,  0x80,  0x800,  0x10000};
</a><a href="#h0-538" id="h0-538" class="i">+static Rune utfmax[UTF_SIZ + 1] = {0x10FFFF, 0x7F, 0x7FF, 0xFFFF, 0x10FFFF};
</a><a href="#h0-539" id="h0-539" class="i">+
</a><a href="#h0-540" id="h0-540" class="i">+/* Font Ring Cache */
</a><a href="#h0-541" id="h0-541" class="i">+enum {
</a><a href="#h0-542" id="h0-542" class="i">+	FRC_NORMAL,
</a><a href="#h0-543" id="h0-543" class="i">+	FRC_ITALIC,
</a><a href="#h0-544" id="h0-544" class="i">+	FRC_BOLD,
</a><a href="#h0-545" id="h0-545" class="i">+	FRC_ITALICBOLD
</a><a href="#h0-546" id="h0-546" class="i">+};
</a><a href="#h0-547" id="h0-547" class="i">+
</a><a href="#h0-548" id="h0-548" class="i">+typedef struct {
</a><a href="#h0-549" id="h0-549" class="i">+	XftFont *font;
</a><a href="#h0-550" id="h0-550" class="i">+	int flags;
</a><a href="#h0-551" id="h0-551" class="i">+	Rune unicodep;
</a><a href="#h0-552" id="h0-552" class="i">+} Fontcache;
</a><a href="#h0-553" id="h0-553" class="i">+
</a><a href="#h0-554" id="h0-554" class="i">+/* Fontcache is an array now. A new font will be appended to the array. */
</a><a href="#h0-555" id="h0-555" class="i">+static Fontcache frc[16];
</a><a href="#h0-556" id="h0-556" class="i">+static int frclen = 0;
</a><a href="#h0-557" id="h0-557" class="i">+
</a><a href="#h0-558" id="h0-558" class="i">+ssize_t
</a><a href="#h0-559" id="h0-559" class="i">+xwrite(int fd, const char *s, size_t len) {
</a><a href="#h0-560" id="h0-560" class="i">+	size_t aux = len;
</a><a href="#h0-561" id="h0-561" class="i">+
</a><a href="#h0-562" id="h0-562" class="i">+	while(len &gt; 0) {
</a><a href="#h0-563" id="h0-563" class="i">+		ssize_t r = write(fd, s, len);
</a><a href="#h0-564" id="h0-564" class="i">+		if(r &lt; 0)
</a><a href="#h0-565" id="h0-565" class="i">+			return r;
</a><a href="#h0-566" id="h0-566" class="i">+		len -= r;
</a><a href="#h0-567" id="h0-567" class="i">+		s += r;
</a><a href="#h0-568" id="h0-568" class="i">+	}
</a><a href="#h0-569" id="h0-569" class="i">+	return aux;
</a><a href="#h0-570" id="h0-570" class="i">+}
</a><a href="#h0-571" id="h0-571" class="i">+
</a><a href="#h0-572" id="h0-572" class="i">+void *
</a><a href="#h0-573" id="h0-573" class="i">+xmalloc(size_t len) {
</a><a href="#h0-574" id="h0-574" class="i">+	void *p = malloc(len);
</a><a href="#h0-575" id="h0-575" class="i">+
</a><a href="#h0-576" id="h0-576" class="i">+	if(!p)
</a><a href="#h0-577" id="h0-577" class="i">+		die(&quot;Out of memory\n&quot;);
</a><a href="#h0-578" id="h0-578" class="i">+
</a><a href="#h0-579" id="h0-579" class="i">+	return p;
</a><a href="#h0-580" id="h0-580" class="i">+}
</a><a href="#h0-581" id="h0-581" class="i">+
</a><a href="#h0-582" id="h0-582" class="i">+void *
</a><a href="#h0-583" id="h0-583" class="i">+xrealloc(void *p, size_t len) {
</a><a href="#h0-584" id="h0-584" class="i">+	if((p = realloc(p, len)) == NULL)
</a><a href="#h0-585" id="h0-585" class="i">+		die(&quot;Out of memory\n&quot;);
</a><a href="#h0-586" id="h0-586" class="i">+
</a><a href="#h0-587" id="h0-587" class="i">+	return p;
</a><a href="#h0-588" id="h0-588" class="i">+}
</a><a href="#h0-589" id="h0-589" class="i">+
</a><a href="#h0-590" id="h0-590" class="i">+char *
</a><a href="#h0-591" id="h0-591" class="i">+xstrdup(char *s) {
</a><a href="#h0-592" id="h0-592" class="i">+	if((s = strdup(s)) == NULL)
</a><a href="#h0-593" id="h0-593" class="i">+		die(&quot;Out of memory\n&quot;);
</a><a href="#h0-594" id="h0-594" class="i">+
</a><a href="#h0-595" id="h0-595" class="i">+	return s;
</a><a href="#h0-596" id="h0-596" class="i">+}
</a><a href="#h0-597" id="h0-597" class="i">+
</a><a href="#h0-598" id="h0-598" class="i">+size_t
</a><a href="#h0-599" id="h0-599" class="i">+utf8decode(char *c, Rune *u, size_t clen) {
</a><a href="#h0-600" id="h0-600" class="i">+	size_t i, j, len, type;
</a><a href="#h0-601" id="h0-601" class="i">+	Rune udecoded;
</a><a href="#h0-602" id="h0-602" class="i">+
</a><a href="#h0-603" id="h0-603" class="i">+	*u = UTF_INVALID;
</a><a href="#h0-604" id="h0-604" class="i">+	if(!clen)
</a><a href="#h0-605" id="h0-605" class="i">+		return 0;
</a><a href="#h0-606" id="h0-606" class="i">+	udecoded = utf8decodebyte(c[0], &amp;len);
</a><a href="#h0-607" id="h0-607" class="i">+	if(!BETWEEN(len, 1, UTF_SIZ))
</a><a href="#h0-608" id="h0-608" class="i">+		return 1;
</a><a href="#h0-609" id="h0-609" class="i">+	for(i = 1, j = 1; i &lt; clen &amp;&amp; j &lt; len; ++i, ++j) {
</a><a href="#h0-610" id="h0-610" class="i">+		udecoded = (udecoded &lt;&lt; 6) | utf8decodebyte(c[i], &amp;type);
</a><a href="#h0-611" id="h0-611" class="i">+		if(type != 0)
</a><a href="#h0-612" id="h0-612" class="i">+			return j;
</a><a href="#h0-613" id="h0-613" class="i">+	}
</a><a href="#h0-614" id="h0-614" class="i">+	if(j &lt; len)
</a><a href="#h0-615" id="h0-615" class="i">+		return 0;
</a><a href="#h0-616" id="h0-616" class="i">+	*u = udecoded;
</a><a href="#h0-617" id="h0-617" class="i">+	utf8validate(u, len);
</a><a href="#h0-618" id="h0-618" class="i">+	return len;
</a><a href="#h0-619" id="h0-619" class="i">+}
</a><a href="#h0-620" id="h0-620" class="i">+
</a><a href="#h0-621" id="h0-621" class="i">+Rune
</a><a href="#h0-622" id="h0-622" class="i">+utf8decodebyte(char c, size_t *i) {
</a><a href="#h0-623" id="h0-623" class="i">+	for(*i = 0; *i &lt; LEN(utfmask); ++(*i))
</a><a href="#h0-624" id="h0-624" class="i">+		if(((uchar)c &amp; utfmask[*i]) == utfbyte[*i])
</a><a href="#h0-625" id="h0-625" class="i">+			return (uchar)c &amp; ~utfmask[*i];
</a><a href="#h0-626" id="h0-626" class="i">+	return 0;
</a><a href="#h0-627" id="h0-627" class="i">+}
</a><a href="#h0-628" id="h0-628" class="i">+
</a><a href="#h0-629" id="h0-629" class="i">+size_t
</a><a href="#h0-630" id="h0-630" class="i">+utf8encode(Rune u, char *c) {
</a><a href="#h0-631" id="h0-631" class="i">+	size_t len, i;
</a><a href="#h0-632" id="h0-632" class="i">+
</a><a href="#h0-633" id="h0-633" class="i">+	len = utf8validate(&amp;u, 0);
</a><a href="#h0-634" id="h0-634" class="i">+	if(len &gt; UTF_SIZ)
</a><a href="#h0-635" id="h0-635" class="i">+		return 0;
</a><a href="#h0-636" id="h0-636" class="i">+	for(i = len - 1; i != 0; --i) {
</a><a href="#h0-637" id="h0-637" class="i">+		c[i] = utf8encodebyte(u, 0);
</a><a href="#h0-638" id="h0-638" class="i">+		u &gt;&gt;= 6;
</a><a href="#h0-639" id="h0-639" class="i">+	}
</a><a href="#h0-640" id="h0-640" class="i">+	c[0] = utf8encodebyte(u, len);
</a><a href="#h0-641" id="h0-641" class="i">+	return len;
</a><a href="#h0-642" id="h0-642" class="i">+}
</a><a href="#h0-643" id="h0-643" class="i">+
</a><a href="#h0-644" id="h0-644" class="i">+char
</a><a href="#h0-645" id="h0-645" class="i">+utf8encodebyte(Rune u, size_t i) {
</a><a href="#h0-646" id="h0-646" class="i">+	return utfbyte[i] | (u &amp; ~utfmask[i]);
</a><a href="#h0-647" id="h0-647" class="i">+}
</a><a href="#h0-648" id="h0-648" class="i">+
</a><a href="#h0-649" id="h0-649" class="i">+char *
</a><a href="#h0-650" id="h0-650" class="i">+utf8strchr(char *s, Rune u) {
</a><a href="#h0-651" id="h0-651" class="i">+	Rune r;
</a><a href="#h0-652" id="h0-652" class="i">+	size_t i, j, len;
</a><a href="#h0-653" id="h0-653" class="i">+
</a><a href="#h0-654" id="h0-654" class="i">+	len = strlen(s);
</a><a href="#h0-655" id="h0-655" class="i">+	for(i = 0, j = 0; i &lt; len; i += j) {
</a><a href="#h0-656" id="h0-656" class="i">+		if(!(j = utf8decode(&amp;s[i], &amp;r, len - i)))
</a><a href="#h0-657" id="h0-657" class="i">+			break;
</a><a href="#h0-658" id="h0-658" class="i">+		if(r == u)
</a><a href="#h0-659" id="h0-659" class="i">+			return &amp;(s[i]);
</a><a href="#h0-660" id="h0-660" class="i">+	}
</a><a href="#h0-661" id="h0-661" class="i">+	return NULL;
</a><a href="#h0-662" id="h0-662" class="i">+}
</a><a href="#h0-663" id="h0-663" class="i">+
</a><a href="#h0-664" id="h0-664" class="i">+size_t
</a><a href="#h0-665" id="h0-665" class="i">+utf8validate(Rune *u, size_t i) {
</a><a href="#h0-666" id="h0-666" class="i">+	if(!BETWEEN(*u, utfmin[i], utfmax[i]) || BETWEEN(*u, 0xD800, 0xDFFF))
</a><a href="#h0-667" id="h0-667" class="i">+		*u = UTF_INVALID;
</a><a href="#h0-668" id="h0-668" class="i">+	for(i = 1; *u &gt; utfmax[i]; ++i)
</a><a href="#h0-669" id="h0-669" class="i">+		;
</a><a href="#h0-670" id="h0-670" class="i">+	return i;
</a><a href="#h0-671" id="h0-671" class="i">+}
</a><a href="#h0-672" id="h0-672" class="i">+
</a><a href="#h0-673" id="h0-673" class="i">+void
</a><a href="#h0-674" id="h0-674" class="i">+selinit(void) {
</a><a href="#h0-675" id="h0-675" class="i">+	memset(&amp;sel.tclick1, 0, sizeof(sel.tclick1));
</a><a href="#h0-676" id="h0-676" class="i">+	memset(&amp;sel.tclick2, 0, sizeof(sel.tclick2));
</a><a href="#h0-677" id="h0-677" class="i">+	sel.mode = SEL_IDLE;
</a><a href="#h0-678" id="h0-678" class="i">+	sel.ob.x = -1;
</a><a href="#h0-679" id="h0-679" class="i">+	sel.primary = NULL;
</a><a href="#h0-680" id="h0-680" class="i">+	sel.clipboard = NULL;
</a><a href="#h0-681" id="h0-681" class="i">+	sel.xtarget = XInternAtom(xw.dpy, &quot;UTF8_STRING&quot;, 0);
</a><a href="#h0-682" id="h0-682" class="i">+	if(sel.xtarget == None)
</a><a href="#h0-683" id="h0-683" class="i">+		sel.xtarget = XA_STRING;
</a><a href="#h0-684" id="h0-684" class="i">+}
</a><a href="#h0-685" id="h0-685" class="i">+
</a><a href="#h0-686" id="h0-686" class="i">+int
</a><a href="#h0-687" id="h0-687" class="i">+x2col(int x) {
</a><a href="#h0-688" id="h0-688" class="i">+	x -= borderpx;
</a><a href="#h0-689" id="h0-689" class="i">+	x /= xw.cw;
</a><a href="#h0-690" id="h0-690" class="i">+
</a><a href="#h0-691" id="h0-691" class="i">+	return LIMIT(x, 0, term.col-1);
</a><a href="#h0-692" id="h0-692" class="i">+}
</a><a href="#h0-693" id="h0-693" class="i">+
</a><a href="#h0-694" id="h0-694" class="i">+int
</a><a href="#h0-695" id="h0-695" class="i">+y2row(int y) {
</a><a href="#h0-696" id="h0-696" class="i">+	y -= borderpx;
</a><a href="#h0-697" id="h0-697" class="i">+	y /= xw.ch;
</a><a href="#h0-698" id="h0-698" class="i">+
</a><a href="#h0-699" id="h0-699" class="i">+	return LIMIT(y, 0, term.row-1);
</a><a href="#h0-700" id="h0-700" class="i">+}
</a><a href="#h0-701" id="h0-701" class="i">+
</a><a href="#h0-702" id="h0-702" class="i">+int
</a><a href="#h0-703" id="h0-703" class="i">+tlinelen(int y) {
</a><a href="#h0-704" id="h0-704" class="i">+	int i = term.col;
</a><a href="#h0-705" id="h0-705" class="i">+
</a><a href="#h0-706" id="h0-706" class="i">+	if(term.line[y][i - 1].mode &amp; ATTR_WRAP)
</a><a href="#h0-707" id="h0-707" class="i">+		return i;
</a><a href="#h0-708" id="h0-708" class="i">+
</a><a href="#h0-709" id="h0-709" class="i">+	while(i &gt; 0 &amp;&amp; term.line[y][i - 1].u == &apos; &apos;)
</a><a href="#h0-710" id="h0-710" class="i">+		--i;
</a><a href="#h0-711" id="h0-711" class="i">+
</a><a href="#h0-712" id="h0-712" class="i">+	return i;
</a><a href="#h0-713" id="h0-713" class="i">+}
</a><a href="#h0-714" id="h0-714" class="i">+
</a><a href="#h0-715" id="h0-715" class="i">+void
</a><a href="#h0-716" id="h0-716" class="i">+selnormalize(void) {
</a><a href="#h0-717" id="h0-717" class="i">+	int i;
</a><a href="#h0-718" id="h0-718" class="i">+
</a><a href="#h0-719" id="h0-719" class="i">+	if(sel.type == SEL_REGULAR &amp;&amp; sel.ob.y != sel.oe.y) {
</a><a href="#h0-720" id="h0-720" class="i">+		sel.nb.x = sel.ob.y &lt; sel.oe.y ? sel.ob.x : sel.oe.x;
</a><a href="#h0-721" id="h0-721" class="i">+		sel.ne.x = sel.ob.y &lt; sel.oe.y ? sel.oe.x : sel.ob.x;
</a><a href="#h0-722" id="h0-722" class="i">+	} else {
</a><a href="#h0-723" id="h0-723" class="i">+		sel.nb.x = MIN(sel.ob.x, sel.oe.x);
</a><a href="#h0-724" id="h0-724" class="i">+		sel.ne.x = MAX(sel.ob.x, sel.oe.x);
</a><a href="#h0-725" id="h0-725" class="i">+	}
</a><a href="#h0-726" id="h0-726" class="i">+	sel.nb.y = MIN(sel.ob.y, sel.oe.y);
</a><a href="#h0-727" id="h0-727" class="i">+	sel.ne.y = MAX(sel.ob.y, sel.oe.y);
</a><a href="#h0-728" id="h0-728" class="i">+
</a><a href="#h0-729" id="h0-729" class="i">+	selsnap(&amp;sel.nb.x, &amp;sel.nb.y, -1);
</a><a href="#h0-730" id="h0-730" class="i">+	selsnap(&amp;sel.ne.x, &amp;sel.ne.y, +1);
</a><a href="#h0-731" id="h0-731" class="i">+
</a><a href="#h0-732" id="h0-732" class="i">+	/* expand selection over line breaks */
</a><a href="#h0-733" id="h0-733" class="i">+	if (sel.type == SEL_RECTANGULAR)
</a><a href="#h0-734" id="h0-734" class="i">+		return;
</a><a href="#h0-735" id="h0-735" class="i">+	i = tlinelen(sel.nb.y);
</a><a href="#h0-736" id="h0-736" class="i">+	if (i &lt; sel.nb.x)
</a><a href="#h0-737" id="h0-737" class="i">+		sel.nb.x = i;
</a><a href="#h0-738" id="h0-738" class="i">+	if (tlinelen(sel.ne.y) &lt;= sel.ne.x)
</a><a href="#h0-739" id="h0-739" class="i">+		sel.ne.x = term.col - 1;
</a><a href="#h0-740" id="h0-740" class="i">+}
</a><a href="#h0-741" id="h0-741" class="i">+
</a><a href="#h0-742" id="h0-742" class="i">+bool
</a><a href="#h0-743" id="h0-743" class="i">+selected(int x, int y) {
</a><a href="#h0-744" id="h0-744" class="i">+	if(sel.mode == SEL_EMPTY)
</a><a href="#h0-745" id="h0-745" class="i">+		return false;
</a><a href="#h0-746" id="h0-746" class="i">+
</a><a href="#h0-747" id="h0-747" class="i">+	if(sel.type == SEL_RECTANGULAR)
</a><a href="#h0-748" id="h0-748" class="i">+		return BETWEEN(y, sel.nb.y, sel.ne.y)
</a><a href="#h0-749" id="h0-749" class="i">+		    &amp;&amp; BETWEEN(x, sel.nb.x, sel.ne.x);
</a><a href="#h0-750" id="h0-750" class="i">+
</a><a href="#h0-751" id="h0-751" class="i">+	return BETWEEN(y, sel.nb.y, sel.ne.y)
</a><a href="#h0-752" id="h0-752" class="i">+	    &amp;&amp; (y != sel.nb.y || x &gt;= sel.nb.x)
</a><a href="#h0-753" id="h0-753" class="i">+	    &amp;&amp; (y != sel.ne.y || x &lt;= sel.ne.x);
</a><a href="#h0-754" id="h0-754" class="i">+}
</a><a href="#h0-755" id="h0-755" class="i">+
</a><a href="#h0-756" id="h0-756" class="i">+void
</a><a href="#h0-757" id="h0-757" class="i">+selsnap(int *x, int *y, int direction) {
</a><a href="#h0-758" id="h0-758" class="i">+	int newx, newy, xt, yt;
</a><a href="#h0-759" id="h0-759" class="i">+	bool delim, prevdelim;
</a><a href="#h0-760" id="h0-760" class="i">+	Glyph *gp, *prevgp;
</a><a href="#h0-761" id="h0-761" class="i">+
</a><a href="#h0-762" id="h0-762" class="i">+	switch(sel.snap) {
</a><a href="#h0-763" id="h0-763" class="i">+	case SNAP_WORD:
</a><a href="#h0-764" id="h0-764" class="i">+		/*
</a><a href="#h0-765" id="h0-765" class="i">+		 * Snap around if the word wraps around at the end or
</a><a href="#h0-766" id="h0-766" class="i">+		 * beginning of a line.
</a><a href="#h0-767" id="h0-767" class="i">+		 */
</a><a href="#h0-768" id="h0-768" class="i">+		prevgp = &amp;term.line[*y][*x];
</a><a href="#h0-769" id="h0-769" class="i">+		prevdelim = ISDELIM(prevgp-&gt;u);
</a><a href="#h0-770" id="h0-770" class="i">+		for(;;) {
</a><a href="#h0-771" id="h0-771" class="i">+			newx = *x + direction;
</a><a href="#h0-772" id="h0-772" class="i">+			newy = *y;
</a><a href="#h0-773" id="h0-773" class="i">+			if(!BETWEEN(newx, 0, term.col - 1)) {
</a><a href="#h0-774" id="h0-774" class="i">+				newy += direction;
</a><a href="#h0-775" id="h0-775" class="i">+				newx = (newx + term.col) % term.col;
</a><a href="#h0-776" id="h0-776" class="i">+				if (!BETWEEN(newy, 0, term.row - 1))
</a><a href="#h0-777" id="h0-777" class="i">+					break;
</a><a href="#h0-778" id="h0-778" class="i">+
</a><a href="#h0-779" id="h0-779" class="i">+				if(direction &gt; 0)
</a><a href="#h0-780" id="h0-780" class="i">+					yt = *y, xt = *x;
</a><a href="#h0-781" id="h0-781" class="i">+				else
</a><a href="#h0-782" id="h0-782" class="i">+					yt = newy, xt = newx;
</a><a href="#h0-783" id="h0-783" class="i">+				if(!(term.line[yt][xt].mode &amp; ATTR_WRAP))
</a><a href="#h0-784" id="h0-784" class="i">+					break;
</a><a href="#h0-785" id="h0-785" class="i">+			}
</a><a href="#h0-786" id="h0-786" class="i">+
</a><a href="#h0-787" id="h0-787" class="i">+			if (newx &gt;= tlinelen(newy))
</a><a href="#h0-788" id="h0-788" class="i">+				break;
</a><a href="#h0-789" id="h0-789" class="i">+
</a><a href="#h0-790" id="h0-790" class="i">+			gp = &amp;term.line[newy][newx];
</a><a href="#h0-791" id="h0-791" class="i">+			delim = ISDELIM(gp-&gt;u);
</a><a href="#h0-792" id="h0-792" class="i">+			if(!(gp-&gt;mode &amp; ATTR_WDUMMY) &amp;&amp; (delim != prevdelim
</a><a href="#h0-793" id="h0-793" class="i">+					|| (delim &amp;&amp; gp-&gt;u != prevgp-&gt;u)))
</a><a href="#h0-794" id="h0-794" class="i">+				break;
</a><a href="#h0-795" id="h0-795" class="i">+
</a><a href="#h0-796" id="h0-796" class="i">+			*x = newx;
</a><a href="#h0-797" id="h0-797" class="i">+			*y = newy;
</a><a href="#h0-798" id="h0-798" class="i">+			prevgp = gp;
</a><a href="#h0-799" id="h0-799" class="i">+			prevdelim = delim;
</a><a href="#h0-800" id="h0-800" class="i">+		}
</a><a href="#h0-801" id="h0-801" class="i">+		break;
</a><a href="#h0-802" id="h0-802" class="i">+	case SNAP_LINE:
</a><a href="#h0-803" id="h0-803" class="i">+		/*
</a><a href="#h0-804" id="h0-804" class="i">+		 * Snap around if the the previous line or the current one
</a><a href="#h0-805" id="h0-805" class="i">+		 * has set ATTR_WRAP at its end. Then the whole next or
</a><a href="#h0-806" id="h0-806" class="i">+		 * previous line will be selected.
</a><a href="#h0-807" id="h0-807" class="i">+		 */
</a><a href="#h0-808" id="h0-808" class="i">+		*x = (direction &lt; 0) ? 0 : term.col - 1;
</a><a href="#h0-809" id="h0-809" class="i">+		if(direction &lt; 0) {
</a><a href="#h0-810" id="h0-810" class="i">+			for(; *y &gt; 0; *y += direction) {
</a><a href="#h0-811" id="h0-811" class="i">+				if(!(term.line[*y-1][term.col-1].mode
</a><a href="#h0-812" id="h0-812" class="i">+						&amp; ATTR_WRAP)) {
</a><a href="#h0-813" id="h0-813" class="i">+					break;
</a><a href="#h0-814" id="h0-814" class="i">+				}
</a><a href="#h0-815" id="h0-815" class="i">+			}
</a><a href="#h0-816" id="h0-816" class="i">+		} else if(direction &gt; 0) {
</a><a href="#h0-817" id="h0-817" class="i">+			for(; *y &lt; term.row-1; *y += direction) {
</a><a href="#h0-818" id="h0-818" class="i">+				if(!(term.line[*y][term.col-1].mode
</a><a href="#h0-819" id="h0-819" class="i">+						&amp; ATTR_WRAP)) {
</a><a href="#h0-820" id="h0-820" class="i">+					break;
</a><a href="#h0-821" id="h0-821" class="i">+				}
</a><a href="#h0-822" id="h0-822" class="i">+			}
</a><a href="#h0-823" id="h0-823" class="i">+		}
</a><a href="#h0-824" id="h0-824" class="i">+		break;
</a><a href="#h0-825" id="h0-825" class="i">+	}
</a><a href="#h0-826" id="h0-826" class="i">+}
</a><a href="#h0-827" id="h0-827" class="i">+
</a><a href="#h0-828" id="h0-828" class="i">+void
</a><a href="#h0-829" id="h0-829" class="i">+getbuttoninfo(XEvent *e) {
</a><a href="#h0-830" id="h0-830" class="i">+	int type;
</a><a href="#h0-831" id="h0-831" class="i">+	uint state = e-&gt;xbutton.state &amp; ~(Button1Mask | forceselmod);
</a><a href="#h0-832" id="h0-832" class="i">+
</a><a href="#h0-833" id="h0-833" class="i">+	sel.alt = IS_SET(MODE_ALTSCREEN);
</a><a href="#h0-834" id="h0-834" class="i">+
</a><a href="#h0-835" id="h0-835" class="i">+	sel.oe.x = x2col(e-&gt;xbutton.x);
</a><a href="#h0-836" id="h0-836" class="i">+	sel.oe.y = y2row(e-&gt;xbutton.y);
</a><a href="#h0-837" id="h0-837" class="i">+	selnormalize();
</a><a href="#h0-838" id="h0-838" class="i">+
</a><a href="#h0-839" id="h0-839" class="i">+	sel.type = SEL_REGULAR;
</a><a href="#h0-840" id="h0-840" class="i">+	for(type = 1; type &lt; LEN(selmasks); ++type) {
</a><a href="#h0-841" id="h0-841" class="i">+		if(match(selmasks[type], state)) {
</a><a href="#h0-842" id="h0-842" class="i">+			sel.type = type;
</a><a href="#h0-843" id="h0-843" class="i">+			break;
</a><a href="#h0-844" id="h0-844" class="i">+		}
</a><a href="#h0-845" id="h0-845" class="i">+	}
</a><a href="#h0-846" id="h0-846" class="i">+}
</a><a href="#h0-847" id="h0-847" class="i">+
</a><a href="#h0-848" id="h0-848" class="i">+void
</a><a href="#h0-849" id="h0-849" class="i">+mousereport(XEvent *e) {
</a><a href="#h0-850" id="h0-850" class="i">+	int x = x2col(e-&gt;xbutton.x), y = y2row(e-&gt;xbutton.y),
</a><a href="#h0-851" id="h0-851" class="i">+	    button = e-&gt;xbutton.button, state = e-&gt;xbutton.state,
</a><a href="#h0-852" id="h0-852" class="i">+	    len;
</a><a href="#h0-853" id="h0-853" class="i">+	char buf[40];
</a><a href="#h0-854" id="h0-854" class="i">+	static int ox, oy;
</a><a href="#h0-855" id="h0-855" class="i">+
</a><a href="#h0-856" id="h0-856" class="i">+	/* from urxvt */
</a><a href="#h0-857" id="h0-857" class="i">+	if(e-&gt;xbutton.type == MotionNotify) {
</a><a href="#h0-858" id="h0-858" class="i">+		if(x == ox &amp;&amp; y == oy)
</a><a href="#h0-859" id="h0-859" class="i">+			return;
</a><a href="#h0-860" id="h0-860" class="i">+		if(!IS_SET(MODE_MOUSEMOTION) &amp;&amp; !IS_SET(MODE_MOUSEMANY))
</a><a href="#h0-861" id="h0-861" class="i">+			return;
</a><a href="#h0-862" id="h0-862" class="i">+		/* MOUSE_MOTION: no reporting if no button is pressed */
</a><a href="#h0-863" id="h0-863" class="i">+		if(IS_SET(MODE_MOUSEMOTION) &amp;&amp; oldbutton == 3)
</a><a href="#h0-864" id="h0-864" class="i">+			return;
</a><a href="#h0-865" id="h0-865" class="i">+
</a><a href="#h0-866" id="h0-866" class="i">+		button = oldbutton + 32;
</a><a href="#h0-867" id="h0-867" class="i">+		ox = x;
</a><a href="#h0-868" id="h0-868" class="i">+		oy = y;
</a><a href="#h0-869" id="h0-869" class="i">+	} else {
</a><a href="#h0-870" id="h0-870" class="i">+		if(!IS_SET(MODE_MOUSESGR) &amp;&amp; e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h0-871" id="h0-871" class="i">+			button = 3;
</a><a href="#h0-872" id="h0-872" class="i">+		} else {
</a><a href="#h0-873" id="h0-873" class="i">+			button -= Button1;
</a><a href="#h0-874" id="h0-874" class="i">+			if(button &gt;= 3)
</a><a href="#h0-875" id="h0-875" class="i">+				button += 64 - 3;
</a><a href="#h0-876" id="h0-876" class="i">+		}
</a><a href="#h0-877" id="h0-877" class="i">+		if(e-&gt;xbutton.type == ButtonPress) {
</a><a href="#h0-878" id="h0-878" class="i">+			oldbutton = button;
</a><a href="#h0-879" id="h0-879" class="i">+			ox = x;
</a><a href="#h0-880" id="h0-880" class="i">+			oy = y;
</a><a href="#h0-881" id="h0-881" class="i">+		} else if(e-&gt;xbutton.type == ButtonRelease) {
</a><a href="#h0-882" id="h0-882" class="i">+			oldbutton = 3;
</a><a href="#h0-883" id="h0-883" class="i">+			/* MODE_MOUSEX10: no button release reporting */
</a><a href="#h0-884" id="h0-884" class="i">+			if(IS_SET(MODE_MOUSEX10))
</a><a href="#h0-885" id="h0-885" class="i">+				return;
</a><a href="#h0-886" id="h0-886" class="i">+			if (button == 64 || button == 65)
</a><a href="#h0-887" id="h0-887" class="i">+				return;
</a><a href="#h0-888" id="h0-888" class="i">+		}
</a><a href="#h0-889" id="h0-889" class="i">+	}
</a><a href="#h0-890" id="h0-890" class="i">+
</a><a href="#h0-891" id="h0-891" class="i">+	if(!IS_SET(MODE_MOUSEX10)) {
</a><a href="#h0-892" id="h0-892" class="i">+		button += ((state &amp; ShiftMask  ) ? 4  : 0)
</a><a href="#h0-893" id="h0-893" class="i">+			+ ((state &amp; Mod4Mask   ) ? 8  : 0)
</a><a href="#h0-894" id="h0-894" class="i">+			+ ((state &amp; ControlMask) ? 16 : 0);
</a><a href="#h0-895" id="h0-895" class="i">+	}
</a><a href="#h0-896" id="h0-896" class="i">+
</a><a href="#h0-897" id="h0-897" class="i">+	if(IS_SET(MODE_MOUSESGR)) {
</a><a href="#h0-898" id="h0-898" class="i">+		len = snprintf(buf, sizeof(buf), &quot;\033[&lt;%d;%d;%d%c&quot;,
</a><a href="#h0-899" id="h0-899" class="i">+				button, x+1, y+1,
</a><a href="#h0-900" id="h0-900" class="i">+				e-&gt;xbutton.type == ButtonRelease ? &apos;m&apos; : &apos;M&apos;);
</a><a href="#h0-901" id="h0-901" class="i">+	} else if(x &lt; 223 &amp;&amp; y &lt; 223) {
</a><a href="#h0-902" id="h0-902" class="i">+		len = snprintf(buf, sizeof(buf), &quot;\033[M%c%c%c&quot;,
</a><a href="#h0-903" id="h0-903" class="i">+				32+button, 32+x+1, 32+y+1);
</a><a href="#h0-904" id="h0-904" class="i">+	} else {
</a><a href="#h0-905" id="h0-905" class="i">+		return;
</a><a href="#h0-906" id="h0-906" class="i">+	}
</a><a href="#h0-907" id="h0-907" class="i">+
</a><a href="#h0-908" id="h0-908" class="i">+	ttywrite(buf, len);
</a><a href="#h0-909" id="h0-909" class="i">+}
</a><a href="#h0-910" id="h0-910" class="i">+
</a><a href="#h0-911" id="h0-911" class="i">+void
</a><a href="#h0-912" id="h0-912" class="i">+bpress(XEvent *e) {
</a><a href="#h0-913" id="h0-913" class="i">+	struct timespec now;
</a><a href="#h0-914" id="h0-914" class="i">+	Mousekey *mk;
</a><a href="#h0-915" id="h0-915" class="i">+
</a><a href="#h0-916" id="h0-916" class="i">+	if(IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h0-917" id="h0-917" class="i">+		mousereport(e);
</a><a href="#h0-918" id="h0-918" class="i">+		return;
</a><a href="#h0-919" id="h0-919" class="i">+	}
</a><a href="#h0-920" id="h0-920" class="i">+
</a><a href="#h0-921" id="h0-921" class="i">+	for(mk = mshortcuts; mk &lt; mshortcuts + LEN(mshortcuts); mk++) {
</a><a href="#h0-922" id="h0-922" class="i">+		if(e-&gt;xbutton.button == mk-&gt;b
</a><a href="#h0-923" id="h0-923" class="i">+				&amp;&amp; match(mk-&gt;mask, e-&gt;xbutton.state)) {
</a><a href="#h0-924" id="h0-924" class="i">+			ttysend(mk-&gt;s, strlen(mk-&gt;s));
</a><a href="#h0-925" id="h0-925" class="i">+			return;
</a><a href="#h0-926" id="h0-926" class="i">+		}
</a><a href="#h0-927" id="h0-927" class="i">+	}
</a><a href="#h0-928" id="h0-928" class="i">+
</a><a href="#h0-929" id="h0-929" class="i">+	if(e-&gt;xbutton.button == Button1) {
</a><a href="#h0-930" id="h0-930" class="i">+		clock_gettime(CLOCK_MONOTONIC, &amp;now);
</a><a href="#h0-931" id="h0-931" class="i">+
</a><a href="#h0-932" id="h0-932" class="i">+		/* Clear previous selection, logically and visually. */
</a><a href="#h0-933" id="h0-933" class="i">+		selclear(NULL);
</a><a href="#h0-934" id="h0-934" class="i">+		sel.mode = SEL_EMPTY;
</a><a href="#h0-935" id="h0-935" class="i">+		sel.type = SEL_REGULAR;
</a><a href="#h0-936" id="h0-936" class="i">+		sel.oe.x = sel.ob.x = x2col(e-&gt;xbutton.x);
</a><a href="#h0-937" id="h0-937" class="i">+		sel.oe.y = sel.ob.y = y2row(e-&gt;xbutton.y);
</a><a href="#h0-938" id="h0-938" class="i">+
</a><a href="#h0-939" id="h0-939" class="i">+		/*
</a><a href="#h0-940" id="h0-940" class="i">+		 * If the user clicks below predefined timeouts specific
</a><a href="#h0-941" id="h0-941" class="i">+		 * snapping behaviour is exposed.
</a><a href="#h0-942" id="h0-942" class="i">+		 */
</a><a href="#h0-943" id="h0-943" class="i">+		if(TIMEDIFF(now, sel.tclick2) &lt;= tripleclicktimeout) {
</a><a href="#h0-944" id="h0-944" class="i">+			sel.snap = SNAP_LINE;
</a><a href="#h0-945" id="h0-945" class="i">+		} else if(TIMEDIFF(now, sel.tclick1) &lt;= doubleclicktimeout) {
</a><a href="#h0-946" id="h0-946" class="i">+			sel.snap = SNAP_WORD;
</a><a href="#h0-947" id="h0-947" class="i">+		} else {
</a><a href="#h0-948" id="h0-948" class="i">+			sel.snap = 0;
</a><a href="#h0-949" id="h0-949" class="i">+		}
</a><a href="#h0-950" id="h0-950" class="i">+		selnormalize();
</a><a href="#h0-951" id="h0-951" class="i">+
</a><a href="#h0-952" id="h0-952" class="i">+		if(sel.snap != 0)
</a><a href="#h0-953" id="h0-953" class="i">+			sel.mode = SEL_READY;
</a><a href="#h0-954" id="h0-954" class="i">+		tsetdirt(sel.nb.y, sel.ne.y);
</a><a href="#h0-955" id="h0-955" class="i">+		sel.tclick2 = sel.tclick1;
</a><a href="#h0-956" id="h0-956" class="i">+		sel.tclick1 = now;
</a><a href="#h0-957" id="h0-957" class="i">+	}
</a><a href="#h0-958" id="h0-958" class="i">+}
</a><a href="#h0-959" id="h0-959" class="i">+
</a><a href="#h0-960" id="h0-960" class="i">+char *
</a><a href="#h0-961" id="h0-961" class="i">+getsel(void) {
</a><a href="#h0-962" id="h0-962" class="i">+	char *str, *ptr;
</a><a href="#h0-963" id="h0-963" class="i">+	int y, bufsize, lastx, linelen;
</a><a href="#h0-964" id="h0-964" class="i">+	Glyph *gp, *last;
</a><a href="#h0-965" id="h0-965" class="i">+
</a><a href="#h0-966" id="h0-966" class="i">+	if(sel.ob.x == -1)
</a><a href="#h0-967" id="h0-967" class="i">+		return NULL;
</a><a href="#h0-968" id="h0-968" class="i">+
</a><a href="#h0-969" id="h0-969" class="i">+	bufsize = (term.col+1) * (sel.ne.y-sel.nb.y+1) * UTF_SIZ;
</a><a href="#h0-970" id="h0-970" class="i">+	ptr = str = xmalloc(bufsize);
</a><a href="#h0-971" id="h0-971" class="i">+
</a><a href="#h0-972" id="h0-972" class="i">+	/* append every set &amp; selected glyph to the selection */
</a><a href="#h0-973" id="h0-973" class="i">+	for(y = sel.nb.y; y &lt;= sel.ne.y; y++) {
</a><a href="#h0-974" id="h0-974" class="i">+		linelen = tlinelen(y);
</a><a href="#h0-975" id="h0-975" class="i">+
</a><a href="#h0-976" id="h0-976" class="i">+		if(sel.type == SEL_RECTANGULAR) {
</a><a href="#h0-977" id="h0-977" class="i">+			gp = &amp;term.line[y][sel.nb.x];
</a><a href="#h0-978" id="h0-978" class="i">+			lastx = sel.ne.x;
</a><a href="#h0-979" id="h0-979" class="i">+		} else {
</a><a href="#h0-980" id="h0-980" class="i">+			gp = &amp;term.line[y][sel.nb.y == y ? sel.nb.x : 0];
</a><a href="#h0-981" id="h0-981" class="i">+			lastx = (sel.ne.y == y) ? sel.ne.x : term.col-1;
</a><a href="#h0-982" id="h0-982" class="i">+		}
</a><a href="#h0-983" id="h0-983" class="i">+		last = &amp;term.line[y][MIN(lastx, linelen-1)];
</a><a href="#h0-984" id="h0-984" class="i">+		while(last &gt;= gp &amp;&amp; last-&gt;u == &apos; &apos;)
</a><a href="#h0-985" id="h0-985" class="i">+			--last;
</a><a href="#h0-986" id="h0-986" class="i">+
</a><a href="#h0-987" id="h0-987" class="i">+		for( ; gp &lt;= last; ++gp) {
</a><a href="#h0-988" id="h0-988" class="i">+			if(gp-&gt;mode &amp; ATTR_WDUMMY)
</a><a href="#h0-989" id="h0-989" class="i">+				continue;
</a><a href="#h0-990" id="h0-990" class="i">+
</a><a href="#h0-991" id="h0-991" class="i">+			ptr += utf8encode(gp-&gt;u, ptr);
</a><a href="#h0-992" id="h0-992" class="i">+		}
</a><a href="#h0-993" id="h0-993" class="i">+
</a><a href="#h0-994" id="h0-994" class="i">+		/*
</a><a href="#h0-995" id="h0-995" class="i">+		 * Copy and pasting of line endings is inconsistent
</a><a href="#h0-996" id="h0-996" class="i">+		 * in the inconsistent terminal and GUI world.
</a><a href="#h0-997" id="h0-997" class="i">+		 * The best solution seems like to produce &apos;\n&apos; when
</a><a href="#h0-998" id="h0-998" class="i">+		 * something is copied from st and convert &apos;\n&apos; to
</a><a href="#h0-999" id="h0-999" class="i">+		 * &apos;\r&apos;, when something to be pasted is received by
</a><a href="#h0-1000" id="h0-1000" class="i">+		 * st.
</a><a href="#h0-1001" id="h0-1001" class="i">+		 * FIXME: Fix the computer world.
</a><a href="#h0-1002" id="h0-1002" class="i">+		 */
</a><a href="#h0-1003" id="h0-1003" class="i">+		if((y &lt; sel.ne.y || lastx &gt;= linelen) &amp;&amp; !(last-&gt;mode &amp; ATTR_WRAP))
</a><a href="#h0-1004" id="h0-1004" class="i">+			*ptr++ = &apos;\n&apos;;
</a><a href="#h0-1005" id="h0-1005" class="i">+	}
</a><a href="#h0-1006" id="h0-1006" class="i">+	*ptr = 0;
</a><a href="#h0-1007" id="h0-1007" class="i">+	return str;
</a><a href="#h0-1008" id="h0-1008" class="i">+}
</a><a href="#h0-1009" id="h0-1009" class="i">+
</a><a href="#h0-1010" id="h0-1010" class="i">+void
</a><a href="#h0-1011" id="h0-1011" class="i">+selcopy(Time t) {
</a><a href="#h0-1012" id="h0-1012" class="i">+	xsetsel(getsel(), t);
</a><a href="#h0-1013" id="h0-1013" class="i">+}
</a><a href="#h0-1014" id="h0-1014" class="i">+
</a><a href="#h0-1015" id="h0-1015" class="i">+void
</a><a href="#h0-1016" id="h0-1016" class="i">+selnotify(XEvent *e) {
</a><a href="#h0-1017" id="h0-1017" class="i">+	ulong nitems, ofs, rem;
</a><a href="#h0-1018" id="h0-1018" class="i">+	int format;
</a><a href="#h0-1019" id="h0-1019" class="i">+	uchar *data, *last, *repl;
</a><a href="#h0-1020" id="h0-1020" class="i">+	Atom type;
</a><a href="#h0-1021" id="h0-1021" class="i">+	XSelectionEvent *xsev;
</a><a href="#h0-1022" id="h0-1022" class="i">+
</a><a href="#h0-1023" id="h0-1023" class="i">+	ofs = 0;
</a><a href="#h0-1024" id="h0-1024" class="i">+	xsev = &amp;e-&gt;xselection;
</a><a href="#h0-1025" id="h0-1025" class="i">+	if (xsev-&gt;property == None)
</a><a href="#h0-1026" id="h0-1026" class="i">+	    return;
</a><a href="#h0-1027" id="h0-1027" class="i">+	do {
</a><a href="#h0-1028" id="h0-1028" class="i">+		if(XGetWindowProperty(xw.dpy, xw.win, xsev-&gt;property, ofs,
</a><a href="#h0-1029" id="h0-1029" class="i">+					BUFSIZ/4, False, AnyPropertyType,
</a><a href="#h0-1030" id="h0-1030" class="i">+					&amp;type, &amp;format, &amp;nitems, &amp;rem,
</a><a href="#h0-1031" id="h0-1031" class="i">+					&amp;data)) {
</a><a href="#h0-1032" id="h0-1032" class="i">+			fprintf(stderr, &quot;Clipboard allocation failed\n&quot;);
</a><a href="#h0-1033" id="h0-1033" class="i">+			return;
</a><a href="#h0-1034" id="h0-1034" class="i">+		}
</a><a href="#h0-1035" id="h0-1035" class="i">+
</a><a href="#h0-1036" id="h0-1036" class="i">+		/*
</a><a href="#h0-1037" id="h0-1037" class="i">+		 * As seen in getsel:
</a><a href="#h0-1038" id="h0-1038" class="i">+		 * Line endings are inconsistent in the terminal and GUI world
</a><a href="#h0-1039" id="h0-1039" class="i">+		 * copy and pasting. When receiving some selection data,
</a><a href="#h0-1040" id="h0-1040" class="i">+		 * replace all &apos;\n&apos; with &apos;\r&apos;.
</a><a href="#h0-1041" id="h0-1041" class="i">+		 * FIXME: Fix the computer world.
</a><a href="#h0-1042" id="h0-1042" class="i">+		 */
</a><a href="#h0-1043" id="h0-1043" class="i">+		repl = data;
</a><a href="#h0-1044" id="h0-1044" class="i">+		last = data + nitems * format / 8;
</a><a href="#h0-1045" id="h0-1045" class="i">+		while((repl = memchr(repl, &apos;\n&apos;, last - repl))) {
</a><a href="#h0-1046" id="h0-1046" class="i">+			*repl++ = &apos;\r&apos;;
</a><a href="#h0-1047" id="h0-1047" class="i">+		}
</a><a href="#h0-1048" id="h0-1048" class="i">+
</a><a href="#h0-1049" id="h0-1049" class="i">+		if(IS_SET(MODE_BRCKTPASTE))
</a><a href="#h0-1050" id="h0-1050" class="i">+			ttywrite(&quot;\033[200~&quot;, 6);
</a><a href="#h0-1051" id="h0-1051" class="i">+		ttysend((char *)data, nitems * format / 8);
</a><a href="#h0-1052" id="h0-1052" class="i">+		if(IS_SET(MODE_BRCKTPASTE))
</a><a href="#h0-1053" id="h0-1053" class="i">+			ttywrite(&quot;\033[201~&quot;, 6);
</a><a href="#h0-1054" id="h0-1054" class="i">+		XFree(data);
</a><a href="#h0-1055" id="h0-1055" class="i">+		/* number of 32-bit chunks returned */
</a><a href="#h0-1056" id="h0-1056" class="i">+		ofs += nitems * format / 32;
</a><a href="#h0-1057" id="h0-1057" class="i">+	} while(rem &gt; 0);
</a><a href="#h0-1058" id="h0-1058" class="i">+}
</a><a href="#h0-1059" id="h0-1059" class="i">+
</a><a href="#h0-1060" id="h0-1060" class="i">+void
</a><a href="#h0-1061" id="h0-1061" class="i">+selpaste(const Arg *dummy) {
</a><a href="#h0-1062" id="h0-1062" class="i">+	XConvertSelection(xw.dpy, XA_PRIMARY, sel.xtarget, XA_PRIMARY,
</a><a href="#h0-1063" id="h0-1063" class="i">+			xw.win, CurrentTime);
</a><a href="#h0-1064" id="h0-1064" class="i">+}
</a><a href="#h0-1065" id="h0-1065" class="i">+
</a><a href="#h0-1066" id="h0-1066" class="i">+void
</a><a href="#h0-1067" id="h0-1067" class="i">+clipcopy(const Arg *dummy) {
</a><a href="#h0-1068" id="h0-1068" class="i">+	Atom clipboard;
</a><a href="#h0-1069" id="h0-1069" class="i">+
</a><a href="#h0-1070" id="h0-1070" class="i">+	if(sel.clipboard != NULL)
</a><a href="#h0-1071" id="h0-1071" class="i">+		free(sel.clipboard);
</a><a href="#h0-1072" id="h0-1072" class="i">+
</a><a href="#h0-1073" id="h0-1073" class="i">+	if(sel.primary != NULL) {
</a><a href="#h0-1074" id="h0-1074" class="i">+		sel.clipboard = xstrdup(sel.primary);
</a><a href="#h0-1075" id="h0-1075" class="i">+		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h0-1076" id="h0-1076" class="i">+		XSetSelectionOwner(xw.dpy, clipboard, xw.win, CurrentTime);
</a><a href="#h0-1077" id="h0-1077" class="i">+	}
</a><a href="#h0-1078" id="h0-1078" class="i">+}
</a><a href="#h0-1079" id="h0-1079" class="i">+
</a><a href="#h0-1080" id="h0-1080" class="i">+void
</a><a href="#h0-1081" id="h0-1081" class="i">+clippaste(const Arg *dummy) {
</a><a href="#h0-1082" id="h0-1082" class="i">+	Atom clipboard;
</a><a href="#h0-1083" id="h0-1083" class="i">+
</a><a href="#h0-1084" id="h0-1084" class="i">+	clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h0-1085" id="h0-1085" class="i">+	XConvertSelection(xw.dpy, clipboard, sel.xtarget, clipboard,
</a><a href="#h0-1086" id="h0-1086" class="i">+			xw.win, CurrentTime);
</a><a href="#h0-1087" id="h0-1087" class="i">+}
</a><a href="#h0-1088" id="h0-1088" class="i">+
</a><a href="#h0-1089" id="h0-1089" class="i">+void
</a><a href="#h0-1090" id="h0-1090" class="i">+selclear(XEvent *e) {
</a><a href="#h0-1091" id="h0-1091" class="i">+	if(sel.ob.x == -1)
</a><a href="#h0-1092" id="h0-1092" class="i">+		return;
</a><a href="#h0-1093" id="h0-1093" class="i">+	sel.mode = SEL_IDLE;
</a><a href="#h0-1094" id="h0-1094" class="i">+	sel.ob.x = -1;
</a><a href="#h0-1095" id="h0-1095" class="i">+	tsetdirt(sel.nb.y, sel.ne.y);
</a><a href="#h0-1096" id="h0-1096" class="i">+}
</a><a href="#h0-1097" id="h0-1097" class="i">+
</a><a href="#h0-1098" id="h0-1098" class="i">+void
</a><a href="#h0-1099" id="h0-1099" class="i">+selrequest(XEvent *e) {
</a><a href="#h0-1100" id="h0-1100" class="i">+	XSelectionRequestEvent *xsre;
</a><a href="#h0-1101" id="h0-1101" class="i">+	XSelectionEvent xev;
</a><a href="#h0-1102" id="h0-1102" class="i">+	Atom xa_targets, string, clipboard;
</a><a href="#h0-1103" id="h0-1103" class="i">+	char *seltext;
</a><a href="#h0-1104" id="h0-1104" class="i">+
</a><a href="#h0-1105" id="h0-1105" class="i">+	xsre = (XSelectionRequestEvent *) e;
</a><a href="#h0-1106" id="h0-1106" class="i">+	xev.type = SelectionNotify;
</a><a href="#h0-1107" id="h0-1107" class="i">+	xev.requestor = xsre-&gt;requestor;
</a><a href="#h0-1108" id="h0-1108" class="i">+	xev.selection = xsre-&gt;selection;
</a><a href="#h0-1109" id="h0-1109" class="i">+	xev.target = xsre-&gt;target;
</a><a href="#h0-1110" id="h0-1110" class="i">+	xev.time = xsre-&gt;time;
</a><a href="#h0-1111" id="h0-1111" class="i">+	if (xsre-&gt;property == None)
</a><a href="#h0-1112" id="h0-1112" class="i">+		xsre-&gt;property = xsre-&gt;target;
</a><a href="#h0-1113" id="h0-1113" class="i">+
</a><a href="#h0-1114" id="h0-1114" class="i">+	/* reject */
</a><a href="#h0-1115" id="h0-1115" class="i">+	xev.property = None;
</a><a href="#h0-1116" id="h0-1116" class="i">+
</a><a href="#h0-1117" id="h0-1117" class="i">+	xa_targets = XInternAtom(xw.dpy, &quot;TARGETS&quot;, 0);
</a><a href="#h0-1118" id="h0-1118" class="i">+	if(xsre-&gt;target == xa_targets) {
</a><a href="#h0-1119" id="h0-1119" class="i">+		/* respond with the supported type */
</a><a href="#h0-1120" id="h0-1120" class="i">+		string = sel.xtarget;
</a><a href="#h0-1121" id="h0-1121" class="i">+		XChangeProperty(xsre-&gt;display, xsre-&gt;requestor, xsre-&gt;property,
</a><a href="#h0-1122" id="h0-1122" class="i">+				XA_ATOM, 32, PropModeReplace,
</a><a href="#h0-1123" id="h0-1123" class="i">+				(uchar *) &amp;string, 1);
</a><a href="#h0-1124" id="h0-1124" class="i">+		xev.property = xsre-&gt;property;
</a><a href="#h0-1125" id="h0-1125" class="i">+	} else if(xsre-&gt;target == sel.xtarget || xsre-&gt;target == XA_STRING) {
</a><a href="#h0-1126" id="h0-1126" class="i">+		/*
</a><a href="#h0-1127" id="h0-1127" class="i">+		 * xith XA_STRING non ascii characters may be incorrect in the
</a><a href="#h0-1128" id="h0-1128" class="i">+		 * requestor. It is not our problem, use utf8.
</a><a href="#h0-1129" id="h0-1129" class="i">+		 */
</a><a href="#h0-1130" id="h0-1130" class="i">+		clipboard = XInternAtom(xw.dpy, &quot;CLIPBOARD&quot;, 0);
</a><a href="#h0-1131" id="h0-1131" class="i">+		if(xsre-&gt;selection == XA_PRIMARY) {
</a><a href="#h0-1132" id="h0-1132" class="i">+			seltext = sel.primary;
</a><a href="#h0-1133" id="h0-1133" class="i">+		} else if(xsre-&gt;selection == clipboard) {
</a><a href="#h0-1134" id="h0-1134" class="i">+			seltext = sel.clipboard;
</a><a href="#h0-1135" id="h0-1135" class="i">+		} else {
</a><a href="#h0-1136" id="h0-1136" class="i">+			fprintf(stderr,
</a><a href="#h0-1137" id="h0-1137" class="i">+				&quot;Unhandled clipboard selection 0x%lx\n&quot;,
</a><a href="#h0-1138" id="h0-1138" class="i">+				xsre-&gt;selection);
</a><a href="#h0-1139" id="h0-1139" class="i">+			return;
</a><a href="#h0-1140" id="h0-1140" class="i">+		}
</a><a href="#h0-1141" id="h0-1141" class="i">+		if(seltext != NULL) {
</a><a href="#h0-1142" id="h0-1142" class="i">+			XChangeProperty(xsre-&gt;display, xsre-&gt;requestor,
</a><a href="#h0-1143" id="h0-1143" class="i">+					xsre-&gt;property, xsre-&gt;target,
</a><a href="#h0-1144" id="h0-1144" class="i">+					8, PropModeReplace,
</a><a href="#h0-1145" id="h0-1145" class="i">+					(uchar *)seltext, strlen(seltext));
</a><a href="#h0-1146" id="h0-1146" class="i">+			xev.property = xsre-&gt;property;
</a><a href="#h0-1147" id="h0-1147" class="i">+		}
</a><a href="#h0-1148" id="h0-1148" class="i">+	}
</a><a href="#h0-1149" id="h0-1149" class="i">+
</a><a href="#h0-1150" id="h0-1150" class="i">+	/* all done, send a notification to the listener */
</a><a href="#h0-1151" id="h0-1151" class="i">+	if(!XSendEvent(xsre-&gt;display, xsre-&gt;requestor, True, 0, (XEvent *) &amp;xev))
</a><a href="#h0-1152" id="h0-1152" class="i">+		fprintf(stderr, &quot;Error sending SelectionNotify event\n&quot;);
</a><a href="#h0-1153" id="h0-1153" class="i">+}
</a><a href="#h0-1154" id="h0-1154" class="i">+
</a><a href="#h0-1155" id="h0-1155" class="i">+void
</a><a href="#h0-1156" id="h0-1156" class="i">+xsetsel(char *str, Time t) {
</a><a href="#h0-1157" id="h0-1157" class="i">+	free(sel.primary);
</a><a href="#h0-1158" id="h0-1158" class="i">+	sel.primary = str;
</a><a href="#h0-1159" id="h0-1159" class="i">+
</a><a href="#h0-1160" id="h0-1160" class="i">+	XSetSelectionOwner(xw.dpy, XA_PRIMARY, xw.win, t);
</a><a href="#h0-1161" id="h0-1161" class="i">+	if (XGetSelectionOwner(xw.dpy, XA_PRIMARY) != xw.win)
</a><a href="#h0-1162" id="h0-1162" class="i">+		selclear(0);
</a><a href="#h0-1163" id="h0-1163" class="i">+
</a><a href="#h0-1164" id="h0-1164" class="i">+  clipcopy(NULL);
</a><a href="#h0-1165" id="h0-1165" class="i">+}
</a><a href="#h0-1166" id="h0-1166" class="i">+
</a><a href="#h0-1167" id="h0-1167" class="i">+void
</a><a href="#h0-1168" id="h0-1168" class="i">+brelease(XEvent *e) {
</a><a href="#h0-1169" id="h0-1169" class="i">+	if(IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h0-1170" id="h0-1170" class="i">+		mousereport(e);
</a><a href="#h0-1171" id="h0-1171" class="i">+		return;
</a><a href="#h0-1172" id="h0-1172" class="i">+	}
</a><a href="#h0-1173" id="h0-1173" class="i">+
</a><a href="#h0-1174" id="h0-1174" class="i">+	if(e-&gt;xbutton.button == Button2) {
</a><a href="#h0-1175" id="h0-1175" class="i">+		selpaste(NULL);
</a><a href="#h0-1176" id="h0-1176" class="i">+	} else if(e-&gt;xbutton.button == Button1) {
</a><a href="#h0-1177" id="h0-1177" class="i">+		if(sel.mode == SEL_READY) {
</a><a href="#h0-1178" id="h0-1178" class="i">+			getbuttoninfo(e);
</a><a href="#h0-1179" id="h0-1179" class="i">+			selcopy(e-&gt;xbutton.time);
</a><a href="#h0-1180" id="h0-1180" class="i">+		} else
</a><a href="#h0-1181" id="h0-1181" class="i">+			selclear(NULL);
</a><a href="#h0-1182" id="h0-1182" class="i">+		sel.mode = SEL_IDLE;
</a><a href="#h0-1183" id="h0-1183" class="i">+		tsetdirt(sel.nb.y, sel.ne.y);
</a><a href="#h0-1184" id="h0-1184" class="i">+	}
</a><a href="#h0-1185" id="h0-1185" class="i">+}
</a><a href="#h0-1186" id="h0-1186" class="i">+
</a><a href="#h0-1187" id="h0-1187" class="i">+void
</a><a href="#h0-1188" id="h0-1188" class="i">+bmotion(XEvent *e) {
</a><a href="#h0-1189" id="h0-1189" class="i">+	int oldey, oldex, oldsby, oldsey;
</a><a href="#h0-1190" id="h0-1190" class="i">+
</a><a href="#h0-1191" id="h0-1191" class="i">+  if(!xw.pointerisvisible) {
</a><a href="#h0-1192" id="h0-1192" class="i">+    XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h0-1193" id="h0-1193" class="i">+    xw.pointerisvisible = true;
</a><a href="#h0-1194" id="h0-1194" class="i">+    if(!IS_SET(MODE_MOUSEMANY))
</a><a href="#h0-1195" id="h0-1195" class="i">+      xsetpointermotion(0);
</a><a href="#h0-1196" id="h0-1196" class="i">+  }
</a><a href="#h0-1197" id="h0-1197" class="i">+
</a><a href="#h0-1198" id="h0-1198" class="i">+	if(IS_SET(MODE_MOUSE) &amp;&amp; !(e-&gt;xbutton.state &amp; forceselmod)) {
</a><a href="#h0-1199" id="h0-1199" class="i">+		mousereport(e);
</a><a href="#h0-1200" id="h0-1200" class="i">+		return;
</a><a href="#h0-1201" id="h0-1201" class="i">+	}
</a><a href="#h0-1202" id="h0-1202" class="i">+
</a><a href="#h0-1203" id="h0-1203" class="i">+	if(!sel.mode)
</a><a href="#h0-1204" id="h0-1204" class="i">+		return;
</a><a href="#h0-1205" id="h0-1205" class="i">+
</a><a href="#h0-1206" id="h0-1206" class="i">+	sel.mode = SEL_READY;
</a><a href="#h0-1207" id="h0-1207" class="i">+	oldey = sel.oe.y;
</a><a href="#h0-1208" id="h0-1208" class="i">+	oldex = sel.oe.x;
</a><a href="#h0-1209" id="h0-1209" class="i">+	oldsby = sel.nb.y;
</a><a href="#h0-1210" id="h0-1210" class="i">+	oldsey = sel.ne.y;
</a><a href="#h0-1211" id="h0-1211" class="i">+	getbuttoninfo(e);
</a><a href="#h0-1212" id="h0-1212" class="i">+
</a><a href="#h0-1213" id="h0-1213" class="i">+	if(oldey != sel.oe.y || oldex != sel.oe.x)
</a><a href="#h0-1214" id="h0-1214" class="i">+		tsetdirt(MIN(sel.nb.y, oldsby), MAX(sel.ne.y, oldsey));
</a><a href="#h0-1215" id="h0-1215" class="i">+}
</a><a href="#h0-1216" id="h0-1216" class="i">+
</a><a href="#h0-1217" id="h0-1217" class="i">+void
</a><a href="#h0-1218" id="h0-1218" class="i">+die(const char *errstr, ...) {
</a><a href="#h0-1219" id="h0-1219" class="i">+	va_list ap;
</a><a href="#h0-1220" id="h0-1220" class="i">+
</a><a href="#h0-1221" id="h0-1221" class="i">+	va_start(ap, errstr);
</a><a href="#h0-1222" id="h0-1222" class="i">+	vfprintf(stderr, errstr, ap);
</a><a href="#h0-1223" id="h0-1223" class="i">+	va_end(ap);
</a><a href="#h0-1224" id="h0-1224" class="i">+	exit(EXIT_FAILURE);
</a><a href="#h0-1225" id="h0-1225" class="i">+}
</a><a href="#h0-1226" id="h0-1226" class="i">+
</a><a href="#h0-1227" id="h0-1227" class="i">+void
</a><a href="#h0-1228" id="h0-1228" class="i">+execsh(void) {
</a><a href="#h0-1229" id="h0-1229" class="i">+	char **args, *sh, *prog;
</a><a href="#h0-1230" id="h0-1230" class="i">+	const struct passwd *pw;
</a><a href="#h0-1231" id="h0-1231" class="i">+	char buf[sizeof(long) * 8 + 1];
</a><a href="#h0-1232" id="h0-1232" class="i">+
</a><a href="#h0-1233" id="h0-1233" class="i">+	errno = 0;
</a><a href="#h0-1234" id="h0-1234" class="i">+	if((pw = getpwuid(getuid())) == NULL) {
</a><a href="#h0-1235" id="h0-1235" class="i">+		if(errno)
</a><a href="#h0-1236" id="h0-1236" class="i">+			die(&quot;getpwuid:%s\n&quot;, strerror(errno));
</a><a href="#h0-1237" id="h0-1237" class="i">+		else
</a><a href="#h0-1238" id="h0-1238" class="i">+			die(&quot;who are you?\n&quot;);
</a><a href="#h0-1239" id="h0-1239" class="i">+	}
</a><a href="#h0-1240" id="h0-1240" class="i">+
</a><a href="#h0-1241" id="h0-1241" class="i">+	if (!(sh = getenv(&quot;SHELL&quot;))) {
</a><a href="#h0-1242" id="h0-1242" class="i">+		sh = (pw-&gt;pw_shell[0]) ? pw-&gt;pw_shell : shell;
</a><a href="#h0-1243" id="h0-1243" class="i">+	}
</a><a href="#h0-1244" id="h0-1244" class="i">+
</a><a href="#h0-1245" id="h0-1245" class="i">+	if(opt_cmd)
</a><a href="#h0-1246" id="h0-1246" class="i">+		prog = opt_cmd[0];
</a><a href="#h0-1247" id="h0-1247" class="i">+	else if(utmp)
</a><a href="#h0-1248" id="h0-1248" class="i">+		prog = utmp;
</a><a href="#h0-1249" id="h0-1249" class="i">+	else
</a><a href="#h0-1250" id="h0-1250" class="i">+		prog = sh;
</a><a href="#h0-1251" id="h0-1251" class="i">+	args = (opt_cmd) ? opt_cmd : (char *[]) {prog, NULL};
</a><a href="#h0-1252" id="h0-1252" class="i">+
</a><a href="#h0-1253" id="h0-1253" class="i">+	snprintf(buf, sizeof(buf), &quot;%lu&quot;, xw.win);
</a><a href="#h0-1254" id="h0-1254" class="i">+
</a><a href="#h0-1255" id="h0-1255" class="i">+	unsetenv(&quot;COLUMNS&quot;);
</a><a href="#h0-1256" id="h0-1256" class="i">+	unsetenv(&quot;LINES&quot;);
</a><a href="#h0-1257" id="h0-1257" class="i">+	unsetenv(&quot;TERMCAP&quot;);
</a><a href="#h0-1258" id="h0-1258" class="i">+	setenv(&quot;LOGNAME&quot;, pw-&gt;pw_name, 1);
</a><a href="#h0-1259" id="h0-1259" class="i">+	setenv(&quot;USER&quot;, pw-&gt;pw_name, 1);
</a><a href="#h0-1260" id="h0-1260" class="i">+	setenv(&quot;SHELL&quot;, sh, 1);
</a><a href="#h0-1261" id="h0-1261" class="i">+	setenv(&quot;HOME&quot;, pw-&gt;pw_dir, 1);
</a><a href="#h0-1262" id="h0-1262" class="i">+	setenv(&quot;TERM&quot;, termname, 1);
</a><a href="#h0-1263" id="h0-1263" class="i">+	setenv(&quot;WINDOWID&quot;, buf, 1);
</a><a href="#h0-1264" id="h0-1264" class="i">+
</a><a href="#h0-1265" id="h0-1265" class="i">+	signal(SIGCHLD, SIG_DFL);
</a><a href="#h0-1266" id="h0-1266" class="i">+	signal(SIGHUP, SIG_DFL);
</a><a href="#h0-1267" id="h0-1267" class="i">+	signal(SIGINT, SIG_DFL);
</a><a href="#h0-1268" id="h0-1268" class="i">+	signal(SIGQUIT, SIG_DFL);
</a><a href="#h0-1269" id="h0-1269" class="i">+	signal(SIGTERM, SIG_DFL);
</a><a href="#h0-1270" id="h0-1270" class="i">+	signal(SIGALRM, SIG_DFL);
</a><a href="#h0-1271" id="h0-1271" class="i">+
</a><a href="#h0-1272" id="h0-1272" class="i">+	execvp(prog, args);
</a><a href="#h0-1273" id="h0-1273" class="i">+	_exit(EXIT_FAILURE);
</a><a href="#h0-1274" id="h0-1274" class="i">+}
</a><a href="#h0-1275" id="h0-1275" class="i">+
</a><a href="#h0-1276" id="h0-1276" class="i">+void
</a><a href="#h0-1277" id="h0-1277" class="i">+sigchld(int a) {
</a><a href="#h0-1278" id="h0-1278" class="i">+	int stat, ret;
</a><a href="#h0-1279" id="h0-1279" class="i">+	pid_t p;
</a><a href="#h0-1280" id="h0-1280" class="i">+
</a><a href="#h0-1281" id="h0-1281" class="i">+	if((p = waitpid(pid, &amp;stat, WNOHANG)) &lt; 0)
</a><a href="#h0-1282" id="h0-1282" class="i">+		die(&quot;Waiting for pid %hd failed: %s\n&quot;, pid, strerror(errno));
</a><a href="#h0-1283" id="h0-1283" class="i">+
</a><a href="#h0-1284" id="h0-1284" class="i">+	if(pid != p)
</a><a href="#h0-1285" id="h0-1285" class="i">+		return;
</a><a href="#h0-1286" id="h0-1286" class="i">+
</a><a href="#h0-1287" id="h0-1287" class="i">+	ret = WIFEXITED(stat) ? WEXITSTATUS(stat) : EXIT_FAILURE;
</a><a href="#h0-1288" id="h0-1288" class="i">+	if (ret != EXIT_SUCCESS)
</a><a href="#h0-1289" id="h0-1289" class="i">+		die(&quot;child finished with error &apos;%d&apos;\n&quot;, stat);
</a><a href="#h0-1290" id="h0-1290" class="i">+	exit(EXIT_SUCCESS);
</a><a href="#h0-1291" id="h0-1291" class="i">+}
</a><a href="#h0-1292" id="h0-1292" class="i">+
</a><a href="#h0-1293" id="h0-1293" class="i">+
</a><a href="#h0-1294" id="h0-1294" class="i">+void
</a><a href="#h0-1295" id="h0-1295" class="i">+stty(void)
</a><a href="#h0-1296" id="h0-1296" class="i">+{
</a><a href="#h0-1297" id="h0-1297" class="i">+	char cmd[_POSIX_ARG_MAX], **p, *q, *s;
</a><a href="#h0-1298" id="h0-1298" class="i">+	size_t n, siz;
</a><a href="#h0-1299" id="h0-1299" class="i">+
</a><a href="#h0-1300" id="h0-1300" class="i">+	if((n = strlen(stty_args)) &gt; sizeof(cmd)-1)
</a><a href="#h0-1301" id="h0-1301" class="i">+		die(&quot;incorrect stty parameters\n&quot;);
</a><a href="#h0-1302" id="h0-1302" class="i">+	memcpy(cmd, stty_args, n);
</a><a href="#h0-1303" id="h0-1303" class="i">+	q = cmd + n;
</a><a href="#h0-1304" id="h0-1304" class="i">+	siz = sizeof(cmd) - n;
</a><a href="#h0-1305" id="h0-1305" class="i">+	for(p = opt_cmd; p &amp;&amp; (s = *p); ++p) {
</a><a href="#h0-1306" id="h0-1306" class="i">+		if((n = strlen(s)) &gt; siz-1)
</a><a href="#h0-1307" id="h0-1307" class="i">+			die(&quot;stty parameter length too long\n&quot;);
</a><a href="#h0-1308" id="h0-1308" class="i">+		*q++ = &apos; &apos;;
</a><a href="#h0-1309" id="h0-1309" class="i">+		q = memcpy(q, s, n);
</a><a href="#h0-1310" id="h0-1310" class="i">+		q += n;
</a><a href="#h0-1311" id="h0-1311" class="i">+		siz-= n + 1;
</a><a href="#h0-1312" id="h0-1312" class="i">+	}
</a><a href="#h0-1313" id="h0-1313" class="i">+	*q = &apos;\0&apos;;
</a><a href="#h0-1314" id="h0-1314" class="i">+	if (system(cmd) != 0)
</a><a href="#h0-1315" id="h0-1315" class="i">+	    perror(&quot;Couldn&apos;t call stty&quot;);
</a><a href="#h0-1316" id="h0-1316" class="i">+}
</a><a href="#h0-1317" id="h0-1317" class="i">+
</a><a href="#h0-1318" id="h0-1318" class="i">+void
</a><a href="#h0-1319" id="h0-1319" class="i">+ttynew(void) {
</a><a href="#h0-1320" id="h0-1320" class="i">+	int m, s;
</a><a href="#h0-1321" id="h0-1321" class="i">+	struct winsize w = {term.row, term.col, 0, 0};
</a><a href="#h0-1322" id="h0-1322" class="i">+
</a><a href="#h0-1323" id="h0-1323" class="i">+	if(opt_io) {
</a><a href="#h0-1324" id="h0-1324" class="i">+		term.mode |= MODE_PRINT;
</a><a href="#h0-1325" id="h0-1325" class="i">+		iofd = (!strcmp(opt_io, &quot;-&quot;)) ?
</a><a href="#h0-1326" id="h0-1326" class="i">+			  STDOUT_FILENO :
</a><a href="#h0-1327" id="h0-1327" class="i">+			  open(opt_io, O_WRONLY | O_CREAT, 0666);
</a><a href="#h0-1328" id="h0-1328" class="i">+		if(iofd &lt; 0) {
</a><a href="#h0-1329" id="h0-1329" class="i">+			fprintf(stderr, &quot;Error opening %s:%s\n&quot;,
</a><a href="#h0-1330" id="h0-1330" class="i">+				opt_io, strerror(errno));
</a><a href="#h0-1331" id="h0-1331" class="i">+		}
</a><a href="#h0-1332" id="h0-1332" class="i">+	}
</a><a href="#h0-1333" id="h0-1333" class="i">+
</a><a href="#h0-1334" id="h0-1334" class="i">+	if (opt_line) {
</a><a href="#h0-1335" id="h0-1335" class="i">+		if((cmdfd = open(opt_line, O_RDWR)) &lt; 0)
</a><a href="#h0-1336" id="h0-1336" class="i">+			die(&quot;open line failed: %s\n&quot;, strerror(errno));
</a><a href="#h0-1337" id="h0-1337" class="i">+		close(STDIN_FILENO);
</a><a href="#h0-1338" id="h0-1338" class="i">+		dup(cmdfd);
</a><a href="#h0-1339" id="h0-1339" class="i">+		stty();
</a><a href="#h0-1340" id="h0-1340" class="i">+		return;
</a><a href="#h0-1341" id="h0-1341" class="i">+	}
</a><a href="#h0-1342" id="h0-1342" class="i">+
</a><a href="#h0-1343" id="h0-1343" class="i">+	/* seems to work fine on linux, openbsd and freebsd */
</a><a href="#h0-1344" id="h0-1344" class="i">+	if(openpty(&amp;m, &amp;s, NULL, NULL, &amp;w) &lt; 0)
</a><a href="#h0-1345" id="h0-1345" class="i">+		die(&quot;openpty failed: %s\n&quot;, strerror(errno));
</a><a href="#h0-1346" id="h0-1346" class="i">+
</a><a href="#h0-1347" id="h0-1347" class="i">+	switch(pid = fork()) {
</a><a href="#h0-1348" id="h0-1348" class="i">+	case -1:
</a><a href="#h0-1349" id="h0-1349" class="i">+		die(&quot;fork failed\n&quot;);
</a><a href="#h0-1350" id="h0-1350" class="i">+		break;
</a><a href="#h0-1351" id="h0-1351" class="i">+	case 0:
</a><a href="#h0-1352" id="h0-1352" class="i">+		close(iofd);
</a><a href="#h0-1353" id="h0-1353" class="i">+		setsid(); /* create a new process group */
</a><a href="#h0-1354" id="h0-1354" class="i">+		dup2(s, STDIN_FILENO);
</a><a href="#h0-1355" id="h0-1355" class="i">+		dup2(s, STDOUT_FILENO);
</a><a href="#h0-1356" id="h0-1356" class="i">+		dup2(s, STDERR_FILENO);
</a><a href="#h0-1357" id="h0-1357" class="i">+		if(ioctl(s, TIOCSCTTY, NULL) &lt; 0)
</a><a href="#h0-1358" id="h0-1358" class="i">+			die(&quot;ioctl TIOCSCTTY failed: %s\n&quot;, strerror(errno));
</a><a href="#h0-1359" id="h0-1359" class="i">+		close(s);
</a><a href="#h0-1360" id="h0-1360" class="i">+		close(m);
</a><a href="#h0-1361" id="h0-1361" class="i">+		execsh();
</a><a href="#h0-1362" id="h0-1362" class="i">+		break;
</a><a href="#h0-1363" id="h0-1363" class="i">+	default:
</a><a href="#h0-1364" id="h0-1364" class="i">+		close(s);
</a><a href="#h0-1365" id="h0-1365" class="i">+		cmdfd = m;
</a><a href="#h0-1366" id="h0-1366" class="i">+		signal(SIGCHLD, sigchld);
</a><a href="#h0-1367" id="h0-1367" class="i">+		break;
</a><a href="#h0-1368" id="h0-1368" class="i">+	}
</a><a href="#h0-1369" id="h0-1369" class="i">+}
</a><a href="#h0-1370" id="h0-1370" class="i">+
</a><a href="#h0-1371" id="h0-1371" class="i">+void
</a><a href="#h0-1372" id="h0-1372" class="i">+ttyread(void) {
</a><a href="#h0-1373" id="h0-1373" class="i">+	static char buf[BUFSIZ];
</a><a href="#h0-1374" id="h0-1374" class="i">+	static int buflen = 0;
</a><a href="#h0-1375" id="h0-1375" class="i">+	char *ptr;
</a><a href="#h0-1376" id="h0-1376" class="i">+	int charsize; /* size of utf8 char in bytes */
</a><a href="#h0-1377" id="h0-1377" class="i">+	Rune unicodep;
</a><a href="#h0-1378" id="h0-1378" class="i">+	int ret;
</a><a href="#h0-1379" id="h0-1379" class="i">+
</a><a href="#h0-1380" id="h0-1380" class="i">+	/* append read bytes to unprocessed bytes */
</a><a href="#h0-1381" id="h0-1381" class="i">+	if((ret = read(cmdfd, buf+buflen, LEN(buf)-buflen)) &lt; 0)
</a><a href="#h0-1382" id="h0-1382" class="i">+		die(&quot;Couldn&apos;t read from shell: %s\n&quot;, strerror(errno));
</a><a href="#h0-1383" id="h0-1383" class="i">+
</a><a href="#h0-1384" id="h0-1384" class="i">+	/* process every complete utf8 char */
</a><a href="#h0-1385" id="h0-1385" class="i">+	buflen += ret;
</a><a href="#h0-1386" id="h0-1386" class="i">+	ptr = buf;
</a><a href="#h0-1387" id="h0-1387" class="i">+	while((charsize = utf8decode(ptr, &amp;unicodep, buflen))) {
</a><a href="#h0-1388" id="h0-1388" class="i">+		tputc(unicodep);
</a><a href="#h0-1389" id="h0-1389" class="i">+		ptr += charsize;
</a><a href="#h0-1390" id="h0-1390" class="i">+		buflen -= charsize;
</a><a href="#h0-1391" id="h0-1391" class="i">+	}
</a><a href="#h0-1392" id="h0-1392" class="i">+
</a><a href="#h0-1393" id="h0-1393" class="i">+	/* keep any uncomplete utf8 char for the next call */
</a><a href="#h0-1394" id="h0-1394" class="i">+	memmove(buf, ptr, buflen);
</a><a href="#h0-1395" id="h0-1395" class="i">+}
</a><a href="#h0-1396" id="h0-1396" class="i">+
</a><a href="#h0-1397" id="h0-1397" class="i">+void
</a><a href="#h0-1398" id="h0-1398" class="i">+ttywrite(const char *s, size_t n) {
</a><a href="#h0-1399" id="h0-1399" class="i">+	if(xwrite(cmdfd, s, n) == -1)
</a><a href="#h0-1400" id="h0-1400" class="i">+		die(&quot;write error on tty: %s\n&quot;, strerror(errno));
</a><a href="#h0-1401" id="h0-1401" class="i">+}
</a><a href="#h0-1402" id="h0-1402" class="i">+
</a><a href="#h0-1403" id="h0-1403" class="i">+void
</a><a href="#h0-1404" id="h0-1404" class="i">+ttysend(char *s, size_t n) {
</a><a href="#h0-1405" id="h0-1405" class="i">+	int len;
</a><a href="#h0-1406" id="h0-1406" class="i">+	Rune u;
</a><a href="#h0-1407" id="h0-1407" class="i">+
</a><a href="#h0-1408" id="h0-1408" class="i">+	ttywrite(s, n);
</a><a href="#h0-1409" id="h0-1409" class="i">+	if(IS_SET(MODE_ECHO))
</a><a href="#h0-1410" id="h0-1410" class="i">+		while((len = utf8decode(s, &amp;u, n)) &gt; 0) {
</a><a href="#h0-1411" id="h0-1411" class="i">+			techo(u);
</a><a href="#h0-1412" id="h0-1412" class="i">+			n -= len;
</a><a href="#h0-1413" id="h0-1413" class="i">+			s += len;
</a><a href="#h0-1414" id="h0-1414" class="i">+		}
</a><a href="#h0-1415" id="h0-1415" class="i">+}
</a><a href="#h0-1416" id="h0-1416" class="i">+
</a><a href="#h0-1417" id="h0-1417" class="i">+void
</a><a href="#h0-1418" id="h0-1418" class="i">+ttyresize(void) {
</a><a href="#h0-1419" id="h0-1419" class="i">+	struct winsize w;
</a><a href="#h0-1420" id="h0-1420" class="i">+
</a><a href="#h0-1421" id="h0-1421" class="i">+	w.ws_row = term.row;
</a><a href="#h0-1422" id="h0-1422" class="i">+	w.ws_col = term.col;
</a><a href="#h0-1423" id="h0-1423" class="i">+	w.ws_xpixel = xw.tw;
</a><a href="#h0-1424" id="h0-1424" class="i">+	w.ws_ypixel = xw.th;
</a><a href="#h0-1425" id="h0-1425" class="i">+	if(ioctl(cmdfd, TIOCSWINSZ, &amp;w) &lt; 0)
</a><a href="#h0-1426" id="h0-1426" class="i">+		fprintf(stderr, &quot;Couldn&apos;t set window size: %s\n&quot;, strerror(errno));
</a><a href="#h0-1427" id="h0-1427" class="i">+}
</a><a href="#h0-1428" id="h0-1428" class="i">+
</a><a href="#h0-1429" id="h0-1429" class="i">+int
</a><a href="#h0-1430" id="h0-1430" class="i">+tattrset(int attr) {
</a><a href="#h0-1431" id="h0-1431" class="i">+	int i, j;
</a><a href="#h0-1432" id="h0-1432" class="i">+
</a><a href="#h0-1433" id="h0-1433" class="i">+	for(i = 0; i &lt; term.row-1; i++) {
</a><a href="#h0-1434" id="h0-1434" class="i">+		for(j = 0; j &lt; term.col-1; j++) {
</a><a href="#h0-1435" id="h0-1435" class="i">+			if(term.line[i][j].mode &amp; attr)
</a><a href="#h0-1436" id="h0-1436" class="i">+				return 1;
</a><a href="#h0-1437" id="h0-1437" class="i">+		}
</a><a href="#h0-1438" id="h0-1438" class="i">+	}
</a><a href="#h0-1439" id="h0-1439" class="i">+
</a><a href="#h0-1440" id="h0-1440" class="i">+	return 0;
</a><a href="#h0-1441" id="h0-1441" class="i">+}
</a><a href="#h0-1442" id="h0-1442" class="i">+
</a><a href="#h0-1443" id="h0-1443" class="i">+void
</a><a href="#h0-1444" id="h0-1444" class="i">+tsetdirt(int top, int bot) {
</a><a href="#h0-1445" id="h0-1445" class="i">+	int i;
</a><a href="#h0-1446" id="h0-1446" class="i">+
</a><a href="#h0-1447" id="h0-1447" class="i">+	LIMIT(top, 0, term.row-1);
</a><a href="#h0-1448" id="h0-1448" class="i">+	LIMIT(bot, 0, term.row-1);
</a><a href="#h0-1449" id="h0-1449" class="i">+
</a><a href="#h0-1450" id="h0-1450" class="i">+	for(i = top; i &lt;= bot; i++)
</a><a href="#h0-1451" id="h0-1451" class="i">+		term.dirty[i] = 1;
</a><a href="#h0-1452" id="h0-1452" class="i">+}
</a><a href="#h0-1453" id="h0-1453" class="i">+
</a><a href="#h0-1454" id="h0-1454" class="i">+void
</a><a href="#h0-1455" id="h0-1455" class="i">+tsetdirtattr(int attr) {
</a><a href="#h0-1456" id="h0-1456" class="i">+	int i, j;
</a><a href="#h0-1457" id="h0-1457" class="i">+
</a><a href="#h0-1458" id="h0-1458" class="i">+	for(i = 0; i &lt; term.row-1; i++) {
</a><a href="#h0-1459" id="h0-1459" class="i">+		for(j = 0; j &lt; term.col-1; j++) {
</a><a href="#h0-1460" id="h0-1460" class="i">+			if(term.line[i][j].mode &amp; attr) {
</a><a href="#h0-1461" id="h0-1461" class="i">+				tsetdirt(i, i);
</a><a href="#h0-1462" id="h0-1462" class="i">+				break;
</a><a href="#h0-1463" id="h0-1463" class="i">+			}
</a><a href="#h0-1464" id="h0-1464" class="i">+		}
</a><a href="#h0-1465" id="h0-1465" class="i">+	}
</a><a href="#h0-1466" id="h0-1466" class="i">+}
</a><a href="#h0-1467" id="h0-1467" class="i">+
</a><a href="#h0-1468" id="h0-1468" class="i">+void
</a><a href="#h0-1469" id="h0-1469" class="i">+tfulldirt(void) {
</a><a href="#h0-1470" id="h0-1470" class="i">+	tsetdirt(0, term.row-1);
</a><a href="#h0-1471" id="h0-1471" class="i">+}
</a><a href="#h0-1472" id="h0-1472" class="i">+
</a><a href="#h0-1473" id="h0-1473" class="i">+void
</a><a href="#h0-1474" id="h0-1474" class="i">+tcursor(int mode) {
</a><a href="#h0-1475" id="h0-1475" class="i">+	static TCursor c[2];
</a><a href="#h0-1476" id="h0-1476" class="i">+	bool alt = IS_SET(MODE_ALTSCREEN);
</a><a href="#h0-1477" id="h0-1477" class="i">+
</a><a href="#h0-1478" id="h0-1478" class="i">+	if(mode == CURSOR_SAVE) {
</a><a href="#h0-1479" id="h0-1479" class="i">+		c[alt] = term.c;
</a><a href="#h0-1480" id="h0-1480" class="i">+	} else if(mode == CURSOR_LOAD) {
</a><a href="#h0-1481" id="h0-1481" class="i">+		term.c = c[alt];
</a><a href="#h0-1482" id="h0-1482" class="i">+		tmoveto(c[alt].x, c[alt].y);
</a><a href="#h0-1483" id="h0-1483" class="i">+	}
</a><a href="#h0-1484" id="h0-1484" class="i">+}
</a><a href="#h0-1485" id="h0-1485" class="i">+
</a><a href="#h0-1486" id="h0-1486" class="i">+void
</a><a href="#h0-1487" id="h0-1487" class="i">+treset(void) {
</a><a href="#h0-1488" id="h0-1488" class="i">+	uint i;
</a><a href="#h0-1489" id="h0-1489" class="i">+
</a><a href="#h0-1490" id="h0-1490" class="i">+	term.c = (TCursor){{
</a><a href="#h0-1491" id="h0-1491" class="i">+		.mode = ATTR_NULL,
</a><a href="#h0-1492" id="h0-1492" class="i">+		.fg = defaultfg,
</a><a href="#h0-1493" id="h0-1493" class="i">+		.bg = defaultbg
</a><a href="#h0-1494" id="h0-1494" class="i">+	}, .x = 0, .y = 0, .state = CURSOR_DEFAULT};
</a><a href="#h0-1495" id="h0-1495" class="i">+
</a><a href="#h0-1496" id="h0-1496" class="i">+	memset(term.tabs, 0, term.col * sizeof(*term.tabs));
</a><a href="#h0-1497" id="h0-1497" class="i">+	for(i = tabspaces; i &lt; term.col; i += tabspaces)
</a><a href="#h0-1498" id="h0-1498" class="i">+		term.tabs[i] = 1;
</a><a href="#h0-1499" id="h0-1499" class="i">+	term.top = 0;
</a><a href="#h0-1500" id="h0-1500" class="i">+	term.bot = term.row - 1;
</a><a href="#h0-1501" id="h0-1501" class="i">+	term.mode = MODE_WRAP;
</a><a href="#h0-1502" id="h0-1502" class="i">+	memset(term.trantbl, CS_USA, sizeof(term.trantbl));
</a><a href="#h0-1503" id="h0-1503" class="i">+	term.charset = 0;
</a><a href="#h0-1504" id="h0-1504" class="i">+
</a><a href="#h0-1505" id="h0-1505" class="i">+	for(i = 0; i &lt; 2; i++) {
</a><a href="#h0-1506" id="h0-1506" class="i">+		tmoveto(0, 0);
</a><a href="#h0-1507" id="h0-1507" class="i">+		tcursor(CURSOR_SAVE);
</a><a href="#h0-1508" id="h0-1508" class="i">+		tclearregion(0, 0, term.col-1, term.row-1);
</a><a href="#h0-1509" id="h0-1509" class="i">+		tswapscreen();
</a><a href="#h0-1510" id="h0-1510" class="i">+	}
</a><a href="#h0-1511" id="h0-1511" class="i">+}
</a><a href="#h0-1512" id="h0-1512" class="i">+
</a><a href="#h0-1513" id="h0-1513" class="i">+void
</a><a href="#h0-1514" id="h0-1514" class="i">+tnew(int col, int row) {
</a><a href="#h0-1515" id="h0-1515" class="i">+	term = (Term){ .c = { .attr = { .fg = defaultfg, .bg = defaultbg } } };
</a><a href="#h0-1516" id="h0-1516" class="i">+	tresize(col, row);
</a><a href="#h0-1517" id="h0-1517" class="i">+	term.numlock = 1;
</a><a href="#h0-1518" id="h0-1518" class="i">+
</a><a href="#h0-1519" id="h0-1519" class="i">+	treset();
</a><a href="#h0-1520" id="h0-1520" class="i">+}
</a><a href="#h0-1521" id="h0-1521" class="i">+
</a><a href="#h0-1522" id="h0-1522" class="i">+void
</a><a href="#h0-1523" id="h0-1523" class="i">+tswapscreen(void) {
</a><a href="#h0-1524" id="h0-1524" class="i">+	Line *tmp = term.line;
</a><a href="#h0-1525" id="h0-1525" class="i">+
</a><a href="#h0-1526" id="h0-1526" class="i">+	term.line = term.alt;
</a><a href="#h0-1527" id="h0-1527" class="i">+	term.alt = tmp;
</a><a href="#h0-1528" id="h0-1528" class="i">+	term.mode ^= MODE_ALTSCREEN;
</a><a href="#h0-1529" id="h0-1529" class="i">+	tfulldirt();
</a><a href="#h0-1530" id="h0-1530" class="i">+}
</a><a href="#h0-1531" id="h0-1531" class="i">+
</a><a href="#h0-1532" id="h0-1532" class="i">+void
</a><a href="#h0-1533" id="h0-1533" class="i">+tscrolldown(int orig, int n) {
</a><a href="#h0-1534" id="h0-1534" class="i">+	int i;
</a><a href="#h0-1535" id="h0-1535" class="i">+	Line temp;
</a><a href="#h0-1536" id="h0-1536" class="i">+
</a><a href="#h0-1537" id="h0-1537" class="i">+	LIMIT(n, 0, term.bot-orig+1);
</a><a href="#h0-1538" id="h0-1538" class="i">+
</a><a href="#h0-1539" id="h0-1539" class="i">+	tsetdirt(orig, term.bot-n);
</a><a href="#h0-1540" id="h0-1540" class="i">+	tclearregion(0, term.bot-n+1, term.col-1, term.bot);
</a><a href="#h0-1541" id="h0-1541" class="i">+
</a><a href="#h0-1542" id="h0-1542" class="i">+	for(i = term.bot; i &gt;= orig+n; i--) {
</a><a href="#h0-1543" id="h0-1543" class="i">+		temp = term.line[i];
</a><a href="#h0-1544" id="h0-1544" class="i">+		term.line[i] = term.line[i-n];
</a><a href="#h0-1545" id="h0-1545" class="i">+		term.line[i-n] = temp;
</a><a href="#h0-1546" id="h0-1546" class="i">+	}
</a><a href="#h0-1547" id="h0-1547" class="i">+
</a><a href="#h0-1548" id="h0-1548" class="i">+	selscroll(orig, n);
</a><a href="#h0-1549" id="h0-1549" class="i">+}
</a><a href="#h0-1550" id="h0-1550" class="i">+
</a><a href="#h0-1551" id="h0-1551" class="i">+void
</a><a href="#h0-1552" id="h0-1552" class="i">+tscrollup(int orig, int n) {
</a><a href="#h0-1553" id="h0-1553" class="i">+	int i;
</a><a href="#h0-1554" id="h0-1554" class="i">+	Line temp;
</a><a href="#h0-1555" id="h0-1555" class="i">+
</a><a href="#h0-1556" id="h0-1556" class="i">+	LIMIT(n, 0, term.bot-orig+1);
</a><a href="#h0-1557" id="h0-1557" class="i">+
</a><a href="#h0-1558" id="h0-1558" class="i">+	tclearregion(0, orig, term.col-1, orig+n-1);
</a><a href="#h0-1559" id="h0-1559" class="i">+	tsetdirt(orig+n, term.bot);
</a><a href="#h0-1560" id="h0-1560" class="i">+
</a><a href="#h0-1561" id="h0-1561" class="i">+	for(i = orig; i &lt;= term.bot-n; i++) {
</a><a href="#h0-1562" id="h0-1562" class="i">+		temp = term.line[i];
</a><a href="#h0-1563" id="h0-1563" class="i">+		term.line[i] = term.line[i+n];
</a><a href="#h0-1564" id="h0-1564" class="i">+		term.line[i+n] = temp;
</a><a href="#h0-1565" id="h0-1565" class="i">+	}
</a><a href="#h0-1566" id="h0-1566" class="i">+
</a><a href="#h0-1567" id="h0-1567" class="i">+	selscroll(orig, -n);
</a><a href="#h0-1568" id="h0-1568" class="i">+}
</a><a href="#h0-1569" id="h0-1569" class="i">+
</a><a href="#h0-1570" id="h0-1570" class="i">+void
</a><a href="#h0-1571" id="h0-1571" class="i">+selscroll(int orig, int n) {
</a><a href="#h0-1572" id="h0-1572" class="i">+	if(sel.ob.x == -1)
</a><a href="#h0-1573" id="h0-1573" class="i">+		return;
</a><a href="#h0-1574" id="h0-1574" class="i">+
</a><a href="#h0-1575" id="h0-1575" class="i">+	if(BETWEEN(sel.ob.y, orig, term.bot) || BETWEEN(sel.oe.y, orig, term.bot)) {
</a><a href="#h0-1576" id="h0-1576" class="i">+		if((sel.ob.y += n) &gt; term.bot || (sel.oe.y += n) &lt; term.top) {
</a><a href="#h0-1577" id="h0-1577" class="i">+			selclear(NULL);
</a><a href="#h0-1578" id="h0-1578" class="i">+			return;
</a><a href="#h0-1579" id="h0-1579" class="i">+		}
</a><a href="#h0-1580" id="h0-1580" class="i">+		if(sel.type == SEL_RECTANGULAR) {
</a><a href="#h0-1581" id="h0-1581" class="i">+			if(sel.ob.y &lt; term.top)
</a><a href="#h0-1582" id="h0-1582" class="i">+				sel.ob.y = term.top;
</a><a href="#h0-1583" id="h0-1583" class="i">+			if(sel.oe.y &gt; term.bot)
</a><a href="#h0-1584" id="h0-1584" class="i">+				sel.oe.y = term.bot;
</a><a href="#h0-1585" id="h0-1585" class="i">+		} else {
</a><a href="#h0-1586" id="h0-1586" class="i">+			if(sel.ob.y &lt; term.top) {
</a><a href="#h0-1587" id="h0-1587" class="i">+				sel.ob.y = term.top;
</a><a href="#h0-1588" id="h0-1588" class="i">+				sel.ob.x = 0;
</a><a href="#h0-1589" id="h0-1589" class="i">+			}
</a><a href="#h0-1590" id="h0-1590" class="i">+			if(sel.oe.y &gt; term.bot) {
</a><a href="#h0-1591" id="h0-1591" class="i">+				sel.oe.y = term.bot;
</a><a href="#h0-1592" id="h0-1592" class="i">+				sel.oe.x = term.col;
</a><a href="#h0-1593" id="h0-1593" class="i">+			}
</a><a href="#h0-1594" id="h0-1594" class="i">+		}
</a><a href="#h0-1595" id="h0-1595" class="i">+		selnormalize();
</a><a href="#h0-1596" id="h0-1596" class="i">+	}
</a><a href="#h0-1597" id="h0-1597" class="i">+}
</a><a href="#h0-1598" id="h0-1598" class="i">+
</a><a href="#h0-1599" id="h0-1599" class="i">+void
</a><a href="#h0-1600" id="h0-1600" class="i">+tnewline(int first_col) {
</a><a href="#h0-1601" id="h0-1601" class="i">+	int y = term.c.y;
</a><a href="#h0-1602" id="h0-1602" class="i">+
</a><a href="#h0-1603" id="h0-1603" class="i">+	if(y == term.bot) {
</a><a href="#h0-1604" id="h0-1604" class="i">+		tscrollup(term.top, 1);
</a><a href="#h0-1605" id="h0-1605" class="i">+	} else {
</a><a href="#h0-1606" id="h0-1606" class="i">+		y++;
</a><a href="#h0-1607" id="h0-1607" class="i">+	}
</a><a href="#h0-1608" id="h0-1608" class="i">+	tmoveto(first_col ? 0 : term.c.x, y);
</a><a href="#h0-1609" id="h0-1609" class="i">+}
</a><a href="#h0-1610" id="h0-1610" class="i">+
</a><a href="#h0-1611" id="h0-1611" class="i">+void
</a><a href="#h0-1612" id="h0-1612" class="i">+csiparse(void) {
</a><a href="#h0-1613" id="h0-1613" class="i">+	char *p = csiescseq.buf, *np;
</a><a href="#h0-1614" id="h0-1614" class="i">+	long int v;
</a><a href="#h0-1615" id="h0-1615" class="i">+
</a><a href="#h0-1616" id="h0-1616" class="i">+	csiescseq.narg = 0;
</a><a href="#h0-1617" id="h0-1617" class="i">+	if(*p == &apos;?&apos;) {
</a><a href="#h0-1618" id="h0-1618" class="i">+		csiescseq.priv = 1;
</a><a href="#h0-1619" id="h0-1619" class="i">+		p++;
</a><a href="#h0-1620" id="h0-1620" class="i">+	}
</a><a href="#h0-1621" id="h0-1621" class="i">+
</a><a href="#h0-1622" id="h0-1622" class="i">+	csiescseq.buf[csiescseq.len] = &apos;\0&apos;;
</a><a href="#h0-1623" id="h0-1623" class="i">+	while(p &lt; csiescseq.buf+csiescseq.len) {
</a><a href="#h0-1624" id="h0-1624" class="i">+		np = NULL;
</a><a href="#h0-1625" id="h0-1625" class="i">+		v = strtol(p, &amp;np, 10);
</a><a href="#h0-1626" id="h0-1626" class="i">+		if(np == p)
</a><a href="#h0-1627" id="h0-1627" class="i">+			v = 0;
</a><a href="#h0-1628" id="h0-1628" class="i">+		if(v == LONG_MAX || v == LONG_MIN)
</a><a href="#h0-1629" id="h0-1629" class="i">+			v = -1;
</a><a href="#h0-1630" id="h0-1630" class="i">+		csiescseq.arg[csiescseq.narg++] = v;
</a><a href="#h0-1631" id="h0-1631" class="i">+		p = np;
</a><a href="#h0-1632" id="h0-1632" class="i">+		if(*p != &apos;;&apos; || csiescseq.narg == ESC_ARG_SIZ)
</a><a href="#h0-1633" id="h0-1633" class="i">+			break;
</a><a href="#h0-1634" id="h0-1634" class="i">+		p++;
</a><a href="#h0-1635" id="h0-1635" class="i">+	}
</a><a href="#h0-1636" id="h0-1636" class="i">+	csiescseq.mode[0] = *p++;
</a><a href="#h0-1637" id="h0-1637" class="i">+	csiescseq.mode[1] = (p &lt; csiescseq.buf+csiescseq.len) ? *p : &apos;\0&apos;;
</a><a href="#h0-1638" id="h0-1638" class="i">+}
</a><a href="#h0-1639" id="h0-1639" class="i">+
</a><a href="#h0-1640" id="h0-1640" class="i">+/* for absolute user moves, when decom is set */
</a><a href="#h0-1641" id="h0-1641" class="i">+void
</a><a href="#h0-1642" id="h0-1642" class="i">+tmoveato(int x, int y) {
</a><a href="#h0-1643" id="h0-1643" class="i">+	tmoveto(x, y + ((term.c.state &amp; CURSOR_ORIGIN) ? term.top: 0));
</a><a href="#h0-1644" id="h0-1644" class="i">+}
</a><a href="#h0-1645" id="h0-1645" class="i">+
</a><a href="#h0-1646" id="h0-1646" class="i">+void
</a><a href="#h0-1647" id="h0-1647" class="i">+tmoveto(int x, int y) {
</a><a href="#h0-1648" id="h0-1648" class="i">+	int miny, maxy;
</a><a href="#h0-1649" id="h0-1649" class="i">+
</a><a href="#h0-1650" id="h0-1650" class="i">+	if(term.c.state &amp; CURSOR_ORIGIN) {
</a><a href="#h0-1651" id="h0-1651" class="i">+		miny = term.top;
</a><a href="#h0-1652" id="h0-1652" class="i">+		maxy = term.bot;
</a><a href="#h0-1653" id="h0-1653" class="i">+	} else {
</a><a href="#h0-1654" id="h0-1654" class="i">+		miny = 0;
</a><a href="#h0-1655" id="h0-1655" class="i">+		maxy = term.row - 1;
</a><a href="#h0-1656" id="h0-1656" class="i">+	}
</a><a href="#h0-1657" id="h0-1657" class="i">+	term.c.state &amp;= ~CURSOR_WRAPNEXT;
</a><a href="#h0-1658" id="h0-1658" class="i">+	term.c.x = LIMIT(x, 0, term.col-1);
</a><a href="#h0-1659" id="h0-1659" class="i">+	term.c.y = LIMIT(y, miny, maxy);
</a><a href="#h0-1660" id="h0-1660" class="i">+}
</a><a href="#h0-1661" id="h0-1661" class="i">+
</a><a href="#h0-1662" id="h0-1662" class="i">+void
</a><a href="#h0-1663" id="h0-1663" class="i">+tsetchar(Rune u, Glyph *attr, int x, int y) {
</a><a href="#h0-1664" id="h0-1664" class="i">+	static char *vt100_0[62] = { /* 0x41 - 0x7e */
</a><a href="#h0-1665" id="h0-1665" class="i">+		&quot;↑&quot;, &quot;↓&quot;, &quot;→&quot;, &quot;←&quot;, &quot;█&quot;, &quot;▚&quot;, &quot;☃&quot;, /* A - G */
</a><a href="#h0-1666" id="h0-1666" class="i">+		0, 0, 0, 0, 0, 0, 0, 0, /* H - O */
</a><a href="#h0-1667" id="h0-1667" class="i">+		0, 0, 0, 0, 0, 0, 0, 0, /* P - W */
</a><a href="#h0-1668" id="h0-1668" class="i">+		0, 0, 0, 0, 0, 0, 0, &quot; &quot;, /* X - _ */
</a><a href="#h0-1669" id="h0-1669" class="i">+		&quot;◆&quot;, &quot;▒&quot;, &quot;␉&quot;, &quot;␌&quot;, &quot;␍&quot;, &quot;␊&quot;, &quot;°&quot;, &quot;±&quot;, /* ` - g */
</a><a href="#h0-1670" id="h0-1670" class="i">+		&quot;␤&quot;, &quot;␋&quot;, &quot;┘&quot;, &quot;┐&quot;, &quot;┌&quot;, &quot;└&quot;, &quot;┼&quot;, &quot;⎺&quot;, /* h - o */
</a><a href="#h0-1671" id="h0-1671" class="i">+		&quot;⎻&quot;, &quot;─&quot;, &quot;⎼&quot;, &quot;⎽&quot;, &quot;├&quot;, &quot;┤&quot;, &quot;┴&quot;, &quot;┬&quot;, /* p - w */
</a><a href="#h0-1672" id="h0-1672" class="i">+		&quot;│&quot;, &quot;≤&quot;, &quot;≥&quot;, &quot;π&quot;, &quot;≠&quot;, &quot;£&quot;, &quot;·&quot;, /* x - ~ */
</a><a href="#h0-1673" id="h0-1673" class="i">+	};
</a><a href="#h0-1674" id="h0-1674" class="i">+
</a><a href="#h0-1675" id="h0-1675" class="i">+	/*
</a><a href="#h0-1676" id="h0-1676" class="i">+	 * The table is proudly stolen from rxvt.
</a><a href="#h0-1677" id="h0-1677" class="i">+	 */
</a><a href="#h0-1678" id="h0-1678" class="i">+	if(term.trantbl[term.charset] == CS_GRAPHIC0 &amp;&amp;
</a><a href="#h0-1679" id="h0-1679" class="i">+	   BETWEEN(u, 0x41, 0x7e) &amp;&amp; vt100_0[u - 0x41])
</a><a href="#h0-1680" id="h0-1680" class="i">+		utf8decode(vt100_0[u - 0x41], &amp;u, UTF_SIZ);
</a><a href="#h0-1681" id="h0-1681" class="i">+
</a><a href="#h0-1682" id="h0-1682" class="i">+	if(term.line[y][x].mode &amp; ATTR_WIDE) {
</a><a href="#h0-1683" id="h0-1683" class="i">+		if(x+1 &lt; term.col) {
</a><a href="#h0-1684" id="h0-1684" class="i">+			term.line[y][x+1].u = &apos; &apos;;
</a><a href="#h0-1685" id="h0-1685" class="i">+			term.line[y][x+1].mode &amp;= ~ATTR_WDUMMY;
</a><a href="#h0-1686" id="h0-1686" class="i">+		}
</a><a href="#h0-1687" id="h0-1687" class="i">+	} else if(term.line[y][x].mode &amp; ATTR_WDUMMY) {
</a><a href="#h0-1688" id="h0-1688" class="i">+		term.line[y][x-1].u = &apos; &apos;;
</a><a href="#h0-1689" id="h0-1689" class="i">+		term.line[y][x-1].mode &amp;= ~ATTR_WIDE;
</a><a href="#h0-1690" id="h0-1690" class="i">+	}
</a><a href="#h0-1691" id="h0-1691" class="i">+
</a><a href="#h0-1692" id="h0-1692" class="i">+	term.dirty[y] = 1;
</a><a href="#h0-1693" id="h0-1693" class="i">+	term.line[y][x] = *attr;
</a><a href="#h0-1694" id="h0-1694" class="i">+	term.line[y][x].u = u;
</a><a href="#h0-1695" id="h0-1695" class="i">+}
</a><a href="#h0-1696" id="h0-1696" class="i">+
</a><a href="#h0-1697" id="h0-1697" class="i">+void
</a><a href="#h0-1698" id="h0-1698" class="i">+tclearregion(int x1, int y1, int x2, int y2) {
</a><a href="#h0-1699" id="h0-1699" class="i">+	int x, y, temp;
</a><a href="#h0-1700" id="h0-1700" class="i">+	Glyph *gp;
</a><a href="#h0-1701" id="h0-1701" class="i">+
</a><a href="#h0-1702" id="h0-1702" class="i">+	if(x1 &gt; x2)
</a><a href="#h0-1703" id="h0-1703" class="i">+		temp = x1, x1 = x2, x2 = temp;
</a><a href="#h0-1704" id="h0-1704" class="i">+	if(y1 &gt; y2)
</a><a href="#h0-1705" id="h0-1705" class="i">+		temp = y1, y1 = y2, y2 = temp;
</a><a href="#h0-1706" id="h0-1706" class="i">+
</a><a href="#h0-1707" id="h0-1707" class="i">+	LIMIT(x1, 0, term.col-1);
</a><a href="#h0-1708" id="h0-1708" class="i">+	LIMIT(x2, 0, term.col-1);
</a><a href="#h0-1709" id="h0-1709" class="i">+	LIMIT(y1, 0, term.row-1);
</a><a href="#h0-1710" id="h0-1710" class="i">+	LIMIT(y2, 0, term.row-1);
</a><a href="#h0-1711" id="h0-1711" class="i">+
</a><a href="#h0-1712" id="h0-1712" class="i">+	for(y = y1; y &lt;= y2; y++) {
</a><a href="#h0-1713" id="h0-1713" class="i">+		term.dirty[y] = 1;
</a><a href="#h0-1714" id="h0-1714" class="i">+		for(x = x1; x &lt;= x2; x++) {
</a><a href="#h0-1715" id="h0-1715" class="i">+			gp = &amp;term.line[y][x];
</a><a href="#h0-1716" id="h0-1716" class="i">+			if(selected(x, y))
</a><a href="#h0-1717" id="h0-1717" class="i">+				selclear(NULL);
</a><a href="#h0-1718" id="h0-1718" class="i">+			gp-&gt;fg = term.c.attr.fg;
</a><a href="#h0-1719" id="h0-1719" class="i">+			gp-&gt;bg = term.c.attr.bg;
</a><a href="#h0-1720" id="h0-1720" class="i">+			gp-&gt;mode = 0;
</a><a href="#h0-1721" id="h0-1721" class="i">+			gp-&gt;u = &apos; &apos;;
</a><a href="#h0-1722" id="h0-1722" class="i">+		}
</a><a href="#h0-1723" id="h0-1723" class="i">+	}
</a><a href="#h0-1724" id="h0-1724" class="i">+}
</a><a href="#h0-1725" id="h0-1725" class="i">+
</a><a href="#h0-1726" id="h0-1726" class="i">+void
</a><a href="#h0-1727" id="h0-1727" class="i">+tdeletechar(int n) {
</a><a href="#h0-1728" id="h0-1728" class="i">+	int dst, src, size;
</a><a href="#h0-1729" id="h0-1729" class="i">+	Glyph *line;
</a><a href="#h0-1730" id="h0-1730" class="i">+
</a><a href="#h0-1731" id="h0-1731" class="i">+	LIMIT(n, 0, term.col - term.c.x);
</a><a href="#h0-1732" id="h0-1732" class="i">+
</a><a href="#h0-1733" id="h0-1733" class="i">+	dst = term.c.x;
</a><a href="#h0-1734" id="h0-1734" class="i">+	src = term.c.x + n;
</a><a href="#h0-1735" id="h0-1735" class="i">+	size = term.col - src;
</a><a href="#h0-1736" id="h0-1736" class="i">+	line = term.line[term.c.y];
</a><a href="#h0-1737" id="h0-1737" class="i">+
</a><a href="#h0-1738" id="h0-1738" class="i">+	memmove(&amp;line[dst], &amp;line[src], size * sizeof(Glyph));
</a><a href="#h0-1739" id="h0-1739" class="i">+	tclearregion(term.col-n, term.c.y, term.col-1, term.c.y);
</a><a href="#h0-1740" id="h0-1740" class="i">+}
</a><a href="#h0-1741" id="h0-1741" class="i">+
</a><a href="#h0-1742" id="h0-1742" class="i">+void
</a><a href="#h0-1743" id="h0-1743" class="i">+tinsertblank(int n) {
</a><a href="#h0-1744" id="h0-1744" class="i">+	int dst, src, size;
</a><a href="#h0-1745" id="h0-1745" class="i">+	Glyph *line;
</a><a href="#h0-1746" id="h0-1746" class="i">+
</a><a href="#h0-1747" id="h0-1747" class="i">+	LIMIT(n, 0, term.col - term.c.x);
</a><a href="#h0-1748" id="h0-1748" class="i">+
</a><a href="#h0-1749" id="h0-1749" class="i">+	dst = term.c.x + n;
</a><a href="#h0-1750" id="h0-1750" class="i">+	src = term.c.x;
</a><a href="#h0-1751" id="h0-1751" class="i">+	size = term.col - dst;
</a><a href="#h0-1752" id="h0-1752" class="i">+	line = term.line[term.c.y];
</a><a href="#h0-1753" id="h0-1753" class="i">+
</a><a href="#h0-1754" id="h0-1754" class="i">+	memmove(&amp;line[dst], &amp;line[src], size * sizeof(Glyph));
</a><a href="#h0-1755" id="h0-1755" class="i">+	tclearregion(src, term.c.y, dst - 1, term.c.y);
</a><a href="#h0-1756" id="h0-1756" class="i">+}
</a><a href="#h0-1757" id="h0-1757" class="i">+
</a><a href="#h0-1758" id="h0-1758" class="i">+void
</a><a href="#h0-1759" id="h0-1759" class="i">+tinsertblankline(int n) {
</a><a href="#h0-1760" id="h0-1760" class="i">+	if(BETWEEN(term.c.y, term.top, term.bot))
</a><a href="#h0-1761" id="h0-1761" class="i">+		tscrolldown(term.c.y, n);
</a><a href="#h0-1762" id="h0-1762" class="i">+}
</a><a href="#h0-1763" id="h0-1763" class="i">+
</a><a href="#h0-1764" id="h0-1764" class="i">+void
</a><a href="#h0-1765" id="h0-1765" class="i">+tdeleteline(int n) {
</a><a href="#h0-1766" id="h0-1766" class="i">+	if(BETWEEN(term.c.y, term.top, term.bot))
</a><a href="#h0-1767" id="h0-1767" class="i">+		tscrollup(term.c.y, n);
</a><a href="#h0-1768" id="h0-1768" class="i">+}
</a><a href="#h0-1769" id="h0-1769" class="i">+
</a><a href="#h0-1770" id="h0-1770" class="i">+int32_t
</a><a href="#h0-1771" id="h0-1771" class="i">+tdefcolor(int *attr, int *npar, int l) {
</a><a href="#h0-1772" id="h0-1772" class="i">+	int32_t idx = -1;
</a><a href="#h0-1773" id="h0-1773" class="i">+	uint r, g, b;
</a><a href="#h0-1774" id="h0-1774" class="i">+
</a><a href="#h0-1775" id="h0-1775" class="i">+	switch (attr[*npar + 1]) {
</a><a href="#h0-1776" id="h0-1776" class="i">+	case 2: /* direct color in RGB space */
</a><a href="#h0-1777" id="h0-1777" class="i">+		if (*npar + 4 &gt;= l) {
</a><a href="#h0-1778" id="h0-1778" class="i">+			fprintf(stderr,
</a><a href="#h0-1779" id="h0-1779" class="i">+				&quot;erresc(38): Incorrect number of parameters (%d)\n&quot;,
</a><a href="#h0-1780" id="h0-1780" class="i">+				*npar);
</a><a href="#h0-1781" id="h0-1781" class="i">+			break;
</a><a href="#h0-1782" id="h0-1782" class="i">+		}
</a><a href="#h0-1783" id="h0-1783" class="i">+		r = attr[*npar + 2];
</a><a href="#h0-1784" id="h0-1784" class="i">+		g = attr[*npar + 3];
</a><a href="#h0-1785" id="h0-1785" class="i">+		b = attr[*npar + 4];
</a><a href="#h0-1786" id="h0-1786" class="i">+		*npar += 4;
</a><a href="#h0-1787" id="h0-1787" class="i">+		if(!BETWEEN(r, 0, 255) || !BETWEEN(g, 0, 255) || !BETWEEN(b, 0, 255))
</a><a href="#h0-1788" id="h0-1788" class="i">+			fprintf(stderr, &quot;erresc: bad rgb color (%u,%u,%u)\n&quot;,
</a><a href="#h0-1789" id="h0-1789" class="i">+				r, g, b);
</a><a href="#h0-1790" id="h0-1790" class="i">+		else
</a><a href="#h0-1791" id="h0-1791" class="i">+			idx = TRUECOLOR(r, g, b);
</a><a href="#h0-1792" id="h0-1792" class="i">+		break;
</a><a href="#h0-1793" id="h0-1793" class="i">+	case 5: /* indexed color */
</a><a href="#h0-1794" id="h0-1794" class="i">+		if (*npar + 2 &gt;= l) {
</a><a href="#h0-1795" id="h0-1795" class="i">+			fprintf(stderr,
</a><a href="#h0-1796" id="h0-1796" class="i">+				&quot;erresc(38): Incorrect number of parameters (%d)\n&quot;,
</a><a href="#h0-1797" id="h0-1797" class="i">+				*npar);
</a><a href="#h0-1798" id="h0-1798" class="i">+			break;
</a><a href="#h0-1799" id="h0-1799" class="i">+		}
</a><a href="#h0-1800" id="h0-1800" class="i">+		*npar += 2;
</a><a href="#h0-1801" id="h0-1801" class="i">+		if(!BETWEEN(attr[*npar], 0, 255))
</a><a href="#h0-1802" id="h0-1802" class="i">+			fprintf(stderr, &quot;erresc: bad fgcolor %d\n&quot;, attr[*npar]);
</a><a href="#h0-1803" id="h0-1803" class="i">+		else
</a><a href="#h0-1804" id="h0-1804" class="i">+			idx = attr[*npar];
</a><a href="#h0-1805" id="h0-1805" class="i">+		break;
</a><a href="#h0-1806" id="h0-1806" class="i">+	case 0: /* implemented defined (only foreground) */
</a><a href="#h0-1807" id="h0-1807" class="i">+	case 1: /* transparent */
</a><a href="#h0-1808" id="h0-1808" class="i">+	case 3: /* direct color in CMY space */
</a><a href="#h0-1809" id="h0-1809" class="i">+	case 4: /* direct color in CMYK space */
</a><a href="#h0-1810" id="h0-1810" class="i">+	default:
</a><a href="#h0-1811" id="h0-1811" class="i">+		fprintf(stderr,
</a><a href="#h0-1812" id="h0-1812" class="i">+		        &quot;erresc(38): gfx attr %d unknown\n&quot;, attr[*npar]);
</a><a href="#h0-1813" id="h0-1813" class="i">+		break;
</a><a href="#h0-1814" id="h0-1814" class="i">+	}
</a><a href="#h0-1815" id="h0-1815" class="i">+
</a><a href="#h0-1816" id="h0-1816" class="i">+	return idx;
</a><a href="#h0-1817" id="h0-1817" class="i">+}
</a><a href="#h0-1818" id="h0-1818" class="i">+
</a><a href="#h0-1819" id="h0-1819" class="i">+void
</a><a href="#h0-1820" id="h0-1820" class="i">+tsetattr(int *attr, int l) {
</a><a href="#h0-1821" id="h0-1821" class="i">+	int i;
</a><a href="#h0-1822" id="h0-1822" class="i">+	int32_t idx;
</a><a href="#h0-1823" id="h0-1823" class="i">+
</a><a href="#h0-1824" id="h0-1824" class="i">+	for(i = 0; i &lt; l; i++) {
</a><a href="#h0-1825" id="h0-1825" class="i">+		switch(attr[i]) {
</a><a href="#h0-1826" id="h0-1826" class="i">+		case 0:
</a><a href="#h0-1827" id="h0-1827" class="i">+			term.c.attr.mode &amp;= ~(
</a><a href="#h0-1828" id="h0-1828" class="i">+				ATTR_BOLD       |
</a><a href="#h0-1829" id="h0-1829" class="i">+				ATTR_FAINT      |
</a><a href="#h0-1830" id="h0-1830" class="i">+				ATTR_ITALIC     |
</a><a href="#h0-1831" id="h0-1831" class="i">+				ATTR_UNDERLINE  |
</a><a href="#h0-1832" id="h0-1832" class="i">+				ATTR_BLINK      |
</a><a href="#h0-1833" id="h0-1833" class="i">+				ATTR_REVERSE    |
</a><a href="#h0-1834" id="h0-1834" class="i">+				ATTR_INVISIBLE  |
</a><a href="#h0-1835" id="h0-1835" class="i">+				ATTR_STRUCK     );
</a><a href="#h0-1836" id="h0-1836" class="i">+			term.c.attr.fg = defaultfg;
</a><a href="#h0-1837" id="h0-1837" class="i">+			term.c.attr.bg = defaultbg;
</a><a href="#h0-1838" id="h0-1838" class="i">+			break;
</a><a href="#h0-1839" id="h0-1839" class="i">+		case 1:
</a><a href="#h0-1840" id="h0-1840" class="i">+			term.c.attr.mode |= ATTR_BOLD;
</a><a href="#h0-1841" id="h0-1841" class="i">+			break;
</a><a href="#h0-1842" id="h0-1842" class="i">+		case 2:
</a><a href="#h0-1843" id="h0-1843" class="i">+			term.c.attr.mode |= ATTR_FAINT;
</a><a href="#h0-1844" id="h0-1844" class="i">+			break;
</a><a href="#h0-1845" id="h0-1845" class="i">+		case 3:
</a><a href="#h0-1846" id="h0-1846" class="i">+			term.c.attr.mode |= ATTR_ITALIC;
</a><a href="#h0-1847" id="h0-1847" class="i">+			break;
</a><a href="#h0-1848" id="h0-1848" class="i">+		case 4:
</a><a href="#h0-1849" id="h0-1849" class="i">+			term.c.attr.mode |= ATTR_UNDERLINE;
</a><a href="#h0-1850" id="h0-1850" class="i">+			break;
</a><a href="#h0-1851" id="h0-1851" class="i">+		case 5: /* slow blink */
</a><a href="#h0-1852" id="h0-1852" class="i">+			/* FALLTHROUGH */
</a><a href="#h0-1853" id="h0-1853" class="i">+		case 6: /* rapid blink */
</a><a href="#h0-1854" id="h0-1854" class="i">+			term.c.attr.mode |= ATTR_BLINK;
</a><a href="#h0-1855" id="h0-1855" class="i">+			break;
</a><a href="#h0-1856" id="h0-1856" class="i">+		case 7:
</a><a href="#h0-1857" id="h0-1857" class="i">+			term.c.attr.mode |= ATTR_REVERSE;
</a><a href="#h0-1858" id="h0-1858" class="i">+			break;
</a><a href="#h0-1859" id="h0-1859" class="i">+		case 8:
</a><a href="#h0-1860" id="h0-1860" class="i">+			term.c.attr.mode |= ATTR_INVISIBLE;
</a><a href="#h0-1861" id="h0-1861" class="i">+			break;
</a><a href="#h0-1862" id="h0-1862" class="i">+		case 9:
</a><a href="#h0-1863" id="h0-1863" class="i">+			term.c.attr.mode |= ATTR_STRUCK;
</a><a href="#h0-1864" id="h0-1864" class="i">+			break;
</a><a href="#h0-1865" id="h0-1865" class="i">+		case 22:
</a><a href="#h0-1866" id="h0-1866" class="i">+			term.c.attr.mode &amp;= ~(ATTR_BOLD | ATTR_FAINT);
</a><a href="#h0-1867" id="h0-1867" class="i">+			break;
</a><a href="#h0-1868" id="h0-1868" class="i">+		case 23:
</a><a href="#h0-1869" id="h0-1869" class="i">+			term.c.attr.mode &amp;= ~ATTR_ITALIC;
</a><a href="#h0-1870" id="h0-1870" class="i">+			break;
</a><a href="#h0-1871" id="h0-1871" class="i">+		case 24:
</a><a href="#h0-1872" id="h0-1872" class="i">+			term.c.attr.mode &amp;= ~ATTR_UNDERLINE;
</a><a href="#h0-1873" id="h0-1873" class="i">+			break;
</a><a href="#h0-1874" id="h0-1874" class="i">+		case 25:
</a><a href="#h0-1875" id="h0-1875" class="i">+			term.c.attr.mode &amp;= ~ATTR_BLINK;
</a><a href="#h0-1876" id="h0-1876" class="i">+			break;
</a><a href="#h0-1877" id="h0-1877" class="i">+		case 27:
</a><a href="#h0-1878" id="h0-1878" class="i">+			term.c.attr.mode &amp;= ~ATTR_REVERSE;
</a><a href="#h0-1879" id="h0-1879" class="i">+			break;
</a><a href="#h0-1880" id="h0-1880" class="i">+		case 28:
</a><a href="#h0-1881" id="h0-1881" class="i">+			term.c.attr.mode &amp;= ~ATTR_INVISIBLE;
</a><a href="#h0-1882" id="h0-1882" class="i">+			break;
</a><a href="#h0-1883" id="h0-1883" class="i">+		case 29:
</a><a href="#h0-1884" id="h0-1884" class="i">+			term.c.attr.mode &amp;= ~ATTR_STRUCK;
</a><a href="#h0-1885" id="h0-1885" class="i">+			break;
</a><a href="#h0-1886" id="h0-1886" class="i">+		case 38:
</a><a href="#h0-1887" id="h0-1887" class="i">+			if ((idx = tdefcolor(attr, &amp;i, l)) &gt;= 0)
</a><a href="#h0-1888" id="h0-1888" class="i">+				term.c.attr.fg = idx;
</a><a href="#h0-1889" id="h0-1889" class="i">+			break;
</a><a href="#h0-1890" id="h0-1890" class="i">+		case 39:
</a><a href="#h0-1891" id="h0-1891" class="i">+			term.c.attr.fg = defaultfg;
</a><a href="#h0-1892" id="h0-1892" class="i">+			break;
</a><a href="#h0-1893" id="h0-1893" class="i">+		case 48:
</a><a href="#h0-1894" id="h0-1894" class="i">+			if ((idx = tdefcolor(attr, &amp;i, l)) &gt;= 0)
</a><a href="#h0-1895" id="h0-1895" class="i">+				term.c.attr.bg = idx;
</a><a href="#h0-1896" id="h0-1896" class="i">+			break;
</a><a href="#h0-1897" id="h0-1897" class="i">+		case 49:
</a><a href="#h0-1898" id="h0-1898" class="i">+			term.c.attr.bg = defaultbg;
</a><a href="#h0-1899" id="h0-1899" class="i">+			break;
</a><a href="#h0-1900" id="h0-1900" class="i">+		default:
</a><a href="#h0-1901" id="h0-1901" class="i">+			if(BETWEEN(attr[i], 30, 37)) {
</a><a href="#h0-1902" id="h0-1902" class="i">+				term.c.attr.fg = attr[i] - 30;
</a><a href="#h0-1903" id="h0-1903" class="i">+			} else if(BETWEEN(attr[i], 40, 47)) {
</a><a href="#h0-1904" id="h0-1904" class="i">+				term.c.attr.bg = attr[i] - 40;
</a><a href="#h0-1905" id="h0-1905" class="i">+			} else if(BETWEEN(attr[i], 90, 97)) {
</a><a href="#h0-1906" id="h0-1906" class="i">+				term.c.attr.fg = attr[i] - 90 + 8;
</a><a href="#h0-1907" id="h0-1907" class="i">+			} else if(BETWEEN(attr[i], 100, 107)) {
</a><a href="#h0-1908" id="h0-1908" class="i">+				term.c.attr.bg = attr[i] - 100 + 8;
</a><a href="#h0-1909" id="h0-1909" class="i">+			} else {
</a><a href="#h0-1910" id="h0-1910" class="i">+				fprintf(stderr,
</a><a href="#h0-1911" id="h0-1911" class="i">+					&quot;erresc(default): gfx attr %d unknown\n&quot;,
</a><a href="#h0-1912" id="h0-1912" class="i">+					attr[i]), csidump();
</a><a href="#h0-1913" id="h0-1913" class="i">+			}
</a><a href="#h0-1914" id="h0-1914" class="i">+			break;
</a><a href="#h0-1915" id="h0-1915" class="i">+		}
</a><a href="#h0-1916" id="h0-1916" class="i">+	}
</a><a href="#h0-1917" id="h0-1917" class="i">+}
</a><a href="#h0-1918" id="h0-1918" class="i">+
</a><a href="#h0-1919" id="h0-1919" class="i">+void
</a><a href="#h0-1920" id="h0-1920" class="i">+tsetscroll(int t, int b) {
</a><a href="#h0-1921" id="h0-1921" class="i">+	int temp;
</a><a href="#h0-1922" id="h0-1922" class="i">+
</a><a href="#h0-1923" id="h0-1923" class="i">+	LIMIT(t, 0, term.row-1);
</a><a href="#h0-1924" id="h0-1924" class="i">+	LIMIT(b, 0, term.row-1);
</a><a href="#h0-1925" id="h0-1925" class="i">+	if(t &gt; b) {
</a><a href="#h0-1926" id="h0-1926" class="i">+		temp = t;
</a><a href="#h0-1927" id="h0-1927" class="i">+		t = b;
</a><a href="#h0-1928" id="h0-1928" class="i">+		b = temp;
</a><a href="#h0-1929" id="h0-1929" class="i">+	}
</a><a href="#h0-1930" id="h0-1930" class="i">+	term.top = t;
</a><a href="#h0-1931" id="h0-1931" class="i">+	term.bot = b;
</a><a href="#h0-1932" id="h0-1932" class="i">+}
</a><a href="#h0-1933" id="h0-1933" class="i">+
</a><a href="#h0-1934" id="h0-1934" class="i">+void
</a><a href="#h0-1935" id="h0-1935" class="i">+tsetmode(bool priv, bool set, int *args, int narg) {
</a><a href="#h0-1936" id="h0-1936" class="i">+	int *lim, mode;
</a><a href="#h0-1937" id="h0-1937" class="i">+	bool alt;
</a><a href="#h0-1938" id="h0-1938" class="i">+
</a><a href="#h0-1939" id="h0-1939" class="i">+	for(lim = args + narg; args &lt; lim; ++args) {
</a><a href="#h0-1940" id="h0-1940" class="i">+		if(priv) {
</a><a href="#h0-1941" id="h0-1941" class="i">+			switch(*args) {
</a><a href="#h0-1942" id="h0-1942" class="i">+			case 1: /* DECCKM -- Cursor key */
</a><a href="#h0-1943" id="h0-1943" class="i">+				MODBIT(term.mode, set, MODE_APPCURSOR);
</a><a href="#h0-1944" id="h0-1944" class="i">+				break;
</a><a href="#h0-1945" id="h0-1945" class="i">+			case 5: /* DECSCNM -- Reverse video */
</a><a href="#h0-1946" id="h0-1946" class="i">+				mode = term.mode;
</a><a href="#h0-1947" id="h0-1947" class="i">+				MODBIT(term.mode, set, MODE_REVERSE);
</a><a href="#h0-1948" id="h0-1948" class="i">+				if(mode != term.mode)
</a><a href="#h0-1949" id="h0-1949" class="i">+					redraw();
</a><a href="#h0-1950" id="h0-1950" class="i">+				break;
</a><a href="#h0-1951" id="h0-1951" class="i">+			case 6: /* DECOM -- Origin */
</a><a href="#h0-1952" id="h0-1952" class="i">+				MODBIT(term.c.state, set, CURSOR_ORIGIN);
</a><a href="#h0-1953" id="h0-1953" class="i">+				tmoveato(0, 0);
</a><a href="#h0-1954" id="h0-1954" class="i">+				break;
</a><a href="#h0-1955" id="h0-1955" class="i">+			case 7: /* DECAWM -- Auto wrap */
</a><a href="#h0-1956" id="h0-1956" class="i">+				MODBIT(term.mode, set, MODE_WRAP);
</a><a href="#h0-1957" id="h0-1957" class="i">+				break;
</a><a href="#h0-1958" id="h0-1958" class="i">+			case 0:  /* Error (IGNORED) */
</a><a href="#h0-1959" id="h0-1959" class="i">+			case 2:  /* DECANM -- ANSI/VT52 (IGNORED) */
</a><a href="#h0-1960" id="h0-1960" class="i">+			case 3:  /* DECCOLM -- Column  (IGNORED) */
</a><a href="#h0-1961" id="h0-1961" class="i">+			case 4:  /* DECSCLM -- Scroll (IGNORED) */
</a><a href="#h0-1962" id="h0-1962" class="i">+			case 8:  /* DECARM -- Auto repeat (IGNORED) */
</a><a href="#h0-1963" id="h0-1963" class="i">+			case 18: /* DECPFF -- Printer feed (IGNORED) */
</a><a href="#h0-1964" id="h0-1964" class="i">+			case 19: /* DECPEX -- Printer extent (IGNORED) */
</a><a href="#h0-1965" id="h0-1965" class="i">+			case 42: /* DECNRCM -- National characters (IGNORED) */
</a><a href="#h0-1966" id="h0-1966" class="i">+			case 12: /* att610 -- Start blinking cursor (IGNORED) */
</a><a href="#h0-1967" id="h0-1967" class="i">+				break;
</a><a href="#h0-1968" id="h0-1968" class="i">+			case 25: /* DECTCEM -- Text Cursor Enable Mode */
</a><a href="#h0-1969" id="h0-1969" class="i">+				MODBIT(term.mode, !set, MODE_HIDE);
</a><a href="#h0-1970" id="h0-1970" class="i">+				break;
</a><a href="#h0-1971" id="h0-1971" class="i">+			case 9:    /* X10 mouse compatibility mode */
</a><a href="#h0-1972" id="h0-1972" class="i">+				xsetpointermotion(0);
</a><a href="#h0-1973" id="h0-1973" class="i">+				MODBIT(term.mode, 0, MODE_MOUSE);
</a><a href="#h0-1974" id="h0-1974" class="i">+				MODBIT(term.mode, set, MODE_MOUSEX10);
</a><a href="#h0-1975" id="h0-1975" class="i">+				break;
</a><a href="#h0-1976" id="h0-1976" class="i">+			case 1000: /* 1000: report button press */
</a><a href="#h0-1977" id="h0-1977" class="i">+				xsetpointermotion(0);
</a><a href="#h0-1978" id="h0-1978" class="i">+				MODBIT(term.mode, 0, MODE_MOUSE);
</a><a href="#h0-1979" id="h0-1979" class="i">+				MODBIT(term.mode, set, MODE_MOUSEBTN);
</a><a href="#h0-1980" id="h0-1980" class="i">+				break;
</a><a href="#h0-1981" id="h0-1981" class="i">+			case 1002: /* 1002: report motion on button press */
</a><a href="#h0-1982" id="h0-1982" class="i">+				xsetpointermotion(0);
</a><a href="#h0-1983" id="h0-1983" class="i">+				MODBIT(term.mode, 0, MODE_MOUSE);
</a><a href="#h0-1984" id="h0-1984" class="i">+				MODBIT(term.mode, set, MODE_MOUSEMOTION);
</a><a href="#h0-1985" id="h0-1985" class="i">+				break;
</a><a href="#h0-1986" id="h0-1986" class="i">+			case 1003: /* 1003: enable all mouse motions */
</a><a href="#h0-1987" id="h0-1987" class="i">+				xsetpointermotion(set);
</a><a href="#h0-1988" id="h0-1988" class="i">+				MODBIT(term.mode, 0, MODE_MOUSE);
</a><a href="#h0-1989" id="h0-1989" class="i">+				MODBIT(term.mode, set, MODE_MOUSEMANY);
</a><a href="#h0-1990" id="h0-1990" class="i">+				break;
</a><a href="#h0-1991" id="h0-1991" class="i">+			case 1004: /* 1004: send focus events to tty */
</a><a href="#h0-1992" id="h0-1992" class="i">+				MODBIT(term.mode, set, MODE_FOCUS);
</a><a href="#h0-1993" id="h0-1993" class="i">+				break;
</a><a href="#h0-1994" id="h0-1994" class="i">+			case 1006: /* 1006: extended reporting mode */
</a><a href="#h0-1995" id="h0-1995" class="i">+				MODBIT(term.mode, set, MODE_MOUSESGR);
</a><a href="#h0-1996" id="h0-1996" class="i">+				break;
</a><a href="#h0-1997" id="h0-1997" class="i">+			case 1034:
</a><a href="#h0-1998" id="h0-1998" class="i">+				MODBIT(term.mode, set, MODE_8BIT);
</a><a href="#h0-1999" id="h0-1999" class="i">+				break;
</a><a href="#h0-2000" id="h0-2000" class="i">+			case 1049: /* swap screen &amp; set/restore cursor as xterm */
</a><a href="#h0-2001" id="h0-2001" class="i">+				if (!allowaltscreen)
</a><a href="#h0-2002" id="h0-2002" class="i">+					break;
</a><a href="#h0-2003" id="h0-2003" class="i">+				tcursor((set) ? CURSOR_SAVE : CURSOR_LOAD);
</a><a href="#h0-2004" id="h0-2004" class="i">+				/* FALLTHROUGH */
</a><a href="#h0-2005" id="h0-2005" class="i">+			case 47: /* swap screen */
</a><a href="#h0-2006" id="h0-2006" class="i">+			case 1047:
</a><a href="#h0-2007" id="h0-2007" class="i">+				if (!allowaltscreen)
</a><a href="#h0-2008" id="h0-2008" class="i">+					break;
</a><a href="#h0-2009" id="h0-2009" class="i">+				alt = IS_SET(MODE_ALTSCREEN);
</a><a href="#h0-2010" id="h0-2010" class="i">+				if(alt) {
</a><a href="#h0-2011" id="h0-2011" class="i">+					tclearregion(0, 0, term.col-1,
</a><a href="#h0-2012" id="h0-2012" class="i">+							term.row-1);
</a><a href="#h0-2013" id="h0-2013" class="i">+				}
</a><a href="#h0-2014" id="h0-2014" class="i">+				if(set ^ alt) /* set is always 1 or 0 */
</a><a href="#h0-2015" id="h0-2015" class="i">+					tswapscreen();
</a><a href="#h0-2016" id="h0-2016" class="i">+				if(*args != 1049)
</a><a href="#h0-2017" id="h0-2017" class="i">+					break;
</a><a href="#h0-2018" id="h0-2018" class="i">+				/* FALLTHROUGH */
</a><a href="#h0-2019" id="h0-2019" class="i">+			case 1048:
</a><a href="#h0-2020" id="h0-2020" class="i">+				tcursor((set) ? CURSOR_SAVE : CURSOR_LOAD);
</a><a href="#h0-2021" id="h0-2021" class="i">+				break;
</a><a href="#h0-2022" id="h0-2022" class="i">+			case 2004: /* 2004: bracketed paste mode */
</a><a href="#h0-2023" id="h0-2023" class="i">+				MODBIT(term.mode, set, MODE_BRCKTPASTE);
</a><a href="#h0-2024" id="h0-2024" class="i">+				break;
</a><a href="#h0-2025" id="h0-2025" class="i">+			/* Not implemented mouse modes. See comments there. */
</a><a href="#h0-2026" id="h0-2026" class="i">+			case 1001: /* mouse highlight mode; can hang the
</a><a href="#h0-2027" id="h0-2027" class="i">+				      terminal by design when implemented. */
</a><a href="#h0-2028" id="h0-2028" class="i">+			case 1005: /* UTF-8 mouse mode; will confuse
</a><a href="#h0-2029" id="h0-2029" class="i">+				      applications not supporting UTF-8
</a><a href="#h0-2030" id="h0-2030" class="i">+				      and luit. */
</a><a href="#h0-2031" id="h0-2031" class="i">+			case 1015: /* urxvt mangled mouse mode; incompatible
</a><a href="#h0-2032" id="h0-2032" class="i">+				      and can be mistaken for other control
</a><a href="#h0-2033" id="h0-2033" class="i">+				      codes. */
</a><a href="#h0-2034" id="h0-2034" class="i">+			default:
</a><a href="#h0-2035" id="h0-2035" class="i">+				fprintf(stderr,
</a><a href="#h0-2036" id="h0-2036" class="i">+					&quot;erresc: unknown private set/reset mode %d\n&quot;,
</a><a href="#h0-2037" id="h0-2037" class="i">+					*args);
</a><a href="#h0-2038" id="h0-2038" class="i">+				break;
</a><a href="#h0-2039" id="h0-2039" class="i">+			}
</a><a href="#h0-2040" id="h0-2040" class="i">+		} else {
</a><a href="#h0-2041" id="h0-2041" class="i">+			switch(*args) {
</a><a href="#h0-2042" id="h0-2042" class="i">+			case 0:  /* Error (IGNORED) */
</a><a href="#h0-2043" id="h0-2043" class="i">+				break;
</a><a href="#h0-2044" id="h0-2044" class="i">+			case 2:  /* KAM -- keyboard action */
</a><a href="#h0-2045" id="h0-2045" class="i">+				MODBIT(term.mode, set, MODE_KBDLOCK);
</a><a href="#h0-2046" id="h0-2046" class="i">+				break;
</a><a href="#h0-2047" id="h0-2047" class="i">+			case 4:  /* IRM -- Insertion-replacement */
</a><a href="#h0-2048" id="h0-2048" class="i">+				MODBIT(term.mode, set, MODE_INSERT);
</a><a href="#h0-2049" id="h0-2049" class="i">+				break;
</a><a href="#h0-2050" id="h0-2050" class="i">+			case 12: /* SRM -- Send/Receive */
</a><a href="#h0-2051" id="h0-2051" class="i">+				MODBIT(term.mode, !set, MODE_ECHO);
</a><a href="#h0-2052" id="h0-2052" class="i">+				break;
</a><a href="#h0-2053" id="h0-2053" class="i">+			case 20: /* LNM -- Linefeed/new line */
</a><a href="#h0-2054" id="h0-2054" class="i">+				MODBIT(term.mode, set, MODE_CRLF);
</a><a href="#h0-2055" id="h0-2055" class="i">+				break;
</a><a href="#h0-2056" id="h0-2056" class="i">+			default:
</a><a href="#h0-2057" id="h0-2057" class="i">+				fprintf(stderr,
</a><a href="#h0-2058" id="h0-2058" class="i">+					&quot;erresc: unknown set/reset mode %d\n&quot;,
</a><a href="#h0-2059" id="h0-2059" class="i">+					*args);
</a><a href="#h0-2060" id="h0-2060" class="i">+				break;
</a><a href="#h0-2061" id="h0-2061" class="i">+			}
</a><a href="#h0-2062" id="h0-2062" class="i">+		}
</a><a href="#h0-2063" id="h0-2063" class="i">+	}
</a><a href="#h0-2064" id="h0-2064" class="i">+}
</a><a href="#h0-2065" id="h0-2065" class="i">+
</a><a href="#h0-2066" id="h0-2066" class="i">+void
</a><a href="#h0-2067" id="h0-2067" class="i">+csihandle(void) {
</a><a href="#h0-2068" id="h0-2068" class="i">+	char buf[40];
</a><a href="#h0-2069" id="h0-2069" class="i">+	int len;
</a><a href="#h0-2070" id="h0-2070" class="i">+
</a><a href="#h0-2071" id="h0-2071" class="i">+	switch(csiescseq.mode[0]) {
</a><a href="#h0-2072" id="h0-2072" class="i">+	default:
</a><a href="#h0-2073" id="h0-2073" class="i">+	unknown:
</a><a href="#h0-2074" id="h0-2074" class="i">+		fprintf(stderr, &quot;erresc: unknown csi &quot;);
</a><a href="#h0-2075" id="h0-2075" class="i">+		csidump();
</a><a href="#h0-2076" id="h0-2076" class="i">+		/* die(&quot;&quot;); */
</a><a href="#h0-2077" id="h0-2077" class="i">+		break;
</a><a href="#h0-2078" id="h0-2078" class="i">+	case &apos;@&apos;: /* ICH -- Insert &lt;n&gt; blank char */
</a><a href="#h0-2079" id="h0-2079" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2080" id="h0-2080" class="i">+		tinsertblank(csiescseq.arg[0]);
</a><a href="#h0-2081" id="h0-2081" class="i">+		break;
</a><a href="#h0-2082" id="h0-2082" class="i">+	case &apos;A&apos;: /* CUU -- Cursor &lt;n&gt; Up */
</a><a href="#h0-2083" id="h0-2083" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2084" id="h0-2084" class="i">+		tmoveto(term.c.x, term.c.y-csiescseq.arg[0]);
</a><a href="#h0-2085" id="h0-2085" class="i">+		break;
</a><a href="#h0-2086" id="h0-2086" class="i">+	case &apos;B&apos;: /* CUD -- Cursor &lt;n&gt; Down */
</a><a href="#h0-2087" id="h0-2087" class="i">+	case &apos;e&apos;: /* VPR --Cursor &lt;n&gt; Down */
</a><a href="#h0-2088" id="h0-2088" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2089" id="h0-2089" class="i">+		tmoveto(term.c.x, term.c.y+csiescseq.arg[0]);
</a><a href="#h0-2090" id="h0-2090" class="i">+		break;
</a><a href="#h0-2091" id="h0-2091" class="i">+	case &apos;i&apos;: /* MC -- Media Copy */
</a><a href="#h0-2092" id="h0-2092" class="i">+		switch(csiescseq.arg[0]) {
</a><a href="#h0-2093" id="h0-2093" class="i">+		case 0:
</a><a href="#h0-2094" id="h0-2094" class="i">+			tdump();
</a><a href="#h0-2095" id="h0-2095" class="i">+			break;
</a><a href="#h0-2096" id="h0-2096" class="i">+		case 1:
</a><a href="#h0-2097" id="h0-2097" class="i">+			tdumpline(term.c.y);
</a><a href="#h0-2098" id="h0-2098" class="i">+			break;
</a><a href="#h0-2099" id="h0-2099" class="i">+		case 2:
</a><a href="#h0-2100" id="h0-2100" class="i">+			tdumpsel();
</a><a href="#h0-2101" id="h0-2101" class="i">+			break;
</a><a href="#h0-2102" id="h0-2102" class="i">+		case 4:
</a><a href="#h0-2103" id="h0-2103" class="i">+			term.mode &amp;= ~MODE_PRINT;
</a><a href="#h0-2104" id="h0-2104" class="i">+			break;
</a><a href="#h0-2105" id="h0-2105" class="i">+		case 5:
</a><a href="#h0-2106" id="h0-2106" class="i">+			term.mode |= MODE_PRINT;
</a><a href="#h0-2107" id="h0-2107" class="i">+			break;
</a><a href="#h0-2108" id="h0-2108" class="i">+		}
</a><a href="#h0-2109" id="h0-2109" class="i">+		break;
</a><a href="#h0-2110" id="h0-2110" class="i">+	case &apos;c&apos;: /* DA -- Device Attributes */
</a><a href="#h0-2111" id="h0-2111" class="i">+		if(csiescseq.arg[0] == 0)
</a><a href="#h0-2112" id="h0-2112" class="i">+			ttywrite(vtiden, sizeof(vtiden) - 1);
</a><a href="#h0-2113" id="h0-2113" class="i">+		break;
</a><a href="#h0-2114" id="h0-2114" class="i">+	case &apos;C&apos;: /* CUF -- Cursor &lt;n&gt; Forward */
</a><a href="#h0-2115" id="h0-2115" class="i">+	case &apos;a&apos;: /* HPR -- Cursor &lt;n&gt; Forward */
</a><a href="#h0-2116" id="h0-2116" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2117" id="h0-2117" class="i">+		tmoveto(term.c.x+csiescseq.arg[0], term.c.y);
</a><a href="#h0-2118" id="h0-2118" class="i">+		break;
</a><a href="#h0-2119" id="h0-2119" class="i">+	case &apos;D&apos;: /* CUB -- Cursor &lt;n&gt; Backward */
</a><a href="#h0-2120" id="h0-2120" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2121" id="h0-2121" class="i">+		tmoveto(term.c.x-csiescseq.arg[0], term.c.y);
</a><a href="#h0-2122" id="h0-2122" class="i">+		break;
</a><a href="#h0-2123" id="h0-2123" class="i">+	case &apos;E&apos;: /* CNL -- Cursor &lt;n&gt; Down and first col */
</a><a href="#h0-2124" id="h0-2124" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2125" id="h0-2125" class="i">+		tmoveto(0, term.c.y+csiescseq.arg[0]);
</a><a href="#h0-2126" id="h0-2126" class="i">+		break;
</a><a href="#h0-2127" id="h0-2127" class="i">+	case &apos;F&apos;: /* CPL -- Cursor &lt;n&gt; Up and first col */
</a><a href="#h0-2128" id="h0-2128" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2129" id="h0-2129" class="i">+		tmoveto(0, term.c.y-csiescseq.arg[0]);
</a><a href="#h0-2130" id="h0-2130" class="i">+		break;
</a><a href="#h0-2131" id="h0-2131" class="i">+	case &apos;g&apos;: /* TBC -- Tabulation clear */
</a><a href="#h0-2132" id="h0-2132" class="i">+		switch(csiescseq.arg[0]) {
</a><a href="#h0-2133" id="h0-2133" class="i">+		case 0: /* clear current tab stop */
</a><a href="#h0-2134" id="h0-2134" class="i">+			term.tabs[term.c.x] = 0;
</a><a href="#h0-2135" id="h0-2135" class="i">+			break;
</a><a href="#h0-2136" id="h0-2136" class="i">+		case 3: /* clear all the tabs */
</a><a href="#h0-2137" id="h0-2137" class="i">+			memset(term.tabs, 0, term.col * sizeof(*term.tabs));
</a><a href="#h0-2138" id="h0-2138" class="i">+			break;
</a><a href="#h0-2139" id="h0-2139" class="i">+		default:
</a><a href="#h0-2140" id="h0-2140" class="i">+			goto unknown;
</a><a href="#h0-2141" id="h0-2141" class="i">+		}
</a><a href="#h0-2142" id="h0-2142" class="i">+		break;
</a><a href="#h0-2143" id="h0-2143" class="i">+	case &apos;G&apos;: /* CHA -- Move to &lt;col&gt; */
</a><a href="#h0-2144" id="h0-2144" class="i">+	case &apos;`&apos;: /* HPA */
</a><a href="#h0-2145" id="h0-2145" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2146" id="h0-2146" class="i">+		tmoveto(csiescseq.arg[0]-1, term.c.y);
</a><a href="#h0-2147" id="h0-2147" class="i">+		break;
</a><a href="#h0-2148" id="h0-2148" class="i">+	case &apos;H&apos;: /* CUP -- Move to &lt;row&gt; &lt;col&gt; */
</a><a href="#h0-2149" id="h0-2149" class="i">+	case &apos;f&apos;: /* HVP */
</a><a href="#h0-2150" id="h0-2150" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2151" id="h0-2151" class="i">+		DEFAULT(csiescseq.arg[1], 1);
</a><a href="#h0-2152" id="h0-2152" class="i">+		tmoveato(csiescseq.arg[1]-1, csiescseq.arg[0]-1);
</a><a href="#h0-2153" id="h0-2153" class="i">+		break;
</a><a href="#h0-2154" id="h0-2154" class="i">+	case &apos;I&apos;: /* CHT -- Cursor Forward Tabulation &lt;n&gt; tab stops */
</a><a href="#h0-2155" id="h0-2155" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2156" id="h0-2156" class="i">+		tputtab(csiescseq.arg[0]);
</a><a href="#h0-2157" id="h0-2157" class="i">+		break;
</a><a href="#h0-2158" id="h0-2158" class="i">+	case &apos;J&apos;: /* ED -- Clear screen */
</a><a href="#h0-2159" id="h0-2159" class="i">+		selclear(NULL);
</a><a href="#h0-2160" id="h0-2160" class="i">+		switch(csiescseq.arg[0]) {
</a><a href="#h0-2161" id="h0-2161" class="i">+		case 0: /* below */
</a><a href="#h0-2162" id="h0-2162" class="i">+			tclearregion(term.c.x, term.c.y, term.col-1, term.c.y);
</a><a href="#h0-2163" id="h0-2163" class="i">+			if(term.c.y &lt; term.row-1) {
</a><a href="#h0-2164" id="h0-2164" class="i">+				tclearregion(0, term.c.y+1, term.col-1,
</a><a href="#h0-2165" id="h0-2165" class="i">+						term.row-1);
</a><a href="#h0-2166" id="h0-2166" class="i">+			}
</a><a href="#h0-2167" id="h0-2167" class="i">+			break;
</a><a href="#h0-2168" id="h0-2168" class="i">+		case 1: /* above */
</a><a href="#h0-2169" id="h0-2169" class="i">+			if(term.c.y &gt; 1)
</a><a href="#h0-2170" id="h0-2170" class="i">+				tclearregion(0, 0, term.col-1, term.c.y-1);
</a><a href="#h0-2171" id="h0-2171" class="i">+			tclearregion(0, term.c.y, term.c.x, term.c.y);
</a><a href="#h0-2172" id="h0-2172" class="i">+			break;
</a><a href="#h0-2173" id="h0-2173" class="i">+		case 2: /* all */
</a><a href="#h0-2174" id="h0-2174" class="i">+			tclearregion(0, 0, term.col-1, term.row-1);
</a><a href="#h0-2175" id="h0-2175" class="i">+			break;
</a><a href="#h0-2176" id="h0-2176" class="i">+		default:
</a><a href="#h0-2177" id="h0-2177" class="i">+			goto unknown;
</a><a href="#h0-2178" id="h0-2178" class="i">+		}
</a><a href="#h0-2179" id="h0-2179" class="i">+		break;
</a><a href="#h0-2180" id="h0-2180" class="i">+	case &apos;K&apos;: /* EL -- Clear line */
</a><a href="#h0-2181" id="h0-2181" class="i">+		switch(csiescseq.arg[0]) {
</a><a href="#h0-2182" id="h0-2182" class="i">+		case 0: /* right */
</a><a href="#h0-2183" id="h0-2183" class="i">+			tclearregion(term.c.x, term.c.y, term.col-1,
</a><a href="#h0-2184" id="h0-2184" class="i">+					term.c.y);
</a><a href="#h0-2185" id="h0-2185" class="i">+			break;
</a><a href="#h0-2186" id="h0-2186" class="i">+		case 1: /* left */
</a><a href="#h0-2187" id="h0-2187" class="i">+			tclearregion(0, term.c.y, term.c.x, term.c.y);
</a><a href="#h0-2188" id="h0-2188" class="i">+			break;
</a><a href="#h0-2189" id="h0-2189" class="i">+		case 2: /* all */
</a><a href="#h0-2190" id="h0-2190" class="i">+			tclearregion(0, term.c.y, term.col-1, term.c.y);
</a><a href="#h0-2191" id="h0-2191" class="i">+			break;
</a><a href="#h0-2192" id="h0-2192" class="i">+		}
</a><a href="#h0-2193" id="h0-2193" class="i">+		break;
</a><a href="#h0-2194" id="h0-2194" class="i">+	case &apos;S&apos;: /* SU -- Scroll &lt;n&gt; line up */
</a><a href="#h0-2195" id="h0-2195" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2196" id="h0-2196" class="i">+		tscrollup(term.top, csiescseq.arg[0]);
</a><a href="#h0-2197" id="h0-2197" class="i">+		break;
</a><a href="#h0-2198" id="h0-2198" class="i">+	case &apos;T&apos;: /* SD -- Scroll &lt;n&gt; line down */
</a><a href="#h0-2199" id="h0-2199" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2200" id="h0-2200" class="i">+		tscrolldown(term.top, csiescseq.arg[0]);
</a><a href="#h0-2201" id="h0-2201" class="i">+		break;
</a><a href="#h0-2202" id="h0-2202" class="i">+	case &apos;L&apos;: /* IL -- Insert &lt;n&gt; blank lines */
</a><a href="#h0-2203" id="h0-2203" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2204" id="h0-2204" class="i">+		tinsertblankline(csiescseq.arg[0]);
</a><a href="#h0-2205" id="h0-2205" class="i">+		break;
</a><a href="#h0-2206" id="h0-2206" class="i">+	case &apos;l&apos;: /* RM -- Reset Mode */
</a><a href="#h0-2207" id="h0-2207" class="i">+		tsetmode(csiescseq.priv, 0, csiescseq.arg, csiescseq.narg);
</a><a href="#h0-2208" id="h0-2208" class="i">+		break;
</a><a href="#h0-2209" id="h0-2209" class="i">+	case &apos;M&apos;: /* DL -- Delete &lt;n&gt; lines */
</a><a href="#h0-2210" id="h0-2210" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2211" id="h0-2211" class="i">+		tdeleteline(csiescseq.arg[0]);
</a><a href="#h0-2212" id="h0-2212" class="i">+		break;
</a><a href="#h0-2213" id="h0-2213" class="i">+	case &apos;X&apos;: /* ECH -- Erase &lt;n&gt; char */
</a><a href="#h0-2214" id="h0-2214" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2215" id="h0-2215" class="i">+		tclearregion(term.c.x, term.c.y,
</a><a href="#h0-2216" id="h0-2216" class="i">+				term.c.x + csiescseq.arg[0] - 1, term.c.y);
</a><a href="#h0-2217" id="h0-2217" class="i">+		break;
</a><a href="#h0-2218" id="h0-2218" class="i">+	case &apos;P&apos;: /* DCH -- Delete &lt;n&gt; char */
</a><a href="#h0-2219" id="h0-2219" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2220" id="h0-2220" class="i">+		tdeletechar(csiescseq.arg[0]);
</a><a href="#h0-2221" id="h0-2221" class="i">+		break;
</a><a href="#h0-2222" id="h0-2222" class="i">+	case &apos;Z&apos;: /* CBT -- Cursor Backward Tabulation &lt;n&gt; tab stops */
</a><a href="#h0-2223" id="h0-2223" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2224" id="h0-2224" class="i">+		tputtab(-csiescseq.arg[0]);
</a><a href="#h0-2225" id="h0-2225" class="i">+		break;
</a><a href="#h0-2226" id="h0-2226" class="i">+	case &apos;d&apos;: /* VPA -- Move to &lt;row&gt; */
</a><a href="#h0-2227" id="h0-2227" class="i">+		DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2228" id="h0-2228" class="i">+		tmoveato(term.c.x, csiescseq.arg[0]-1);
</a><a href="#h0-2229" id="h0-2229" class="i">+		break;
</a><a href="#h0-2230" id="h0-2230" class="i">+	case &apos;h&apos;: /* SM -- Set terminal mode */
</a><a href="#h0-2231" id="h0-2231" class="i">+		tsetmode(csiescseq.priv, 1, csiescseq.arg, csiescseq.narg);
</a><a href="#h0-2232" id="h0-2232" class="i">+		break;
</a><a href="#h0-2233" id="h0-2233" class="i">+	case &apos;m&apos;: /* SGR -- Terminal attribute (color) */
</a><a href="#h0-2234" id="h0-2234" class="i">+		tsetattr(csiescseq.arg, csiescseq.narg);
</a><a href="#h0-2235" id="h0-2235" class="i">+		break;
</a><a href="#h0-2236" id="h0-2236" class="i">+	case &apos;n&apos;: /* DSR – Device Status Report (cursor position) */
</a><a href="#h0-2237" id="h0-2237" class="i">+		if (csiescseq.arg[0] == 6) {
</a><a href="#h0-2238" id="h0-2238" class="i">+			len = snprintf(buf, sizeof(buf),&quot;\033[%i;%iR&quot;,
</a><a href="#h0-2239" id="h0-2239" class="i">+					term.c.y+1, term.c.x+1);
</a><a href="#h0-2240" id="h0-2240" class="i">+			ttywrite(buf, len);
</a><a href="#h0-2241" id="h0-2241" class="i">+		}
</a><a href="#h0-2242" id="h0-2242" class="i">+		break;
</a><a href="#h0-2243" id="h0-2243" class="i">+	case &apos;r&apos;: /* DECSTBM -- Set Scrolling Region */
</a><a href="#h0-2244" id="h0-2244" class="i">+		if(csiescseq.priv) {
</a><a href="#h0-2245" id="h0-2245" class="i">+			goto unknown;
</a><a href="#h0-2246" id="h0-2246" class="i">+		} else {
</a><a href="#h0-2247" id="h0-2247" class="i">+			DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2248" id="h0-2248" class="i">+			DEFAULT(csiescseq.arg[1], term.row);
</a><a href="#h0-2249" id="h0-2249" class="i">+			tsetscroll(csiescseq.arg[0]-1, csiescseq.arg[1]-1);
</a><a href="#h0-2250" id="h0-2250" class="i">+			tmoveato(0, 0);
</a><a href="#h0-2251" id="h0-2251" class="i">+		}
</a><a href="#h0-2252" id="h0-2252" class="i">+		break;
</a><a href="#h0-2253" id="h0-2253" class="i">+	case &apos;s&apos;: /* DECSC -- Save cursor position (ANSI.SYS) */
</a><a href="#h0-2254" id="h0-2254" class="i">+		tcursor(CURSOR_SAVE);
</a><a href="#h0-2255" id="h0-2255" class="i">+		break;
</a><a href="#h0-2256" id="h0-2256" class="i">+	case &apos;u&apos;: /* DECRC -- Restore cursor position (ANSI.SYS) */
</a><a href="#h0-2257" id="h0-2257" class="i">+		tcursor(CURSOR_LOAD);
</a><a href="#h0-2258" id="h0-2258" class="i">+		break;
</a><a href="#h0-2259" id="h0-2259" class="i">+	case &apos; &apos;:
</a><a href="#h0-2260" id="h0-2260" class="i">+		switch (csiescseq.mode[1]) {
</a><a href="#h0-2261" id="h0-2261" class="i">+			case &apos;q&apos;: /* DECSCUSR -- Set Cursor Style */
</a><a href="#h0-2262" id="h0-2262" class="i">+				DEFAULT(csiescseq.arg[0], 1);
</a><a href="#h0-2263" id="h0-2263" class="i">+				if (!BETWEEN(csiescseq.arg[0], 0, 6)) {
</a><a href="#h0-2264" id="h0-2264" class="i">+					goto unknown;
</a><a href="#h0-2265" id="h0-2265" class="i">+				}
</a><a href="#h0-2266" id="h0-2266" class="i">+				xw.cursor = csiescseq.arg[0];
</a><a href="#h0-2267" id="h0-2267" class="i">+				break;
</a><a href="#h0-2268" id="h0-2268" class="i">+			default:
</a><a href="#h0-2269" id="h0-2269" class="i">+				goto unknown;
</a><a href="#h0-2270" id="h0-2270" class="i">+		}
</a><a href="#h0-2271" id="h0-2271" class="i">+		break;
</a><a href="#h0-2272" id="h0-2272" class="i">+	}
</a><a href="#h0-2273" id="h0-2273" class="i">+}
</a><a href="#h0-2274" id="h0-2274" class="i">+
</a><a href="#h0-2275" id="h0-2275" class="i">+void
</a><a href="#h0-2276" id="h0-2276" class="i">+csidump(void) {
</a><a href="#h0-2277" id="h0-2277" class="i">+	int i;
</a><a href="#h0-2278" id="h0-2278" class="i">+	uint c;
</a><a href="#h0-2279" id="h0-2279" class="i">+
</a><a href="#h0-2280" id="h0-2280" class="i">+	printf(&quot;ESC[&quot;);
</a><a href="#h0-2281" id="h0-2281" class="i">+	for(i = 0; i &lt; csiescseq.len; i++) {
</a><a href="#h0-2282" id="h0-2282" class="i">+		c = csiescseq.buf[i] &amp; 0xff;
</a><a href="#h0-2283" id="h0-2283" class="i">+		if(isprint(c)) {
</a><a href="#h0-2284" id="h0-2284" class="i">+			putchar(c);
</a><a href="#h0-2285" id="h0-2285" class="i">+		} else if(c == &apos;\n&apos;) {
</a><a href="#h0-2286" id="h0-2286" class="i">+			printf(&quot;(\\n)&quot;);
</a><a href="#h0-2287" id="h0-2287" class="i">+		} else if(c == &apos;\r&apos;) {
</a><a href="#h0-2288" id="h0-2288" class="i">+			printf(&quot;(\\r)&quot;);
</a><a href="#h0-2289" id="h0-2289" class="i">+		} else if(c == 0x1b) {
</a><a href="#h0-2290" id="h0-2290" class="i">+			printf(&quot;(\\e)&quot;);
</a><a href="#h0-2291" id="h0-2291" class="i">+		} else {
</a><a href="#h0-2292" id="h0-2292" class="i">+			printf(&quot;(%02x)&quot;, c);
</a><a href="#h0-2293" id="h0-2293" class="i">+		}
</a><a href="#h0-2294" id="h0-2294" class="i">+	}
</a><a href="#h0-2295" id="h0-2295" class="i">+	putchar(&apos;\n&apos;);
</a><a href="#h0-2296" id="h0-2296" class="i">+}
</a><a href="#h0-2297" id="h0-2297" class="i">+
</a><a href="#h0-2298" id="h0-2298" class="i">+void
</a><a href="#h0-2299" id="h0-2299" class="i">+csireset(void) {
</a><a href="#h0-2300" id="h0-2300" class="i">+	memset(&amp;csiescseq, 0, sizeof(csiescseq));
</a><a href="#h0-2301" id="h0-2301" class="i">+}
</a><a href="#h0-2302" id="h0-2302" class="i">+
</a><a href="#h0-2303" id="h0-2303" class="i">+void
</a><a href="#h0-2304" id="h0-2304" class="i">+strhandle(void) {
</a><a href="#h0-2305" id="h0-2305" class="i">+	char *p = NULL;
</a><a href="#h0-2306" id="h0-2306" class="i">+	int j, narg, par;
</a><a href="#h0-2307" id="h0-2307" class="i">+
</a><a href="#h0-2308" id="h0-2308" class="i">+	term.esc &amp;= ~(ESC_STR_END|ESC_STR);
</a><a href="#h0-2309" id="h0-2309" class="i">+	strparse();
</a><a href="#h0-2310" id="h0-2310" class="i">+	par = (narg = strescseq.narg) ? atoi(strescseq.args[0]) : 0;
</a><a href="#h0-2311" id="h0-2311" class="i">+
</a><a href="#h0-2312" id="h0-2312" class="i">+	switch(strescseq.type) {
</a><a href="#h0-2313" id="h0-2313" class="i">+	case &apos;]&apos;: /* OSC -- Operating System Command */
</a><a href="#h0-2314" id="h0-2314" class="i">+		switch(par) {
</a><a href="#h0-2315" id="h0-2315" class="i">+		case 0:
</a><a href="#h0-2316" id="h0-2316" class="i">+		case 1:
</a><a href="#h0-2317" id="h0-2317" class="i">+		case 2:
</a><a href="#h0-2318" id="h0-2318" class="i">+			if(narg &gt; 1)
</a><a href="#h0-2319" id="h0-2319" class="i">+				xsettitle(strescseq.args[1]);
</a><a href="#h0-2320" id="h0-2320" class="i">+			return;
</a><a href="#h0-2321" id="h0-2321" class="i">+		case 4: /* color set */
</a><a href="#h0-2322" id="h0-2322" class="i">+			if(narg &lt; 3)
</a><a href="#h0-2323" id="h0-2323" class="i">+				break;
</a><a href="#h0-2324" id="h0-2324" class="i">+			p = strescseq.args[2];
</a><a href="#h0-2325" id="h0-2325" class="i">+			/* FALLTHROUGH */
</a><a href="#h0-2326" id="h0-2326" class="i">+		case 104: /* color reset, here p = NULL */
</a><a href="#h0-2327" id="h0-2327" class="i">+			j = (narg &gt; 1) ? atoi(strescseq.args[1]) : -1;
</a><a href="#h0-2328" id="h0-2328" class="i">+			if(xsetcolorname(j, p)) {
</a><a href="#h0-2329" id="h0-2329" class="i">+				fprintf(stderr, &quot;erresc: invalid color %s\n&quot;, p);
</a><a href="#h0-2330" id="h0-2330" class="i">+			} else {
</a><a href="#h0-2331" id="h0-2331" class="i">+				/*
</a><a href="#h0-2332" id="h0-2332" class="i">+				 * TODO if defaultbg color is changed, borders
</a><a href="#h0-2333" id="h0-2333" class="i">+				 * are dirty
</a><a href="#h0-2334" id="h0-2334" class="i">+				 */
</a><a href="#h0-2335" id="h0-2335" class="i">+				redraw();
</a><a href="#h0-2336" id="h0-2336" class="i">+			}
</a><a href="#h0-2337" id="h0-2337" class="i">+			return;
</a><a href="#h0-2338" id="h0-2338" class="i">+		}
</a><a href="#h0-2339" id="h0-2339" class="i">+		break;
</a><a href="#h0-2340" id="h0-2340" class="i">+	case &apos;k&apos;: /* old title set compatibility */
</a><a href="#h0-2341" id="h0-2341" class="i">+		xsettitle(strescseq.args[0]);
</a><a href="#h0-2342" id="h0-2342" class="i">+		return;
</a><a href="#h0-2343" id="h0-2343" class="i">+	case &apos;P&apos;: /* DCS -- Device Control String */
</a><a href="#h0-2344" id="h0-2344" class="i">+	case &apos;_&apos;: /* APC -- Application Program Command */
</a><a href="#h0-2345" id="h0-2345" class="i">+	case &apos;^&apos;: /* PM -- Privacy Message */
</a><a href="#h0-2346" id="h0-2346" class="i">+		return;
</a><a href="#h0-2347" id="h0-2347" class="i">+	}
</a><a href="#h0-2348" id="h0-2348" class="i">+
</a><a href="#h0-2349" id="h0-2349" class="i">+	fprintf(stderr, &quot;erresc: unknown str &quot;);
</a><a href="#h0-2350" id="h0-2350" class="i">+	strdump();
</a><a href="#h0-2351" id="h0-2351" class="i">+}
</a><a href="#h0-2352" id="h0-2352" class="i">+
</a><a href="#h0-2353" id="h0-2353" class="i">+void
</a><a href="#h0-2354" id="h0-2354" class="i">+strparse(void) {
</a><a href="#h0-2355" id="h0-2355" class="i">+	int c;
</a><a href="#h0-2356" id="h0-2356" class="i">+	char *p = strescseq.buf;
</a><a href="#h0-2357" id="h0-2357" class="i">+
</a><a href="#h0-2358" id="h0-2358" class="i">+	strescseq.narg = 0;
</a><a href="#h0-2359" id="h0-2359" class="i">+	strescseq.buf[strescseq.len] = &apos;\0&apos;;
</a><a href="#h0-2360" id="h0-2360" class="i">+
</a><a href="#h0-2361" id="h0-2361" class="i">+	if(*p == &apos;\0&apos;)
</a><a href="#h0-2362" id="h0-2362" class="i">+		return;
</a><a href="#h0-2363" id="h0-2363" class="i">+
</a><a href="#h0-2364" id="h0-2364" class="i">+	while(strescseq.narg &lt; STR_ARG_SIZ) {
</a><a href="#h0-2365" id="h0-2365" class="i">+		strescseq.args[strescseq.narg++] = p;
</a><a href="#h0-2366" id="h0-2366" class="i">+		while((c = *p) != &apos;;&apos; &amp;&amp; c != &apos;\0&apos;)
</a><a href="#h0-2367" id="h0-2367" class="i">+			++p;
</a><a href="#h0-2368" id="h0-2368" class="i">+		if(c == &apos;\0&apos;)
</a><a href="#h0-2369" id="h0-2369" class="i">+			return;
</a><a href="#h0-2370" id="h0-2370" class="i">+		*p++ = &apos;\0&apos;;
</a><a href="#h0-2371" id="h0-2371" class="i">+	}
</a><a href="#h0-2372" id="h0-2372" class="i">+}
</a><a href="#h0-2373" id="h0-2373" class="i">+
</a><a href="#h0-2374" id="h0-2374" class="i">+void
</a><a href="#h0-2375" id="h0-2375" class="i">+strdump(void) {
</a><a href="#h0-2376" id="h0-2376" class="i">+	int i;
</a><a href="#h0-2377" id="h0-2377" class="i">+	uint c;
</a><a href="#h0-2378" id="h0-2378" class="i">+
</a><a href="#h0-2379" id="h0-2379" class="i">+	printf(&quot;ESC%c&quot;, strescseq.type);
</a><a href="#h0-2380" id="h0-2380" class="i">+	for(i = 0; i &lt; strescseq.len; i++) {
</a><a href="#h0-2381" id="h0-2381" class="i">+		c = strescseq.buf[i] &amp; 0xff;
</a><a href="#h0-2382" id="h0-2382" class="i">+		if(c == &apos;\0&apos;) {
</a><a href="#h0-2383" id="h0-2383" class="i">+			return;
</a><a href="#h0-2384" id="h0-2384" class="i">+		} else if(isprint(c)) {
</a><a href="#h0-2385" id="h0-2385" class="i">+			putchar(c);
</a><a href="#h0-2386" id="h0-2386" class="i">+		} else if(c == &apos;\n&apos;) {
</a><a href="#h0-2387" id="h0-2387" class="i">+			printf(&quot;(\\n)&quot;);
</a><a href="#h0-2388" id="h0-2388" class="i">+		} else if(c == &apos;\r&apos;) {
</a><a href="#h0-2389" id="h0-2389" class="i">+			printf(&quot;(\\r)&quot;);
</a><a href="#h0-2390" id="h0-2390" class="i">+		} else if(c == 0x1b) {
</a><a href="#h0-2391" id="h0-2391" class="i">+			printf(&quot;(\\e)&quot;);
</a><a href="#h0-2392" id="h0-2392" class="i">+		} else {
</a><a href="#h0-2393" id="h0-2393" class="i">+			printf(&quot;(%02x)&quot;, c);
</a><a href="#h0-2394" id="h0-2394" class="i">+		}
</a><a href="#h0-2395" id="h0-2395" class="i">+	}
</a><a href="#h0-2396" id="h0-2396" class="i">+	printf(&quot;ESC\\\n&quot;);
</a><a href="#h0-2397" id="h0-2397" class="i">+}
</a><a href="#h0-2398" id="h0-2398" class="i">+
</a><a href="#h0-2399" id="h0-2399" class="i">+void
</a><a href="#h0-2400" id="h0-2400" class="i">+strreset(void) {
</a><a href="#h0-2401" id="h0-2401" class="i">+	memset(&amp;strescseq, 0, sizeof(strescseq));
</a><a href="#h0-2402" id="h0-2402" class="i">+}
</a><a href="#h0-2403" id="h0-2403" class="i">+
</a><a href="#h0-2404" id="h0-2404" class="i">+void
</a><a href="#h0-2405" id="h0-2405" class="i">+tprinter(char *s, size_t len) {
</a><a href="#h0-2406" id="h0-2406" class="i">+	if(iofd != -1 &amp;&amp; xwrite(iofd, s, len) &lt; 0) {
</a><a href="#h0-2407" id="h0-2407" class="i">+		fprintf(stderr, &quot;Error writing in %s:%s\n&quot;,
</a><a href="#h0-2408" id="h0-2408" class="i">+			opt_io, strerror(errno));
</a><a href="#h0-2409" id="h0-2409" class="i">+		close(iofd);
</a><a href="#h0-2410" id="h0-2410" class="i">+		iofd = -1;
</a><a href="#h0-2411" id="h0-2411" class="i">+	}
</a><a href="#h0-2412" id="h0-2412" class="i">+}
</a><a href="#h0-2413" id="h0-2413" class="i">+
</a><a href="#h0-2414" id="h0-2414" class="i">+void
</a><a href="#h0-2415" id="h0-2415" class="i">+toggleprinter(const Arg *arg) {
</a><a href="#h0-2416" id="h0-2416" class="i">+	term.mode ^= MODE_PRINT;
</a><a href="#h0-2417" id="h0-2417" class="i">+}
</a><a href="#h0-2418" id="h0-2418" class="i">+
</a><a href="#h0-2419" id="h0-2419" class="i">+void
</a><a href="#h0-2420" id="h0-2420" class="i">+printscreen(const Arg *arg) {
</a><a href="#h0-2421" id="h0-2421" class="i">+	tdump();
</a><a href="#h0-2422" id="h0-2422" class="i">+}
</a><a href="#h0-2423" id="h0-2423" class="i">+
</a><a href="#h0-2424" id="h0-2424" class="i">+void
</a><a href="#h0-2425" id="h0-2425" class="i">+printsel(const Arg *arg) {
</a><a href="#h0-2426" id="h0-2426" class="i">+	tdumpsel();
</a><a href="#h0-2427" id="h0-2427" class="i">+}
</a><a href="#h0-2428" id="h0-2428" class="i">+
</a><a href="#h0-2429" id="h0-2429" class="i">+void
</a><a href="#h0-2430" id="h0-2430" class="i">+tdumpsel(void) {
</a><a href="#h0-2431" id="h0-2431" class="i">+	char *ptr;
</a><a href="#h0-2432" id="h0-2432" class="i">+
</a><a href="#h0-2433" id="h0-2433" class="i">+	if((ptr = getsel())) {
</a><a href="#h0-2434" id="h0-2434" class="i">+		tprinter(ptr, strlen(ptr));
</a><a href="#h0-2435" id="h0-2435" class="i">+		free(ptr);
</a><a href="#h0-2436" id="h0-2436" class="i">+	}
</a><a href="#h0-2437" id="h0-2437" class="i">+}
</a><a href="#h0-2438" id="h0-2438" class="i">+
</a><a href="#h0-2439" id="h0-2439" class="i">+void
</a><a href="#h0-2440" id="h0-2440" class="i">+tdumpline(int n) {
</a><a href="#h0-2441" id="h0-2441" class="i">+	char buf[UTF_SIZ];
</a><a href="#h0-2442" id="h0-2442" class="i">+	Glyph *bp, *end;
</a><a href="#h0-2443" id="h0-2443" class="i">+
</a><a href="#h0-2444" id="h0-2444" class="i">+	bp = &amp;term.line[n][0];
</a><a href="#h0-2445" id="h0-2445" class="i">+	end = &amp;bp[MIN(tlinelen(n), term.col) - 1];
</a><a href="#h0-2446" id="h0-2446" class="i">+	if(bp != end || bp-&gt;u != &apos; &apos;) {
</a><a href="#h0-2447" id="h0-2447" class="i">+		for( ;bp &lt;= end; ++bp)
</a><a href="#h0-2448" id="h0-2448" class="i">+			tprinter(buf, utf8encode(bp-&gt;u, buf));
</a><a href="#h0-2449" id="h0-2449" class="i">+	}
</a><a href="#h0-2450" id="h0-2450" class="i">+	tprinter(&quot;\n&quot;, 1);
</a><a href="#h0-2451" id="h0-2451" class="i">+}
</a><a href="#h0-2452" id="h0-2452" class="i">+
</a><a href="#h0-2453" id="h0-2453" class="i">+void
</a><a href="#h0-2454" id="h0-2454" class="i">+tdump(void) {
</a><a href="#h0-2455" id="h0-2455" class="i">+	int i;
</a><a href="#h0-2456" id="h0-2456" class="i">+
</a><a href="#h0-2457" id="h0-2457" class="i">+	for(i = 0; i &lt; term.row; ++i)
</a><a href="#h0-2458" id="h0-2458" class="i">+		tdumpline(i);
</a><a href="#h0-2459" id="h0-2459" class="i">+}
</a><a href="#h0-2460" id="h0-2460" class="i">+
</a><a href="#h0-2461" id="h0-2461" class="i">+void
</a><a href="#h0-2462" id="h0-2462" class="i">+tputtab(int n) {
</a><a href="#h0-2463" id="h0-2463" class="i">+	uint x = term.c.x;
</a><a href="#h0-2464" id="h0-2464" class="i">+
</a><a href="#h0-2465" id="h0-2465" class="i">+	if(n &gt; 0) {
</a><a href="#h0-2466" id="h0-2466" class="i">+		while(x &lt; term.col &amp;&amp; n--)
</a><a href="#h0-2467" id="h0-2467" class="i">+			for(++x; x &lt; term.col &amp;&amp; !term.tabs[x]; ++x)
</a><a href="#h0-2468" id="h0-2468" class="i">+				/* nothing */ ;
</a><a href="#h0-2469" id="h0-2469" class="i">+	} else if(n &lt; 0) {
</a><a href="#h0-2470" id="h0-2470" class="i">+		while(x &gt; 0 &amp;&amp; n++)
</a><a href="#h0-2471" id="h0-2471" class="i">+			for(--x; x &gt; 0 &amp;&amp; !term.tabs[x]; --x)
</a><a href="#h0-2472" id="h0-2472" class="i">+				/* nothing */ ;
</a><a href="#h0-2473" id="h0-2473" class="i">+	}
</a><a href="#h0-2474" id="h0-2474" class="i">+	term.c.x = LIMIT(x, 0, term.col-1);
</a><a href="#h0-2475" id="h0-2475" class="i">+}
</a><a href="#h0-2476" id="h0-2476" class="i">+
</a><a href="#h0-2477" id="h0-2477" class="i">+void
</a><a href="#h0-2478" id="h0-2478" class="i">+techo(Rune u) {
</a><a href="#h0-2479" id="h0-2479" class="i">+	if(ISCONTROL(u)) { /* control code */
</a><a href="#h0-2480" id="h0-2480" class="i">+		if(u &amp; 0x80) {
</a><a href="#h0-2481" id="h0-2481" class="i">+			u &amp;= 0x7f;
</a><a href="#h0-2482" id="h0-2482" class="i">+			tputc(&apos;^&apos;);
</a><a href="#h0-2483" id="h0-2483" class="i">+			tputc(&apos;[&apos;);
</a><a href="#h0-2484" id="h0-2484" class="i">+		} else if(u != &apos;\n&apos; &amp;&amp; u != &apos;\r&apos; &amp;&amp; u != &apos;\t&apos;) {
</a><a href="#h0-2485" id="h0-2485" class="i">+			u ^= 0x40;
</a><a href="#h0-2486" id="h0-2486" class="i">+			tputc(&apos;^&apos;);
</a><a href="#h0-2487" id="h0-2487" class="i">+		}
</a><a href="#h0-2488" id="h0-2488" class="i">+	}
</a><a href="#h0-2489" id="h0-2489" class="i">+	tputc(u);
</a><a href="#h0-2490" id="h0-2490" class="i">+}
</a><a href="#h0-2491" id="h0-2491" class="i">+
</a><a href="#h0-2492" id="h0-2492" class="i">+void
</a><a href="#h0-2493" id="h0-2493" class="i">+tdeftran(char ascii) {
</a><a href="#h0-2494" id="h0-2494" class="i">+	static char cs[] = &quot;0B&quot;;
</a><a href="#h0-2495" id="h0-2495" class="i">+	static int vcs[] = {CS_GRAPHIC0, CS_USA};
</a><a href="#h0-2496" id="h0-2496" class="i">+	char *p;
</a><a href="#h0-2497" id="h0-2497" class="i">+
</a><a href="#h0-2498" id="h0-2498" class="i">+	if((p = strchr(cs, ascii)) == NULL) {
</a><a href="#h0-2499" id="h0-2499" class="i">+		fprintf(stderr, &quot;esc unhandled charset: ESC ( %c\n&quot;, ascii);
</a><a href="#h0-2500" id="h0-2500" class="i">+	} else {
</a><a href="#h0-2501" id="h0-2501" class="i">+		term.trantbl[term.icharset] = vcs[p - cs];
</a><a href="#h0-2502" id="h0-2502" class="i">+	}
</a><a href="#h0-2503" id="h0-2503" class="i">+}
</a><a href="#h0-2504" id="h0-2504" class="i">+
</a><a href="#h0-2505" id="h0-2505" class="i">+void
</a><a href="#h0-2506" id="h0-2506" class="i">+tdectest(char c) {
</a><a href="#h0-2507" id="h0-2507" class="i">+	int x, y;
</a><a href="#h0-2508" id="h0-2508" class="i">+
</a><a href="#h0-2509" id="h0-2509" class="i">+	if(c == &apos;8&apos;) { /* DEC screen alignment test. */
</a><a href="#h0-2510" id="h0-2510" class="i">+		for(x = 0; x &lt; term.col; ++x) {
</a><a href="#h0-2511" id="h0-2511" class="i">+			for(y = 0; y &lt; term.row; ++y)
</a><a href="#h0-2512" id="h0-2512" class="i">+				tsetchar(&apos;E&apos;, &amp;term.c.attr, x, y);
</a><a href="#h0-2513" id="h0-2513" class="i">+		}
</a><a href="#h0-2514" id="h0-2514" class="i">+	}
</a><a href="#h0-2515" id="h0-2515" class="i">+}
</a><a href="#h0-2516" id="h0-2516" class="i">+
</a><a href="#h0-2517" id="h0-2517" class="i">+void
</a><a href="#h0-2518" id="h0-2518" class="i">+tstrsequence(uchar c) {
</a><a href="#h0-2519" id="h0-2519" class="i">+	switch (c) {
</a><a href="#h0-2520" id="h0-2520" class="i">+	case 0x90:   /* DCS -- Device Control String */
</a><a href="#h0-2521" id="h0-2521" class="i">+		c = &apos;P&apos;;
</a><a href="#h0-2522" id="h0-2522" class="i">+		break;
</a><a href="#h0-2523" id="h0-2523" class="i">+	case 0x9f:   /* APC -- Application Program Command */
</a><a href="#h0-2524" id="h0-2524" class="i">+		c = &apos;_&apos;;
</a><a href="#h0-2525" id="h0-2525" class="i">+		break;
</a><a href="#h0-2526" id="h0-2526" class="i">+	case 0x9e:   /* PM -- Privacy Message */
</a><a href="#h0-2527" id="h0-2527" class="i">+		c = &apos;^&apos;;
</a><a href="#h0-2528" id="h0-2528" class="i">+		break;
</a><a href="#h0-2529" id="h0-2529" class="i">+	case 0x9d:   /* OSC -- Operating System Command */
</a><a href="#h0-2530" id="h0-2530" class="i">+		c = &apos;]&apos;;
</a><a href="#h0-2531" id="h0-2531" class="i">+		break;
</a><a href="#h0-2532" id="h0-2532" class="i">+	}
</a><a href="#h0-2533" id="h0-2533" class="i">+	strreset();
</a><a href="#h0-2534" id="h0-2534" class="i">+	strescseq.type = c;
</a><a href="#h0-2535" id="h0-2535" class="i">+	term.esc |= ESC_STR;
</a><a href="#h0-2536" id="h0-2536" class="i">+}
</a><a href="#h0-2537" id="h0-2537" class="i">+
</a><a href="#h0-2538" id="h0-2538" class="i">+void
</a><a href="#h0-2539" id="h0-2539" class="i">+tcontrolcode(uchar ascii) {
</a><a href="#h0-2540" id="h0-2540" class="i">+	switch(ascii) {
</a><a href="#h0-2541" id="h0-2541" class="i">+	case &apos;\t&apos;:   /* HT */
</a><a href="#h0-2542" id="h0-2542" class="i">+		tputtab(1);
</a><a href="#h0-2543" id="h0-2543" class="i">+		return;
</a><a href="#h0-2544" id="h0-2544" class="i">+	case &apos;\b&apos;:   /* BS */
</a><a href="#h0-2545" id="h0-2545" class="i">+		tmoveto(term.c.x-1, term.c.y);
</a><a href="#h0-2546" id="h0-2546" class="i">+		return;
</a><a href="#h0-2547" id="h0-2547" class="i">+	case &apos;\r&apos;:   /* CR */
</a><a href="#h0-2548" id="h0-2548" class="i">+		tmoveto(0, term.c.y);
</a><a href="#h0-2549" id="h0-2549" class="i">+		return;
</a><a href="#h0-2550" id="h0-2550" class="i">+	case &apos;\f&apos;:   /* LF */
</a><a href="#h0-2551" id="h0-2551" class="i">+	case &apos;\v&apos;:   /* VT */
</a><a href="#h0-2552" id="h0-2552" class="i">+	case &apos;\n&apos;:   /* LF */
</a><a href="#h0-2553" id="h0-2553" class="i">+		/* go to first col if the mode is set */
</a><a href="#h0-2554" id="h0-2554" class="i">+		tnewline(IS_SET(MODE_CRLF));
</a><a href="#h0-2555" id="h0-2555" class="i">+		return;
</a><a href="#h0-2556" id="h0-2556" class="i">+	case &apos;\a&apos;:   /* BEL */
</a><a href="#h0-2557" id="h0-2557" class="i">+		if(term.esc &amp; ESC_STR_END) {
</a><a href="#h0-2558" id="h0-2558" class="i">+			/* backwards compatibility to xterm */
</a><a href="#h0-2559" id="h0-2559" class="i">+			strhandle();
</a><a href="#h0-2560" id="h0-2560" class="i">+		} else {
</a><a href="#h0-2561" id="h0-2561" class="i">+			if(!(xw.state &amp; WIN_FOCUSED))
</a><a href="#h0-2562" id="h0-2562" class="i">+				xseturgency(1);
</a><a href="#h0-2563" id="h0-2563" class="i">+			if (bellvolume)
</a><a href="#h0-2564" id="h0-2564" class="i">+				XkbBell(xw.dpy, xw.win, bellvolume, (Atom)NULL);
</a><a href="#h0-2565" id="h0-2565" class="i">+		}
</a><a href="#h0-2566" id="h0-2566" class="i">+		break;
</a><a href="#h0-2567" id="h0-2567" class="i">+	case &apos;\033&apos;: /* ESC */
</a><a href="#h0-2568" id="h0-2568" class="i">+		csireset();
</a><a href="#h0-2569" id="h0-2569" class="i">+		term.esc &amp;= ~(ESC_CSI|ESC_ALTCHARSET|ESC_TEST);
</a><a href="#h0-2570" id="h0-2570" class="i">+		term.esc |= ESC_START;
</a><a href="#h0-2571" id="h0-2571" class="i">+		return;
</a><a href="#h0-2572" id="h0-2572" class="i">+	case &apos;\016&apos;: /* SO (LS1 -- Locking shift 1) */
</a><a href="#h0-2573" id="h0-2573" class="i">+	case &apos;\017&apos;: /* SI (LS0 -- Locking shift 0) */
</a><a href="#h0-2574" id="h0-2574" class="i">+		term.charset = 1 - (ascii - &apos;\016&apos;);
</a><a href="#h0-2575" id="h0-2575" class="i">+		return;
</a><a href="#h0-2576" id="h0-2576" class="i">+	case &apos;\032&apos;: /* SUB */
</a><a href="#h0-2577" id="h0-2577" class="i">+		tsetchar(&apos;?&apos;, &amp;term.c.attr, term.c.x, term.c.y);
</a><a href="#h0-2578" id="h0-2578" class="i">+	case &apos;\030&apos;: /* CAN */
</a><a href="#h0-2579" id="h0-2579" class="i">+		csireset();
</a><a href="#h0-2580" id="h0-2580" class="i">+		break;
</a><a href="#h0-2581" id="h0-2581" class="i">+	case &apos;\005&apos;: /* ENQ (IGNORED) */
</a><a href="#h0-2582" id="h0-2582" class="i">+	case &apos;\000&apos;: /* NUL (IGNORED) */
</a><a href="#h0-2583" id="h0-2583" class="i">+	case &apos;\021&apos;: /* XON (IGNORED) */
</a><a href="#h0-2584" id="h0-2584" class="i">+	case &apos;\023&apos;: /* XOFF (IGNORED) */
</a><a href="#h0-2585" id="h0-2585" class="i">+	case 0177:   /* DEL (IGNORED) */
</a><a href="#h0-2586" id="h0-2586" class="i">+		return;
</a><a href="#h0-2587" id="h0-2587" class="i">+	case 0x84:   /* TODO: IND */
</a><a href="#h0-2588" id="h0-2588" class="i">+		break;
</a><a href="#h0-2589" id="h0-2589" class="i">+	case 0x85:   /* NEL -- Next line */
</a><a href="#h0-2590" id="h0-2590" class="i">+		tnewline(1); /* always go to first col */
</a><a href="#h0-2591" id="h0-2591" class="i">+		break;
</a><a href="#h0-2592" id="h0-2592" class="i">+	case 0x88:   /* HTS -- Horizontal tab stop */
</a><a href="#h0-2593" id="h0-2593" class="i">+		term.tabs[term.c.x] = 1;
</a><a href="#h0-2594" id="h0-2594" class="i">+		break;
</a><a href="#h0-2595" id="h0-2595" class="i">+	case 0x8d:   /* TODO: RI */
</a><a href="#h0-2596" id="h0-2596" class="i">+	case 0x8e:   /* TODO: SS2 */
</a><a href="#h0-2597" id="h0-2597" class="i">+	case 0x8f:   /* TODO: SS3 */
</a><a href="#h0-2598" id="h0-2598" class="i">+	case 0x98:   /* TODO: SOS */
</a><a href="#h0-2599" id="h0-2599" class="i">+		break;
</a><a href="#h0-2600" id="h0-2600" class="i">+	case 0x9a:   /* DECID -- Identify Terminal */
</a><a href="#h0-2601" id="h0-2601" class="i">+		ttywrite(vtiden, sizeof(vtiden) - 1);
</a><a href="#h0-2602" id="h0-2602" class="i">+		break;
</a><a href="#h0-2603" id="h0-2603" class="i">+	case 0x9b:   /* TODO: CSI */
</a><a href="#h0-2604" id="h0-2604" class="i">+	case 0x9c:   /* TODO: ST */
</a><a href="#h0-2605" id="h0-2605" class="i">+		break;
</a><a href="#h0-2606" id="h0-2606" class="i">+	case 0x90:   /* DCS -- Device Control String */
</a><a href="#h0-2607" id="h0-2607" class="i">+	case 0x9f:   /* APC -- Application Program Command */
</a><a href="#h0-2608" id="h0-2608" class="i">+	case 0x9e:   /* PM -- Privacy Message */
</a><a href="#h0-2609" id="h0-2609" class="i">+	case 0x9d:   /* OSC -- Operating System Command */
</a><a href="#h0-2610" id="h0-2610" class="i">+		tstrsequence(ascii);
</a><a href="#h0-2611" id="h0-2611" class="i">+		return;
</a><a href="#h0-2612" id="h0-2612" class="i">+	}
</a><a href="#h0-2613" id="h0-2613" class="i">+	/* only CAN, SUB, \a and C1 chars interrupt a sequence */
</a><a href="#h0-2614" id="h0-2614" class="i">+	term.esc &amp;= ~(ESC_STR_END|ESC_STR);
</a><a href="#h0-2615" id="h0-2615" class="i">+}
</a><a href="#h0-2616" id="h0-2616" class="i">+
</a><a href="#h0-2617" id="h0-2617" class="i">+/*
</a><a href="#h0-2618" id="h0-2618" class="i">+ * returns 1 when the sequence is finished and it hasn&apos;t to read
</a><a href="#h0-2619" id="h0-2619" class="i">+ * more characters for this sequence, otherwise 0
</a><a href="#h0-2620" id="h0-2620" class="i">+ */
</a><a href="#h0-2621" id="h0-2621" class="i">+int
</a><a href="#h0-2622" id="h0-2622" class="i">+eschandle(uchar ascii) {
</a><a href="#h0-2623" id="h0-2623" class="i">+	switch(ascii) {
</a><a href="#h0-2624" id="h0-2624" class="i">+	case &apos;[&apos;:
</a><a href="#h0-2625" id="h0-2625" class="i">+		term.esc |= ESC_CSI;
</a><a href="#h0-2626" id="h0-2626" class="i">+		return 0;
</a><a href="#h0-2627" id="h0-2627" class="i">+	case &apos;#&apos;:
</a><a href="#h0-2628" id="h0-2628" class="i">+		term.esc |= ESC_TEST;
</a><a href="#h0-2629" id="h0-2629" class="i">+		return 0;
</a><a href="#h0-2630" id="h0-2630" class="i">+	case &apos;P&apos;: /* DCS -- Device Control String */
</a><a href="#h0-2631" id="h0-2631" class="i">+	case &apos;_&apos;: /* APC -- Application Program Command */
</a><a href="#h0-2632" id="h0-2632" class="i">+	case &apos;^&apos;: /* PM -- Privacy Message */
</a><a href="#h0-2633" id="h0-2633" class="i">+	case &apos;]&apos;: /* OSC -- Operating System Command */
</a><a href="#h0-2634" id="h0-2634" class="i">+	case &apos;k&apos;: /* old title set compatibility */
</a><a href="#h0-2635" id="h0-2635" class="i">+		tstrsequence(ascii);
</a><a href="#h0-2636" id="h0-2636" class="i">+		return 0;
</a><a href="#h0-2637" id="h0-2637" class="i">+	case &apos;n&apos;: /* LS2 -- Locking shift 2 */
</a><a href="#h0-2638" id="h0-2638" class="i">+	case &apos;o&apos;: /* LS3 -- Locking shift 3 */
</a><a href="#h0-2639" id="h0-2639" class="i">+		term.charset = 2 + (ascii - &apos;n&apos;);
</a><a href="#h0-2640" id="h0-2640" class="i">+		break;
</a><a href="#h0-2641" id="h0-2641" class="i">+	case &apos;(&apos;: /* GZD4 -- set primary charset G0 */
</a><a href="#h0-2642" id="h0-2642" class="i">+	case &apos;)&apos;: /* G1D4 -- set secondary charset G1 */
</a><a href="#h0-2643" id="h0-2643" class="i">+	case &apos;*&apos;: /* G2D4 -- set tertiary charset G2 */
</a><a href="#h0-2644" id="h0-2644" class="i">+	case &apos;+&apos;: /* G3D4 -- set quaternary charset G3 */
</a><a href="#h0-2645" id="h0-2645" class="i">+		term.icharset = ascii - &apos;(&apos;;
</a><a href="#h0-2646" id="h0-2646" class="i">+		term.esc |= ESC_ALTCHARSET;
</a><a href="#h0-2647" id="h0-2647" class="i">+		return 0;
</a><a href="#h0-2648" id="h0-2648" class="i">+	case &apos;D&apos;: /* IND -- Linefeed */
</a><a href="#h0-2649" id="h0-2649" class="i">+		if(term.c.y == term.bot) {
</a><a href="#h0-2650" id="h0-2650" class="i">+			tscrollup(term.top, 1);
</a><a href="#h0-2651" id="h0-2651" class="i">+		} else {
</a><a href="#h0-2652" id="h0-2652" class="i">+			tmoveto(term.c.x, term.c.y+1);
</a><a href="#h0-2653" id="h0-2653" class="i">+		}
</a><a href="#h0-2654" id="h0-2654" class="i">+		break;
</a><a href="#h0-2655" id="h0-2655" class="i">+	case &apos;E&apos;: /* NEL -- Next line */
</a><a href="#h0-2656" id="h0-2656" class="i">+		tnewline(1); /* always go to first col */
</a><a href="#h0-2657" id="h0-2657" class="i">+		break;
</a><a href="#h0-2658" id="h0-2658" class="i">+	case &apos;H&apos;: /* HTS -- Horizontal tab stop */
</a><a href="#h0-2659" id="h0-2659" class="i">+		term.tabs[term.c.x] = 1;
</a><a href="#h0-2660" id="h0-2660" class="i">+		break;
</a><a href="#h0-2661" id="h0-2661" class="i">+	case &apos;M&apos;: /* RI -- Reverse index */
</a><a href="#h0-2662" id="h0-2662" class="i">+		if(term.c.y == term.top) {
</a><a href="#h0-2663" id="h0-2663" class="i">+			tscrolldown(term.top, 1);
</a><a href="#h0-2664" id="h0-2664" class="i">+		} else {
</a><a href="#h0-2665" id="h0-2665" class="i">+			tmoveto(term.c.x, term.c.y-1);
</a><a href="#h0-2666" id="h0-2666" class="i">+		}
</a><a href="#h0-2667" id="h0-2667" class="i">+		break;
</a><a href="#h0-2668" id="h0-2668" class="i">+	case &apos;Z&apos;: /* DECID -- Identify Terminal */
</a><a href="#h0-2669" id="h0-2669" class="i">+		ttywrite(vtiden, sizeof(vtiden) - 1);
</a><a href="#h0-2670" id="h0-2670" class="i">+		break;
</a><a href="#h0-2671" id="h0-2671" class="i">+	case &apos;c&apos;: /* RIS -- Reset to inital state */
</a><a href="#h0-2672" id="h0-2672" class="i">+		treset();
</a><a href="#h0-2673" id="h0-2673" class="i">+		xresettitle();
</a><a href="#h0-2674" id="h0-2674" class="i">+		xloadcols();
</a><a href="#h0-2675" id="h0-2675" class="i">+		break;
</a><a href="#h0-2676" id="h0-2676" class="i">+	case &apos;=&apos;: /* DECPAM -- Application keypad */
</a><a href="#h0-2677" id="h0-2677" class="i">+		term.mode |= MODE_APPKEYPAD;
</a><a href="#h0-2678" id="h0-2678" class="i">+		break;
</a><a href="#h0-2679" id="h0-2679" class="i">+	case &apos;&gt;&apos;: /* DECPNM -- Normal keypad */
</a><a href="#h0-2680" id="h0-2680" class="i">+		term.mode &amp;= ~MODE_APPKEYPAD;
</a><a href="#h0-2681" id="h0-2681" class="i">+		break;
</a><a href="#h0-2682" id="h0-2682" class="i">+	case &apos;7&apos;: /* DECSC -- Save Cursor */
</a><a href="#h0-2683" id="h0-2683" class="i">+		tcursor(CURSOR_SAVE);
</a><a href="#h0-2684" id="h0-2684" class="i">+		break;
</a><a href="#h0-2685" id="h0-2685" class="i">+	case &apos;8&apos;: /* DECRC -- Restore Cursor */
</a><a href="#h0-2686" id="h0-2686" class="i">+		tcursor(CURSOR_LOAD);
</a><a href="#h0-2687" id="h0-2687" class="i">+		break;
</a><a href="#h0-2688" id="h0-2688" class="i">+	case &apos;\\&apos;: /* ST -- String Terminator */
</a><a href="#h0-2689" id="h0-2689" class="i">+		if(term.esc &amp; ESC_STR_END)
</a><a href="#h0-2690" id="h0-2690" class="i">+			strhandle();
</a><a href="#h0-2691" id="h0-2691" class="i">+		break;
</a><a href="#h0-2692" id="h0-2692" class="i">+	default:
</a><a href="#h0-2693" id="h0-2693" class="i">+		fprintf(stderr, &quot;erresc: unknown sequence ESC 0x%02X &apos;%c&apos;\n&quot;,
</a><a href="#h0-2694" id="h0-2694" class="i">+			(uchar) ascii, isprint(ascii)? ascii:&apos;.&apos;);
</a><a href="#h0-2695" id="h0-2695" class="i">+		break;
</a><a href="#h0-2696" id="h0-2696" class="i">+	}
</a><a href="#h0-2697" id="h0-2697" class="i">+	return 1;
</a><a href="#h0-2698" id="h0-2698" class="i">+}
</a><a href="#h0-2699" id="h0-2699" class="i">+
</a><a href="#h0-2700" id="h0-2700" class="i">+void
</a><a href="#h0-2701" id="h0-2701" class="i">+externalpipe(const Arg *arg)
</a><a href="#h0-2702" id="h0-2702" class="i">+{
</a><a href="#h0-2703" id="h0-2703" class="i">+	int to[2]; /* 0 = read, 1 = write */
</a><a href="#h0-2704" id="h0-2704" class="i">+	pid_t child;
</a><a href="#h0-2705" id="h0-2705" class="i">+	int n;
</a><a href="#h0-2706" id="h0-2706" class="i">+	void (*oldsigpipe)(int);
</a><a href="#h0-2707" id="h0-2707" class="i">+	char buf[UTF_SIZ];
</a><a href="#h0-2708" id="h0-2708" class="i">+	Glyph *bp, *end;
</a><a href="#h0-2709" id="h0-2709" class="i">+
</a><a href="#h0-2710" id="h0-2710" class="i">+	if(pipe(to) == -1)
</a><a href="#h0-2711" id="h0-2711" class="i">+		return;
</a><a href="#h0-2712" id="h0-2712" class="i">+
</a><a href="#h0-2713" id="h0-2713" class="i">+	/* sigchld() handles this */
</a><a href="#h0-2714" id="h0-2714" class="i">+	switch(child = fork()){
</a><a href="#h0-2715" id="h0-2715" class="i">+		case -1:
</a><a href="#h0-2716" id="h0-2716" class="i">+			close(to[0]), close(to[1]);
</a><a href="#h0-2717" id="h0-2717" class="i">+			return;
</a><a href="#h0-2718" id="h0-2718" class="i">+		case 0:
</a><a href="#h0-2719" id="h0-2719" class="i">+			/* child */
</a><a href="#h0-2720" id="h0-2720" class="i">+			close(to[1]);
</a><a href="#h0-2721" id="h0-2721" class="i">+			dup2(to[0], STDIN_FILENO); /* 0&lt;&amp;to */
</a><a href="#h0-2722" id="h0-2722" class="i">+			close(to[0]);
</a><a href="#h0-2723" id="h0-2723" class="i">+			execvp(
</a><a href="#h0-2724" id="h0-2724" class="i">+					&quot;sh&quot;,
</a><a href="#h0-2725" id="h0-2725" class="i">+					(char *const []){
</a><a href="#h0-2726" id="h0-2726" class="i">+						&quot;/bin/sh&quot;,
</a><a href="#h0-2727" id="h0-2727" class="i">+						&quot;-c&quot;,
</a><a href="#h0-2728" id="h0-2728" class="i">+						(char *)arg-&gt;v,
</a><a href="#h0-2729" id="h0-2729" class="i">+						0
</a><a href="#h0-2730" id="h0-2730" class="i">+					});
</a><a href="#h0-2731" id="h0-2731" class="i">+			exit(127);
</a><a href="#h0-2732" id="h0-2732" class="i">+	}
</a><a href="#h0-2733" id="h0-2733" class="i">+
</a><a href="#h0-2734" id="h0-2734" class="i">+	/* parent */
</a><a href="#h0-2735" id="h0-2735" class="i">+	close(to[0]);
</a><a href="#h0-2736" id="h0-2736" class="i">+	/* ignore sigpipe for now, in case child exits early */
</a><a href="#h0-2737" id="h0-2737" class="i">+	oldsigpipe = signal(SIGPIPE, SIG_IGN);
</a><a href="#h0-2738" id="h0-2738" class="i">+
</a><a href="#h0-2739" id="h0-2739" class="i">+	for(n = 0; n &lt; term.row; n++){
</a><a href="#h0-2740" id="h0-2740" class="i">+		bp = &amp;term.line[n][0];
</a><a href="#h0-2741" id="h0-2741" class="i">+		end = &amp;bp[MIN(tlinelen(n), term.col) - 1];
</a><a href="#h0-2742" id="h0-2742" class="i">+		if(bp != end || bp-&gt;u != &apos; &apos;)
</a><a href="#h0-2743" id="h0-2743" class="i">+			for(; bp &lt;= end; ++bp)
</a><a href="#h0-2744" id="h0-2744" class="i">+				if(xwrite(to[1], buf, utf8encode(bp-&gt;u, buf)) &lt; 0)
</a><a href="#h0-2745" id="h0-2745" class="i">+					break;
</a><a href="#h0-2746" id="h0-2746" class="i">+		if(xwrite(to[1], &quot;\n&quot;, 1) &lt; 0)
</a><a href="#h0-2747" id="h0-2747" class="i">+			break;
</a><a href="#h0-2748" id="h0-2748" class="i">+	}
</a><a href="#h0-2749" id="h0-2749" class="i">+
</a><a href="#h0-2750" id="h0-2750" class="i">+	close(to[1]);
</a><a href="#h0-2751" id="h0-2751" class="i">+
</a><a href="#h0-2752" id="h0-2752" class="i">+	/* restore */
</a><a href="#h0-2753" id="h0-2753" class="i">+	signal(SIGPIPE, oldsigpipe);
</a><a href="#h0-2754" id="h0-2754" class="i">+}
</a><a href="#h0-2755" id="h0-2755" class="i">+
</a><a href="#h0-2756" id="h0-2756" class="i">+void
</a><a href="#h0-2757" id="h0-2757" class="i">+tputc(Rune u) {
</a><a href="#h0-2758" id="h0-2758" class="i">+	char c[UTF_SIZ];
</a><a href="#h0-2759" id="h0-2759" class="i">+	bool control;
</a><a href="#h0-2760" id="h0-2760" class="i">+	int width, len;
</a><a href="#h0-2761" id="h0-2761" class="i">+	Glyph *gp;
</a><a href="#h0-2762" id="h0-2762" class="i">+
</a><a href="#h0-2763" id="h0-2763" class="i">+	len = utf8encode(u, c);
</a><a href="#h0-2764" id="h0-2764" class="i">+	if((width = wcwidth(u)) == -1) {
</a><a href="#h0-2765" id="h0-2765" class="i">+		memcpy(c, &quot;\357\277\275&quot;, 4); /* UTF_INVALID */
</a><a href="#h0-2766" id="h0-2766" class="i">+		width = 1;
</a><a href="#h0-2767" id="h0-2767" class="i">+	}
</a><a href="#h0-2768" id="h0-2768" class="i">+
</a><a href="#h0-2769" id="h0-2769" class="i">+	if(IS_SET(MODE_PRINT))
</a><a href="#h0-2770" id="h0-2770" class="i">+		tprinter(c, len);
</a><a href="#h0-2771" id="h0-2771" class="i">+	control = ISCONTROL(u);
</a><a href="#h0-2772" id="h0-2772" class="i">+
</a><a href="#h0-2773" id="h0-2773" class="i">+	/*
</a><a href="#h0-2774" id="h0-2774" class="i">+	 * STR sequence must be checked before anything else
</a><a href="#h0-2775" id="h0-2775" class="i">+	 * because it uses all following characters until it
</a><a href="#h0-2776" id="h0-2776" class="i">+	 * receives a ESC, a SUB, a ST or any other C1 control
</a><a href="#h0-2777" id="h0-2777" class="i">+	 * character.
</a><a href="#h0-2778" id="h0-2778" class="i">+	 */
</a><a href="#h0-2779" id="h0-2779" class="i">+	if(term.esc &amp; ESC_STR) {
</a><a href="#h0-2780" id="h0-2780" class="i">+		if(u == &apos;\a&apos; || u == 030 || u == 032 || u == 033 ||
</a><a href="#h0-2781" id="h0-2781" class="i">+		   ISCONTROLC1(u)) {
</a><a href="#h0-2782" id="h0-2782" class="i">+			term.esc &amp;= ~(ESC_START|ESC_STR);
</a><a href="#h0-2783" id="h0-2783" class="i">+			term.esc |= ESC_STR_END;
</a><a href="#h0-2784" id="h0-2784" class="i">+		} else if(strescseq.len + len &lt; sizeof(strescseq.buf) - 1) {
</a><a href="#h0-2785" id="h0-2785" class="i">+			memmove(&amp;strescseq.buf[strescseq.len], c, len);
</a><a href="#h0-2786" id="h0-2786" class="i">+			strescseq.len += len;
</a><a href="#h0-2787" id="h0-2787" class="i">+			return;
</a><a href="#h0-2788" id="h0-2788" class="i">+		} else {
</a><a href="#h0-2789" id="h0-2789" class="i">+		/*
</a><a href="#h0-2790" id="h0-2790" class="i">+		 * Here is a bug in terminals. If the user never sends
</a><a href="#h0-2791" id="h0-2791" class="i">+		 * some code to stop the str or esc command, then st
</a><a href="#h0-2792" id="h0-2792" class="i">+		 * will stop responding. But this is better than
</a><a href="#h0-2793" id="h0-2793" class="i">+		 * silently failing with unknown characters. At least
</a><a href="#h0-2794" id="h0-2794" class="i">+		 * then users will report back.
</a><a href="#h0-2795" id="h0-2795" class="i">+		 *
</a><a href="#h0-2796" id="h0-2796" class="i">+		 * In the case users ever get fixed, here is the code:
</a><a href="#h0-2797" id="h0-2797" class="i">+		 */
</a><a href="#h0-2798" id="h0-2798" class="i">+		/*
</a><a href="#h0-2799" id="h0-2799" class="i">+		 * term.esc = 0;
</a><a href="#h0-2800" id="h0-2800" class="i">+		 * strhandle();
</a><a href="#h0-2801" id="h0-2801" class="i">+		 */
</a><a href="#h0-2802" id="h0-2802" class="i">+			return;
</a><a href="#h0-2803" id="h0-2803" class="i">+		}
</a><a href="#h0-2804" id="h0-2804" class="i">+	}
</a><a href="#h0-2805" id="h0-2805" class="i">+
</a><a href="#h0-2806" id="h0-2806" class="i">+	/*
</a><a href="#h0-2807" id="h0-2807" class="i">+	 * Actions of control codes must be performed as soon they arrive
</a><a href="#h0-2808" id="h0-2808" class="i">+	 * because they can be embedded inside a control sequence, and
</a><a href="#h0-2809" id="h0-2809" class="i">+	 * they must not cause conflicts with sequences.
</a><a href="#h0-2810" id="h0-2810" class="i">+	 */
</a><a href="#h0-2811" id="h0-2811" class="i">+	if(control) {
</a><a href="#h0-2812" id="h0-2812" class="i">+		tcontrolcode(u);
</a><a href="#h0-2813" id="h0-2813" class="i">+		/*
</a><a href="#h0-2814" id="h0-2814" class="i">+		 * control codes are not shown ever
</a><a href="#h0-2815" id="h0-2815" class="i">+		 */
</a><a href="#h0-2816" id="h0-2816" class="i">+		return;
</a><a href="#h0-2817" id="h0-2817" class="i">+	} else if(term.esc &amp; ESC_START) {
</a><a href="#h0-2818" id="h0-2818" class="i">+		if(term.esc &amp; ESC_CSI) {
</a><a href="#h0-2819" id="h0-2819" class="i">+			csiescseq.buf[csiescseq.len++] = u;
</a><a href="#h0-2820" id="h0-2820" class="i">+			if(BETWEEN(u, 0x40, 0x7E)
</a><a href="#h0-2821" id="h0-2821" class="i">+					|| csiescseq.len &gt;= \
</a><a href="#h0-2822" id="h0-2822" class="i">+					sizeof(csiescseq.buf)-1) {
</a><a href="#h0-2823" id="h0-2823" class="i">+				term.esc = 0;
</a><a href="#h0-2824" id="h0-2824" class="i">+				csiparse();
</a><a href="#h0-2825" id="h0-2825" class="i">+				csihandle();
</a><a href="#h0-2826" id="h0-2826" class="i">+			}
</a><a href="#h0-2827" id="h0-2827" class="i">+			return;
</a><a href="#h0-2828" id="h0-2828" class="i">+		} else if(term.esc &amp; ESC_ALTCHARSET) {
</a><a href="#h0-2829" id="h0-2829" class="i">+			tdeftran(u);
</a><a href="#h0-2830" id="h0-2830" class="i">+		} else if(term.esc &amp; ESC_TEST) {
</a><a href="#h0-2831" id="h0-2831" class="i">+			tdectest(u);
</a><a href="#h0-2832" id="h0-2832" class="i">+		} else {
</a><a href="#h0-2833" id="h0-2833" class="i">+			if (!eschandle(u))
</a><a href="#h0-2834" id="h0-2834" class="i">+				return;
</a><a href="#h0-2835" id="h0-2835" class="i">+			/* sequence already finished */
</a><a href="#h0-2836" id="h0-2836" class="i">+		}
</a><a href="#h0-2837" id="h0-2837" class="i">+		term.esc = 0;
</a><a href="#h0-2838" id="h0-2838" class="i">+		/*
</a><a href="#h0-2839" id="h0-2839" class="i">+		 * All characters which form part of a sequence are not
</a><a href="#h0-2840" id="h0-2840" class="i">+		 * printed
</a><a href="#h0-2841" id="h0-2841" class="i">+		 */
</a><a href="#h0-2842" id="h0-2842" class="i">+		return;
</a><a href="#h0-2843" id="h0-2843" class="i">+	}
</a><a href="#h0-2844" id="h0-2844" class="i">+	if(sel.ob.x != -1 &amp;&amp; BETWEEN(term.c.y, sel.ob.y, sel.oe.y))
</a><a href="#h0-2845" id="h0-2845" class="i">+		selclear(NULL);
</a><a href="#h0-2846" id="h0-2846" class="i">+
</a><a href="#h0-2847" id="h0-2847" class="i">+	gp = &amp;term.line[term.c.y][term.c.x];
</a><a href="#h0-2848" id="h0-2848" class="i">+	if(IS_SET(MODE_WRAP) &amp;&amp; (term.c.state &amp; CURSOR_WRAPNEXT)) {
</a><a href="#h0-2849" id="h0-2849" class="i">+		gp-&gt;mode |= ATTR_WRAP;
</a><a href="#h0-2850" id="h0-2850" class="i">+		tnewline(1);
</a><a href="#h0-2851" id="h0-2851" class="i">+		gp = &amp;term.line[term.c.y][term.c.x];
</a><a href="#h0-2852" id="h0-2852" class="i">+	}
</a><a href="#h0-2853" id="h0-2853" class="i">+
</a><a href="#h0-2854" id="h0-2854" class="i">+	if(IS_SET(MODE_INSERT) &amp;&amp; term.c.x+width &lt; term.col)
</a><a href="#h0-2855" id="h0-2855" class="i">+		memmove(gp+width, gp, (term.col - term.c.x - width) * sizeof(Glyph));
</a><a href="#h0-2856" id="h0-2856" class="i">+
</a><a href="#h0-2857" id="h0-2857" class="i">+	if(term.c.x+width &gt; term.col) {
</a><a href="#h0-2858" id="h0-2858" class="i">+		tnewline(1);
</a><a href="#h0-2859" id="h0-2859" class="i">+		gp = &amp;term.line[term.c.y][term.c.x];
</a><a href="#h0-2860" id="h0-2860" class="i">+	}
</a><a href="#h0-2861" id="h0-2861" class="i">+
</a><a href="#h0-2862" id="h0-2862" class="i">+	tsetchar(u, &amp;term.c.attr, term.c.x, term.c.y);
</a><a href="#h0-2863" id="h0-2863" class="i">+
</a><a href="#h0-2864" id="h0-2864" class="i">+	if(width == 2) {
</a><a href="#h0-2865" id="h0-2865" class="i">+		gp-&gt;mode |= ATTR_WIDE;
</a><a href="#h0-2866" id="h0-2866" class="i">+		if(term.c.x+1 &lt; term.col) {
</a><a href="#h0-2867" id="h0-2867" class="i">+			gp[1].u = &apos;\0&apos;;
</a><a href="#h0-2868" id="h0-2868" class="i">+			gp[1].mode = ATTR_WDUMMY;
</a><a href="#h0-2869" id="h0-2869" class="i">+		}
</a><a href="#h0-2870" id="h0-2870" class="i">+	}
</a><a href="#h0-2871" id="h0-2871" class="i">+	if(term.c.x+width &lt; term.col) {
</a><a href="#h0-2872" id="h0-2872" class="i">+		tmoveto(term.c.x+width, term.c.y);
</a><a href="#h0-2873" id="h0-2873" class="i">+	} else {
</a><a href="#h0-2874" id="h0-2874" class="i">+		term.c.state |= CURSOR_WRAPNEXT;
</a><a href="#h0-2875" id="h0-2875" class="i">+	}
</a><a href="#h0-2876" id="h0-2876" class="i">+}
</a><a href="#h0-2877" id="h0-2877" class="i">+
</a><a href="#h0-2878" id="h0-2878" class="i">+void
</a><a href="#h0-2879" id="h0-2879" class="i">+tresize(int col, int row) {
</a><a href="#h0-2880" id="h0-2880" class="i">+	int i;
</a><a href="#h0-2881" id="h0-2881" class="i">+	int minrow = MIN(row, term.row);
</a><a href="#h0-2882" id="h0-2882" class="i">+	int mincol = MIN(col, term.col);
</a><a href="#h0-2883" id="h0-2883" class="i">+	bool *bp;
</a><a href="#h0-2884" id="h0-2884" class="i">+	TCursor c;
</a><a href="#h0-2885" id="h0-2885" class="i">+
</a><a href="#h0-2886" id="h0-2886" class="i">+	if(col &lt; 1 || row &lt; 1) {
</a><a href="#h0-2887" id="h0-2887" class="i">+		fprintf(stderr,
</a><a href="#h0-2888" id="h0-2888" class="i">+		        &quot;tresize: error resizing to %dx%d\n&quot;, col, row);
</a><a href="#h0-2889" id="h0-2889" class="i">+		return;
</a><a href="#h0-2890" id="h0-2890" class="i">+	}
</a><a href="#h0-2891" id="h0-2891" class="i">+
</a><a href="#h0-2892" id="h0-2892" class="i">+	/*
</a><a href="#h0-2893" id="h0-2893" class="i">+	 * slide screen to keep cursor where we expect it -
</a><a href="#h0-2894" id="h0-2894" class="i">+	 * tscrollup would work here, but we can optimize to
</a><a href="#h0-2895" id="h0-2895" class="i">+	 * memmove because we&apos;re freeing the earlier lines
</a><a href="#h0-2896" id="h0-2896" class="i">+	 */
</a><a href="#h0-2897" id="h0-2897" class="i">+	for(i = 0; i &lt;= term.c.y - row; i++) {
</a><a href="#h0-2898" id="h0-2898" class="i">+		free(term.line[i]);
</a><a href="#h0-2899" id="h0-2899" class="i">+		free(term.alt[i]);
</a><a href="#h0-2900" id="h0-2900" class="i">+	}
</a><a href="#h0-2901" id="h0-2901" class="i">+	/* ensure that both src and dst are not NULL */
</a><a href="#h0-2902" id="h0-2902" class="i">+	if (i &gt; 0) {
</a><a href="#h0-2903" id="h0-2903" class="i">+		memmove(term.line, term.line + i, row * sizeof(Line));
</a><a href="#h0-2904" id="h0-2904" class="i">+		memmove(term.alt, term.alt + i, row * sizeof(Line));
</a><a href="#h0-2905" id="h0-2905" class="i">+	}
</a><a href="#h0-2906" id="h0-2906" class="i">+	for(i += row; i &lt; term.row; i++) {
</a><a href="#h0-2907" id="h0-2907" class="i">+		free(term.line[i]);
</a><a href="#h0-2908" id="h0-2908" class="i">+		free(term.alt[i]);
</a><a href="#h0-2909" id="h0-2909" class="i">+	}
</a><a href="#h0-2910" id="h0-2910" class="i">+
</a><a href="#h0-2911" id="h0-2911" class="i">+	/* resize to new width */
</a><a href="#h0-2912" id="h0-2912" class="i">+	term.specbuf = xrealloc(term.specbuf, col * sizeof(XftGlyphFontSpec));
</a><a href="#h0-2913" id="h0-2913" class="i">+
</a><a href="#h0-2914" id="h0-2914" class="i">+	/* resize to new height */
</a><a href="#h0-2915" id="h0-2915" class="i">+	term.line = xrealloc(term.line, row * sizeof(Line));
</a><a href="#h0-2916" id="h0-2916" class="i">+	term.alt  = xrealloc(term.alt,  row * sizeof(Line));
</a><a href="#h0-2917" id="h0-2917" class="i">+	term.dirty = xrealloc(term.dirty, row * sizeof(*term.dirty));
</a><a href="#h0-2918" id="h0-2918" class="i">+	term.tabs = xrealloc(term.tabs, col * sizeof(*term.tabs));
</a><a href="#h0-2919" id="h0-2919" class="i">+
</a><a href="#h0-2920" id="h0-2920" class="i">+	/* resize each row to new width, zero-pad if needed */
</a><a href="#h0-2921" id="h0-2921" class="i">+	for(i = 0; i &lt; minrow; i++) {
</a><a href="#h0-2922" id="h0-2922" class="i">+		term.line[i] = xrealloc(term.line[i], col * sizeof(Glyph));
</a><a href="#h0-2923" id="h0-2923" class="i">+		term.alt[i]  = xrealloc(term.alt[i],  col * sizeof(Glyph));
</a><a href="#h0-2924" id="h0-2924" class="i">+	}
</a><a href="#h0-2925" id="h0-2925" class="i">+
</a><a href="#h0-2926" id="h0-2926" class="i">+	/* allocate any new rows */
</a><a href="#h0-2927" id="h0-2927" class="i">+	for(/* i == minrow */; i &lt; row; i++) {
</a><a href="#h0-2928" id="h0-2928" class="i">+		term.line[i] = xmalloc(col * sizeof(Glyph));
</a><a href="#h0-2929" id="h0-2929" class="i">+		term.alt[i] = xmalloc(col * sizeof(Glyph));
</a><a href="#h0-2930" id="h0-2930" class="i">+	}
</a><a href="#h0-2931" id="h0-2931" class="i">+	if(col &gt; term.col) {
</a><a href="#h0-2932" id="h0-2932" class="i">+		bp = term.tabs + term.col;
</a><a href="#h0-2933" id="h0-2933" class="i">+
</a><a href="#h0-2934" id="h0-2934" class="i">+		memset(bp, 0, sizeof(*term.tabs) * (col - term.col));
</a><a href="#h0-2935" id="h0-2935" class="i">+		while(--bp &gt; term.tabs &amp;&amp; !*bp)
</a><a href="#h0-2936" id="h0-2936" class="i">+			/* nothing */ ;
</a><a href="#h0-2937" id="h0-2937" class="i">+		for(bp += tabspaces; bp &lt; term.tabs + col; bp += tabspaces)
</a><a href="#h0-2938" id="h0-2938" class="i">+			*bp = 1;
</a><a href="#h0-2939" id="h0-2939" class="i">+	}
</a><a href="#h0-2940" id="h0-2940" class="i">+	/* update terminal size */
</a><a href="#h0-2941" id="h0-2941" class="i">+	term.col = col;
</a><a href="#h0-2942" id="h0-2942" class="i">+	term.row = row;
</a><a href="#h0-2943" id="h0-2943" class="i">+	/* reset scrolling region */
</a><a href="#h0-2944" id="h0-2944" class="i">+	tsetscroll(0, row-1);
</a><a href="#h0-2945" id="h0-2945" class="i">+	/* make use of the LIMIT in tmoveto */
</a><a href="#h0-2946" id="h0-2946" class="i">+	tmoveto(term.c.x, term.c.y);
</a><a href="#h0-2947" id="h0-2947" class="i">+	/* Clearing both screens (it makes dirty all lines) */
</a><a href="#h0-2948" id="h0-2948" class="i">+	c = term.c;
</a><a href="#h0-2949" id="h0-2949" class="i">+	for(i = 0; i &lt; 2; i++) {
</a><a href="#h0-2950" id="h0-2950" class="i">+		if(mincol &lt; col &amp;&amp; 0 &lt; minrow) {
</a><a href="#h0-2951" id="h0-2951" class="i">+			tclearregion(mincol, 0, col - 1, minrow - 1);
</a><a href="#h0-2952" id="h0-2952" class="i">+		}
</a><a href="#h0-2953" id="h0-2953" class="i">+		if(0 &lt; col &amp;&amp; minrow &lt; row) {
</a><a href="#h0-2954" id="h0-2954" class="i">+			tclearregion(0, minrow, col - 1, row - 1);
</a><a href="#h0-2955" id="h0-2955" class="i">+		}
</a><a href="#h0-2956" id="h0-2956" class="i">+		tswapscreen();
</a><a href="#h0-2957" id="h0-2957" class="i">+		tcursor(CURSOR_LOAD);
</a><a href="#h0-2958" id="h0-2958" class="i">+	}
</a><a href="#h0-2959" id="h0-2959" class="i">+	term.c = c;
</a><a href="#h0-2960" id="h0-2960" class="i">+}
</a><a href="#h0-2961" id="h0-2961" class="i">+
</a><a href="#h0-2962" id="h0-2962" class="i">+void
</a><a href="#h0-2963" id="h0-2963" class="i">+xresize(int col, int row) {
</a><a href="#h0-2964" id="h0-2964" class="i">+	xw.tw = MAX(1, col * xw.cw);
</a><a href="#h0-2965" id="h0-2965" class="i">+	xw.th = MAX(1, row * xw.ch);
</a><a href="#h0-2966" id="h0-2966" class="i">+
</a><a href="#h0-2967" id="h0-2967" class="i">+	XFreePixmap(xw.dpy, xw.buf);
</a><a href="#h0-2968" id="h0-2968" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, xw.w, xw.h,
</a><a href="#h0-2969" id="h0-2969" class="i">+			DefaultDepth(xw.dpy, xw.scr));
</a><a href="#h0-2970" id="h0-2970" class="i">+	XftDrawChange(xw.draw, xw.buf);
</a><a href="#h0-2971" id="h0-2971" class="i">+	xclear(0, 0, xw.w, xw.h);
</a><a href="#h0-2972" id="h0-2972" class="i">+}
</a><a href="#h0-2973" id="h0-2973" class="i">+
</a><a href="#h0-2974" id="h0-2974" class="i">+ushort
</a><a href="#h0-2975" id="h0-2975" class="i">+sixd_to_16bit(int x) {
</a><a href="#h0-2976" id="h0-2976" class="i">+	return x == 0 ? 0 : 0x3737 + 0x2828 * x;
</a><a href="#h0-2977" id="h0-2977" class="i">+}
</a><a href="#h0-2978" id="h0-2978" class="i">+
</a><a href="#h0-2979" id="h0-2979" class="i">+bool
</a><a href="#h0-2980" id="h0-2980" class="i">+xloadcolor(int i, const char *name, Color *ncolor) {
</a><a href="#h0-2981" id="h0-2981" class="i">+	XRenderColor color = { .alpha = 0xffff };
</a><a href="#h0-2982" id="h0-2982" class="i">+
</a><a href="#h0-2983" id="h0-2983" class="i">+	if(!name) {
</a><a href="#h0-2984" id="h0-2984" class="i">+		if(BETWEEN(i, 16, 255)) { /* 256 color */
</a><a href="#h0-2985" id="h0-2985" class="i">+			if(i &lt; 6*6*6+16) { /* same colors as xterm */
</a><a href="#h0-2986" id="h0-2986" class="i">+				color.red   = sixd_to_16bit( ((i-16)/36)%6 );
</a><a href="#h0-2987" id="h0-2987" class="i">+				color.green = sixd_to_16bit( ((i-16)/6) %6 );
</a><a href="#h0-2988" id="h0-2988" class="i">+				color.blue  = sixd_to_16bit( ((i-16)/1) %6 );
</a><a href="#h0-2989" id="h0-2989" class="i">+			} else { /* greyscale */
</a><a href="#h0-2990" id="h0-2990" class="i">+				color.red = 0x0808 + 0x0a0a * (i - (6*6*6+16));
</a><a href="#h0-2991" id="h0-2991" class="i">+				color.green = color.blue = color.red;
</a><a href="#h0-2992" id="h0-2992" class="i">+			}
</a><a href="#h0-2993" id="h0-2993" class="i">+			return XftColorAllocValue(xw.dpy, xw.vis,
</a><a href="#h0-2994" id="h0-2994" class="i">+			                          xw.cmap, &amp;color, ncolor);
</a><a href="#h0-2995" id="h0-2995" class="i">+		} else
</a><a href="#h0-2996" id="h0-2996" class="i">+			name = colorname[i];
</a><a href="#h0-2997" id="h0-2997" class="i">+	}
</a><a href="#h0-2998" id="h0-2998" class="i">+	return XftColorAllocName(xw.dpy, xw.vis, xw.cmap, name, ncolor);
</a><a href="#h0-2999" id="h0-2999" class="i">+}
</a><a href="#h0-3000" id="h0-3000" class="i">+
</a><a href="#h0-3001" id="h0-3001" class="i">+void
</a><a href="#h0-3002" id="h0-3002" class="i">+xloadcols(void) {
</a><a href="#h0-3003" id="h0-3003" class="i">+	int i;
</a><a href="#h0-3004" id="h0-3004" class="i">+	static bool loaded;
</a><a href="#h0-3005" id="h0-3005" class="i">+	Color *cp;
</a><a href="#h0-3006" id="h0-3006" class="i">+
</a><a href="#h0-3007" id="h0-3007" class="i">+	if(loaded) {
</a><a href="#h0-3008" id="h0-3008" class="i">+		for (cp = dc.col; cp &lt; &amp;dc.col[LEN(dc.col)]; ++cp)
</a><a href="#h0-3009" id="h0-3009" class="i">+			XftColorFree(xw.dpy, xw.vis, xw.cmap, cp);
</a><a href="#h0-3010" id="h0-3010" class="i">+	}
</a><a href="#h0-3011" id="h0-3011" class="i">+
</a><a href="#h0-3012" id="h0-3012" class="i">+	for(i = 0; i &lt; LEN(dc.col); i++)
</a><a href="#h0-3013" id="h0-3013" class="i">+		if(!xloadcolor(i, NULL, &amp;dc.col[i])) {
</a><a href="#h0-3014" id="h0-3014" class="i">+			if(colorname[i])
</a><a href="#h0-3015" id="h0-3015" class="i">+				die(&quot;Could not allocate color &apos;%s&apos;\n&quot;, colorname[i]);
</a><a href="#h0-3016" id="h0-3016" class="i">+			else
</a><a href="#h0-3017" id="h0-3017" class="i">+				die(&quot;Could not allocate color %d\n&quot;, i);
</a><a href="#h0-3018" id="h0-3018" class="i">+		}
</a><a href="#h0-3019" id="h0-3019" class="i">+	loaded = true;
</a><a href="#h0-3020" id="h0-3020" class="i">+}
</a><a href="#h0-3021" id="h0-3021" class="i">+
</a><a href="#h0-3022" id="h0-3022" class="i">+int
</a><a href="#h0-3023" id="h0-3023" class="i">+xsetcolorname(int x, const char *name) {
</a><a href="#h0-3024" id="h0-3024" class="i">+	Color ncolor;
</a><a href="#h0-3025" id="h0-3025" class="i">+
</a><a href="#h0-3026" id="h0-3026" class="i">+	if(!BETWEEN(x, 0, LEN(dc.col)))
</a><a href="#h0-3027" id="h0-3027" class="i">+		return 1;
</a><a href="#h0-3028" id="h0-3028" class="i">+
</a><a href="#h0-3029" id="h0-3029" class="i">+
</a><a href="#h0-3030" id="h0-3030" class="i">+	if(!xloadcolor(x, name, &amp;ncolor))
</a><a href="#h0-3031" id="h0-3031" class="i">+		return 1;
</a><a href="#h0-3032" id="h0-3032" class="i">+
</a><a href="#h0-3033" id="h0-3033" class="i">+	XftColorFree(xw.dpy, xw.vis, xw.cmap, &amp;dc.col[x]);
</a><a href="#h0-3034" id="h0-3034" class="i">+	dc.col[x] = ncolor;
</a><a href="#h0-3035" id="h0-3035" class="i">+	return 0;
</a><a href="#h0-3036" id="h0-3036" class="i">+}
</a><a href="#h0-3037" id="h0-3037" class="i">+
</a><a href="#h0-3038" id="h0-3038" class="i">+void
</a><a href="#h0-3039" id="h0-3039" class="i">+xtermclear(int col1, int row1, int col2, int row2) {
</a><a href="#h0-3040" id="h0-3040" class="i">+	XftDrawRect(xw.draw,
</a><a href="#h0-3041" id="h0-3041" class="i">+			&amp;dc.col[IS_SET(MODE_REVERSE) ? defaultfg : defaultbg],
</a><a href="#h0-3042" id="h0-3042" class="i">+			borderpx + col1 * xw.cw,
</a><a href="#h0-3043" id="h0-3043" class="i">+			borderpx + row1 * xw.ch,
</a><a href="#h0-3044" id="h0-3044" class="i">+			(col2-col1+1) * xw.cw,
</a><a href="#h0-3045" id="h0-3045" class="i">+			(row2-row1+1) * xw.ch);
</a><a href="#h0-3046" id="h0-3046" class="i">+}
</a><a href="#h0-3047" id="h0-3047" class="i">+
</a><a href="#h0-3048" id="h0-3048" class="i">+/*
</a><a href="#h0-3049" id="h0-3049" class="i">+ * Absolute coordinates.
</a><a href="#h0-3050" id="h0-3050" class="i">+ */
</a><a href="#h0-3051" id="h0-3051" class="i">+void
</a><a href="#h0-3052" id="h0-3052" class="i">+xclear(int x1, int y1, int x2, int y2) {
</a><a href="#h0-3053" id="h0-3053" class="i">+	XftDrawRect(xw.draw,
</a><a href="#h0-3054" id="h0-3054" class="i">+			&amp;dc.col[IS_SET(MODE_REVERSE)? defaultfg : defaultbg],
</a><a href="#h0-3055" id="h0-3055" class="i">+			x1, y1, x2-x1, y2-y1);
</a><a href="#h0-3056" id="h0-3056" class="i">+}
</a><a href="#h0-3057" id="h0-3057" class="i">+
</a><a href="#h0-3058" id="h0-3058" class="i">+void
</a><a href="#h0-3059" id="h0-3059" class="i">+xhints(void) {
</a><a href="#h0-3060" id="h0-3060" class="i">+	XClassHint class = {opt_class ? opt_class : termname, termname};
</a><a href="#h0-3061" id="h0-3061" class="i">+	XWMHints wm = {.flags = InputHint, .input = 1};
</a><a href="#h0-3062" id="h0-3062" class="i">+	XSizeHints *sizeh = NULL;
</a><a href="#h0-3063" id="h0-3063" class="i">+
</a><a href="#h0-3064" id="h0-3064" class="i">+	sizeh = XAllocSizeHints();
</a><a href="#h0-3065" id="h0-3065" class="i">+
</a><a href="#h0-3066" id="h0-3066" class="i">+	sizeh-&gt;flags = PSize | PResizeInc | PBaseSize;
</a><a href="#h0-3067" id="h0-3067" class="i">+	sizeh-&gt;height = xw.h;
</a><a href="#h0-3068" id="h0-3068" class="i">+	sizeh-&gt;width = xw.w;
</a><a href="#h0-3069" id="h0-3069" class="i">+	sizeh-&gt;height_inc = xw.ch;
</a><a href="#h0-3070" id="h0-3070" class="i">+	sizeh-&gt;width_inc = xw.cw;
</a><a href="#h0-3071" id="h0-3071" class="i">+	sizeh-&gt;base_height = 2 * borderpx;
</a><a href="#h0-3072" id="h0-3072" class="i">+	sizeh-&gt;base_width = 2 * borderpx;
</a><a href="#h0-3073" id="h0-3073" class="i">+	if(xw.isfixed == True) {
</a><a href="#h0-3074" id="h0-3074" class="i">+		sizeh-&gt;flags |= PMaxSize | PMinSize;
</a><a href="#h0-3075" id="h0-3075" class="i">+		sizeh-&gt;min_width = sizeh-&gt;max_width = xw.w;
</a><a href="#h0-3076" id="h0-3076" class="i">+		sizeh-&gt;min_height = sizeh-&gt;max_height = xw.h;
</a><a href="#h0-3077" id="h0-3077" class="i">+	}
</a><a href="#h0-3078" id="h0-3078" class="i">+	if(xw.gm &amp; (XValue|YValue)) {
</a><a href="#h0-3079" id="h0-3079" class="i">+		sizeh-&gt;flags |= USPosition | PWinGravity;
</a><a href="#h0-3080" id="h0-3080" class="i">+		sizeh-&gt;x = xw.l;
</a><a href="#h0-3081" id="h0-3081" class="i">+		sizeh-&gt;y = xw.t;
</a><a href="#h0-3082" id="h0-3082" class="i">+		sizeh-&gt;win_gravity = xgeommasktogravity(xw.gm);
</a><a href="#h0-3083" id="h0-3083" class="i">+	}
</a><a href="#h0-3084" id="h0-3084" class="i">+
</a><a href="#h0-3085" id="h0-3085" class="i">+	XSetWMProperties(xw.dpy, xw.win, NULL, NULL, NULL, 0, sizeh, &amp;wm,
</a><a href="#h0-3086" id="h0-3086" class="i">+			&amp;class);
</a><a href="#h0-3087" id="h0-3087" class="i">+	XFree(sizeh);
</a><a href="#h0-3088" id="h0-3088" class="i">+}
</a><a href="#h0-3089" id="h0-3089" class="i">+
</a><a href="#h0-3090" id="h0-3090" class="i">+int
</a><a href="#h0-3091" id="h0-3091" class="i">+xgeommasktogravity(int mask) {
</a><a href="#h0-3092" id="h0-3092" class="i">+	switch(mask &amp; (XNegative|YNegative)) {
</a><a href="#h0-3093" id="h0-3093" class="i">+	case 0:
</a><a href="#h0-3094" id="h0-3094" class="i">+		return NorthWestGravity;
</a><a href="#h0-3095" id="h0-3095" class="i">+	case XNegative:
</a><a href="#h0-3096" id="h0-3096" class="i">+		return NorthEastGravity;
</a><a href="#h0-3097" id="h0-3097" class="i">+	case YNegative:
</a><a href="#h0-3098" id="h0-3098" class="i">+		return SouthWestGravity;
</a><a href="#h0-3099" id="h0-3099" class="i">+	}
</a><a href="#h0-3100" id="h0-3100" class="i">+	return SouthEastGravity;
</a><a href="#h0-3101" id="h0-3101" class="i">+}
</a><a href="#h0-3102" id="h0-3102" class="i">+
</a><a href="#h0-3103" id="h0-3103" class="i">+int
</a><a href="#h0-3104" id="h0-3104" class="i">+xloadfont(Font *f, FcPattern *pattern) {
</a><a href="#h0-3105" id="h0-3105" class="i">+	FcPattern *match;
</a><a href="#h0-3106" id="h0-3106" class="i">+	FcResult result;
</a><a href="#h0-3107" id="h0-3107" class="i">+
</a><a href="#h0-3108" id="h0-3108" class="i">+	match = FcFontMatch(NULL, pattern, &amp;result);
</a><a href="#h0-3109" id="h0-3109" class="i">+	if(!match)
</a><a href="#h0-3110" id="h0-3110" class="i">+		return 1;
</a><a href="#h0-3111" id="h0-3111" class="i">+
</a><a href="#h0-3112" id="h0-3112" class="i">+	if(!(f-&gt;match = XftFontOpenPattern(xw.dpy, match))) {
</a><a href="#h0-3113" id="h0-3113" class="i">+		FcPatternDestroy(match);
</a><a href="#h0-3114" id="h0-3114" class="i">+		return 1;
</a><a href="#h0-3115" id="h0-3115" class="i">+	}
</a><a href="#h0-3116" id="h0-3116" class="i">+
</a><a href="#h0-3117" id="h0-3117" class="i">+	f-&gt;set = NULL;
</a><a href="#h0-3118" id="h0-3118" class="i">+	f-&gt;pattern = FcPatternDuplicate(pattern);
</a><a href="#h0-3119" id="h0-3119" class="i">+
</a><a href="#h0-3120" id="h0-3120" class="i">+	f-&gt;ascent = f-&gt;match-&gt;ascent;
</a><a href="#h0-3121" id="h0-3121" class="i">+	f-&gt;descent = f-&gt;match-&gt;descent;
</a><a href="#h0-3122" id="h0-3122" class="i">+	f-&gt;lbearing = 0;
</a><a href="#h0-3123" id="h0-3123" class="i">+	f-&gt;rbearing = f-&gt;match-&gt;max_advance_width;
</a><a href="#h0-3124" id="h0-3124" class="i">+
</a><a href="#h0-3125" id="h0-3125" class="i">+	f-&gt;height = f-&gt;ascent + f-&gt;descent;
</a><a href="#h0-3126" id="h0-3126" class="i">+	f-&gt;width = f-&gt;lbearing + f-&gt;rbearing;
</a><a href="#h0-3127" id="h0-3127" class="i">+
</a><a href="#h0-3128" id="h0-3128" class="i">+	return 0;
</a><a href="#h0-3129" id="h0-3129" class="i">+}
</a><a href="#h0-3130" id="h0-3130" class="i">+
</a><a href="#h0-3131" id="h0-3131" class="i">+void
</a><a href="#h0-3132" id="h0-3132" class="i">+xloadfonts(char *fontstr, double fontsize) {
</a><a href="#h0-3133" id="h0-3133" class="i">+	FcPattern *pattern;
</a><a href="#h0-3134" id="h0-3134" class="i">+	double fontval;
</a><a href="#h0-3135" id="h0-3135" class="i">+	float ceilf(float);
</a><a href="#h0-3136" id="h0-3136" class="i">+
</a><a href="#h0-3137" id="h0-3137" class="i">+	if(fontstr[0] == &apos;-&apos;) {
</a><a href="#h0-3138" id="h0-3138" class="i">+		pattern = XftXlfdParse(fontstr, False, False);
</a><a href="#h0-3139" id="h0-3139" class="i">+	} else {
</a><a href="#h0-3140" id="h0-3140" class="i">+		pattern = FcNameParse((FcChar8 *)fontstr);
</a><a href="#h0-3141" id="h0-3141" class="i">+	}
</a><a href="#h0-3142" id="h0-3142" class="i">+
</a><a href="#h0-3143" id="h0-3143" class="i">+	if(!pattern)
</a><a href="#h0-3144" id="h0-3144" class="i">+		die(&quot;st: can&apos;t open font %s\n&quot;, fontstr);
</a><a href="#h0-3145" id="h0-3145" class="i">+
</a><a href="#h0-3146" id="h0-3146" class="i">+	if(fontsize &gt; 1) {
</a><a href="#h0-3147" id="h0-3147" class="i">+		FcPatternDel(pattern, FC_PIXEL_SIZE);
</a><a href="#h0-3148" id="h0-3148" class="i">+		FcPatternDel(pattern, FC_SIZE);
</a><a href="#h0-3149" id="h0-3149" class="i">+		FcPatternAddDouble(pattern, FC_PIXEL_SIZE, (double)fontsize);
</a><a href="#h0-3150" id="h0-3150" class="i">+		usedfontsize = fontsize;
</a><a href="#h0-3151" id="h0-3151" class="i">+	} else {
</a><a href="#h0-3152" id="h0-3152" class="i">+		if(FcPatternGetDouble(pattern, FC_PIXEL_SIZE, 0, &amp;fontval) ==
</a><a href="#h0-3153" id="h0-3153" class="i">+				FcResultMatch) {
</a><a href="#h0-3154" id="h0-3154" class="i">+			usedfontsize = fontval;
</a><a href="#h0-3155" id="h0-3155" class="i">+		} else if(FcPatternGetDouble(pattern, FC_SIZE, 0, &amp;fontval) ==
</a><a href="#h0-3156" id="h0-3156" class="i">+				FcResultMatch) {
</a><a href="#h0-3157" id="h0-3157" class="i">+			usedfontsize = -1;
</a><a href="#h0-3158" id="h0-3158" class="i">+		} else {
</a><a href="#h0-3159" id="h0-3159" class="i">+			/*
</a><a href="#h0-3160" id="h0-3160" class="i">+			 * Default font size is 12, if none given. This is to
</a><a href="#h0-3161" id="h0-3161" class="i">+			 * have a known usedfontsize value.
</a><a href="#h0-3162" id="h0-3162" class="i">+			 */
</a><a href="#h0-3163" id="h0-3163" class="i">+			FcPatternAddDouble(pattern, FC_PIXEL_SIZE, 12);
</a><a href="#h0-3164" id="h0-3164" class="i">+			usedfontsize = 12;
</a><a href="#h0-3165" id="h0-3165" class="i">+		}
</a><a href="#h0-3166" id="h0-3166" class="i">+		defaultfontsize = usedfontsize;
</a><a href="#h0-3167" id="h0-3167" class="i">+	}
</a><a href="#h0-3168" id="h0-3168" class="i">+
</a><a href="#h0-3169" id="h0-3169" class="i">+	FcConfigSubstitute(0, pattern, FcMatchPattern);
</a><a href="#h0-3170" id="h0-3170" class="i">+	FcDefaultSubstitute(pattern);
</a><a href="#h0-3171" id="h0-3171" class="i">+
</a><a href="#h0-3172" id="h0-3172" class="i">+	if(xloadfont(&amp;dc.font, pattern))
</a><a href="#h0-3173" id="h0-3173" class="i">+		die(&quot;st: can&apos;t open font %s\n&quot;, fontstr);
</a><a href="#h0-3174" id="h0-3174" class="i">+
</a><a href="#h0-3175" id="h0-3175" class="i">+	if(usedfontsize &lt; 0) {
</a><a href="#h0-3176" id="h0-3176" class="i">+		FcPatternGetDouble(dc.font.match-&gt;pattern,
</a><a href="#h0-3177" id="h0-3177" class="i">+		                   FC_PIXEL_SIZE, 0, &amp;fontval);
</a><a href="#h0-3178" id="h0-3178" class="i">+		usedfontsize = fontval;
</a><a href="#h0-3179" id="h0-3179" class="i">+		if(fontsize == 0)
</a><a href="#h0-3180" id="h0-3180" class="i">+			defaultfontsize = fontval;
</a><a href="#h0-3181" id="h0-3181" class="i">+	}
</a><a href="#h0-3182" id="h0-3182" class="i">+
</a><a href="#h0-3183" id="h0-3183" class="i">+	/* Setting character width and height. */
</a><a href="#h0-3184" id="h0-3184" class="i">+	xw.cw = ceilf(dc.font.width * cwscale);
</a><a href="#h0-3185" id="h0-3185" class="i">+	xw.ch = ceilf(dc.font.height * chscale);
</a><a href="#h0-3186" id="h0-3186" class="i">+
</a><a href="#h0-3187" id="h0-3187" class="i">+	FcPatternDel(pattern, FC_SLANT);
</a><a href="#h0-3188" id="h0-3188" class="i">+	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ITALIC);
</a><a href="#h0-3189" id="h0-3189" class="i">+	if(xloadfont(&amp;dc.ifont, pattern))
</a><a href="#h0-3190" id="h0-3190" class="i">+		die(&quot;st: can&apos;t open font %s\n&quot;, fontstr);
</a><a href="#h0-3191" id="h0-3191" class="i">+
</a><a href="#h0-3192" id="h0-3192" class="i">+  if (bold_font) {
</a><a href="#h0-3193" id="h0-3193" class="i">+    FcPatternDel(pattern, FC_WEIGHT);
</a><a href="#h0-3194" id="h0-3194" class="i">+    FcPatternAddInteger(pattern, FC_WEIGHT, FC_WEIGHT_BOLD);
</a><a href="#h0-3195" id="h0-3195" class="i">+  }
</a><a href="#h0-3196" id="h0-3196" class="i">+	if(xloadfont(&amp;dc.ibfont, pattern))
</a><a href="#h0-3197" id="h0-3197" class="i">+		die(&quot;st: can&apos;t open font %s\n&quot;, fontstr);
</a><a href="#h0-3198" id="h0-3198" class="i">+
</a><a href="#h0-3199" id="h0-3199" class="i">+	FcPatternDel(pattern, FC_SLANT);
</a><a href="#h0-3200" id="h0-3200" class="i">+	FcPatternAddInteger(pattern, FC_SLANT, FC_SLANT_ROMAN);
</a><a href="#h0-3201" id="h0-3201" class="i">+	if(xloadfont(&amp;dc.bfont, pattern))
</a><a href="#h0-3202" id="h0-3202" class="i">+		die(&quot;st: can&apos;t open font %s\n&quot;, fontstr);
</a><a href="#h0-3203" id="h0-3203" class="i">+
</a><a href="#h0-3204" id="h0-3204" class="i">+	FcPatternDestroy(pattern);
</a><a href="#h0-3205" id="h0-3205" class="i">+}
</a><a href="#h0-3206" id="h0-3206" class="i">+
</a><a href="#h0-3207" id="h0-3207" class="i">+void
</a><a href="#h0-3208" id="h0-3208" class="i">+xunloadfont(Font *f) {
</a><a href="#h0-3209" id="h0-3209" class="i">+	XftFontClose(xw.dpy, f-&gt;match);
</a><a href="#h0-3210" id="h0-3210" class="i">+	FcPatternDestroy(f-&gt;pattern);
</a><a href="#h0-3211" id="h0-3211" class="i">+	if(f-&gt;set)
</a><a href="#h0-3212" id="h0-3212" class="i">+		FcFontSetDestroy(f-&gt;set);
</a><a href="#h0-3213" id="h0-3213" class="i">+}
</a><a href="#h0-3214" id="h0-3214" class="i">+
</a><a href="#h0-3215" id="h0-3215" class="i">+void
</a><a href="#h0-3216" id="h0-3216" class="i">+xunloadfonts(void) {
</a><a href="#h0-3217" id="h0-3217" class="i">+	/* Free the loaded fonts in the font cache.  */
</a><a href="#h0-3218" id="h0-3218" class="i">+	while(frclen &gt; 0)
</a><a href="#h0-3219" id="h0-3219" class="i">+		XftFontClose(xw.dpy, frc[--frclen].font);
</a><a href="#h0-3220" id="h0-3220" class="i">+
</a><a href="#h0-3221" id="h0-3221" class="i">+	xunloadfont(&amp;dc.font);
</a><a href="#h0-3222" id="h0-3222" class="i">+	xunloadfont(&amp;dc.bfont);
</a><a href="#h0-3223" id="h0-3223" class="i">+	xunloadfont(&amp;dc.ifont);
</a><a href="#h0-3224" id="h0-3224" class="i">+	xunloadfont(&amp;dc.ibfont);
</a><a href="#h0-3225" id="h0-3225" class="i">+}
</a><a href="#h0-3226" id="h0-3226" class="i">+
</a><a href="#h0-3227" id="h0-3227" class="i">+void
</a><a href="#h0-3228" id="h0-3228" class="i">+xzoom(const Arg *arg) {
</a><a href="#h0-3229" id="h0-3229" class="i">+	Arg larg;
</a><a href="#h0-3230" id="h0-3230" class="i">+
</a><a href="#h0-3231" id="h0-3231" class="i">+	larg.f = usedfontsize + arg-&gt;f;
</a><a href="#h0-3232" id="h0-3232" class="i">+	xzoomabs(&amp;larg);
</a><a href="#h0-3233" id="h0-3233" class="i">+}
</a><a href="#h0-3234" id="h0-3234" class="i">+
</a><a href="#h0-3235" id="h0-3235" class="i">+void
</a><a href="#h0-3236" id="h0-3236" class="i">+xzoomabs(const Arg *arg) {
</a><a href="#h0-3237" id="h0-3237" class="i">+	xunloadfonts();
</a><a href="#h0-3238" id="h0-3238" class="i">+	xloadfonts(usedfont, arg-&gt;f);
</a><a href="#h0-3239" id="h0-3239" class="i">+	cresize(0, 0);
</a><a href="#h0-3240" id="h0-3240" class="i">+	redraw();
</a><a href="#h0-3241" id="h0-3241" class="i">+	xhints();
</a><a href="#h0-3242" id="h0-3242" class="i">+}
</a><a href="#h0-3243" id="h0-3243" class="i">+
</a><a href="#h0-3244" id="h0-3244" class="i">+void
</a><a href="#h0-3245" id="h0-3245" class="i">+xzoomreset(const Arg *arg) {
</a><a href="#h0-3246" id="h0-3246" class="i">+	Arg larg;
</a><a href="#h0-3247" id="h0-3247" class="i">+
</a><a href="#h0-3248" id="h0-3248" class="i">+	if(defaultfontsize &gt; 0) {
</a><a href="#h0-3249" id="h0-3249" class="i">+		larg.f = defaultfontsize;
</a><a href="#h0-3250" id="h0-3250" class="i">+		xzoomabs(&amp;larg);
</a><a href="#h0-3251" id="h0-3251" class="i">+	}
</a><a href="#h0-3252" id="h0-3252" class="i">+}
</a><a href="#h0-3253" id="h0-3253" class="i">+
</a><a href="#h0-3254" id="h0-3254" class="i">+void
</a><a href="#h0-3255" id="h0-3255" class="i">+xinit(void) {
</a><a href="#h0-3256" id="h0-3256" class="i">+  XGCValues gcvalues;
</a><a href="#h0-3257" id="h0-3257" class="i">+  Window parent;
</a><a href="#h0-3258" id="h0-3258" class="i">+  XColor xcwhite = {.red = 0xffff, .green = 0xffff, .blue = 0xffff};
</a><a href="#h0-3259" id="h0-3259" class="i">+  XColor xcblack = {.red = 0x0000, .green = 0x0000, .blue = 0x0000};
</a><a href="#h0-3260" id="h0-3260" class="i">+  Pixmap blankpm;
</a><a href="#h0-3261" id="h0-3261" class="i">+	pid_t thispid = getpid();
</a><a href="#h0-3262" id="h0-3262" class="i">+
</a><a href="#h0-3263" id="h0-3263" class="i">+	if(!(xw.dpy = XOpenDisplay(NULL)))
</a><a href="#h0-3264" id="h0-3264" class="i">+		die(&quot;Can&apos;t open display\n&quot;);
</a><a href="#h0-3265" id="h0-3265" class="i">+	xw.scr = XDefaultScreen(xw.dpy);
</a><a href="#h0-3266" id="h0-3266" class="i">+	xw.vis = XDefaultVisual(xw.dpy, xw.scr);
</a><a href="#h0-3267" id="h0-3267" class="i">+
</a><a href="#h0-3268" id="h0-3268" class="i">+	/* font */
</a><a href="#h0-3269" id="h0-3269" class="i">+	if(!FcInit())
</a><a href="#h0-3270" id="h0-3270" class="i">+		die(&quot;Could not init fontconfig.\n&quot;);
</a><a href="#h0-3271" id="h0-3271" class="i">+
</a><a href="#h0-3272" id="h0-3272" class="i">+	usedfont = (opt_font == NULL)? font : opt_font;
</a><a href="#h0-3273" id="h0-3273" class="i">+	xloadfonts(usedfont, 0);
</a><a href="#h0-3274" id="h0-3274" class="i">+
</a><a href="#h0-3275" id="h0-3275" class="i">+	/* colors */
</a><a href="#h0-3276" id="h0-3276" class="i">+	xw.cmap = XDefaultColormap(xw.dpy, xw.scr);
</a><a href="#h0-3277" id="h0-3277" class="i">+	xloadcols();
</a><a href="#h0-3278" id="h0-3278" class="i">+
</a><a href="#h0-3279" id="h0-3279" class="i">+	/* adjust fixed window geometry */
</a><a href="#h0-3280" id="h0-3280" class="i">+	xw.w = 2 * borderpx + term.col * xw.cw;
</a><a href="#h0-3281" id="h0-3281" class="i">+	xw.h = 2 * borderpx + term.row * xw.ch;
</a><a href="#h0-3282" id="h0-3282" class="i">+	if(xw.gm &amp; XNegative)
</a><a href="#h0-3283" id="h0-3283" class="i">+		xw.l += DisplayWidth(xw.dpy, xw.scr) - xw.w - 2;
</a><a href="#h0-3284" id="h0-3284" class="i">+	if(xw.gm &amp; YNegative)
</a><a href="#h0-3285" id="h0-3285" class="i">+		xw.t += DisplayWidth(xw.dpy, xw.scr) - xw.h - 2;
</a><a href="#h0-3286" id="h0-3286" class="i">+
</a><a href="#h0-3287" id="h0-3287" class="i">+	/* Events */
</a><a href="#h0-3288" id="h0-3288" class="i">+	xw.attrs.background_pixel = dc.col[defaultbg].pixel;
</a><a href="#h0-3289" id="h0-3289" class="i">+	xw.attrs.border_pixel = dc.col[defaultbg].pixel;
</a><a href="#h0-3290" id="h0-3290" class="i">+	xw.attrs.bit_gravity = NorthWestGravity;
</a><a href="#h0-3291" id="h0-3291" class="i">+	xw.attrs.event_mask = FocusChangeMask | KeyPressMask
</a><a href="#h0-3292" id="h0-3292" class="i">+		| ExposureMask | VisibilityChangeMask | StructureNotifyMask
</a><a href="#h0-3293" id="h0-3293" class="i">+		| ButtonMotionMask | ButtonPressMask | ButtonReleaseMask;
</a><a href="#h0-3294" id="h0-3294" class="i">+	xw.attrs.colormap = xw.cmap;
</a><a href="#h0-3295" id="h0-3295" class="i">+
</a><a href="#h0-3296" id="h0-3296" class="i">+	if (!(opt_embed &amp;&amp; (parent = strtol(opt_embed, NULL, 0))))
</a><a href="#h0-3297" id="h0-3297" class="i">+		parent = XRootWindow(xw.dpy, xw.scr);
</a><a href="#h0-3298" id="h0-3298" class="i">+	xw.win = XCreateWindow(xw.dpy, parent, xw.l, xw.t,
</a><a href="#h0-3299" id="h0-3299" class="i">+			xw.w, xw.h, 0, XDefaultDepth(xw.dpy, xw.scr), InputOutput,
</a><a href="#h0-3300" id="h0-3300" class="i">+			xw.vis, CWBackPixel | CWBorderPixel | CWBitGravity
</a><a href="#h0-3301" id="h0-3301" class="i">+			| CWEventMask | CWColormap, &amp;xw.attrs);
</a><a href="#h0-3302" id="h0-3302" class="i">+
</a><a href="#h0-3303" id="h0-3303" class="i">+	memset(&amp;gcvalues, 0, sizeof(gcvalues));
</a><a href="#h0-3304" id="h0-3304" class="i">+	gcvalues.graphics_exposures = False;
</a><a href="#h0-3305" id="h0-3305" class="i">+	dc.gc = XCreateGC(xw.dpy, parent, GCGraphicsExposures,
</a><a href="#h0-3306" id="h0-3306" class="i">+			&amp;gcvalues);
</a><a href="#h0-3307" id="h0-3307" class="i">+	xw.buf = XCreatePixmap(xw.dpy, xw.win, xw.w, xw.h,
</a><a href="#h0-3308" id="h0-3308" class="i">+			DefaultDepth(xw.dpy, xw.scr));
</a><a href="#h0-3309" id="h0-3309" class="i">+	XSetForeground(xw.dpy, dc.gc, dc.col[defaultbg].pixel);
</a><a href="#h0-3310" id="h0-3310" class="i">+	XFillRectangle(xw.dpy, xw.buf, dc.gc, 0, 0, xw.w, xw.h);
</a><a href="#h0-3311" id="h0-3311" class="i">+
</a><a href="#h0-3312" id="h0-3312" class="i">+	/* Xft rendering context */
</a><a href="#h0-3313" id="h0-3313" class="i">+	xw.draw = XftDrawCreate(xw.dpy, xw.buf, xw.vis, xw.cmap);
</a><a href="#h0-3314" id="h0-3314" class="i">+
</a><a href="#h0-3315" id="h0-3315" class="i">+	/* input methods */
</a><a href="#h0-3316" id="h0-3316" class="i">+	if((xw.xim = XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h0-3317" id="h0-3317" class="i">+		XSetLocaleModifiers(&quot;@im=local&quot;);
</a><a href="#h0-3318" id="h0-3318" class="i">+		if((xw.xim =  XOpenIM(xw.dpy, NULL, NULL, NULL)) == NULL) {
</a><a href="#h0-3319" id="h0-3319" class="i">+			XSetLocaleModifiers(&quot;@im=&quot;);
</a><a href="#h0-3320" id="h0-3320" class="i">+			if((xw.xim = XOpenIM(xw.dpy,
</a><a href="#h0-3321" id="h0-3321" class="i">+					NULL, NULL, NULL)) == NULL) {
</a><a href="#h0-3322" id="h0-3322" class="i">+				die(&quot;XOpenIM failed. Could not open input&quot;
</a><a href="#h0-3323" id="h0-3323" class="i">+					&quot; device.\n&quot;);
</a><a href="#h0-3324" id="h0-3324" class="i">+			}
</a><a href="#h0-3325" id="h0-3325" class="i">+		}
</a><a href="#h0-3326" id="h0-3326" class="i">+	}
</a><a href="#h0-3327" id="h0-3327" class="i">+	xw.xic = XCreateIC(xw.xim, XNInputStyle, XIMPreeditNothing
</a><a href="#h0-3328" id="h0-3328" class="i">+					   | XIMStatusNothing, XNClientWindow, xw.win,
</a><a href="#h0-3329" id="h0-3329" class="i">+					   XNFocusWindow, xw.win, NULL);
</a><a href="#h0-3330" id="h0-3330" class="i">+	if(xw.xic == NULL)
</a><a href="#h0-3331" id="h0-3331" class="i">+		die(&quot;XCreateIC failed. Could not obtain input method.\n&quot;);
</a><a href="#h0-3332" id="h0-3332" class="i">+
</a><a href="#h0-3333" id="h0-3333" class="i">+	/* white cursor, black outline */
</a><a href="#h0-3334" id="h0-3334" class="i">+	xw.vpointer = XCreateFontCursor(xw.dpy, XC_xterm);
</a><a href="#h0-3335" id="h0-3335" class="i">+  XDefineCursor(xw.dpy, xw.win, xw.vpointer);
</a><a href="#h0-3336" id="h0-3336" class="i">+  XRecolorCursor(xw.dpy, xw.vpointer, &amp;xcwhite, &amp;xcblack);
</a><a href="#h0-3337" id="h0-3337" class="i">+  xw.pointerisvisible = true;
</a><a href="#h0-3338" id="h0-3338" class="i">+  blankpm = XCreateBitmapFromData(xw.dpy, xw.win, &amp;(char){0}, 1, 1);
</a><a href="#h0-3339" id="h0-3339" class="i">+  xw.bpointer = XCreatePixmapCursor(xw.dpy, blankpm, blankpm, &amp;xcblack, &amp;xcblack, 0, 0);
</a><a href="#h0-3340" id="h0-3340" class="i">+
</a><a href="#h0-3341" id="h0-3341" class="i">+	xw.xembed = XInternAtom(xw.dpy, &quot;_XEMBED&quot;, False);
</a><a href="#h0-3342" id="h0-3342" class="i">+	xw.wmdeletewin = XInternAtom(xw.dpy, &quot;WM_DELETE_WINDOW&quot;, False);
</a><a href="#h0-3343" id="h0-3343" class="i">+	xw.netwmname = XInternAtom(xw.dpy, &quot;_NET_WM_NAME&quot;, False);
</a><a href="#h0-3344" id="h0-3344" class="i">+	XSetWMProtocols(xw.dpy, xw.win, &amp;xw.wmdeletewin, 1);
</a><a href="#h0-3345" id="h0-3345" class="i">+
</a><a href="#h0-3346" id="h0-3346" class="i">+	xw.netwmpid = XInternAtom(xw.dpy, &quot;_NET_WM_PID&quot;, False);
</a><a href="#h0-3347" id="h0-3347" class="i">+	XChangeProperty(xw.dpy, xw.win, xw.netwmpid, XA_CARDINAL, 32,
</a><a href="#h0-3348" id="h0-3348" class="i">+			PropModeReplace, (uchar *)&amp;thispid, 1);
</a><a href="#h0-3349" id="h0-3349" class="i">+
</a><a href="#h0-3350" id="h0-3350" class="i">+	xresettitle();
</a><a href="#h0-3351" id="h0-3351" class="i">+	XMapWindow(xw.dpy, xw.win);
</a><a href="#h0-3352" id="h0-3352" class="i">+	xhints();
</a><a href="#h0-3353" id="h0-3353" class="i">+	XSync(xw.dpy, False);
</a><a href="#h0-3354" id="h0-3354" class="i">+}
</a><a href="#h0-3355" id="h0-3355" class="i">+
</a><a href="#h0-3356" id="h0-3356" class="i">+int
</a><a href="#h0-3357" id="h0-3357" class="i">+xmakeglyphfontspecs(XftGlyphFontSpec *specs, const Glyph *glyphs, int len, int x, int y)
</a><a href="#h0-3358" id="h0-3358" class="i">+{
</a><a href="#h0-3359" id="h0-3359" class="i">+	float winx = borderpx + x * xw.cw, winy = borderpx + y * xw.ch, xp, yp;
</a><a href="#h0-3360" id="h0-3360" class="i">+	ushort mode, prevmode = USHRT_MAX;
</a><a href="#h0-3361" id="h0-3361" class="i">+	Font *font = &amp;dc.font;
</a><a href="#h0-3362" id="h0-3362" class="i">+	int frcflags = FRC_NORMAL;
</a><a href="#h0-3363" id="h0-3363" class="i">+	float runewidth = xw.cw;
</a><a href="#h0-3364" id="h0-3364" class="i">+	Rune rune;
</a><a href="#h0-3365" id="h0-3365" class="i">+	FT_UInt glyphidx;
</a><a href="#h0-3366" id="h0-3366" class="i">+	FcResult fcres;
</a><a href="#h0-3367" id="h0-3367" class="i">+	FcPattern *fcpattern, *fontpattern;
</a><a href="#h0-3368" id="h0-3368" class="i">+	FcFontSet *fcsets[] = { NULL };
</a><a href="#h0-3369" id="h0-3369" class="i">+	FcCharSet *fccharset;
</a><a href="#h0-3370" id="h0-3370" class="i">+	int i, f, numspecs = 0;
</a><a href="#h0-3371" id="h0-3371" class="i">+
</a><a href="#h0-3372" id="h0-3372" class="i">+	for(i = 0, xp = winx, yp = winy + font-&gt;ascent; i &lt; len; ++i) {
</a><a href="#h0-3373" id="h0-3373" class="i">+		/* Fetch rune and mode for current glyph. */
</a><a href="#h0-3374" id="h0-3374" class="i">+		rune = glyphs[i].u;
</a><a href="#h0-3375" id="h0-3375" class="i">+		mode = glyphs[i].mode;
</a><a href="#h0-3376" id="h0-3376" class="i">+
</a><a href="#h0-3377" id="h0-3377" class="i">+		/* Skip dummy wide-character spacing. */
</a><a href="#h0-3378" id="h0-3378" class="i">+		if(mode == ATTR_WDUMMY)
</a><a href="#h0-3379" id="h0-3379" class="i">+			continue;
</a><a href="#h0-3380" id="h0-3380" class="i">+
</a><a href="#h0-3381" id="h0-3381" class="i">+		/* Determine font for glyph if different from previous glyph. */
</a><a href="#h0-3382" id="h0-3382" class="i">+		if(prevmode != mode) {
</a><a href="#h0-3383" id="h0-3383" class="i">+			prevmode = mode;
</a><a href="#h0-3384" id="h0-3384" class="i">+			font = &amp;dc.font;
</a><a href="#h0-3385" id="h0-3385" class="i">+			frcflags = FRC_NORMAL;
</a><a href="#h0-3386" id="h0-3386" class="i">+			runewidth = xw.cw * ((mode &amp; ATTR_WIDE) ? 2.0f : 1.0f);
</a><a href="#h0-3387" id="h0-3387" class="i">+			if((mode &amp; ATTR_ITALIC) &amp;&amp; (mode &amp; ATTR_BOLD)) {
</a><a href="#h0-3388" id="h0-3388" class="i">+				font = &amp;dc.ibfont;
</a><a href="#h0-3389" id="h0-3389" class="i">+				frcflags = FRC_ITALICBOLD;
</a><a href="#h0-3390" id="h0-3390" class="i">+			} else if(mode &amp; ATTR_ITALIC) {
</a><a href="#h0-3391" id="h0-3391" class="i">+				font = &amp;dc.ifont;
</a><a href="#h0-3392" id="h0-3392" class="i">+				frcflags = FRC_ITALIC;
</a><a href="#h0-3393" id="h0-3393" class="i">+			} else if(mode &amp; ATTR_BOLD) {
</a><a href="#h0-3394" id="h0-3394" class="i">+				font = &amp;dc.bfont;
</a><a href="#h0-3395" id="h0-3395" class="i">+				frcflags = FRC_BOLD;
</a><a href="#h0-3396" id="h0-3396" class="i">+			}
</a><a href="#h0-3397" id="h0-3397" class="i">+			yp = winy + font-&gt;ascent;
</a><a href="#h0-3398" id="h0-3398" class="i">+		}
</a><a href="#h0-3399" id="h0-3399" class="i">+
</a><a href="#h0-3400" id="h0-3400" class="i">+		/* Lookup character index with default font. */
</a><a href="#h0-3401" id="h0-3401" class="i">+		glyphidx = XftCharIndex(xw.dpy, font-&gt;match, rune);
</a><a href="#h0-3402" id="h0-3402" class="i">+		if(glyphidx) {
</a><a href="#h0-3403" id="h0-3403" class="i">+			specs[numspecs].font = font-&gt;match;
</a><a href="#h0-3404" id="h0-3404" class="i">+			specs[numspecs].glyph = glyphidx;
</a><a href="#h0-3405" id="h0-3405" class="i">+			specs[numspecs].x = (short)xp;
</a><a href="#h0-3406" id="h0-3406" class="i">+			specs[numspecs].y = (short)yp;
</a><a href="#h0-3407" id="h0-3407" class="i">+			xp += runewidth;
</a><a href="#h0-3408" id="h0-3408" class="i">+			numspecs++;
</a><a href="#h0-3409" id="h0-3409" class="i">+			continue;
</a><a href="#h0-3410" id="h0-3410" class="i">+		}
</a><a href="#h0-3411" id="h0-3411" class="i">+
</a><a href="#h0-3412" id="h0-3412" class="i">+		/* Fallback on font cache, search the font cache for match. */
</a><a href="#h0-3413" id="h0-3413" class="i">+		for(f = 0; f &lt; frclen; f++) {
</a><a href="#h0-3414" id="h0-3414" class="i">+			glyphidx = XftCharIndex(xw.dpy, frc[f].font, rune);
</a><a href="#h0-3415" id="h0-3415" class="i">+			/* Everything correct. */
</a><a href="#h0-3416" id="h0-3416" class="i">+			if(glyphidx &amp;&amp; frc[f].flags == frcflags)
</a><a href="#h0-3417" id="h0-3417" class="i">+				break;
</a><a href="#h0-3418" id="h0-3418" class="i">+			/* We got a default font for a not found glyph. */
</a><a href="#h0-3419" id="h0-3419" class="i">+			if(!glyphidx &amp;&amp; frc[f].flags == frcflags
</a><a href="#h0-3420" id="h0-3420" class="i">+					&amp;&amp; frc[f].unicodep == rune) {
</a><a href="#h0-3421" id="h0-3421" class="i">+				break;
</a><a href="#h0-3422" id="h0-3422" class="i">+			}
</a><a href="#h0-3423" id="h0-3423" class="i">+		}
</a><a href="#h0-3424" id="h0-3424" class="i">+
</a><a href="#h0-3425" id="h0-3425" class="i">+		/* Nothing was found. Use fontconfig to find matching font. */
</a><a href="#h0-3426" id="h0-3426" class="i">+		if(f &gt;= frclen) {
</a><a href="#h0-3427" id="h0-3427" class="i">+			if(!font-&gt;set)
</a><a href="#h0-3428" id="h0-3428" class="i">+				font-&gt;set = FcFontSort(0, font-&gt;pattern,
</a><a href="#h0-3429" id="h0-3429" class="i">+				                       FcTrue, 0, &amp;fcres);
</a><a href="#h0-3430" id="h0-3430" class="i">+			fcsets[0] = font-&gt;set;
</a><a href="#h0-3431" id="h0-3431" class="i">+
</a><a href="#h0-3432" id="h0-3432" class="i">+			/*
</a><a href="#h0-3433" id="h0-3433" class="i">+			 * Nothing was found in the cache. Now use
</a><a href="#h0-3434" id="h0-3434" class="i">+			 * some dozen of Fontconfig calls to get the
</a><a href="#h0-3435" id="h0-3435" class="i">+			 * font for one single character.
</a><a href="#h0-3436" id="h0-3436" class="i">+			 *
</a><a href="#h0-3437" id="h0-3437" class="i">+			 * Xft and fontconfig are design failures.
</a><a href="#h0-3438" id="h0-3438" class="i">+			 */
</a><a href="#h0-3439" id="h0-3439" class="i">+			fcpattern = FcPatternDuplicate(font-&gt;pattern);
</a><a href="#h0-3440" id="h0-3440" class="i">+			fccharset = FcCharSetCreate();
</a><a href="#h0-3441" id="h0-3441" class="i">+
</a><a href="#h0-3442" id="h0-3442" class="i">+			FcCharSetAddChar(fccharset, rune);
</a><a href="#h0-3443" id="h0-3443" class="i">+			FcPatternAddCharSet(fcpattern, FC_CHARSET,
</a><a href="#h0-3444" id="h0-3444" class="i">+					fccharset);
</a><a href="#h0-3445" id="h0-3445" class="i">+			FcPatternAddBool(fcpattern, FC_SCALABLE,
</a><a href="#h0-3446" id="h0-3446" class="i">+					FcTrue);
</a><a href="#h0-3447" id="h0-3447" class="i">+
</a><a href="#h0-3448" id="h0-3448" class="i">+			FcConfigSubstitute(0, fcpattern,
</a><a href="#h0-3449" id="h0-3449" class="i">+					FcMatchPattern);
</a><a href="#h0-3450" id="h0-3450" class="i">+			FcDefaultSubstitute(fcpattern);
</a><a href="#h0-3451" id="h0-3451" class="i">+
</a><a href="#h0-3452" id="h0-3452" class="i">+			fontpattern = FcFontSetMatch(0, fcsets, 1,
</a><a href="#h0-3453" id="h0-3453" class="i">+					fcpattern, &amp;fcres);
</a><a href="#h0-3454" id="h0-3454" class="i">+
</a><a href="#h0-3455" id="h0-3455" class="i">+			/*
</a><a href="#h0-3456" id="h0-3456" class="i">+			 * Overwrite or create the new cache entry.
</a><a href="#h0-3457" id="h0-3457" class="i">+			 */
</a><a href="#h0-3458" id="h0-3458" class="i">+			if(frclen &gt;= LEN(frc)) {
</a><a href="#h0-3459" id="h0-3459" class="i">+				frclen = LEN(frc) - 1;
</a><a href="#h0-3460" id="h0-3460" class="i">+				XftFontClose(xw.dpy, frc[frclen].font);
</a><a href="#h0-3461" id="h0-3461" class="i">+				frc[frclen].unicodep = 0;
</a><a href="#h0-3462" id="h0-3462" class="i">+			}
</a><a href="#h0-3463" id="h0-3463" class="i">+
</a><a href="#h0-3464" id="h0-3464" class="i">+			frc[frclen].font = XftFontOpenPattern(xw.dpy,
</a><a href="#h0-3465" id="h0-3465" class="i">+					fontpattern);
</a><a href="#h0-3466" id="h0-3466" class="i">+			frc[frclen].flags = frcflags;
</a><a href="#h0-3467" id="h0-3467" class="i">+			frc[frclen].unicodep = rune;
</a><a href="#h0-3468" id="h0-3468" class="i">+
</a><a href="#h0-3469" id="h0-3469" class="i">+			glyphidx = XftCharIndex(xw.dpy, frc[frclen].font, rune);
</a><a href="#h0-3470" id="h0-3470" class="i">+
</a><a href="#h0-3471" id="h0-3471" class="i">+			f = frclen;
</a><a href="#h0-3472" id="h0-3472" class="i">+			frclen++;
</a><a href="#h0-3473" id="h0-3473" class="i">+
</a><a href="#h0-3474" id="h0-3474" class="i">+			FcPatternDestroy(fcpattern);
</a><a href="#h0-3475" id="h0-3475" class="i">+			FcCharSetDestroy(fccharset);
</a><a href="#h0-3476" id="h0-3476" class="i">+		}
</a><a href="#h0-3477" id="h0-3477" class="i">+
</a><a href="#h0-3478" id="h0-3478" class="i">+		specs[numspecs].font = frc[f].font;
</a><a href="#h0-3479" id="h0-3479" class="i">+		specs[numspecs].glyph = glyphidx;
</a><a href="#h0-3480" id="h0-3480" class="i">+		specs[numspecs].x = (short)xp;
</a><a href="#h0-3481" id="h0-3481" class="i">+		specs[numspecs].y = (short)(winy + frc[f].font-&gt;ascent);
</a><a href="#h0-3482" id="h0-3482" class="i">+		xp += runewidth;
</a><a href="#h0-3483" id="h0-3483" class="i">+		numspecs++;
</a><a href="#h0-3484" id="h0-3484" class="i">+	}
</a><a href="#h0-3485" id="h0-3485" class="i">+
</a><a href="#h0-3486" id="h0-3486" class="i">+	return numspecs;
</a><a href="#h0-3487" id="h0-3487" class="i">+}
</a><a href="#h0-3488" id="h0-3488" class="i">+
</a><a href="#h0-3489" id="h0-3489" class="i">+void
</a><a href="#h0-3490" id="h0-3490" class="i">+xdrawglyphfontspecs(const XftGlyphFontSpec *specs, Glyph base, int len, int x, int y) {
</a><a href="#h0-3491" id="h0-3491" class="i">+	int charlen = len * ((base.mode &amp; ATTR_WIDE) ? 2 : 1);
</a><a href="#h0-3492" id="h0-3492" class="i">+	int winx = borderpx + x * xw.cw, winy = borderpx + y * xw.ch,
</a><a href="#h0-3493" id="h0-3493" class="i">+	    width = charlen * xw.cw;
</a><a href="#h0-3494" id="h0-3494" class="i">+	Color *fg, *bg, *temp, revfg, revbg, truefg, truebg;
</a><a href="#h0-3495" id="h0-3495" class="i">+	XRenderColor colfg, colbg;
</a><a href="#h0-3496" id="h0-3496" class="i">+	XRectangle r;
</a><a href="#h0-3497" id="h0-3497" class="i">+
</a><a href="#h0-3498" id="h0-3498" class="i">+	/* Determine foreground and background colors based on mode. */
</a><a href="#h0-3499" id="h0-3499" class="i">+	if(base.fg == defaultfg) {
</a><a href="#h0-3500" id="h0-3500" class="i">+		if(base.mode &amp; ATTR_ITALIC)
</a><a href="#h0-3501" id="h0-3501" class="i">+			base.fg = defaultitalic;
</a><a href="#h0-3502" id="h0-3502" class="i">+		else if((base.mode &amp; ATTR_ITALIC) &amp;&amp; (base.mode &amp; ATTR_BOLD))
</a><a href="#h0-3503" id="h0-3503" class="i">+			base.fg = defaultitalic;
</a><a href="#h0-3504" id="h0-3504" class="i">+		else if(base.mode &amp; ATTR_UNDERLINE)
</a><a href="#h0-3505" id="h0-3505" class="i">+			base.fg = defaultunderline;
</a><a href="#h0-3506" id="h0-3506" class="i">+	}
</a><a href="#h0-3507" id="h0-3507" class="i">+
</a><a href="#h0-3508" id="h0-3508" class="i">+	if(IS_TRUECOL(base.fg)) {
</a><a href="#h0-3509" id="h0-3509" class="i">+		colfg.alpha = 0xffff;
</a><a href="#h0-3510" id="h0-3510" class="i">+		colfg.red = TRUERED(base.fg);
</a><a href="#h0-3511" id="h0-3511" class="i">+		colfg.green = TRUEGREEN(base.fg);
</a><a href="#h0-3512" id="h0-3512" class="i">+		colfg.blue = TRUEBLUE(base.fg);
</a><a href="#h0-3513" id="h0-3513" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg, &amp;truefg);
</a><a href="#h0-3514" id="h0-3514" class="i">+		fg = &amp;truefg;
</a><a href="#h0-3515" id="h0-3515" class="i">+	} else {
</a><a href="#h0-3516" id="h0-3516" class="i">+		fg = &amp;dc.col[base.fg];
</a><a href="#h0-3517" id="h0-3517" class="i">+	}
</a><a href="#h0-3518" id="h0-3518" class="i">+
</a><a href="#h0-3519" id="h0-3519" class="i">+	if(IS_TRUECOL(base.bg)) {
</a><a href="#h0-3520" id="h0-3520" class="i">+		colbg.alpha = 0xffff;
</a><a href="#h0-3521" id="h0-3521" class="i">+		colbg.green = TRUEGREEN(base.bg);
</a><a href="#h0-3522" id="h0-3522" class="i">+		colbg.red = TRUERED(base.bg);
</a><a href="#h0-3523" id="h0-3523" class="i">+		colbg.blue = TRUEBLUE(base.bg);
</a><a href="#h0-3524" id="h0-3524" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colbg, &amp;truebg);
</a><a href="#h0-3525" id="h0-3525" class="i">+		bg = &amp;truebg;
</a><a href="#h0-3526" id="h0-3526" class="i">+	} else {
</a><a href="#h0-3527" id="h0-3527" class="i">+		bg = &amp;dc.col[base.bg];
</a><a href="#h0-3528" id="h0-3528" class="i">+	}
</a><a href="#h0-3529" id="h0-3529" class="i">+
</a><a href="#h0-3530" id="h0-3530" class="i">+	/* Change basic system colors [0-7] to bright system colors [8-15] */
</a><a href="#h0-3531" id="h0-3531" class="i">+	if((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_BOLD &amp;&amp; BETWEEN(base.fg, 0, 7))
</a><a href="#h0-3532" id="h0-3532" class="i">+		fg = &amp;dc.col[base.fg + 8];
</a><a href="#h0-3533" id="h0-3533" class="i">+
</a><a href="#h0-3534" id="h0-3534" class="i">+	if(IS_SET(MODE_REVERSE)) {
</a><a href="#h0-3535" id="h0-3535" class="i">+		if(fg == &amp;dc.col[defaultfg]) {
</a><a href="#h0-3536" id="h0-3536" class="i">+			fg = &amp;dc.col[defaultbg];
</a><a href="#h0-3537" id="h0-3537" class="i">+		} else {
</a><a href="#h0-3538" id="h0-3538" class="i">+			colfg.red = ~fg-&gt;color.red;
</a><a href="#h0-3539" id="h0-3539" class="i">+			colfg.green = ~fg-&gt;color.green;
</a><a href="#h0-3540" id="h0-3540" class="i">+			colfg.blue = ~fg-&gt;color.blue;
</a><a href="#h0-3541" id="h0-3541" class="i">+			colfg.alpha = fg-&gt;color.alpha;
</a><a href="#h0-3542" id="h0-3542" class="i">+			XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg,
</a><a href="#h0-3543" id="h0-3543" class="i">+					&amp;revfg);
</a><a href="#h0-3544" id="h0-3544" class="i">+			fg = &amp;revfg;
</a><a href="#h0-3545" id="h0-3545" class="i">+		}
</a><a href="#h0-3546" id="h0-3546" class="i">+
</a><a href="#h0-3547" id="h0-3547" class="i">+		if(bg == &amp;dc.col[defaultbg]) {
</a><a href="#h0-3548" id="h0-3548" class="i">+			bg = &amp;dc.col[defaultfg];
</a><a href="#h0-3549" id="h0-3549" class="i">+		} else {
</a><a href="#h0-3550" id="h0-3550" class="i">+			colbg.red = ~bg-&gt;color.red;
</a><a href="#h0-3551" id="h0-3551" class="i">+			colbg.green = ~bg-&gt;color.green;
</a><a href="#h0-3552" id="h0-3552" class="i">+			colbg.blue = ~bg-&gt;color.blue;
</a><a href="#h0-3553" id="h0-3553" class="i">+			colbg.alpha = bg-&gt;color.alpha;
</a><a href="#h0-3554" id="h0-3554" class="i">+			XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colbg,
</a><a href="#h0-3555" id="h0-3555" class="i">+					&amp;revbg);
</a><a href="#h0-3556" id="h0-3556" class="i">+			bg = &amp;revbg;
</a><a href="#h0-3557" id="h0-3557" class="i">+		}
</a><a href="#h0-3558" id="h0-3558" class="i">+	}
</a><a href="#h0-3559" id="h0-3559" class="i">+
</a><a href="#h0-3560" id="h0-3560" class="i">+	if(base.mode &amp; ATTR_REVERSE) {
</a><a href="#h0-3561" id="h0-3561" class="i">+		if (bg == fg) {
</a><a href="#h0-3562" id="h0-3562" class="i">+		  bg = &amp;dc.col[defaultfg];
</a><a href="#h0-3563" id="h0-3563" class="i">+      fg = &amp;dc.col[defaultbg];
</a><a href="#h0-3564" id="h0-3564" class="i">+    } else {
</a><a href="#h0-3565" id="h0-3565" class="i">+		  temp = fg;
</a><a href="#h0-3566" id="h0-3566" class="i">+      fg = bg;
</a><a href="#h0-3567" id="h0-3567" class="i">+      bg = temp;
</a><a href="#h0-3568" id="h0-3568" class="i">+    }
</a><a href="#h0-3569" id="h0-3569" class="i">+	}
</a><a href="#h0-3570" id="h0-3570" class="i">+
</a><a href="#h0-3571" id="h0-3571" class="i">+	if((base.mode &amp; ATTR_BOLD_FAINT) == ATTR_FAINT) {
</a><a href="#h0-3572" id="h0-3572" class="i">+		colfg.red = fg-&gt;color.red / 2;
</a><a href="#h0-3573" id="h0-3573" class="i">+		colfg.green = fg-&gt;color.green / 2;
</a><a href="#h0-3574" id="h0-3574" class="i">+		colfg.blue = fg-&gt;color.blue / 2;
</a><a href="#h0-3575" id="h0-3575" class="i">+		XftColorAllocValue(xw.dpy, xw.vis, xw.cmap, &amp;colfg, &amp;revfg);
</a><a href="#h0-3576" id="h0-3576" class="i">+		fg = &amp;revfg;
</a><a href="#h0-3577" id="h0-3577" class="i">+	}
</a><a href="#h0-3578" id="h0-3578" class="i">+
</a><a href="#h0-3579" id="h0-3579" class="i">+	if(base.mode &amp; ATTR_BLINK &amp;&amp; term.mode &amp; MODE_BLINK)
</a><a href="#h0-3580" id="h0-3580" class="i">+		fg = bg;
</a><a href="#h0-3581" id="h0-3581" class="i">+
</a><a href="#h0-3582" id="h0-3582" class="i">+	if(base.mode &amp; ATTR_INVISIBLE)
</a><a href="#h0-3583" id="h0-3583" class="i">+		fg = bg;
</a><a href="#h0-3584" id="h0-3584" class="i">+
</a><a href="#h0-3585" id="h0-3585" class="i">+	/* Intelligent cleaning up of the borders. */
</a><a href="#h0-3586" id="h0-3586" class="i">+	if(x == 0) {
</a><a href="#h0-3587" id="h0-3587" class="i">+		xclear(0, (y == 0)? 0 : winy, borderpx,
</a><a href="#h0-3588" id="h0-3588" class="i">+			winy + xw.ch + ((y &gt;= term.row-1)? xw.h : 0));
</a><a href="#h0-3589" id="h0-3589" class="i">+	}
</a><a href="#h0-3590" id="h0-3590" class="i">+	if(x + charlen &gt;= term.col) {
</a><a href="#h0-3591" id="h0-3591" class="i">+		xclear(winx + width, (y == 0)? 0 : winy, xw.w,
</a><a href="#h0-3592" id="h0-3592" class="i">+			((y &gt;= term.row-1)? xw.h : (winy + xw.ch)));
</a><a href="#h0-3593" id="h0-3593" class="i">+	}
</a><a href="#h0-3594" id="h0-3594" class="i">+	if(y == 0)
</a><a href="#h0-3595" id="h0-3595" class="i">+		xclear(winx, 0, winx + width, borderpx);
</a><a href="#h0-3596" id="h0-3596" class="i">+	if(y == term.row-1)
</a><a href="#h0-3597" id="h0-3597" class="i">+		xclear(winx, winy + xw.ch, winx + width, xw.h);
</a><a href="#h0-3598" id="h0-3598" class="i">+
</a><a href="#h0-3599" id="h0-3599" class="i">+	/* Clean up the region we want to draw to. */
</a><a href="#h0-3600" id="h0-3600" class="i">+	XftDrawRect(xw.draw, bg, winx, winy, width, xw.ch);
</a><a href="#h0-3601" id="h0-3601" class="i">+
</a><a href="#h0-3602" id="h0-3602" class="i">+	/* Set the clip region because Xft is sometimes dirty. */
</a><a href="#h0-3603" id="h0-3603" class="i">+	r.x = 0;
</a><a href="#h0-3604" id="h0-3604" class="i">+	r.y = 0;
</a><a href="#h0-3605" id="h0-3605" class="i">+	r.height = xw.ch;
</a><a href="#h0-3606" id="h0-3606" class="i">+	r.width = width;
</a><a href="#h0-3607" id="h0-3607" class="i">+	XftDrawSetClipRectangles(xw.draw, winx, winy, &amp;r, 1);
</a><a href="#h0-3608" id="h0-3608" class="i">+
</a><a href="#h0-3609" id="h0-3609" class="i">+	/* Render the glyphs. */
</a><a href="#h0-3610" id="h0-3610" class="i">+	XftDrawGlyphFontSpec(xw.draw, fg, specs, len);
</a><a href="#h0-3611" id="h0-3611" class="i">+
</a><a href="#h0-3612" id="h0-3612" class="i">+	/* Render underline and strikethrough. */
</a><a href="#h0-3613" id="h0-3613" class="i">+	if(base.mode &amp; ATTR_UNDERLINE) {
</a><a href="#h0-3614" id="h0-3614" class="i">+		XftDrawRect(xw.draw, fg, winx, winy + dc.font.ascent + 1,
</a><a href="#h0-3615" id="h0-3615" class="i">+				width, 1);
</a><a href="#h0-3616" id="h0-3616" class="i">+	}
</a><a href="#h0-3617" id="h0-3617" class="i">+
</a><a href="#h0-3618" id="h0-3618" class="i">+	if(base.mode &amp; ATTR_STRUCK) {
</a><a href="#h0-3619" id="h0-3619" class="i">+		XftDrawRect(xw.draw, fg, winx, winy + 2 * dc.font.ascent / 3,
</a><a href="#h0-3620" id="h0-3620" class="i">+				width, 1);
</a><a href="#h0-3621" id="h0-3621" class="i">+	}
</a><a href="#h0-3622" id="h0-3622" class="i">+
</a><a href="#h0-3623" id="h0-3623" class="i">+	/* Reset clip to none. */
</a><a href="#h0-3624" id="h0-3624" class="i">+	XftDrawSetClip(xw.draw, 0);
</a><a href="#h0-3625" id="h0-3625" class="i">+}
</a><a href="#h0-3626" id="h0-3626" class="i">+
</a><a href="#h0-3627" id="h0-3627" class="i">+void
</a><a href="#h0-3628" id="h0-3628" class="i">+xdrawglyph(Glyph g, int x, int y) {
</a><a href="#h0-3629" id="h0-3629" class="i">+	int numspecs;
</a><a href="#h0-3630" id="h0-3630" class="i">+	XftGlyphFontSpec spec;
</a><a href="#h0-3631" id="h0-3631" class="i">+	numspecs = xmakeglyphfontspecs(&amp;spec, &amp;g, 1, x, y);
</a><a href="#h0-3632" id="h0-3632" class="i">+	xdrawglyphfontspecs(&amp;spec, g, numspecs, x, y);
</a><a href="#h0-3633" id="h0-3633" class="i">+}
</a><a href="#h0-3634" id="h0-3634" class="i">+
</a><a href="#h0-3635" id="h0-3635" class="i">+void
</a><a href="#h0-3636" id="h0-3636" class="i">+xdrawcursor(void) {
</a><a href="#h0-3637" id="h0-3637" class="i">+	static int oldx = 0, oldy = 0;
</a><a href="#h0-3638" id="h0-3638" class="i">+	int curx;
</a><a href="#h0-3639" id="h0-3639" class="i">+	Glyph g = {&apos; &apos;, ATTR_NULL, defaultbg, defaultcs};
</a><a href="#h0-3640" id="h0-3640" class="i">+
</a><a href="#h0-3641" id="h0-3641" class="i">+	LIMIT(oldx, 0, term.col-1);
</a><a href="#h0-3642" id="h0-3642" class="i">+	LIMIT(oldy, 0, term.row-1);
</a><a href="#h0-3643" id="h0-3643" class="i">+
</a><a href="#h0-3644" id="h0-3644" class="i">+	curx = term.c.x;
</a><a href="#h0-3645" id="h0-3645" class="i">+
</a><a href="#h0-3646" id="h0-3646" class="i">+	/* adjust position if in dummy */
</a><a href="#h0-3647" id="h0-3647" class="i">+	if(term.line[oldy][oldx].mode &amp; ATTR_WDUMMY)
</a><a href="#h0-3648" id="h0-3648" class="i">+		oldx--;
</a><a href="#h0-3649" id="h0-3649" class="i">+	if(term.line[term.c.y][curx].mode &amp; ATTR_WDUMMY)
</a><a href="#h0-3650" id="h0-3650" class="i">+		curx--;
</a><a href="#h0-3651" id="h0-3651" class="i">+
</a><a href="#h0-3652" id="h0-3652" class="i">+	g.u = term.line[term.c.y][term.c.x].u;
</a><a href="#h0-3653" id="h0-3653" class="i">+
</a><a href="#h0-3654" id="h0-3654" class="i">+	/* remove the old cursor */
</a><a href="#h0-3655" id="h0-3655" class="i">+	xdrawglyph(term.line[oldy][oldx], oldx, oldy);
</a><a href="#h0-3656" id="h0-3656" class="i">+
</a><a href="#h0-3657" id="h0-3657" class="i">+	if(IS_SET(MODE_HIDE))
</a><a href="#h0-3658" id="h0-3658" class="i">+		return;
</a><a href="#h0-3659" id="h0-3659" class="i">+
</a><a href="#h0-3660" id="h0-3660" class="i">+	/* draw the new one */
</a><a href="#h0-3661" id="h0-3661" class="i">+	if(xw.state &amp; WIN_FOCUSED) {
</a><a href="#h0-3662" id="h0-3662" class="i">+		switch (xw.cursor) {
</a><a href="#h0-3663" id="h0-3663" class="i">+			case 0: /* Blinking Block */
</a><a href="#h0-3664" id="h0-3664" class="i">+			case 1: /* Blinking Block (Default) */
</a><a href="#h0-3665" id="h0-3665" class="i">+			case 2: /* Steady Block */
</a><a href="#h0-3666" id="h0-3666" class="i">+				if(IS_SET(MODE_REVERSE)) {
</a><a href="#h0-3667" id="h0-3667" class="i">+						g.mode |= ATTR_REVERSE;
</a><a href="#h0-3668" id="h0-3668" class="i">+						g.fg = defaultcs;
</a><a href="#h0-3669" id="h0-3669" class="i">+						g.bg = defaultfg;
</a><a href="#h0-3670" id="h0-3670" class="i">+					}
</a><a href="#h0-3671" id="h0-3671" class="i">+
</a><a href="#h0-3672" id="h0-3672" class="i">+				g.mode |= term.line[term.c.y][curx].mode &amp; ATTR_WIDE;
</a><a href="#h0-3673" id="h0-3673" class="i">+				xdrawglyph(g, term.c.x, term.c.y);
</a><a href="#h0-3674" id="h0-3674" class="i">+				break;
</a><a href="#h0-3675" id="h0-3675" class="i">+			case 3: /* Blinking Underline */
</a><a href="#h0-3676" id="h0-3676" class="i">+			case 4: /* Steady Underline */
</a><a href="#h0-3677" id="h0-3677" class="i">+				XftDrawRect(xw.draw, &amp;dc.col[defaultcs],
</a><a href="#h0-3678" id="h0-3678" class="i">+						borderpx + curx * xw.cw,
</a><a href="#h0-3679" id="h0-3679" class="i">+						borderpx + (term.c.y + 1) * xw.ch - cursorthickness,
</a><a href="#h0-3680" id="h0-3680" class="i">+						xw.cw, cursorthickness);
</a><a href="#h0-3681" id="h0-3681" class="i">+				break;
</a><a href="#h0-3682" id="h0-3682" class="i">+			case 5: /* Blinking bar */
</a><a href="#h0-3683" id="h0-3683" class="i">+			case 6: /* Steady bar */
</a><a href="#h0-3684" id="h0-3684" class="i">+				XftDrawRect(xw.draw, &amp;dc.col[defaultcs],
</a><a href="#h0-3685" id="h0-3685" class="i">+						borderpx + curx * xw.cw,
</a><a href="#h0-3686" id="h0-3686" class="i">+						borderpx + term.c.y * xw.ch,
</a><a href="#h0-3687" id="h0-3687" class="i">+						cursorthickness, xw.ch);
</a><a href="#h0-3688" id="h0-3688" class="i">+				break;
</a><a href="#h0-3689" id="h0-3689" class="i">+		}
</a><a href="#h0-3690" id="h0-3690" class="i">+	} else {
</a><a href="#h0-3691" id="h0-3691" class="i">+		XftDrawRect(xw.draw, &amp;dc.col[defaultcs],
</a><a href="#h0-3692" id="h0-3692" class="i">+				borderpx + curx * xw.cw,
</a><a href="#h0-3693" id="h0-3693" class="i">+				borderpx + term.c.y * xw.ch,
</a><a href="#h0-3694" id="h0-3694" class="i">+				xw.cw - 1, 1);
</a><a href="#h0-3695" id="h0-3695" class="i">+		XftDrawRect(xw.draw, &amp;dc.col[defaultcs],
</a><a href="#h0-3696" id="h0-3696" class="i">+				borderpx + curx * xw.cw,
</a><a href="#h0-3697" id="h0-3697" class="i">+				borderpx + term.c.y * xw.ch,
</a><a href="#h0-3698" id="h0-3698" class="i">+				1, xw.ch - 1);
</a><a href="#h0-3699" id="h0-3699" class="i">+		XftDrawRect(xw.draw, &amp;dc.col[defaultcs],
</a><a href="#h0-3700" id="h0-3700" class="i">+				borderpx + (curx + 1) * xw.cw - 1,
</a><a href="#h0-3701" id="h0-3701" class="i">+				borderpx + term.c.y * xw.ch,
</a><a href="#h0-3702" id="h0-3702" class="i">+				1, xw.ch - 1);
</a><a href="#h0-3703" id="h0-3703" class="i">+		XftDrawRect(xw.draw, &amp;dc.col[defaultcs],
</a><a href="#h0-3704" id="h0-3704" class="i">+				borderpx + curx * xw.cw,
</a><a href="#h0-3705" id="h0-3705" class="i">+				borderpx + (term.c.y + 1) * xw.ch - 1,
</a><a href="#h0-3706" id="h0-3706" class="i">+				xw.cw, 1);
</a><a href="#h0-3707" id="h0-3707" class="i">+	}
</a><a href="#h0-3708" id="h0-3708" class="i">+	oldx = curx, oldy = term.c.y;
</a><a href="#h0-3709" id="h0-3709" class="i">+}
</a><a href="#h0-3710" id="h0-3710" class="i">+
</a><a href="#h0-3711" id="h0-3711" class="i">+
</a><a href="#h0-3712" id="h0-3712" class="i">+void
</a><a href="#h0-3713" id="h0-3713" class="i">+xsettitle(char *p) {
</a><a href="#h0-3714" id="h0-3714" class="i">+	XTextProperty prop;
</a><a href="#h0-3715" id="h0-3715" class="i">+
</a><a href="#h0-3716" id="h0-3716" class="i">+	Xutf8TextListToTextProperty(xw.dpy, &amp;p, 1, XUTF8StringStyle,
</a><a href="#h0-3717" id="h0-3717" class="i">+			&amp;prop);
</a><a href="#h0-3718" id="h0-3718" class="i">+	XSetWMName(xw.dpy, xw.win, &amp;prop);
</a><a href="#h0-3719" id="h0-3719" class="i">+	XSetTextProperty(xw.dpy, xw.win, &amp;prop, xw.netwmname);
</a><a href="#h0-3720" id="h0-3720" class="i">+	XFree(prop.value);
</a><a href="#h0-3721" id="h0-3721" class="i">+}
</a><a href="#h0-3722" id="h0-3722" class="i">+
</a><a href="#h0-3723" id="h0-3723" class="i">+void
</a><a href="#h0-3724" id="h0-3724" class="i">+xresettitle(void) {
</a><a href="#h0-3725" id="h0-3725" class="i">+	xsettitle(opt_title ? opt_title : &quot;st&quot;);
</a><a href="#h0-3726" id="h0-3726" class="i">+}
</a><a href="#h0-3727" id="h0-3727" class="i">+
</a><a href="#h0-3728" id="h0-3728" class="i">+void
</a><a href="#h0-3729" id="h0-3729" class="i">+redraw(void) {
</a><a href="#h0-3730" id="h0-3730" class="i">+	tfulldirt();
</a><a href="#h0-3731" id="h0-3731" class="i">+	draw();
</a><a href="#h0-3732" id="h0-3732" class="i">+}
</a><a href="#h0-3733" id="h0-3733" class="i">+
</a><a href="#h0-3734" id="h0-3734" class="i">+void
</a><a href="#h0-3735" id="h0-3735" class="i">+draw(void) {
</a><a href="#h0-3736" id="h0-3736" class="i">+	drawregion(0, 0, term.col, term.row);
</a><a href="#h0-3737" id="h0-3737" class="i">+	XCopyArea(xw.dpy, xw.buf, xw.win, dc.gc, 0, 0, xw.w,
</a><a href="#h0-3738" id="h0-3738" class="i">+			xw.h, 0, 0);
</a><a href="#h0-3739" id="h0-3739" class="i">+	XSetForeground(xw.dpy, dc.gc,
</a><a href="#h0-3740" id="h0-3740" class="i">+			dc.col[IS_SET(MODE_REVERSE)?
</a><a href="#h0-3741" id="h0-3741" class="i">+				defaultfg : defaultbg].pixel);
</a><a href="#h0-3742" id="h0-3742" class="i">+}
</a><a href="#h0-3743" id="h0-3743" class="i">+
</a><a href="#h0-3744" id="h0-3744" class="i">+void
</a><a href="#h0-3745" id="h0-3745" class="i">+drawregion(int x1, int y1, int x2, int y2) {
</a><a href="#h0-3746" id="h0-3746" class="i">+	int i, x, y, ox, numspecs;
</a><a href="#h0-3747" id="h0-3747" class="i">+	Glyph base, new;
</a><a href="#h0-3748" id="h0-3748" class="i">+	XftGlyphFontSpec* specs;
</a><a href="#h0-3749" id="h0-3749" class="i">+	bool ena_sel = sel.ob.x != -1 &amp;&amp; sel.alt == IS_SET(MODE_ALTSCREEN);
</a><a href="#h0-3750" id="h0-3750" class="i">+
</a><a href="#h0-3751" id="h0-3751" class="i">+	if(!(xw.state &amp; WIN_VISIBLE))
</a><a href="#h0-3752" id="h0-3752" class="i">+		return;
</a><a href="#h0-3753" id="h0-3753" class="i">+
</a><a href="#h0-3754" id="h0-3754" class="i">+	for(y = y1; y &lt; y2; y++) {
</a><a href="#h0-3755" id="h0-3755" class="i">+		if(!term.dirty[y])
</a><a href="#h0-3756" id="h0-3756" class="i">+			continue;
</a><a href="#h0-3757" id="h0-3757" class="i">+
</a><a href="#h0-3758" id="h0-3758" class="i">+		xtermclear(0, y, term.col, y);
</a><a href="#h0-3759" id="h0-3759" class="i">+		term.dirty[y] = 0;
</a><a href="#h0-3760" id="h0-3760" class="i">+
</a><a href="#h0-3761" id="h0-3761" class="i">+		specs = term.specbuf;
</a><a href="#h0-3762" id="h0-3762" class="i">+		numspecs = xmakeglyphfontspecs(specs, &amp;term.line[y][x1], x2 - x1, x1, y);
</a><a href="#h0-3763" id="h0-3763" class="i">+
</a><a href="#h0-3764" id="h0-3764" class="i">+		i = ox = 0;
</a><a href="#h0-3765" id="h0-3765" class="i">+		for(x = x1; x &lt; x2 &amp;&amp; i &lt; numspecs; x++) {
</a><a href="#h0-3766" id="h0-3766" class="i">+			new = term.line[y][x];
</a><a href="#h0-3767" id="h0-3767" class="i">+			if(new.mode == ATTR_WDUMMY)
</a><a href="#h0-3768" id="h0-3768" class="i">+				continue;
</a><a href="#h0-3769" id="h0-3769" class="i">+			if(ena_sel &amp;&amp; selected(x, y))
</a><a href="#h0-3770" id="h0-3770" class="i">+				new.mode ^= ATTR_REVERSE;
</a><a href="#h0-3771" id="h0-3771" class="i">+			if(i &gt; 0 &amp;&amp; ATTRCMP(base, new)) {
</a><a href="#h0-3772" id="h0-3772" class="i">+				xdrawglyphfontspecs(specs, base, i, ox, y);
</a><a href="#h0-3773" id="h0-3773" class="i">+				specs += i;
</a><a href="#h0-3774" id="h0-3774" class="i">+				numspecs -= i;
</a><a href="#h0-3775" id="h0-3775" class="i">+				i = 0;
</a><a href="#h0-3776" id="h0-3776" class="i">+			}
</a><a href="#h0-3777" id="h0-3777" class="i">+			if(i == 0) {
</a><a href="#h0-3778" id="h0-3778" class="i">+				ox = x;
</a><a href="#h0-3779" id="h0-3779" class="i">+				base = new;
</a><a href="#h0-3780" id="h0-3780" class="i">+			}
</a><a href="#h0-3781" id="h0-3781" class="i">+			i++;
</a><a href="#h0-3782" id="h0-3782" class="i">+		}
</a><a href="#h0-3783" id="h0-3783" class="i">+		if(i &gt; 0)
</a><a href="#h0-3784" id="h0-3784" class="i">+			xdrawglyphfontspecs(specs, base, i, ox, y);
</a><a href="#h0-3785" id="h0-3785" class="i">+	}
</a><a href="#h0-3786" id="h0-3786" class="i">+	xdrawcursor();
</a><a href="#h0-3787" id="h0-3787" class="i">+}
</a><a href="#h0-3788" id="h0-3788" class="i">+
</a><a href="#h0-3789" id="h0-3789" class="i">+void
</a><a href="#h0-3790" id="h0-3790" class="i">+expose(XEvent *ev) {
</a><a href="#h0-3791" id="h0-3791" class="i">+	redraw();
</a><a href="#h0-3792" id="h0-3792" class="i">+}
</a><a href="#h0-3793" id="h0-3793" class="i">+
</a><a href="#h0-3794" id="h0-3794" class="i">+void
</a><a href="#h0-3795" id="h0-3795" class="i">+visibility(XEvent *ev) {
</a><a href="#h0-3796" id="h0-3796" class="i">+	XVisibilityEvent *e = &amp;ev-&gt;xvisibility;
</a><a href="#h0-3797" id="h0-3797" class="i">+
</a><a href="#h0-3798" id="h0-3798" class="i">+	MODBIT(xw.state, e-&gt;state != VisibilityFullyObscured, WIN_VISIBLE);
</a><a href="#h0-3799" id="h0-3799" class="i">+}
</a><a href="#h0-3800" id="h0-3800" class="i">+
</a><a href="#h0-3801" id="h0-3801" class="i">+void
</a><a href="#h0-3802" id="h0-3802" class="i">+unmap(XEvent *ev) {
</a><a href="#h0-3803" id="h0-3803" class="i">+	xw.state &amp;= ~WIN_VISIBLE;
</a><a href="#h0-3804" id="h0-3804" class="i">+}
</a><a href="#h0-3805" id="h0-3805" class="i">+
</a><a href="#h0-3806" id="h0-3806" class="i">+void
</a><a href="#h0-3807" id="h0-3807" class="i">+xsetpointermotion(int set) {
</a><a href="#h0-3808" id="h0-3808" class="i">+  if(!set &amp;&amp; !xw.pointerisvisible)
</a><a href="#h0-3809" id="h0-3809" class="i">+    return;
</a><a href="#h0-3810" id="h0-3810" class="i">+	MODBIT(xw.attrs.event_mask, set, PointerMotionMask);
</a><a href="#h0-3811" id="h0-3811" class="i">+	XChangeWindowAttributes(xw.dpy, xw.win, CWEventMask, &amp;xw.attrs);
</a><a href="#h0-3812" id="h0-3812" class="i">+}
</a><a href="#h0-3813" id="h0-3813" class="i">+
</a><a href="#h0-3814" id="h0-3814" class="i">+void
</a><a href="#h0-3815" id="h0-3815" class="i">+xseturgency(int add) {
</a><a href="#h0-3816" id="h0-3816" class="i">+	XWMHints *h = XGetWMHints(xw.dpy, xw.win);
</a><a href="#h0-3817" id="h0-3817" class="i">+
</a><a href="#h0-3818" id="h0-3818" class="i">+	MODBIT(h-&gt;flags, add, XUrgencyHint);
</a><a href="#h0-3819" id="h0-3819" class="i">+	XSetWMHints(xw.dpy, xw.win, h);
</a><a href="#h0-3820" id="h0-3820" class="i">+	XFree(h);
</a><a href="#h0-3821" id="h0-3821" class="i">+}
</a><a href="#h0-3822" id="h0-3822" class="i">+
</a><a href="#h0-3823" id="h0-3823" class="i">+void
</a><a href="#h0-3824" id="h0-3824" class="i">+focus(XEvent *ev) {
</a><a href="#h0-3825" id="h0-3825" class="i">+	XFocusChangeEvent *e = &amp;ev-&gt;xfocus;
</a><a href="#h0-3826" id="h0-3826" class="i">+
</a><a href="#h0-3827" id="h0-3827" class="i">+	if(e-&gt;mode == NotifyGrab)
</a><a href="#h0-3828" id="h0-3828" class="i">+		return;
</a><a href="#h0-3829" id="h0-3829" class="i">+
</a><a href="#h0-3830" id="h0-3830" class="i">+	if(ev-&gt;type == FocusIn) {
</a><a href="#h0-3831" id="h0-3831" class="i">+		XSetICFocus(xw.xic);
</a><a href="#h0-3832" id="h0-3832" class="i">+		xw.state |= WIN_FOCUSED;
</a><a href="#h0-3833" id="h0-3833" class="i">+		xseturgency(0);
</a><a href="#h0-3834" id="h0-3834" class="i">+		if(IS_SET(MODE_FOCUS))
</a><a href="#h0-3835" id="h0-3835" class="i">+			ttywrite(&quot;\033[I&quot;, 3);
</a><a href="#h0-3836" id="h0-3836" class="i">+	} else {
</a><a href="#h0-3837" id="h0-3837" class="i">+		XUnsetICFocus(xw.xic);
</a><a href="#h0-3838" id="h0-3838" class="i">+		xw.state &amp;= ~WIN_FOCUSED;
</a><a href="#h0-3839" id="h0-3839" class="i">+		if(IS_SET(MODE_FOCUS))
</a><a href="#h0-3840" id="h0-3840" class="i">+			ttywrite(&quot;\033[O&quot;, 3);
</a><a href="#h0-3841" id="h0-3841" class="i">+	}
</a><a href="#h0-3842" id="h0-3842" class="i">+}
</a><a href="#h0-3843" id="h0-3843" class="i">+
</a><a href="#h0-3844" id="h0-3844" class="i">+bool
</a><a href="#h0-3845" id="h0-3845" class="i">+match(uint mask, uint state) {
</a><a href="#h0-3846" id="h0-3846" class="i">+	return mask == XK_ANY_MOD || mask == (state &amp; ~ignoremod);
</a><a href="#h0-3847" id="h0-3847" class="i">+}
</a><a href="#h0-3848" id="h0-3848" class="i">+
</a><a href="#h0-3849" id="h0-3849" class="i">+void
</a><a href="#h0-3850" id="h0-3850" class="i">+numlock(const Arg *dummy) {
</a><a href="#h0-3851" id="h0-3851" class="i">+	term.numlock ^= 1;
</a><a href="#h0-3852" id="h0-3852" class="i">+}
</a><a href="#h0-3853" id="h0-3853" class="i">+
</a><a href="#h0-3854" id="h0-3854" class="i">+char*
</a><a href="#h0-3855" id="h0-3855" class="i">+kmap(KeySym k, uint state) {
</a><a href="#h0-3856" id="h0-3856" class="i">+	Key *kp;
</a><a href="#h0-3857" id="h0-3857" class="i">+	int i;
</a><a href="#h0-3858" id="h0-3858" class="i">+
</a><a href="#h0-3859" id="h0-3859" class="i">+	/* Check for mapped keys out of X11 function keys. */
</a><a href="#h0-3860" id="h0-3860" class="i">+	for(i = 0; i &lt; LEN(mappedkeys); i++) {
</a><a href="#h0-3861" id="h0-3861" class="i">+		if(mappedkeys[i] == k)
</a><a href="#h0-3862" id="h0-3862" class="i">+			break;
</a><a href="#h0-3863" id="h0-3863" class="i">+	}
</a><a href="#h0-3864" id="h0-3864" class="i">+	if(i == LEN(mappedkeys)) {
</a><a href="#h0-3865" id="h0-3865" class="i">+		if((k &amp; 0xFFFF) &lt; 0xFD00)
</a><a href="#h0-3866" id="h0-3866" class="i">+			return NULL;
</a><a href="#h0-3867" id="h0-3867" class="i">+	}
</a><a href="#h0-3868" id="h0-3868" class="i">+
</a><a href="#h0-3869" id="h0-3869" class="i">+	for(kp = key; kp &lt; key + LEN(key); kp++) {
</a><a href="#h0-3870" id="h0-3870" class="i">+		if(kp-&gt;k != k)
</a><a href="#h0-3871" id="h0-3871" class="i">+			continue;
</a><a href="#h0-3872" id="h0-3872" class="i">+
</a><a href="#h0-3873" id="h0-3873" class="i">+		if(!match(kp-&gt;mask, state))
</a><a href="#h0-3874" id="h0-3874" class="i">+			continue;
</a><a href="#h0-3875" id="h0-3875" class="i">+
</a><a href="#h0-3876" id="h0-3876" class="i">+		if(IS_SET(MODE_APPKEYPAD) ? kp-&gt;appkey &lt; 0 : kp-&gt;appkey &gt; 0)
</a><a href="#h0-3877" id="h0-3877" class="i">+			continue;
</a><a href="#h0-3878" id="h0-3878" class="i">+		if(term.numlock &amp;&amp; kp-&gt;appkey == 2)
</a><a href="#h0-3879" id="h0-3879" class="i">+			continue;
</a><a href="#h0-3880" id="h0-3880" class="i">+
</a><a href="#h0-3881" id="h0-3881" class="i">+		if(IS_SET(MODE_APPCURSOR) ? kp-&gt;appcursor &lt; 0 : kp-&gt;appcursor &gt; 0)
</a><a href="#h0-3882" id="h0-3882" class="i">+			continue;
</a><a href="#h0-3883" id="h0-3883" class="i">+
</a><a href="#h0-3884" id="h0-3884" class="i">+		if(IS_SET(MODE_CRLF) ? kp-&gt;crlf &lt; 0 : kp-&gt;crlf &gt; 0)
</a><a href="#h0-3885" id="h0-3885" class="i">+			continue;
</a><a href="#h0-3886" id="h0-3886" class="i">+
</a><a href="#h0-3887" id="h0-3887" class="i">+		return kp-&gt;s;
</a><a href="#h0-3888" id="h0-3888" class="i">+	}
</a><a href="#h0-3889" id="h0-3889" class="i">+
</a><a href="#h0-3890" id="h0-3890" class="i">+	return NULL;
</a><a href="#h0-3891" id="h0-3891" class="i">+}
</a><a href="#h0-3892" id="h0-3892" class="i">+
</a><a href="#h0-3893" id="h0-3893" class="i">+void
</a><a href="#h0-3894" id="h0-3894" class="i">+kpress(XEvent *ev) {
</a><a href="#h0-3895" id="h0-3895" class="i">+	XKeyEvent *e = &amp;ev-&gt;xkey;
</a><a href="#h0-3896" id="h0-3896" class="i">+	KeySym ksym;
</a><a href="#h0-3897" id="h0-3897" class="i">+	char buf[32], *customkey;
</a><a href="#h0-3898" id="h0-3898" class="i">+	int len;
</a><a href="#h0-3899" id="h0-3899" class="i">+	Rune c;
</a><a href="#h0-3900" id="h0-3900" class="i">+	Status status;
</a><a href="#h0-3901" id="h0-3901" class="i">+	Shortcut *bp;
</a><a href="#h0-3902" id="h0-3902" class="i">+
</a><a href="#h0-3903" id="h0-3903" class="i">+  if(xw.pointerisvisible) {
</a><a href="#h0-3904" id="h0-3904" class="i">+    XDefineCursor(xw.dpy, xw.win, xw.bpointer);
</a><a href="#h0-3905" id="h0-3905" class="i">+    xsetpointermotion(1);
</a><a href="#h0-3906" id="h0-3906" class="i">+    xw.pointerisvisible = false;
</a><a href="#h0-3907" id="h0-3907" class="i">+  }
</a><a href="#h0-3908" id="h0-3908" class="i">+
</a><a href="#h0-3909" id="h0-3909" class="i">+	if(IS_SET(MODE_KBDLOCK))
</a><a href="#h0-3910" id="h0-3910" class="i">+		return;
</a><a href="#h0-3911" id="h0-3911" class="i">+
</a><a href="#h0-3912" id="h0-3912" class="i">+	len = XmbLookupString(xw.xic, e, buf, sizeof buf, &amp;ksym, &amp;status);
</a><a href="#h0-3913" id="h0-3913" class="i">+	/* 1. shortcuts */
</a><a href="#h0-3914" id="h0-3914" class="i">+	for(bp = shortcuts; bp &lt; shortcuts + LEN(shortcuts); bp++) {
</a><a href="#h0-3915" id="h0-3915" class="i">+		if(ksym == bp-&gt;keysym &amp;&amp; match(bp-&gt;mod, e-&gt;state)) {
</a><a href="#h0-3916" id="h0-3916" class="i">+			bp-&gt;func(&amp;(bp-&gt;arg));
</a><a href="#h0-3917" id="h0-3917" class="i">+			return;
</a><a href="#h0-3918" id="h0-3918" class="i">+		}
</a><a href="#h0-3919" id="h0-3919" class="i">+	}
</a><a href="#h0-3920" id="h0-3920" class="i">+
</a><a href="#h0-3921" id="h0-3921" class="i">+	/* 2. custom keys from config.h */
</a><a href="#h0-3922" id="h0-3922" class="i">+	if((customkey = kmap(ksym, e-&gt;state))) {
</a><a href="#h0-3923" id="h0-3923" class="i">+		ttysend(customkey, strlen(customkey));
</a><a href="#h0-3924" id="h0-3924" class="i">+		return;
</a><a href="#h0-3925" id="h0-3925" class="i">+	}
</a><a href="#h0-3926" id="h0-3926" class="i">+
</a><a href="#h0-3927" id="h0-3927" class="i">+	/* 3. composed string from input method */
</a><a href="#h0-3928" id="h0-3928" class="i">+	if(len == 0)
</a><a href="#h0-3929" id="h0-3929" class="i">+		return;
</a><a href="#h0-3930" id="h0-3930" class="i">+	if(len == 1 &amp;&amp; e-&gt;state &amp; Mod1Mask) {
</a><a href="#h0-3931" id="h0-3931" class="i">+		if(IS_SET(MODE_8BIT)) {
</a><a href="#h0-3932" id="h0-3932" class="i">+			if(*buf &lt; 0177) {
</a><a href="#h0-3933" id="h0-3933" class="i">+				c = *buf | 0x80;
</a><a href="#h0-3934" id="h0-3934" class="i">+				len = utf8encode(c, buf);
</a><a href="#h0-3935" id="h0-3935" class="i">+			}
</a><a href="#h0-3936" id="h0-3936" class="i">+		} else {
</a><a href="#h0-3937" id="h0-3937" class="i">+			buf[1] = buf[0];
</a><a href="#h0-3938" id="h0-3938" class="i">+			buf[0] = &apos;\033&apos;;
</a><a href="#h0-3939" id="h0-3939" class="i">+			len = 2;
</a><a href="#h0-3940" id="h0-3940" class="i">+		}
</a><a href="#h0-3941" id="h0-3941" class="i">+	}
</a><a href="#h0-3942" id="h0-3942" class="i">+	ttysend(buf, len);
</a><a href="#h0-3943" id="h0-3943" class="i">+}
</a><a href="#h0-3944" id="h0-3944" class="i">+
</a><a href="#h0-3945" id="h0-3945" class="i">+
</a><a href="#h0-3946" id="h0-3946" class="i">+void
</a><a href="#h0-3947" id="h0-3947" class="i">+cmessage(XEvent *e) {
</a><a href="#h0-3948" id="h0-3948" class="i">+	/*
</a><a href="#h0-3949" id="h0-3949" class="i">+	 * See xembed specs
</a><a href="#h0-3950" id="h0-3950" class="i">+	 *  http://standards.freedesktop.org/xembed-spec/xembed-spec-latest.html
</a><a href="#h0-3951" id="h0-3951" class="i">+	 */
</a><a href="#h0-3952" id="h0-3952" class="i">+	if(e-&gt;xclient.message_type == xw.xembed &amp;&amp; e-&gt;xclient.format == 32) {
</a><a href="#h0-3953" id="h0-3953" class="i">+		if(e-&gt;xclient.data.l[1] == XEMBED_FOCUS_IN) {
</a><a href="#h0-3954" id="h0-3954" class="i">+			xw.state |= WIN_FOCUSED;
</a><a href="#h0-3955" id="h0-3955" class="i">+			xseturgency(0);
</a><a href="#h0-3956" id="h0-3956" class="i">+		} else if(e-&gt;xclient.data.l[1] == XEMBED_FOCUS_OUT) {
</a><a href="#h0-3957" id="h0-3957" class="i">+			xw.state &amp;= ~WIN_FOCUSED;
</a><a href="#h0-3958" id="h0-3958" class="i">+		}
</a><a href="#h0-3959" id="h0-3959" class="i">+	} else if(e-&gt;xclient.data.l[0] == xw.wmdeletewin) {
</a><a href="#h0-3960" id="h0-3960" class="i">+		/* Send SIGHUP to shell */
</a><a href="#h0-3961" id="h0-3961" class="i">+		kill(pid, SIGHUP);
</a><a href="#h0-3962" id="h0-3962" class="i">+		exit(EXIT_SUCCESS);
</a><a href="#h0-3963" id="h0-3963" class="i">+	}
</a><a href="#h0-3964" id="h0-3964" class="i">+}
</a><a href="#h0-3965" id="h0-3965" class="i">+
</a><a href="#h0-3966" id="h0-3966" class="i">+void
</a><a href="#h0-3967" id="h0-3967" class="i">+cresize(int width, int height) {
</a><a href="#h0-3968" id="h0-3968" class="i">+	int col, row;
</a><a href="#h0-3969" id="h0-3969" class="i">+
</a><a href="#h0-3970" id="h0-3970" class="i">+	if(width != 0)
</a><a href="#h0-3971" id="h0-3971" class="i">+		xw.w = width;
</a><a href="#h0-3972" id="h0-3972" class="i">+	if(height != 0)
</a><a href="#h0-3973" id="h0-3973" class="i">+		xw.h = height;
</a><a href="#h0-3974" id="h0-3974" class="i">+
</a><a href="#h0-3975" id="h0-3975" class="i">+	col = (xw.w - 2 * borderpx) / xw.cw;
</a><a href="#h0-3976" id="h0-3976" class="i">+	row = (xw.h - 2 * borderpx) / xw.ch;
</a><a href="#h0-3977" id="h0-3977" class="i">+
</a><a href="#h0-3978" id="h0-3978" class="i">+	tresize(col, row);
</a><a href="#h0-3979" id="h0-3979" class="i">+	xresize(col, row);
</a><a href="#h0-3980" id="h0-3980" class="i">+	ttyresize();
</a><a href="#h0-3981" id="h0-3981" class="i">+}
</a><a href="#h0-3982" id="h0-3982" class="i">+
</a><a href="#h0-3983" id="h0-3983" class="i">+void
</a><a href="#h0-3984" id="h0-3984" class="i">+resize(XEvent *e) {
</a><a href="#h0-3985" id="h0-3985" class="i">+	if(e-&gt;xconfigure.width == xw.w &amp;&amp; e-&gt;xconfigure.height == xw.h)
</a><a href="#h0-3986" id="h0-3986" class="i">+		return;
</a><a href="#h0-3987" id="h0-3987" class="i">+
</a><a href="#h0-3988" id="h0-3988" class="i">+	cresize(e-&gt;xconfigure.width, e-&gt;xconfigure.height);
</a><a href="#h0-3989" id="h0-3989" class="i">+}
</a><a href="#h0-3990" id="h0-3990" class="i">+
</a><a href="#h0-3991" id="h0-3991" class="i">+void
</a><a href="#h0-3992" id="h0-3992" class="i">+run(void) {
</a><a href="#h0-3993" id="h0-3993" class="i">+	XEvent ev;
</a><a href="#h0-3994" id="h0-3994" class="i">+	int w = xw.w, h = xw.h;
</a><a href="#h0-3995" id="h0-3995" class="i">+	fd_set rfd;
</a><a href="#h0-3996" id="h0-3996" class="i">+	int xfd = XConnectionNumber(xw.dpy), xev, blinkset = 0, dodraw = 0;
</a><a href="#h0-3997" id="h0-3997" class="i">+	struct timespec drawtimeout, *tv = NULL, now, last, lastblink;
</a><a href="#h0-3998" id="h0-3998" class="i">+	long deltatime;
</a><a href="#h0-3999" id="h0-3999" class="i">+
</a><a href="#h0-4000" id="h0-4000" class="i">+	/* Waiting for window mapping */
</a><a href="#h0-4001" id="h0-4001" class="i">+	do {
</a><a href="#h0-4002" id="h0-4002" class="i">+		XNextEvent(xw.dpy, &amp;ev);
</a><a href="#h0-4003" id="h0-4003" class="i">+		/*
</a><a href="#h0-4004" id="h0-4004" class="i">+		 * XFilterEvent is required to be called after you using XOpenIM,
</a><a href="#h0-4005" id="h0-4005" class="i">+		 * this is not unnecessary.It does not only filter the key event,
</a><a href="#h0-4006" id="h0-4006" class="i">+		 * but some clientmessage for input method as well.
</a><a href="#h0-4007" id="h0-4007" class="i">+		 */
</a><a href="#h0-4008" id="h0-4008" class="i">+		if(XFilterEvent(&amp;ev, None))
</a><a href="#h0-4009" id="h0-4009" class="i">+			continue;
</a><a href="#h0-4010" id="h0-4010" class="i">+		if(ev.type == ConfigureNotify) {
</a><a href="#h0-4011" id="h0-4011" class="i">+			w = ev.xconfigure.width;
</a><a href="#h0-4012" id="h0-4012" class="i">+			h = ev.xconfigure.height;
</a><a href="#h0-4013" id="h0-4013" class="i">+		}
</a><a href="#h0-4014" id="h0-4014" class="i">+	} while(ev.type != MapNotify);
</a><a href="#h0-4015" id="h0-4015" class="i">+
</a><a href="#h0-4016" id="h0-4016" class="i">+	ttynew();
</a><a href="#h0-4017" id="h0-4017" class="i">+	cresize(w, h);
</a><a href="#h0-4018" id="h0-4018" class="i">+
</a><a href="#h0-4019" id="h0-4019" class="i">+	clock_gettime(CLOCK_MONOTONIC, &amp;last);
</a><a href="#h0-4020" id="h0-4020" class="i">+	lastblink = last;
</a><a href="#h0-4021" id="h0-4021" class="i">+
</a><a href="#h0-4022" id="h0-4022" class="i">+	for(xev = actionfps;;) {
</a><a href="#h0-4023" id="h0-4023" class="i">+		FD_ZERO(&amp;rfd);
</a><a href="#h0-4024" id="h0-4024" class="i">+		FD_SET(cmdfd, &amp;rfd);
</a><a href="#h0-4025" id="h0-4025" class="i">+		FD_SET(xfd, &amp;rfd);
</a><a href="#h0-4026" id="h0-4026" class="i">+
</a><a href="#h0-4027" id="h0-4027" class="i">+		if(pselect(MAX(xfd, cmdfd)+1, &amp;rfd, NULL, NULL, tv, NULL) &lt; 0) {
</a><a href="#h0-4028" id="h0-4028" class="i">+			if(errno == EINTR)
</a><a href="#h0-4029" id="h0-4029" class="i">+				continue;
</a><a href="#h0-4030" id="h0-4030" class="i">+			die(&quot;select failed: %s\n&quot;, strerror(errno));
</a><a href="#h0-4031" id="h0-4031" class="i">+		}
</a><a href="#h0-4032" id="h0-4032" class="i">+		if(FD_ISSET(cmdfd, &amp;rfd)) {
</a><a href="#h0-4033" id="h0-4033" class="i">+			ttyread();
</a><a href="#h0-4034" id="h0-4034" class="i">+			if(blinktimeout) {
</a><a href="#h0-4035" id="h0-4035" class="i">+				blinkset = tattrset(ATTR_BLINK);
</a><a href="#h0-4036" id="h0-4036" class="i">+				if(!blinkset)
</a><a href="#h0-4037" id="h0-4037" class="i">+					MODBIT(term.mode, 0, MODE_BLINK);
</a><a href="#h0-4038" id="h0-4038" class="i">+			}
</a><a href="#h0-4039" id="h0-4039" class="i">+		}
</a><a href="#h0-4040" id="h0-4040" class="i">+
</a><a href="#h0-4041" id="h0-4041" class="i">+		if(FD_ISSET(xfd, &amp;rfd))
</a><a href="#h0-4042" id="h0-4042" class="i">+			xev = actionfps;
</a><a href="#h0-4043" id="h0-4043" class="i">+
</a><a href="#h0-4044" id="h0-4044" class="i">+		clock_gettime(CLOCK_MONOTONIC, &amp;now);
</a><a href="#h0-4045" id="h0-4045" class="i">+		drawtimeout.tv_sec = 0;
</a><a href="#h0-4046" id="h0-4046" class="i">+		drawtimeout.tv_nsec =  (1000 * 1E6)/ xfps;
</a><a href="#h0-4047" id="h0-4047" class="i">+		tv = &amp;drawtimeout;
</a><a href="#h0-4048" id="h0-4048" class="i">+
</a><a href="#h0-4049" id="h0-4049" class="i">+		dodraw = 0;
</a><a href="#h0-4050" id="h0-4050" class="i">+		if(blinktimeout &amp;&amp; TIMEDIFF(now, lastblink) &gt; blinktimeout) {
</a><a href="#h0-4051" id="h0-4051" class="i">+			tsetdirtattr(ATTR_BLINK);
</a><a href="#h0-4052" id="h0-4052" class="i">+			term.mode ^= MODE_BLINK;
</a><a href="#h0-4053" id="h0-4053" class="i">+			lastblink = now;
</a><a href="#h0-4054" id="h0-4054" class="i">+			dodraw = 1;
</a><a href="#h0-4055" id="h0-4055" class="i">+		}
</a><a href="#h0-4056" id="h0-4056" class="i">+		deltatime = TIMEDIFF(now, last);
</a><a href="#h0-4057" id="h0-4057" class="i">+		if(deltatime &gt; 1000 / (xev ? xfps : actionfps)) {
</a><a href="#h0-4058" id="h0-4058" class="i">+			dodraw = 1;
</a><a href="#h0-4059" id="h0-4059" class="i">+			last = now;
</a><a href="#h0-4060" id="h0-4060" class="i">+		}
</a><a href="#h0-4061" id="h0-4061" class="i">+
</a><a href="#h0-4062" id="h0-4062" class="i">+		if(dodraw) {
</a><a href="#h0-4063" id="h0-4063" class="i">+			while(XPending(xw.dpy)) {
</a><a href="#h0-4064" id="h0-4064" class="i">+				XNextEvent(xw.dpy, &amp;ev);
</a><a href="#h0-4065" id="h0-4065" class="i">+				if(XFilterEvent(&amp;ev, None))
</a><a href="#h0-4066" id="h0-4066" class="i">+					continue;
</a><a href="#h0-4067" id="h0-4067" class="i">+				if(handler[ev.type])
</a><a href="#h0-4068" id="h0-4068" class="i">+					(handler[ev.type])(&amp;ev);
</a><a href="#h0-4069" id="h0-4069" class="i">+			}
</a><a href="#h0-4070" id="h0-4070" class="i">+
</a><a href="#h0-4071" id="h0-4071" class="i">+			draw();
</a><a href="#h0-4072" id="h0-4072" class="i">+			XFlush(xw.dpy);
</a><a href="#h0-4073" id="h0-4073" class="i">+
</a><a href="#h0-4074" id="h0-4074" class="i">+			if(xev &amp;&amp; !FD_ISSET(xfd, &amp;rfd))
</a><a href="#h0-4075" id="h0-4075" class="i">+				xev--;
</a><a href="#h0-4076" id="h0-4076" class="i">+			if(!FD_ISSET(cmdfd, &amp;rfd) &amp;&amp; !FD_ISSET(xfd, &amp;rfd)) {
</a><a href="#h0-4077" id="h0-4077" class="i">+				if(blinkset) {
</a><a href="#h0-4078" id="h0-4078" class="i">+					if(TIMEDIFF(now, lastblink) \
</a><a href="#h0-4079" id="h0-4079" class="i">+							&gt; blinktimeout) {
</a><a href="#h0-4080" id="h0-4080" class="i">+						drawtimeout.tv_nsec = 1000;
</a><a href="#h0-4081" id="h0-4081" class="i">+					} else {
</a><a href="#h0-4082" id="h0-4082" class="i">+						drawtimeout.tv_nsec = (1E6 * \
</a><a href="#h0-4083" id="h0-4083" class="i">+							(blinktimeout - \
</a><a href="#h0-4084" id="h0-4084" class="i">+							TIMEDIFF(now,
</a><a href="#h0-4085" id="h0-4085" class="i">+								lastblink)));
</a><a href="#h0-4086" id="h0-4086" class="i">+					}
</a><a href="#h0-4087" id="h0-4087" class="i">+					drawtimeout.tv_sec = \
</a><a href="#h0-4088" id="h0-4088" class="i">+					    drawtimeout.tv_nsec / 1E9;
</a><a href="#h0-4089" id="h0-4089" class="i">+					drawtimeout.tv_nsec %= (long)1E9;
</a><a href="#h0-4090" id="h0-4090" class="i">+				} else {
</a><a href="#h0-4091" id="h0-4091" class="i">+					tv = NULL;
</a><a href="#h0-4092" id="h0-4092" class="i">+				}
</a><a href="#h0-4093" id="h0-4093" class="i">+			}
</a><a href="#h0-4094" id="h0-4094" class="i">+		}
</a><a href="#h0-4095" id="h0-4095" class="i">+	}
</a><a href="#h0-4096" id="h0-4096" class="i">+}
</a><a href="#h0-4097" id="h0-4097" class="i">+
</a><a href="#h0-4098" id="h0-4098" class="i">+void
</a><a href="#h0-4099" id="h0-4099" class="i">+usage(void) {
</a><a href="#h0-4100" id="h0-4100" class="i">+	die(&quot;%s &quot; VERSION &quot; (c) 2010-2015 st engineers\n&quot;
</a><a href="#h0-4101" id="h0-4101" class="i">+	&quot;usage: st [-a] [-v] [-c class] [-f font] [-g geometry] [-o file]\n&quot;
</a><a href="#h0-4102" id="h0-4102" class="i">+	&quot;          [-i] [-t title] [-w windowid] [-e command ...] [command ...]\n&quot;
</a><a href="#h0-4103" id="h0-4103" class="i">+	&quot;       st [-a] [-v] [-c class] [-f font] [-g geometry] [-o file]\n&quot;
</a><a href="#h0-4104" id="h0-4104" class="i">+	&quot;          [-i] [-t title] [-w windowid] [-l line] [stty_args ...]\n&quot;,
</a><a href="#h0-4105" id="h0-4105" class="i">+	argv0);
</a><a href="#h0-4106" id="h0-4106" class="i">+}
</a><a href="#h0-4107" id="h0-4107" class="i">+
</a><a href="#h0-4108" id="h0-4108" class="i">+int
</a><a href="#h0-4109" id="h0-4109" class="i">+main(int argc, char *argv[]) {
</a><a href="#h0-4110" id="h0-4110" class="i">+	uint cols = 80, rows = 24;
</a><a href="#h0-4111" id="h0-4111" class="i">+
</a><a href="#h0-4112" id="h0-4112" class="i">+	xw.l = xw.t = 0;
</a><a href="#h0-4113" id="h0-4113" class="i">+	xw.isfixed = False;
</a><a href="#h0-4114" id="h0-4114" class="i">+	xw.cursor = 0;
</a><a href="#h0-4115" id="h0-4115" class="i">+
</a><a href="#h0-4116" id="h0-4116" class="i">+	ARGBEGIN {
</a><a href="#h0-4117" id="h0-4117" class="i">+	case &apos;a&apos;:
</a><a href="#h0-4118" id="h0-4118" class="i">+		allowaltscreen = false;
</a><a href="#h0-4119" id="h0-4119" class="i">+		break;
</a><a href="#h0-4120" id="h0-4120" class="i">+	case &apos;c&apos;:
</a><a href="#h0-4121" id="h0-4121" class="i">+		opt_class = EARGF(usage());
</a><a href="#h0-4122" id="h0-4122" class="i">+		break;
</a><a href="#h0-4123" id="h0-4123" class="i">+	case &apos;e&apos;:
</a><a href="#h0-4124" id="h0-4124" class="i">+		if(argc &gt; 0)
</a><a href="#h0-4125" id="h0-4125" class="i">+			--argc, ++argv;
</a><a href="#h0-4126" id="h0-4126" class="i">+		goto run;
</a><a href="#h0-4127" id="h0-4127" class="i">+	case &apos;f&apos;:
</a><a href="#h0-4128" id="h0-4128" class="i">+		opt_font = EARGF(usage());
</a><a href="#h0-4129" id="h0-4129" class="i">+		break;
</a><a href="#h0-4130" id="h0-4130" class="i">+	case &apos;g&apos;:
</a><a href="#h0-4131" id="h0-4131" class="i">+		xw.gm = XParseGeometry(EARGF(usage()),
</a><a href="#h0-4132" id="h0-4132" class="i">+				&amp;xw.l, &amp;xw.t, &amp;cols, &amp;rows);
</a><a href="#h0-4133" id="h0-4133" class="i">+		break;
</a><a href="#h0-4134" id="h0-4134" class="i">+	case &apos;i&apos;:
</a><a href="#h0-4135" id="h0-4135" class="i">+		xw.isfixed = True;
</a><a href="#h0-4136" id="h0-4136" class="i">+		break;
</a><a href="#h0-4137" id="h0-4137" class="i">+	case &apos;o&apos;:
</a><a href="#h0-4138" id="h0-4138" class="i">+		opt_io = EARGF(usage());
</a><a href="#h0-4139" id="h0-4139" class="i">+		break;
</a><a href="#h0-4140" id="h0-4140" class="i">+	case &apos;l&apos;:
</a><a href="#h0-4141" id="h0-4141" class="i">+		opt_line = EARGF(usage());
</a><a href="#h0-4142" id="h0-4142" class="i">+		break;
</a><a href="#h0-4143" id="h0-4143" class="i">+	case &apos;t&apos;:
</a><a href="#h0-4144" id="h0-4144" class="i">+		opt_title = EARGF(usage());
</a><a href="#h0-4145" id="h0-4145" class="i">+		break;
</a><a href="#h0-4146" id="h0-4146" class="i">+	case &apos;w&apos;:
</a><a href="#h0-4147" id="h0-4147" class="i">+		opt_embed = EARGF(usage());
</a><a href="#h0-4148" id="h0-4148" class="i">+		break;
</a><a href="#h0-4149" id="h0-4149" class="i">+	case &apos;v&apos;:
</a><a href="#h0-4150" id="h0-4150" class="i">+	default:
</a><a href="#h0-4151" id="h0-4151" class="i">+		usage();
</a><a href="#h0-4152" id="h0-4152" class="i">+	} ARGEND;
</a><a href="#h0-4153" id="h0-4153" class="i">+
</a><a href="#h0-4154" id="h0-4154" class="i">+run:
</a><a href="#h0-4155" id="h0-4155" class="i">+	if(argc &gt; 0) {
</a><a href="#h0-4156" id="h0-4156" class="i">+		/* eat all remaining arguments */
</a><a href="#h0-4157" id="h0-4157" class="i">+		opt_cmd = argv;
</a><a href="#h0-4158" id="h0-4158" class="i">+		if(!opt_title &amp;&amp; !opt_line)
</a><a href="#h0-4159" id="h0-4159" class="i">+			opt_title = basename(xstrdup(argv[0]));
</a><a href="#h0-4160" id="h0-4160" class="i">+	}
</a><a href="#h0-4161" id="h0-4161" class="i">+	setlocale(LC_CTYPE, &quot;&quot;);
</a><a href="#h0-4162" id="h0-4162" class="i">+	XSetLocaleModifiers(&quot;&quot;);
</a><a href="#h0-4163" id="h0-4163" class="i">+	tnew(MAX(cols, 1), MAX(rows, 1));
</a><a href="#h0-4164" id="h0-4164" class="i">+	xinit();
</a><a href="#h0-4165" id="h0-4165" class="i">+	selinit();
</a><a href="#h0-4166" id="h0-4166" class="i">+	run();
</a><a href="#h0-4167" id="h0-4167" class="i">+
</a><a href="#h0-4168" id="h0-4168" class="i">+	return 0;
</a><a href="#h0-4169" id="h0-4169" class="i">+}
</a><a href="#h0-4170" id="h0-4170" class="i">+
</a><b>diff --git a/<a href="../file/st/st.info.html">st/st.info</a> b/<a href="../file/st/st.info.html">st/st.info</a></b>
<a href="#h0" id="h0" class="h">@@ -0,0 +1,213 @@
</a><a href="#h0-0" id="h0-0" class="i">+st| simpleterm,
</a><a href="#h0-1" id="h0-1" class="i">+	acsc=``aaffggiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz{{||}}~~,
</a><a href="#h0-2" id="h0-2" class="i">+	am,
</a><a href="#h0-3" id="h0-3" class="i">+	bce,
</a><a href="#h0-4" id="h0-4" class="i">+	bel=^G,
</a><a href="#h0-5" id="h0-5" class="i">+	blink=\E[5m,
</a><a href="#h0-6" id="h0-6" class="i">+	bold=\E[1m,
</a><a href="#h0-7" id="h0-7" class="i">+	cbt=\E[Z,
</a><a href="#h0-8" id="h0-8" class="i">+	cvvis=\E[?25h,
</a><a href="#h0-9" id="h0-9" class="i">+	civis=\E[?25l,
</a><a href="#h0-10" id="h0-10" class="i">+	clear=\E[H\E[2J,
</a><a href="#h0-11" id="h0-11" class="i">+	cnorm=\E[?12l\E[?25h,
</a><a href="#h0-12" id="h0-12" class="i">+	colors#8,
</a><a href="#h0-13" id="h0-13" class="i">+	cols#80,
</a><a href="#h0-14" id="h0-14" class="i">+	cr=^M,
</a><a href="#h0-15" id="h0-15" class="i">+	csr=\E[%i%p1%d;%p2%dr,
</a><a href="#h0-16" id="h0-16" class="i">+	cub=\E[%p1%dD,
</a><a href="#h0-17" id="h0-17" class="i">+	cub1=^H,
</a><a href="#h0-18" id="h0-18" class="i">+	cud1=^J,
</a><a href="#h0-19" id="h0-19" class="i">+	cud=\E[%p1%dB,
</a><a href="#h0-20" id="h0-20" class="i">+	cuf1=\E[C,
</a><a href="#h0-21" id="h0-21" class="i">+	cuf=\E[%p1%dC,
</a><a href="#h0-22" id="h0-22" class="i">+	cup=\E[%i%p1%d;%p2%dH,
</a><a href="#h0-23" id="h0-23" class="i">+	cuu1=\E[A,
</a><a href="#h0-24" id="h0-24" class="i">+	cuu=\E[%p1%dA,
</a><a href="#h0-25" id="h0-25" class="i">+	dch=\E[%p1%dP,
</a><a href="#h0-26" id="h0-26" class="i">+	dch1=\E[P,
</a><a href="#h0-27" id="h0-27" class="i">+	dl=\E[%p1%dM,
</a><a href="#h0-28" id="h0-28" class="i">+	dl1=\E[M,
</a><a href="#h0-29" id="h0-29" class="i">+	ech=\E[%p1%dX,
</a><a href="#h0-30" id="h0-30" class="i">+	ed=\E[J,
</a><a href="#h0-31" id="h0-31" class="i">+	el=\E[K,
</a><a href="#h0-32" id="h0-32" class="i">+	el1=\E[1K,
</a><a href="#h0-33" id="h0-33" class="i">+	enacs=\E)0,
</a><a href="#h0-34" id="h0-34" class="i">+	flash=\E[?5h$&lt;80/&gt;\E[?5l,
</a><a href="#h0-35" id="h0-35" class="i">+	fsl=^G,
</a><a href="#h0-36" id="h0-36" class="i">+	home=\E[H,
</a><a href="#h0-37" id="h0-37" class="i">+	hpa=\E[%i%p1%dG,
</a><a href="#h0-38" id="h0-38" class="i">+	hs,
</a><a href="#h0-39" id="h0-39" class="i">+	ht=^I,
</a><a href="#h0-40" id="h0-40" class="i">+	hts=\EH,
</a><a href="#h0-41" id="h0-41" class="i">+	ich=\E[%p1%d@,
</a><a href="#h0-42" id="h0-42" class="i">+	il1=\E[L,
</a><a href="#h0-43" id="h0-43" class="i">+	il=\E[%p1%dL,
</a><a href="#h0-44" id="h0-44" class="i">+	ind=^J,
</a><a href="#h0-45" id="h0-45" class="i">+	indn=\E[%p1%dS,
</a><a href="#h0-46" id="h0-46" class="i">+	invis=\E[8m,
</a><a href="#h0-47" id="h0-47" class="i">+	is2=\E[4l\E&gt;\E[?1034l,
</a><a href="#h0-48" id="h0-48" class="i">+	it#8,
</a><a href="#h0-49" id="h0-49" class="i">+	kel=\E[1;2F,
</a><a href="#h0-50" id="h0-50" class="i">+	ked=\E[1;5F,
</a><a href="#h0-51" id="h0-51" class="i">+	ka1=\E[1~,
</a><a href="#h0-52" id="h0-52" class="i">+	ka3=\E[5~,
</a><a href="#h0-53" id="h0-53" class="i">+	kc1=\E[4~,
</a><a href="#h0-54" id="h0-54" class="i">+	kc3=\E[6~,
</a><a href="#h0-55" id="h0-55" class="i">+	kbs=\177,
</a><a href="#h0-56" id="h0-56" class="i">+	kcbt=\E[Z,
</a><a href="#h0-57" id="h0-57" class="i">+	kb2=\EOu,
</a><a href="#h0-58" id="h0-58" class="i">+	kcub1=\EOD,
</a><a href="#h0-59" id="h0-59" class="i">+	kcud1=\EOB,
</a><a href="#h0-60" id="h0-60" class="i">+	kcuf1=\EOC,
</a><a href="#h0-61" id="h0-61" class="i">+	kcuu1=\EOA,
</a><a href="#h0-62" id="h0-62" class="i">+	kDC=\E[3;2~,
</a><a href="#h0-63" id="h0-63" class="i">+	kent=\EOM,
</a><a href="#h0-64" id="h0-64" class="i">+	kEND=\E[1;2F,
</a><a href="#h0-65" id="h0-65" class="i">+	kIC=\E[2;2~,
</a><a href="#h0-66" id="h0-66" class="i">+	kNXT=\E[6;2~,
</a><a href="#h0-67" id="h0-67" class="i">+	kPRV=\E[5;2~,
</a><a href="#h0-68" id="h0-68" class="i">+	kHOM=\E[1;2H,
</a><a href="#h0-69" id="h0-69" class="i">+	kLFT=\E[1;2D,
</a><a href="#h0-70" id="h0-70" class="i">+	kRIT=\E[1;2C,
</a><a href="#h0-71" id="h0-71" class="i">+	kind=\E[1;2B,
</a><a href="#h0-72" id="h0-72" class="i">+	kri=\E[1;2A,
</a><a href="#h0-73" id="h0-73" class="i">+	kclr=\E[3;5~,
</a><a href="#h0-74" id="h0-74" class="i">+	kdl1=\E[3;2~,
</a><a href="#h0-75" id="h0-75" class="i">+	kdch1=\E[3~,
</a><a href="#h0-76" id="h0-76" class="i">+	kich1=\E[2~,
</a><a href="#h0-77" id="h0-77" class="i">+	kend=\E[4~,
</a><a href="#h0-78" id="h0-78" class="i">+	kf1=\EOP,
</a><a href="#h0-79" id="h0-79" class="i">+	kf2=\EOQ,
</a><a href="#h0-80" id="h0-80" class="i">+	kf3=\EOR,
</a><a href="#h0-81" id="h0-81" class="i">+	kf4=\EOS,
</a><a href="#h0-82" id="h0-82" class="i">+	kf5=\E[15~,
</a><a href="#h0-83" id="h0-83" class="i">+	kf6=\E[17~,
</a><a href="#h0-84" id="h0-84" class="i">+	kf7=\E[18~,
</a><a href="#h0-85" id="h0-85" class="i">+	kf8=\E[19~,
</a><a href="#h0-86" id="h0-86" class="i">+	kf9=\E[20~,
</a><a href="#h0-87" id="h0-87" class="i">+	kf10=\E[21~,
</a><a href="#h0-88" id="h0-88" class="i">+	kf11=\E[23~,
</a><a href="#h0-89" id="h0-89" class="i">+	kf12=\E[24~,
</a><a href="#h0-90" id="h0-90" class="i">+	kf13=\E[1;2P,
</a><a href="#h0-91" id="h0-91" class="i">+	kf14=\E[1;2Q,
</a><a href="#h0-92" id="h0-92" class="i">+	kf15=\E[1;2R,
</a><a href="#h0-93" id="h0-93" class="i">+	kf16=\E[1;2S,
</a><a href="#h0-94" id="h0-94" class="i">+	kf17=\E[15;2~,
</a><a href="#h0-95" id="h0-95" class="i">+	kf18=\E[17;2~,
</a><a href="#h0-96" id="h0-96" class="i">+	kf19=\E[18;2~,
</a><a href="#h0-97" id="h0-97" class="i">+	kf20=\E[19;2~,
</a><a href="#h0-98" id="h0-98" class="i">+	kf21=\E[20;2~,
</a><a href="#h0-99" id="h0-99" class="i">+	kf22=\E[21;2~,
</a><a href="#h0-100" id="h0-100" class="i">+	kf23=\E[23;2~,
</a><a href="#h0-101" id="h0-101" class="i">+	kf24=\E[24;2~,
</a><a href="#h0-102" id="h0-102" class="i">+	kf25=\E[1;5P,
</a><a href="#h0-103" id="h0-103" class="i">+	kf26=\E[1;5Q,
</a><a href="#h0-104" id="h0-104" class="i">+	kf27=\E[1;5R,
</a><a href="#h0-105" id="h0-105" class="i">+	kf28=\E[1;5S,
</a><a href="#h0-106" id="h0-106" class="i">+	kf29=\E[15;5~,
</a><a href="#h0-107" id="h0-107" class="i">+	kf30=\E[17;5~,
</a><a href="#h0-108" id="h0-108" class="i">+	kf31=\E[18;5~,
</a><a href="#h0-109" id="h0-109" class="i">+	kf32=\E[19;5~,
</a><a href="#h0-110" id="h0-110" class="i">+	kf33=\E[20;5~,
</a><a href="#h0-111" id="h0-111" class="i">+	kf34=\E[21;5~,
</a><a href="#h0-112" id="h0-112" class="i">+	kf35=\E[23;5~,
</a><a href="#h0-113" id="h0-113" class="i">+	kf36=\E[24;5~,
</a><a href="#h0-114" id="h0-114" class="i">+	kf37=\E[1;6P,
</a><a href="#h0-115" id="h0-115" class="i">+	kf38=\E[1;6Q,
</a><a href="#h0-116" id="h0-116" class="i">+	kf39=\E[1;6R,
</a><a href="#h0-117" id="h0-117" class="i">+	kf40=\E[1;6S,
</a><a href="#h0-118" id="h0-118" class="i">+	kf41=\E[15;6~,
</a><a href="#h0-119" id="h0-119" class="i">+	kf42=\E[17;6~,
</a><a href="#h0-120" id="h0-120" class="i">+	kf43=\E[18;6~,
</a><a href="#h0-121" id="h0-121" class="i">+	kf44=\E[19;6~,
</a><a href="#h0-122" id="h0-122" class="i">+	kf45=\E[20;6~,
</a><a href="#h0-123" id="h0-123" class="i">+	kf46=\E[21;6~,
</a><a href="#h0-124" id="h0-124" class="i">+	kf47=\E[23;6~,
</a><a href="#h0-125" id="h0-125" class="i">+	kf48=\E[24;6~,
</a><a href="#h0-126" id="h0-126" class="i">+	kf49=\E[1;3P,
</a><a href="#h0-127" id="h0-127" class="i">+	kf50=\E[1;3Q,
</a><a href="#h0-128" id="h0-128" class="i">+	kf51=\E[1;3R,
</a><a href="#h0-129" id="h0-129" class="i">+	kf52=\E[1;3S,
</a><a href="#h0-130" id="h0-130" class="i">+	kf53=\E[15;3~,
</a><a href="#h0-131" id="h0-131" class="i">+	kf54=\E[17;3~,
</a><a href="#h0-132" id="h0-132" class="i">+	kf55=\E[18;3~,
</a><a href="#h0-133" id="h0-133" class="i">+	kf56=\E[19;3~,
</a><a href="#h0-134" id="h0-134" class="i">+	kf57=\E[20;3~,
</a><a href="#h0-135" id="h0-135" class="i">+	kf58=\E[21;3~,
</a><a href="#h0-136" id="h0-136" class="i">+	kf59=\E[23;3~,
</a><a href="#h0-137" id="h0-137" class="i">+	kf60=\E[24;3~,
</a><a href="#h0-138" id="h0-138" class="i">+	kf61=\E[1;4P,
</a><a href="#h0-139" id="h0-139" class="i">+	kf62=\E[1;4Q,
</a><a href="#h0-140" id="h0-140" class="i">+	kf63=\E[1;4R,
</a><a href="#h0-141" id="h0-141" class="i">+	khome=\E[1~,
</a><a href="#h0-142" id="h0-142" class="i">+	kil1=\E[2;5~,
</a><a href="#h0-143" id="h0-143" class="i">+	krmir=\E[2;2~,
</a><a href="#h0-144" id="h0-144" class="i">+	kich1=\E[2~,
</a><a href="#h0-145" id="h0-145" class="i">+	knp=\E[6~,
</a><a href="#h0-146" id="h0-146" class="i">+	kmous=\E[M,
</a><a href="#h0-147" id="h0-147" class="i">+	kpp=\E[5~,
</a><a href="#h0-148" id="h0-148" class="i">+	lines#24,
</a><a href="#h0-149" id="h0-149" class="i">+	mir,
</a><a href="#h0-150" id="h0-150" class="i">+	msgr,
</a><a href="#h0-151" id="h0-151" class="i">+	ncv#3,
</a><a href="#h0-152" id="h0-152" class="i">+	npc,
</a><a href="#h0-153" id="h0-153" class="i">+	op=\E[39;49m,
</a><a href="#h0-154" id="h0-154" class="i">+	pairs#64,
</a><a href="#h0-155" id="h0-155" class="i">+	mc0=\E[i,
</a><a href="#h0-156" id="h0-156" class="i">+	mc4=\E[4i,
</a><a href="#h0-157" id="h0-157" class="i">+	mc5=\E[5i,
</a><a href="#h0-158" id="h0-158" class="i">+	rc=\E8,
</a><a href="#h0-159" id="h0-159" class="i">+	rev=\E[7m,
</a><a href="#h0-160" id="h0-160" class="i">+	ri=\EM,
</a><a href="#h0-161" id="h0-161" class="i">+	ritm=\E[23m,
</a><a href="#h0-162" id="h0-162" class="i">+	rmacs=\E(B,
</a><a href="#h0-163" id="h0-163" class="i">+	rmcup=\E[?1049l,
</a><a href="#h0-164" id="h0-164" class="i">+	rmir=\E[4l,
</a><a href="#h0-165" id="h0-165" class="i">+	rmkx=\E[?1l\E&gt;,
</a><a href="#h0-166" id="h0-166" class="i">+	rmso=\E[27m,
</a><a href="#h0-167" id="h0-167" class="i">+	rmul=\E[24m,
</a><a href="#h0-168" id="h0-168" class="i">+	rs1=\Ec,
</a><a href="#h0-169" id="h0-169" class="i">+	rs2=\E[4l\E&gt;\E[?1034l,
</a><a href="#h0-170" id="h0-170" class="i">+	sc=\E7,
</a><a href="#h0-171" id="h0-171" class="i">+	setab=\E[4%p1%dm,
</a><a href="#h0-172" id="h0-172" class="i">+	setaf=\E[3%p1%dm,
</a><a href="#h0-173" id="h0-173" class="i">+	setb=\E[4%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m,
</a><a href="#h0-174" id="h0-174" class="i">+	setf=\E[3%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m,
</a><a href="#h0-175" id="h0-175" class="i">+	sgr0=\E[0m,
</a><a href="#h0-176" id="h0-176" class="i">+	sgr=%?%p9%t\E(0%e\E(B%;\E[0%?%p6%t;1%;%?%p2%t;4%;%?%p1%p3%|%t;7%;%?%p4%t;5%;%?%p7%t;8%;m,
</a><a href="#h0-177" id="h0-177" class="i">+	sitm=\E[3m,
</a><a href="#h0-178" id="h0-178" class="i">+	smacs=\E(0,
</a><a href="#h0-179" id="h0-179" class="i">+	smcup=\E[?1049h,
</a><a href="#h0-180" id="h0-180" class="i">+	smir=\E[4h,
</a><a href="#h0-181" id="h0-181" class="i">+	smkx=\E[?1h\E=,
</a><a href="#h0-182" id="h0-182" class="i">+	smso=\E[7m,
</a><a href="#h0-183" id="h0-183" class="i">+	smul=\E[4m,
</a><a href="#h0-184" id="h0-184" class="i">+	tbc=\E[3g,
</a><a href="#h0-185" id="h0-185" class="i">+	tsl=\E]0;,
</a><a href="#h0-186" id="h0-186" class="i">+	xenl,
</a><a href="#h0-187" id="h0-187" class="i">+	vpa=\E[%i%p1%dd,
</a><a href="#h0-188" id="h0-188" class="i">+
</a><a href="#h0-189" id="h0-189" class="i">+
</a><a href="#h0-190" id="h0-190" class="i">+st-256color| simpleterm with 256 colors,
</a><a href="#h0-191" id="h0-191" class="i">+	use=st,
</a><a href="#h0-192" id="h0-192" class="i">+	colors#256,
</a><a href="#h0-193" id="h0-193" class="i">+	pairs#32767,
</a><a href="#h0-194" id="h0-194" class="i">+#	Nicked from xterm-256color
</a><a href="#h0-195" id="h0-195" class="i">+	setab=\E[%?%p1%{8}%&lt;%t4%p1%d%e%p1%{16}%&lt;%t10%p1%{8}%-%d%e48;5;%p1%d%;m,
</a><a href="#h0-196" id="h0-196" class="i">+	setaf=\E[%?%p1%{8}%&lt;%t3%p1%d%e%p1%{16}%&lt;%t9%p1%{8}%-%d%e38;5;%p1%d%;m,
</a><a href="#h0-197" id="h0-197" class="i">+
</a><a href="#h0-198" id="h0-198" class="i">+st-meta| simpleterm with meta key,
</a><a href="#h0-199" id="h0-199" class="i">+	use=st,
</a><a href="#h0-200" id="h0-200" class="i">+	km,
</a><a href="#h0-201" id="h0-201" class="i">+	rmm=\E[?1034l,
</a><a href="#h0-202" id="h0-202" class="i">+	smm=\E[?1034h,
</a><a href="#h0-203" id="h0-203" class="i">+	rs2=\E[4l\E&gt;\E[?1034h,
</a><a href="#h0-204" id="h0-204" class="i">+	is2=\E[4l\E&gt;\E[?1034h,
</a><a href="#h0-205" id="h0-205" class="i">+
</a><a href="#h0-206" id="h0-206" class="i">+st-meta-256color| simpleterm with meta key and 256 colors,
</a><a href="#h0-207" id="h0-207" class="i">+	use=st-256color,
</a><a href="#h0-208" id="h0-208" class="i">+	km,
</a><a href="#h0-209" id="h0-209" class="i">+	rmm=\E[?1034l,
</a><a href="#h0-210" id="h0-210" class="i">+	smm=\E[?1034h,
</a><a href="#h0-211" id="h0-211" class="i">+	rs2=\E[4l\E&gt;\E[?1034h,
</a><a href="#h0-212" id="h0-212" class="i">+	is2=\E[4l\E&gt;\E[?1034h,
</a><b>diff --git a/<a href="../file/st/st.o.html">st/st.o</a> b/<a href="../file/st/st.o.html">st/st.o</a></b>
Binary files differ
<b>diff --git a/<a href="../file/x/.Xresources.html">x/.Xresources</a> b/<a href="../file/x/.Xresources.html">x/.Xresources</a></b>
<a href="#h0" id="h0" class="h">@@ -8,4 +8,3 @@
</a> #include &quot;.xres/rofi&quot;
 #include &quot;.xres/colors/cloudy&quot;
 #include &quot;.xres/urxvt&quot;
<a href="#h0-3" id="h0-3" class="d">-#include &quot;.xres/st&quot;
</a><b>diff --git a/<a href="../file/x/.xres/st.html">x/.xres/st</a> b/<a href="../file/x/.xres/st.html">x/.xres/st</a></b>
<a href="#h0" id="h0" class="h">@@ -1,3 +0,0 @@
</a><a href="#h0-0" id="h0-0" class="d">-st.font: Erusfont
</a><a href="#h0-1" id="h0-1" class="d">-st.bold_font: 0
</a><a href="#h0-2" id="h0-2" class="d">-! vim: set ft=xdefaults :
</a></pre>
</div>
</body>
</html>
