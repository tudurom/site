<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>added config file and go fmt&apos;d sourcecode - albumify-next - Next gen albumify, written in Go. Uses mongodb. WIP!
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="albumify-next.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>albumify-next</h1><span class="desc">Next gen albumify, written in Go. Uses mongodb. WIP!
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/albumify-next.git">git://thetudor.ddns.net/albumify-next.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/1b67b9dc835d2bcb37e6fbc00fdf77d5d4f8d170.html">1b67b9dc835d2bcb37e6fbc00fdf77d5d4f8d170</a>
<b>parent</b> <a href="../commit/8ee196e220236369d24334d0409ca79991467178.html">8ee196e220236369d24334d0409ca79991467178</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Fri Jun  3 13:04:16 +0300

added config file and go fmt&apos;d sourcecode

<b>Diffstat:</b>
<table><tr><td><a href="#h0">config.json</a></td><td> | </td><td class="num">5</td><td><span class="i">+++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h1">controllers/albums.go</a></td><td> | </td><td class="num">40</td><td><span class="i">+++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td><a href="#h2">main.go</a></td><td> | </td><td class="num">36</td><td><span class="i">++++++++++++++++++</span><span class="d">------------------</span></td></tr>
<tr><td><a href="#h3">models/album.go</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td><a href="#h4">models/image.go</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td><a href="#h5">util/config.go</a></td><td> | </td><td class="num">26</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h6">util/db.go</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++</span><span class="d">--------</span></td></tr>
<tr><td><a href="#h7">util/logger.go</a></td><td> | </td><td class="num">7</td><td><span class="i">++++</span><span class="d">---</span></td></tr>
<tr><td><a href="#h8">util/router.go</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++</span><span class="d">----</span></td></tr>
<tr><td><a href="#h9">util/string.go</a></td><td> | </td><td class="num">26</td><td><span class="i">+++++++++++++</span><span class="d">-------------</span></td></tr>
<tr><td><a href="#h10">util/url.go</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
</table>11 files changed, 128 insertions(+), 92 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/config.json.html">config.json</a> b/<a href="../file/config.json.html">config.json</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1,5 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+{
</a><a href="#h0-0-1" id="h0-0-1" class="i">+    &quot;ServerPort&quot;: 8080,
</a><a href="#h0-0-2" id="h0-0-2" class="i">+    &quot;ApiEndpoint&quot;: &quot;/api&quot;,
</a><a href="#h0-0-3" id="h0-0-3" class="i">+    &quot;DatabaseAddress&quot;: &quot;localhost&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+}
</a><b>diff --git a/<a id="h1" href="../file/controllers/albums.go.html">controllers/albums.go</a> b/<a href="../file/controllers/albums.go.html">controllers/albums.go</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,34 +1,36 @@
</a> package controllers
 
 import (
<a href="#h1-0-3" id="h1-0-3" class="d">-    &quot;encoding/json&quot;
</a><a href="#h1-0-4" id="h1-0-4" class="d">-    &quot;net/http&quot;
</a><a href="#h1-0-5" id="h1-0-5" class="i">+	&quot;encoding/json&quot;
</a><a href="#h1-0-6" id="h1-0-6" class="i">+	&quot;net/http&quot;
</a> 
<a href="#h1-0-8" id="h1-0-8" class="d">-    &quot;github.com/gorilla/mux&quot;
</a><a href="#h1-0-9" id="h1-0-9" class="d">-    &quot;gopkg.in/mgo.v2&quot;
</a><a href="#h1-0-10" id="h1-0-10" class="d">-    &quot;gopkg.in/mgo.v2/bson&quot;
</a><a href="#h1-0-11" id="h1-0-11" class="i">+	&quot;github.com/gorilla/mux&quot;
</a><a href="#h1-0-12" id="h1-0-12" class="i">+	&quot;gopkg.in/mgo.v2&quot;
</a><a href="#h1-0-13" id="h1-0-13" class="i">+	&quot;gopkg.in/mgo.v2/bson&quot;
</a> 
<a href="#h1-0-15" id="h1-0-15" class="d">-    &quot;github.com/gnotclub/albumify-next/util&quot;
</a><a href="#h1-0-16" id="h1-0-16" class="d">-    &quot;github.com/gnotclub/albumify-next/models&quot;
</a><a href="#h1-0-17" id="h1-0-17" class="i">+	&quot;github.com/gnotclub/albumify-next/models&quot;
</a><a href="#h1-0-18" id="h1-0-18" class="i">+	&quot;github.com/gnotclub/albumify-next/util&quot;
</a> )
 
 const prefix string = &quot;/albums&quot;
<a href="#h1-0-22" id="h1-0-22" class="i">+
</a> var collection *mgo.Collection
<a href="#h1-0-24" id="h1-0-24" class="i">+
</a> func AlbumRegisterController() {
<a href="#h1-0-26" id="h1-0-26" class="d">-    collection = util.GetDB().C(&quot;albums&quot;)
</a><a href="#h1-0-27" id="h1-0-27" class="i">+	collection = util.GetDB().C(&quot;albums&quot;)
</a> 
<a href="#h1-0-29" id="h1-0-29" class="d">-    util.Router.HandleFunc(prefix + &quot;/{albumId}&quot;, AlbumShow)
</a><a href="#h1-0-30" id="h1-0-30" class="i">+	util.Router.HandleFunc(prefix+&quot;/{albumId}&quot;, AlbumShow)
</a> }
 
 func AlbumShow(w http.ResponseWriter, r *http.Request) {
<a href="#h1-0-34" id="h1-0-34" class="d">-    vars := mux.Vars(r)
</a><a href="#h1-0-35" id="h1-0-35" class="d">-    albumId := vars[&quot;albumId&quot;]
</a><a href="#h1-0-36" id="h1-0-36" class="d">-    documentId := util.UrlDecode(albumId)
</a><a href="#h1-0-37" id="h1-0-37" class="d">-    result := models.Album{}
</a><a href="#h1-0-38" id="h1-0-38" class="d">-    err := collection.Find(bson.M{&quot;_id&quot;: documentId}).One(&amp;result)
</a><a href="#h1-0-39" id="h1-0-39" class="d">-    if err != nil {
</a><a href="#h1-0-40" id="h1-0-40" class="d">-        http.Error(w, &quot;not found&quot;, http.StatusNotFound)
</a><a href="#h1-0-41" id="h1-0-41" class="d">-    } else {
</a><a href="#h1-0-42" id="h1-0-42" class="d">-        json.NewEncoder(w).Encode(result)
</a><a href="#h1-0-43" id="h1-0-43" class="d">-    }
</a><a href="#h1-0-44" id="h1-0-44" class="i">+	vars := mux.Vars(r)
</a><a href="#h1-0-45" id="h1-0-45" class="i">+	albumId := vars[&quot;albumId&quot;]
</a><a href="#h1-0-46" id="h1-0-46" class="i">+	documentId := util.UrlDecode(albumId)
</a><a href="#h1-0-47" id="h1-0-47" class="i">+	result := models.Album{}
</a><a href="#h1-0-48" id="h1-0-48" class="i">+	err := collection.Find(bson.M{&quot;_id&quot;: documentId}).One(&amp;result)
</a><a href="#h1-0-49" id="h1-0-49" class="i">+	if err != nil {
</a><a href="#h1-0-50" id="h1-0-50" class="i">+		http.Error(w, &quot;not found&quot;, http.StatusNotFound)
</a><a href="#h1-0-51" id="h1-0-51" class="i">+	} else {
</a><a href="#h1-0-52" id="h1-0-52" class="i">+		json.NewEncoder(w).Encode(result)
</a><a href="#h1-0-53" id="h1-0-53" class="i">+	}
</a> }
<b>diff --git a/<a id="h2" href="../file/main.go.html">main.go</a> b/<a href="../file/main.go.html">main.go</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,32 +1,32 @@
</a> package main
 
 import (
<a href="#h2-0-3" id="h2-0-3" class="d">-    &quot;fmt&quot;
</a><a href="#h2-0-4" id="h2-0-4" class="d">-    &quot;log&quot;
</a><a href="#h2-0-5" id="h2-0-5" class="d">-    &quot;os&quot;
</a><a href="#h2-0-6" id="h2-0-6" class="d">-    &quot;net/http&quot;
</a><a href="#h2-0-7" id="h2-0-7" class="i">+	&quot;flag&quot;
</a><a href="#h2-0-8" id="h2-0-8" class="i">+	&quot;log&quot;
</a><a href="#h2-0-9" id="h2-0-9" class="i">+	&quot;net/http&quot;
</a><a href="#h2-0-10" id="h2-0-10" class="i">+	&quot;os&quot;
</a><a href="#h2-0-11" id="h2-0-11" class="i">+	&quot;strconv&quot;
</a> 
<a href="#h2-0-13" id="h2-0-13" class="d">-    &quot;github.com/gorilla/handlers&quot;
</a><a href="#h2-0-14" id="h2-0-14" class="i">+	&quot;github.com/gorilla/handlers&quot;
</a> 
<a href="#h2-0-16" id="h2-0-16" class="d">-    &quot;github.com/gnotclub/albumify-next/util&quot;
</a><a href="#h2-0-17" id="h2-0-17" class="d">-    &quot;github.com/gnotclub/albumify-next/controllers&quot;
</a><a href="#h2-0-18" id="h2-0-18" class="i">+	&quot;github.com/gnotclub/albumify-next/controllers&quot;
</a><a href="#h2-0-19" id="h2-0-19" class="i">+	&quot;github.com/gnotclub/albumify-next/util&quot;
</a> )
 
 func main() {
<a href="#h2-0-23" id="h2-0-23" class="d">-    util.GetLogger()
</a><a href="#h2-0-24" id="h2-0-24" class="i">+	util.GetLogger()
</a> 
<a href="#h2-0-26" id="h2-0-26" class="d">-    util.GetDBSession()
</a><a href="#h2-0-27" id="h2-0-27" class="d">-    defer util.DBSession.Close()
</a><a href="#h2-0-28" id="h2-0-28" class="i">+	var configFile = flag.String(&quot;config&quot;, &quot;config.json&quot;, &quot;path of the config file&quot;)
</a><a href="#h2-0-29" id="h2-0-29" class="i">+	flag.Parse()
</a><a href="#h2-0-30" id="h2-0-30" class="i">+	util.ReadConfig(*configFile)
</a> 
<a href="#h2-0-32" id="h2-0-32" class="d">-    util.GetRouter()
</a><a href="#h2-0-33" id="h2-0-33" class="d">-    util.Router.HandleFunc(&quot;/&quot;, EmptyHandler)
</a><a href="#h2-0-34" id="h2-0-34" class="i">+	util.GetDBSession()
</a><a href="#h2-0-35" id="h2-0-35" class="i">+	defer util.DBSession.Close()
</a> 
<a href="#h2-0-37" id="h2-0-37" class="d">-    controllers.AlbumRegisterController()
</a><a href="#h2-0-38" id="h2-0-38" class="i">+	util.GetRouter()
</a> 
<a href="#h2-0-40" id="h2-0-40" class="d">-    util.Logger.Println(&quot;Server ready.&quot;)
</a><a href="#h2-0-41" id="h2-0-41" class="d">-    log.Fatal(http.ListenAndServe(&quot;:8080&quot;, handlers.LoggingHandler(os.Stdout, util.Router)))
</a><a href="#h2-0-42" id="h2-0-42" class="d">-}
</a><a href="#h2-0-43" id="h2-0-43" class="i">+	controllers.AlbumRegisterController()
</a> 
<a href="#h2-0-45" id="h2-0-45" class="d">-func EmptyHandler(w http.ResponseWriter, r *http.Request) {
</a><a href="#h2-0-46" id="h2-0-46" class="d">-    fmt.Fprint(w, &quot;&quot;)
</a><a href="#h2-0-47" id="h2-0-47" class="i">+	util.Logger.Printf(&quot;Listening on port %d&quot;, util.Config.ServerPort)
</a><a href="#h2-0-48" id="h2-0-48" class="i">+	log.Fatal(http.ListenAndServe(&quot;:&quot;+strconv.Itoa(util.Config.ServerPort), handlers.LoggingHandler(os.Stdout, util.Router)))
</a> }
<b>diff --git a/<a id="h3" href="../file/models/album.go.html">models/album.go</a> b/<a href="../file/models/album.go.html">models/album.go</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,8 +1,8 @@
</a> package models
 
 type Album struct {
<a href="#h3-0-3" id="h3-0-3" class="d">-    Id int64 `bson:&quot;_id&quot; json:&quot;_id&quot;`
</a><a href="#h3-0-4" id="h3-0-4" class="d">-    Title string `bson:&quot;title&quot; json:&quot;title&quot;`
</a><a href="#h3-0-5" id="h3-0-5" class="d">-    Description string `bson:&quot;description&quot; json:&quot;description&quot;`
</a><a href="#h3-0-6" id="h3-0-6" class="d">-    Images []*Image `bson:&quot;images&quot; json:&quot;images&quot;`
</a><a href="#h3-0-7" id="h3-0-7" class="i">+	Id          int64    `bson:&quot;_id&quot; json:&quot;_id&quot;`
</a><a href="#h3-0-8" id="h3-0-8" class="i">+	Title       string   `bson:&quot;title&quot; json:&quot;title&quot;`
</a><a href="#h3-0-9" id="h3-0-9" class="i">+	Description string   `bson:&quot;description&quot; json:&quot;description&quot;`
</a><a href="#h3-0-10" id="h3-0-10" class="i">+	Images      []*Image `bson:&quot;images&quot; json:&quot;images&quot;`
</a> }
<b>diff --git a/<a id="h4" href="../file/models/image.go.html">models/image.go</a> b/<a href="../file/models/image.go.html">models/image.go</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,7 +1,7 @@
</a> package models
 
 type Image struct {
<a href="#h4-0-3" id="h4-0-3" class="d">-    Title string `bson:&quot;title&quot; json:&quot;title&quot;`
</a><a href="#h4-0-4" id="h4-0-4" class="d">-    Description string `bson:&quot;description&quot; json:&quot;description&quot;`
</a><a href="#h4-0-5" id="h4-0-5" class="d">-    Link string `bson:&quot;link&quot; json:&quot;link&quot;`
</a><a href="#h4-0-6" id="h4-0-6" class="i">+	Title       string `bson:&quot;title&quot; json:&quot;title&quot;`
</a><a href="#h4-0-7" id="h4-0-7" class="i">+	Description string `bson:&quot;description&quot; json:&quot;description&quot;`
</a><a href="#h4-0-8" id="h4-0-8" class="i">+	Link        string `bson:&quot;link&quot; json:&quot;link&quot;`
</a> }
<b>diff --git a/<a id="h5" href="../file/util/config.go.html">util/config.go</a> b/<a href="../file/util/config.go.html">util/config.go</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,26 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+package util
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+import (
</a><a href="#h5-0-3" id="h5-0-3" class="i">+	&quot;encoding/json&quot;
</a><a href="#h5-0-4" id="h5-0-4" class="i">+	&quot;io/ioutil&quot;
</a><a href="#h5-0-5" id="h5-0-5" class="i">+)
</a><a href="#h5-0-6" id="h5-0-6" class="i">+
</a><a href="#h5-0-7" id="h5-0-7" class="i">+type ConfigStructure struct {
</a><a href="#h5-0-8" id="h5-0-8" class="i">+	ServerPort  int
</a><a href="#h5-0-9" id="h5-0-9" class="i">+	ApiEndpoint string
</a><a href="#h5-0-10" id="h5-0-10" class="i">+    DatabaseAddress string
</a><a href="#h5-0-11" id="h5-0-11" class="i">+}
</a><a href="#h5-0-12" id="h5-0-12" class="i">+
</a><a href="#h5-0-13" id="h5-0-13" class="i">+var Config ConfigStructure
</a><a href="#h5-0-14" id="h5-0-14" class="i">+
</a><a href="#h5-0-15" id="h5-0-15" class="i">+func ReadConfig(filePath string) {
</a><a href="#h5-0-16" id="h5-0-16" class="i">+    Logger.Printf(&quot;Reading config from %s&quot;, filePath)
</a><a href="#h5-0-17" id="h5-0-17" class="i">+	rawData, err := ioutil.ReadFile(filePath)
</a><a href="#h5-0-18" id="h5-0-18" class="i">+	if err != nil {
</a><a href="#h5-0-19" id="h5-0-19" class="i">+		Logger.Fatalf(&quot;Error while reading config file: %s&quot;, err)
</a><a href="#h5-0-20" id="h5-0-20" class="i">+	}
</a><a href="#h5-0-21" id="h5-0-21" class="i">+	err = json.Unmarshal(rawData, &amp;Config)
</a><a href="#h5-0-22" id="h5-0-22" class="i">+	if err != nil {
</a><a href="#h5-0-23" id="h5-0-23" class="i">+		Logger.Fatalf(&quot;Error while decoding json input in config file: %s&quot;, err)
</a><a href="#h5-0-24" id="h5-0-24" class="i">+	}
</a><a href="#h5-0-25" id="h5-0-25" class="i">+}
</a><b>diff --git a/<a id="h6" href="../file/util/db.go.html">util/db.go</a> b/<a href="../file/util/db.go.html">util/db.go</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,19 +1,20 @@
</a> package util
 
 import (
<a href="#h6-0-3" id="h6-0-3" class="d">-    &quot;gopkg.in/mgo.v2&quot;
</a><a href="#h6-0-4" id="h6-0-4" class="i">+	&quot;gopkg.in/mgo.v2&quot;
</a> )
 
 var DBSession *mgo.Session
<a href="#h6-0-8" id="h6-0-8" class="i">+
</a> func GetDBSession() {
<a href="#h6-0-10" id="h6-0-10" class="d">-    session, err := mgo.Dial(&quot;localhost&quot;)
</a><a href="#h6-0-11" id="h6-0-11" class="d">-    if err != nil {
</a><a href="#h6-0-12" id="h6-0-12" class="d">-        panic(err)
</a><a href="#h6-0-13" id="h6-0-13" class="d">-    }
</a><a href="#h6-0-14" id="h6-0-14" class="d">-    Logger.Println(&quot;Database connection openned.&quot;)
</a><a href="#h6-0-15" id="h6-0-15" class="d">-    DBSession = session
</a><a href="#h6-0-16" id="h6-0-16" class="i">+	session, err := mgo.Dial(Config.DatabaseAddress)
</a><a href="#h6-0-17" id="h6-0-17" class="i">+	if err != nil {
</a><a href="#h6-0-18" id="h6-0-18" class="i">+		Logger.Fatalf(&quot;Error while openning database connection: %s&quot;, err)
</a><a href="#h6-0-19" id="h6-0-19" class="i">+	}
</a><a href="#h6-0-20" id="h6-0-20" class="i">+	Logger.Printf(&quot;Database connection to %s openned.&quot;, Config.DatabaseAddress)
</a><a href="#h6-0-21" id="h6-0-21" class="i">+	DBSession = session
</a> }
 
 func GetDB() *mgo.Database {
<a href="#h6-0-25" id="h6-0-25" class="d">-    return DBSession.DB(&quot;albumify&quot;)
</a><a href="#h6-0-26" id="h6-0-26" class="i">+	return DBSession.DB(&quot;albumify&quot;)
</a> }
<b>diff --git a/<a id="h7" href="../file/util/logger.go.html">util/logger.go</a> b/<a href="../file/util/logger.go.html">util/logger.go</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,11 +1,12 @@
</a> package util
 
 import (
<a href="#h7-0-3" id="h7-0-3" class="d">-    &quot;log&quot;
</a><a href="#h7-0-4" id="h7-0-4" class="d">-    &quot;os&quot;
</a><a href="#h7-0-5" id="h7-0-5" class="i">+	&quot;log&quot;
</a><a href="#h7-0-6" id="h7-0-6" class="i">+	&quot;os&quot;
</a> )
 
 var Logger *log.Logger
<a href="#h7-0-10" id="h7-0-10" class="i">+
</a> func GetLogger() {
<a href="#h7-0-12" id="h7-0-12" class="d">-    Logger = log.New(os.Stdout, &quot;logger: &quot;, log.Lshortfile)
</a><a href="#h7-0-13" id="h7-0-13" class="i">+	Logger = log.New(os.Stdout, &quot;logger: &quot;, log.Lshortfile)
</a> }
<b>diff --git a/<a id="h8" href="../file/util/router.go.html">util/router.go</a> b/<a href="../file/util/router.go.html">util/router.go</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,13 +1,14 @@
</a> package util
 
 import (
<a href="#h8-0-3" id="h8-0-3" class="d">-    &quot;github.com/gorilla/mux&quot;
</a><a href="#h8-0-4" id="h8-0-4" class="i">+	&quot;github.com/gorilla/mux&quot;
</a> )
 
 var MainRouter *mux.Router
 var Router *mux.Router
<a href="#h8-0-9" id="h8-0-9" class="i">+
</a> func GetRouter() {
<a href="#h8-0-11" id="h8-0-11" class="d">-    MainRouter = mux.NewRouter()
</a><a href="#h8-0-12" id="h8-0-12" class="d">-    MainRouter.StrictSlash(true)
</a><a href="#h8-0-13" id="h8-0-13" class="d">-    Router = MainRouter.PathPrefix(&quot;/api&quot;).Subrouter()
</a><a href="#h8-0-14" id="h8-0-14" class="i">+	MainRouter = mux.NewRouter()
</a><a href="#h8-0-15" id="h8-0-15" class="i">+	MainRouter.StrictSlash(true)
</a><a href="#h8-0-16" id="h8-0-16" class="i">+	Router = MainRouter.PathPrefix(Config.ApiEndpoint).Subrouter()
</a> }
<b>diff --git a/<a id="h9" href="../file/util/string.go.html">util/string.go</a> b/<a href="../file/util/string.go.html">util/string.go</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,18 +1,18 @@
</a> package util
 
 func ReverseString(str string) string {
<a href="#h9-0-3" id="h9-0-3" class="d">-    // Store runes
</a><a href="#h9-0-4" id="h9-0-4" class="d">-    n := 0
</a><a href="#h9-0-5" id="h9-0-5" class="d">-    runes := make([]rune, len(str))
</a><a href="#h9-0-6" id="h9-0-6" class="d">-    for _, r := range str {
</a><a href="#h9-0-7" id="h9-0-7" class="d">-        runes[n] = r
</a><a href="#h9-0-8" id="h9-0-8" class="d">-        n++
</a><a href="#h9-0-9" id="h9-0-9" class="d">-    }
</a><a href="#h9-0-10" id="h9-0-10" class="d">-    runes = runes[0:n]
</a><a href="#h9-0-11" id="h9-0-11" class="i">+	// Store runes
</a><a href="#h9-0-12" id="h9-0-12" class="i">+	n := 0
</a><a href="#h9-0-13" id="h9-0-13" class="i">+	runes := make([]rune, len(str))
</a><a href="#h9-0-14" id="h9-0-14" class="i">+	for _, r := range str {
</a><a href="#h9-0-15" id="h9-0-15" class="i">+		runes[n] = r
</a><a href="#h9-0-16" id="h9-0-16" class="i">+		n++
</a><a href="#h9-0-17" id="h9-0-17" class="i">+	}
</a><a href="#h9-0-18" id="h9-0-18" class="i">+	runes = runes[0:n]
</a> 
<a href="#h9-0-20" id="h9-0-20" class="d">-    // Reverse
</a><a href="#h9-0-21" id="h9-0-21" class="d">-    for i := 0; i &lt; n / 2; i++ {
</a><a href="#h9-0-22" id="h9-0-22" class="d">-        runes[i], runes[n - 1 - i] = runes[n - 1 - i], runes[i]
</a><a href="#h9-0-23" id="h9-0-23" class="d">-    }
</a><a href="#h9-0-24" id="h9-0-24" class="d">-    return string(runes)
</a><a href="#h9-0-25" id="h9-0-25" class="i">+	// Reverse
</a><a href="#h9-0-26" id="h9-0-26" class="i">+	for i := 0; i &lt; n/2; i++ {
</a><a href="#h9-0-27" id="h9-0-27" class="i">+		runes[i], runes[n-1-i] = runes[n-1-i], runes[i]
</a><a href="#h9-0-28" id="h9-0-28" class="i">+	}
</a><a href="#h9-0-29" id="h9-0-29" class="i">+	return string(runes)
</a> }
<b>diff --git a/<a id="h10" href="../file/util/url.go.html">util/url.go</a> b/<a href="../file/util/url.go.html">util/url.go</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,31 +1,31 @@
</a> package util
 
 import (
<a href="#h10-0-3" id="h10-0-3" class="d">-    &quot;bytes&quot;
</a><a href="#h10-0-4" id="h10-0-4" class="d">-    &quot;math&quot;
</a><a href="#h10-0-5" id="h10-0-5" class="i">+	&quot;bytes&quot;
</a><a href="#h10-0-6" id="h10-0-6" class="i">+	&quot;math&quot;
</a> )
 
<a href="#h10-0-9" id="h10-0-9" class="d">-var alphabet = []byte {&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;, &apos;k&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;, &apos;o&apos;, &apos;p&apos;, &apos;q&apos;, &apos;r&apos;, &apos;s&apos;, &apos;t&apos;, &apos;u&apos;, &apos;v&apos;, &apos;w&apos;, &apos;x&apos;, &apos;y&apos;, &apos;z&apos;, &apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;D&apos;, &apos;E&apos;, &apos;F&apos;, &apos;G&apos;, &apos;H&apos;, &apos;I&apos;, &apos;J&apos;, &apos;K&apos;, &apos;L&apos;, &apos;M&apos;, &apos;N&apos;, &apos;O&apos;, &apos;P&apos;, &apos;Q&apos;, &apos;R&apos;, &apos;S&apos;, &apos;T&apos;, &apos;U&apos;, &apos;V&apos;, &apos;W&apos;, &apos;X&apos;, &apos;Y&apos;, &apos;Z&apos;, &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;}
</a><a href="#h10-0-10" id="h10-0-10" class="i">+var alphabet = []byte{&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;, &apos;k&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;, &apos;o&apos;, &apos;p&apos;, &apos;q&apos;, &apos;r&apos;, &apos;s&apos;, &apos;t&apos;, &apos;u&apos;, &apos;v&apos;, &apos;w&apos;, &apos;x&apos;, &apos;y&apos;, &apos;z&apos;, &apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;D&apos;, &apos;E&apos;, &apos;F&apos;, &apos;G&apos;, &apos;H&apos;, &apos;I&apos;, &apos;J&apos;, &apos;K&apos;, &apos;L&apos;, &apos;M&apos;, &apos;N&apos;, &apos;O&apos;, &apos;P&apos;, &apos;Q&apos;, &apos;R&apos;, &apos;S&apos;, &apos;T&apos;, &apos;U&apos;, &apos;V&apos;, &apos;W&apos;, &apos;X&apos;, &apos;Y&apos;, &apos;Z&apos;, &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;}
</a> 
 func UrlEncode(id int64) string {
<a href="#h10-0-13" id="h10-0-13" class="d">-    var ret string
</a><a href="#h10-0-14" id="h10-0-14" class="d">-    var alphabetLen int64 = int64(len(alphabet))
</a><a href="#h10-0-15" id="h10-0-15" class="d">-    for id &gt; 0 {
</a><a href="#h10-0-16" id="h10-0-16" class="d">-        ret += string(alphabet[id % alphabetLen])
</a><a href="#h10-0-17" id="h10-0-17" class="d">-        id /= alphabetLen
</a><a href="#h10-0-18" id="h10-0-18" class="d">-    }
</a><a href="#h10-0-19" id="h10-0-19" class="d">-    ret = ReverseString(ret)
</a><a href="#h10-0-20" id="h10-0-20" class="d">-    return ret
</a><a href="#h10-0-21" id="h10-0-21" class="i">+	var ret string
</a><a href="#h10-0-22" id="h10-0-22" class="i">+	var alphabetLen int64 = int64(len(alphabet))
</a><a href="#h10-0-23" id="h10-0-23" class="i">+	for id &gt; 0 {
</a><a href="#h10-0-24" id="h10-0-24" class="i">+		ret += string(alphabet[id%alphabetLen])
</a><a href="#h10-0-25" id="h10-0-25" class="i">+		id /= alphabetLen
</a><a href="#h10-0-26" id="h10-0-26" class="i">+	}
</a><a href="#h10-0-27" id="h10-0-27" class="i">+	ret = ReverseString(ret)
</a><a href="#h10-0-28" id="h10-0-28" class="i">+	return ret
</a> }
 
 func UrlDecode(url string) int64 {
<a href="#h10-0-32" id="h10-0-32" class="d">-    digits := make([]byte, 5)
</a><a href="#h10-0-33" id="h10-0-33" class="d">-    var ret int64 = 0
</a><a href="#h10-0-34" id="h10-0-34" class="d">-    for _, r := range url {
</a><a href="#h10-0-35" id="h10-0-35" class="d">-        digits = append(digits, byte(bytes.IndexByte(alphabet, byte(r))))
</a><a href="#h10-0-36" id="h10-0-36" class="d">-    }
</a><a href="#h10-0-37" id="h10-0-37" class="d">-    for i, r := range digits {
</a><a href="#h10-0-38" id="h10-0-38" class="d">-        ret += int64(r) * int64(math.Pow(float64(len(alphabet)), float64(len(digits) - 1 - i)))
</a><a href="#h10-0-39" id="h10-0-39" class="d">-    }
</a><a href="#h10-0-40" id="h10-0-40" class="d">-    return ret
</a><a href="#h10-0-41" id="h10-0-41" class="i">+	digits := make([]byte, 5)
</a><a href="#h10-0-42" id="h10-0-42" class="i">+	var ret int64 = 0
</a><a href="#h10-0-43" id="h10-0-43" class="i">+	for _, r := range url {
</a><a href="#h10-0-44" id="h10-0-44" class="i">+		digits = append(digits, byte(bytes.IndexByte(alphabet, byte(r))))
</a><a href="#h10-0-45" id="h10-0-45" class="i">+	}
</a><a href="#h10-0-46" id="h10-0-46" class="i">+	for i, r := range digits {
</a><a href="#h10-0-47" id="h10-0-47" class="i">+		ret += int64(r) * int64(math.Pow(float64(len(alphabet)), float64(len(digits)-1-i)))
</a><a href="#h10-0-48" id="h10-0-48" class="i">+	}
</a><a href="#h10-0-49" id="h10-0-49" class="i">+	return ret
</a> }
</pre>
</div>
</body>
</html>
