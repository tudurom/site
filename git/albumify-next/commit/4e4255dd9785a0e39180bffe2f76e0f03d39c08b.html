<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>enable CORS - albumify-next - Next gen albumify, written in Go. Uses mongodb. WIP!
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="albumify-next.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>albumify-next</h1><span class="desc">Next gen albumify, written in Go. Uses mongodb. WIP!
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/albumify-next.git">git://thetudor.ddns.net/albumify-next.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/4e4255dd9785a0e39180bffe2f76e0f03d39c08b.html">4e4255dd9785a0e39180bffe2f76e0f03d39c08b</a>
<b>parent</b> <a href="../commit/951274969cb8dd9667f0109b5293c93644799874.html">951274969cb8dd9667f0109b5293c93644799874</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Fri Jun  3 23:20:46 +0300

enable CORS

<b>Diffstat:</b>
<table><tr><td><a href="#h0">client/.gitignore</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h1">client/index.html</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h2">controllers/albums.go</a></td><td> | </td><td class="num">4</td><td><span class="i">+</span><span class="d">---</span></td></tr>
<tr><td><a href="#h3">main.go</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td><a href="#h4">util/router.go</a></td><td> | </td><td class="num">25</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">-</span></td></tr>
</table>5 files changed, 38 insertions(+), 5 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/client/.gitignore.html">client/.gitignore</a> b/<a href="../file/client/.gitignore.html">client/.gitignore</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+node_modules
</a><b>diff --git a/<a id="h1" href="../file/client/index.html.html">client/index.html</a> b/<a href="../file/client/index.html.html">client/index.html</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+&lt;!DOCTYPE html&gt;
</a><a href="#h1-0-1" id="h1-0-1" class="i">+&lt;html&gt;
</a><a href="#h1-0-2" id="h1-0-2" class="i">+    &lt;head&gt;
</a><a href="#h1-0-3" id="h1-0-3" class="i">+        &lt;title&gt;Albumify&lt;/title&gt;
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        &lt;meta charset=&quot;utf-8&quot;&gt;
</a><a href="#h1-0-5" id="h1-0-5" class="i">+        &lt;script src=&quot;node_modules/superagent/superagent.js&quot;&gt;&lt;/script&gt;
</a><a href="#h1-0-6" id="h1-0-6" class="i">+    &lt;/head&gt;
</a><a href="#h1-0-7" id="h1-0-7" class="i">+    &lt;body&gt;
</a><a href="#h1-0-8" id="h1-0-8" class="i">+    &lt;/body&gt;
</a><a href="#h1-0-9" id="h1-0-9" class="i">+&lt;/html&gt;
</a><b>diff --git a/<a id="h2" href="../file/controllers/albums.go.html">controllers/albums.go</a> b/<a href="../file/controllers/albums.go.html">controllers/albums.go</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -52,9 +52,7 @@ func AlbumSubmit(w http.ResponseWriter, r *http.Request) {
</a> 	// TODO: validation
 	if err != nil {
 		http.Error(w, &quot;400 bad request&quot;, http.StatusBadRequest)
<a href="#h2-0-3" id="h2-0-3" class="d">-		var s []byte
</a><a href="#h2-0-4" id="h2-0-4" class="d">-		r.Body.Read(s)
</a><a href="#h2-0-5" id="h2-0-5" class="d">-		util.Logger.Printf(&quot;%s Bad Request in album submission: %s&quot;, err)
</a><a href="#h2-0-6" id="h2-0-6" class="i">+		util.Logger.Printf(&quot;Bad Request in album submission: %s&quot;, err)
</a> 		return
 	}
 	err = models.PutAlbum(&amp;album)
<b>diff --git a/<a id="h3" href="../file/main.go.html">main.go</a> b/<a href="../file/main.go.html">main.go</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -32,5 +32,6 @@ func main() {
</a> 	// Listen
 	address := fmt.Sprintf(&quot;%s:%d&quot;, util.Config.ServerHostname, util.Config.ServerPort)
 	util.Logger.Printf(&quot;Listening on %s&quot;, address)
<a href="#h3-0-3" id="h3-0-3" class="d">-	log.Fatal(http.ListenAndServe(address, handlers.LoggingHandler(os.Stdout, util.Router)))
</a><a href="#h3-0-4" id="h3-0-4" class="i">+	http.Handle(&quot;/&quot;, &amp;util.MyServer{util.MainRouter})
</a><a href="#h3-0-5" id="h3-0-5" class="i">+	log.Fatal(http.ListenAndServe(address, handlers.LoggingHandler(os.Stdout, &amp;util.MyServer{util.MainRouter})))
</a> }
<b>diff --git a/<a id="h4" href="../file/util/router.go.html">util/router.go</a> b/<a href="../file/util/router.go.html">util/router.go</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,6 +1,10 @@
</a> package util
 
<a href="#h4-0-2" id="h4-0-2" class="d">-import &quot;github.com/gorilla/mux&quot;
</a><a href="#h4-0-3" id="h4-0-3" class="i">+import (
</a><a href="#h4-0-4" id="h4-0-4" class="i">+	&quot;net/http&quot;
</a><a href="#h4-0-5" id="h4-0-5" class="i">+
</a><a href="#h4-0-6" id="h4-0-6" class="i">+	&quot;github.com/gorilla/mux&quot;
</a><a href="#h4-0-7" id="h4-0-7" class="i">+)
</a> 
 var MainRouter *mux.Router
 var Router *mux.Router
<a href="#h4-1" id="h4-1" class="h">@@ -11,3 +15,22 @@ func GetRouter() {
</a> 	MainRouter.StrictSlash(true)
 	Router = MainRouter.PathPrefix(Config.ApiEndpoint).Subrouter()
 }
<a href="#h4-1-3" id="h4-1-3" class="i">+
</a><a href="#h4-1-4" id="h4-1-4" class="i">+type MyServer struct {
</a><a href="#h4-1-5" id="h4-1-5" class="i">+	R *mux.Router
</a><a href="#h4-1-6" id="h4-1-6" class="i">+}
</a><a href="#h4-1-7" id="h4-1-7" class="i">+
</a><a href="#h4-1-8" id="h4-1-8" class="i">+func (s *MyServer) ServeHTTP(rw http.ResponseWriter, req *http.Request) {
</a><a href="#h4-1-9" id="h4-1-9" class="i">+	if origin := req.Header.Get(&quot;Origin&quot;); origin != &quot;&quot; {
</a><a href="#h4-1-10" id="h4-1-10" class="i">+		rw.Header().Set(&quot;Access-Control-Allow-Origin&quot;, origin)
</a><a href="#h4-1-11" id="h4-1-11" class="i">+		rw.Header().Set(&quot;Access-Control-Allow-Methods&quot;, &quot;POST, GET, OPTIONS, PUT, DELETE&quot;)
</a><a href="#h4-1-12" id="h4-1-12" class="i">+		rw.Header().Set(&quot;Access-Control-Allow-Headers&quot;,
</a><a href="#h4-1-13" id="h4-1-13" class="i">+			&quot;Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization&quot;)
</a><a href="#h4-1-14" id="h4-1-14" class="i">+	}
</a><a href="#h4-1-15" id="h4-1-15" class="i">+	// Stop here if its Preflighted OPTIONS request
</a><a href="#h4-1-16" id="h4-1-16" class="i">+	if req.Method == &quot;OPTIONS&quot; {
</a><a href="#h4-1-17" id="h4-1-17" class="i">+		return
</a><a href="#h4-1-18" id="h4-1-18" class="i">+	}
</a><a href="#h4-1-19" id="h4-1-19" class="i">+	// Lets Gorilla work
</a><a href="#h4-1-20" id="h4-1-20" class="i">+	s.R.ServeHTTP(rw, req)
</a><a href="#h4-1-21" id="h4-1-21" class="i">+}
</a></pre>
</div>
</body>
</html>
