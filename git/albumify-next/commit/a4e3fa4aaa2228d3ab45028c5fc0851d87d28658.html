<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>added documentation - albumify-next - Next gen albumify, written in Go. Uses mongodb. WIP!
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="albumify-next.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>albumify-next</h1><span class="desc">Next gen albumify, written in Go. Uses mongodb. WIP!
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/albumify-next.git">git://thetudor.ddns.net/albumify-next.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a4e3fa4aaa2228d3ab45028c5fc0851d87d28658.html">a4e3fa4aaa2228d3ab45028c5fc0851d87d28658</a>
<b>parent</b> <a href="../commit/1e004f18f90c925348dab55c71f0398e5753d713.html">1e004f18f90c925348dab55c71f0398e5753d713</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Fri Jun  3 14:59:27 +0300

added documentation

<b>Diffstat:</b>
<table><tr><td><a href="#h0">controllers/albums.go</a></td><td> | </td><td class="num">5</td><td><span class="i">+++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h1">main.go</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td><a href="#h2">models/album.go</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h3">util/config.go</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h4">util/db.go</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td><a href="#h5">util/logger.go</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h6">util/router.go</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h7">util/string.go</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h8">util/url.go</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
</table>9 files changed, 20 insertions(+), 0 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/controllers/albums.go.html">controllers/albums.go</a> b/<a href="../file/controllers/albums.go.html">controllers/albums.go</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -18,6 +18,7 @@ const prefix string = &quot;/albums&quot;
</a> var subrouter *mux.Router
 var collection *mgo.Collection
 
<a href="#h0-0-3" id="h0-0-3" class="i">+// Registers the routes for this controller
</a> func AlbumRegisterController() {
 	subrouter = util.Router.PathPrefix(prefix).Subrouter()
 	collection = util.GetDB().C(&quot;albums&quot;)
<a href="#h0-1" id="h0-1" class="h">@@ -26,6 +27,7 @@ func AlbumRegisterController() {
</a> 	subrouter.HandleFunc(&quot;/&quot;, AlbumSubmit).Methods(&quot;GET&quot;, &quot;POST&quot;)
 }
 
<a href="#h0-1-3" id="h0-1-3" class="i">+// Display an Album in JSON form
</a> func AlbumShow(w http.ResponseWriter, r *http.Request) {
 	vars := mux.Vars(r)
 	albumId := vars[&quot;albumId&quot;]
<a href="#h0-2" id="h0-2" class="h">@@ -39,6 +41,7 @@ func AlbumShow(w http.ResponseWriter, r *http.Request) {
</a> 	}
 }
 
<a href="#h0-2-3" id="h0-2-3" class="i">+// Register a new album based on the JSON passed in the request
</a> func AlbumSubmit(w http.ResponseWriter, r *http.Request) {
 	var album, prevAlbum models.Album
 	decoder := json.NewDecoder(r.Body)
<a href="#h0-3" id="h0-3" class="h">@@ -48,11 +51,13 @@ func AlbumSubmit(w http.ResponseWriter, r *http.Request) {
</a> 		http.Error(w, &quot;bad request&quot;, http.StatusBadRequest)
 		util.Logger.Printf(&quot;Bad Request in album submission: %s&quot;, err)
 	}
<a href="#h0-3-3" id="h0-3-3" class="i">+	// Get the last album registered
</a> 	err = collection.Find(bson.M{}).Sort(&quot;-_id&quot;).One(&amp;prevAlbum)
 	if err != nil {
 		http.Error(w, &quot;internal server error&quot;, http.StatusInternalServerError)
 		util.Logger.Printf(&quot;Couldn&apos;t get last album in collection: %s&quot;, err)
 	}
<a href="#h0-3-9" id="h0-3-9" class="i">+	// Increment new album&apos;s id
</a> 	album.Id = prevAlbum.Id + 1
 	err = collection.Insert(album)
 	if err != nil {
<b>diff --git a/<a id="h1" href="../file/main.go.html">main.go</a> b/<a href="../file/main.go.html">main.go</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -16,6 +16,7 @@ import (
</a> func main() {
 	util.GetLogger()
 
<a href="#h1-0-3" id="h1-0-3" class="i">+	// Get config file path from command line args
</a> 	var configFile = flag.String(&quot;config&quot;, &quot;config.json&quot;, &quot;path of the config file&quot;)
 	flag.Parse()
 	util.ReadConfig(*configFile)
<a href="#h1-1" id="h1-1" class="h">@@ -25,8 +26,10 @@ func main() {
</a> 
 	util.GetRouter()
 
<a href="#h1-1-3" id="h1-1-3" class="i">+	// Register routes for all of Album&apos;s controllers
</a> 	controllers.AlbumRegisterController()
 
<a href="#h1-1-6" id="h1-1-6" class="i">+	// Listen
</a> 	address := fmt.Sprintf(&quot;%s:%d&quot;, util.Config.ServerHostname, util.Config.ServerPort)
 	util.Logger.Printf(&quot;Listening on %s&quot;, address)
 	log.Fatal(http.ListenAndServe(address, handlers.LoggingHandler(os.Stdout, util.Router)))
<b>diff --git a/<a id="h2" href="../file/models/album.go.html">models/album.go</a> b/<a href="../file/models/album.go.html">models/album.go</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,5 +1,6 @@
</a> package models
 
<a href="#h2-0-2" id="h2-0-2" class="i">+// An album contains images and metadata
</a> type Album struct {
 	Id          int64    `bson:&quot;_id&quot; json:&quot;_id&quot;`
 	Title       string   `bson:&quot;title&quot; json:&quot;title&quot;`
<b>diff --git a/<a id="h3" href="../file/util/config.go.html">util/config.go</a> b/<a href="../file/util/config.go.html">util/config.go</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -15,12 +15,16 @@ type ConfigStructure struct {
</a> 
 var Config ConfigStructure
 
<a href="#h3-0-3" id="h3-0-3" class="i">+// Gets config values from the config file
</a> func ReadConfig(filePath string) {
 	Logger.Printf(&quot;Reading config from %s&quot;, filePath)
<a href="#h3-0-6" id="h3-0-6" class="i">+
</a><a href="#h3-0-7" id="h3-0-7" class="i">+	// Read whole file in the string
</a> 	rawData, err := ioutil.ReadFile(filePath)
 	if err != nil {
 		Logger.Fatalf(&quot;Error while reading config file: %s&quot;, err)
 	}
<a href="#h3-0-12" id="h3-0-12" class="i">+	// Get configuration values
</a> 	err = json.Unmarshal(rawData, &amp;Config)
 	if err != nil {
 		Logger.Fatalf(&quot;Error while decoding json input in config file: %s&quot;, err)
<b>diff --git a/<a id="h4" href="../file/util/db.go.html">util/db.go</a> b/<a href="../file/util/db.go.html">util/db.go</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -6,6 +6,7 @@ import (
</a> 
 var DBSession *mgo.Session
 
<a href="#h4-0-3" id="h4-0-3" class="i">+// Try to connect to the database
</a> func GetDBSession() {
 	session, err := mgo.Dial(Config.DatabaseAddress)
 	if err != nil {
<a href="#h4-1" id="h4-1" class="h">@@ -15,6 +16,7 @@ func GetDBSession() {
</a> 	DBSession = session
 }
 
<a href="#h4-1-3" id="h4-1-3" class="i">+// Returns the database we&apos;re operating on
</a> func GetDB() *mgo.Database {
 	Logger.Printf(&quot;Got database %s&quot;, Config.DatabaseName)
 	return DBSession.DB(Config.DatabaseName)
<b>diff --git a/<a id="h5" href="../file/util/logger.go.html">util/logger.go</a> b/<a href="../file/util/logger.go.html">util/logger.go</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -7,6 +7,7 @@ import (
</a> 
 var Logger *log.Logger
 
<a href="#h5-0-3" id="h5-0-3" class="i">+// Returns a new logger instance
</a> func GetLogger() {
 	Logger = log.New(os.Stdout, &quot;logger: &quot;, log.Lshortfile)
 }
<b>diff --git a/<a id="h6" href="../file/util/router.go.html">util/router.go</a> b/<a href="../file/util/router.go.html">util/router.go</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -5,6 +5,7 @@ import &quot;github.com/gorilla/mux&quot;
</a> var MainRouter *mux.Router
 var Router *mux.Router
 
<a href="#h6-0-3" id="h6-0-3" class="i">+// Returns a new pre-configured router instance
</a> func GetRouter() {
 	MainRouter = mux.NewRouter()
 	MainRouter.StrictSlash(true)
<b>diff --git a/<a id="h7" href="../file/util/string.go.html">util/string.go</a> b/<a href="../file/util/string.go.html">util/string.go</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,5 +1,6 @@
</a> package util
 
<a href="#h7-0-2" id="h7-0-2" class="i">+// Returns the reversed form of str. UTF-8 aware
</a> func ReverseString(str string) string {
 	// Store runes
 	n := 0
<b>diff --git a/<a id="h8" href="../file/util/url.go.html">util/url.go</a> b/<a href="../file/util/url.go.html">util/url.go</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -7,6 +7,7 @@ import (
</a> 
 var alphabet = []byte{&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;, &apos;i&apos;, &apos;j&apos;, &apos;k&apos;, &apos;l&apos;, &apos;m&apos;, &apos;n&apos;, &apos;o&apos;, &apos;p&apos;, &apos;q&apos;, &apos;r&apos;, &apos;s&apos;, &apos;t&apos;, &apos;u&apos;, &apos;v&apos;, &apos;w&apos;, &apos;x&apos;, &apos;y&apos;, &apos;z&apos;, &apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;D&apos;, &apos;E&apos;, &apos;F&apos;, &apos;G&apos;, &apos;H&apos;, &apos;I&apos;, &apos;J&apos;, &apos;K&apos;, &apos;L&apos;, &apos;M&apos;, &apos;N&apos;, &apos;O&apos;, &apos;P&apos;, &apos;Q&apos;, &apos;R&apos;, &apos;S&apos;, &apos;T&apos;, &apos;U&apos;, &apos;V&apos;, &apos;W&apos;, &apos;X&apos;, &apos;Y&apos;, &apos;Z&apos;, &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;}
 
<a href="#h8-0-3" id="h8-0-3" class="i">+// Encodes the database id in a short string form
</a> func UrlEncode(id int64) string {
 	var ret string
 	var alphabetLen int64 = int64(len(alphabet))
<a href="#h8-1" id="h8-1" class="h">@@ -18,6 +19,7 @@ func UrlEncode(id int64) string {
</a> 	return ret
 }
 
<a href="#h8-1-3" id="h8-1-3" class="i">+// Turns a short string form in a databse-friendly integer id
</a> func UrlDecode(url string) int64 {
 	digits := make([]byte, 5)
 	var ret int64 = 0
</pre>
</div>
</body>
</html>
