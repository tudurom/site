<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>cleaned up indentation, comments and man pages - disputils - Utilities for getting information about connected displays.
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="disputils.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>disputils</h1><span class="desc">Utilities for getting information about connected displays.
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/disputils.git">git://thetudor.ddns.net/disputils.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/README.html">README</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/7bb0537920e091c9a091f63672e57a992268711b.html">7bb0537920e091c9a091f63672e57a992268711b</a>
<b>parent</b> <a href="../commit/857d868922d67703cbfbf7856092a8381f306ca2.html">857d868922d67703cbfbf7856092a8381f306ca2</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Tue Aug  2 12:06:23 +0300

cleaned up indentation, comments and man pages

<b>Diffstat:</b>
<table><tr><td><a href="#h0">Makefile</a></td><td> | </td><td class="num">15</td><td><span class="i">++++++</span><span class="d">---------</span></td></tr>
<tr><td><a href="#h1">config.mk</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td><a href="#h2">dattr.c</a></td><td> | </td><td class="num">13</td><td><span class="i">++++++</span><span class="d">-------</span></td></tr>
<tr><td><a href="#h3">lsd.c</a></td><td> | </td><td class="num">7</td><td><span class="i">+++</span><span class="d">----</span></td></tr>
<tr><td><a href="#h4">man/Makefile</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h5">man/disputils.1</a></td><td> | </td><td class="num">31</td><td><span class="i">+++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h6">man/pfd.1</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td><a href="#h7">man/ppd.1</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td><a href="#h8">pfd.c</a></td><td> | </td><td class="num">25</td><td><span class="i">++++++++++++</span><span class="d">-------------</span></td></tr>
<tr><td><a href="#h9">ppd.c</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td><a href="#h10">randr.c</a></td><td> | </td><td class="num">142</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td><a href="#h11">randr.h</a></td><td> | </td><td class="num">40</td><td><span class="i"></span><span class="d">----------------------------------------</span></td></tr>
<tr><td><a href="#h12">util.c</a></td><td> | </td><td class="num">195</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td><a href="#h13">util.h</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++</span><span class="d">--------</span></td></tr>
</table>14 files changed, 229 insertions(+), 275 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Makefile.html">Makefile</a> b/<a href="../file/Makefile.html">Makefile</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,6 +1,6 @@
</a> include config.mk
 
<a href="#h0-0-2" id="h0-0-2" class="d">-HDR = util.h randr.h
</a><a href="#h0-0-3" id="h0-0-3" class="i">+HDR = util.h
</a> SRC = lsd.c dattr.c pfd.c ppd.c
 
 OBJ = $(SRC:.c=.o)
<a href="#h0-1" id="h0-1" class="h">@@ -12,14 +12,11 @@ all: binutils
</a> 
 binutils: $(BIN)
 
<a href="#h0-1-3" id="h0-1-3" class="d">-manpages:
</a><a href="#h0-1-4" id="h0-1-4" class="d">-	cd man; $(MAKE) $(MFLAGS)
</a><a href="#h0-1-5" id="h0-1-5" class="d">-
</a><a href="#h0-1-6" id="h0-1-6" class="d">-$(OBJ): $(HDR) util.o randr.o
</a><a href="#h0-1-7" id="h0-1-7" class="i">+$(OBJ): $(HDR) util.o
</a> 
 .o:
 	@echo &quot;LD $@&quot;
<a href="#h0-1-11" id="h0-1-11" class="d">-	@$(LD) $&lt; -o $@ $(LDFLAGS) util.o randr.o
</a><a href="#h0-1-12" id="h0-1-12" class="i">+	@$(LD) $&lt; -o $@ $(LDFLAGS) util.o
</a> 
 .c.o:
 	@echo &quot;CC $&lt;&quot;
<a href="#h0-2" id="h0-2" class="h">@@ -28,14 +25,14 @@ $(OBJ): $(HDR) util.o randr.o
</a> install: $(BIN)
 	mkdir -p $(DESTDIR)$(PREFIX)/bin/
 	cp -f $(BIN) $(DESTDIR)$(PREFIX)/bin/
<a href="#h0-2-3" id="h0-2-3" class="d">-	cd man; $(MAKE) $(MFLAGS) install
</a><a href="#h0-2-4" id="h0-2-4" class="i">+	cd man; $(MAKE) install
</a> 
 uninstall:
 	@echo &quot;uninstalling binaries&quot;
 	@for util in $(BIN); do \
 		rm -f $(DESTDIR)$(PREFIX)/bin/$$util; \
 	done
<a href="#h0-2-11" id="h0-2-11" class="d">-	cd man; $(MAKE) $(MFLAGS) uninstall
</a><a href="#h0-2-12" id="h0-2-12" class="i">+	cd man; $(MAKE) uninstall
</a> 
 clean:
<a href="#h0-2-15" id="h0-2-15" class="d">-	rm -f $(OBJ) $(BIN) util.o randr.o
</a><a href="#h0-2-16" id="h0-2-16" class="i">+	rm -f $(OBJ) $(BIN) util.o
</a><b>diff --git a/<a id="h1" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -4,5 +4,5 @@ MANPREFIX = $(PREFIX)/share/man
</a> CC = cc
 LD = $(CC)
 
<a href="#h1-0-3" id="h1-0-3" class="d">-CFLAGS +=  `pkg-config --cflags xcb xcb-randr` -pedantic -Wall -O2
</a><a href="#h1-0-4" id="h1-0-4" class="d">-LDFLAGS += `pkg-config --libs xcb xcb-randr`
</a><a href="#h1-0-5" id="h1-0-5" class="i">+CFLAGS  += -std=c99 -pedantic -Wall -O2
</a><a href="#h1-0-6" id="h1-0-6" class="i">+LDFLAGS += -lxcb -lxcb-randr
</a><b>diff --git a/<a id="h2" href="../file/dattr.c.html">dattr.c</a> b/<a href="../file/dattr.c.html">dattr.c</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -9,7 +9,6 @@
</a> #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
 
<a href="#h2-0-3" id="h2-0-3" class="d">-#include &quot;randr.h&quot;
</a> #include &quot;util.h&quot;
 
 xcb_connection_t *conn;
<a href="#h2-1" id="h2-1" class="h">@@ -33,7 +32,7 @@ main(int argc, char *argv[])
</a> 	xcb_randr_get_output_info_reply_t *output_info = NULL;
 	xcb_randr_crtc_t screen_crtc;
 	xcb_randr_get_crtc_info_reply_t *screen_crtc_info = NULL;
<a href="#h2-1-3" id="h2-1-3" class="d">-	char           *output_name;
</a><a href="#h2-1-4" id="h2-1-4" class="i">+	char *output_name;
</a> 
 	if (argc != 3)
 		usage(argv[0]);
<a href="#h2-2" id="h2-2" class="h">@@ -43,15 +42,15 @@ main(int argc, char *argv[])
</a> 	get_screen(conn, &amp;scrn);
 
 	xcb_randr_provider_t *providers;
<a href="#h2-2-3" id="h2-2-3" class="d">-	int 		p_len = get_providers(conn, scrn, &amp;providers);
</a><a href="#h2-2-4" id="h2-2-4" class="i">+	int p_len = get_providers(conn, scrn, &amp;providers);
</a> 
 	/* get the id of the output */
<a href="#h2-2-7" id="h2-2-7" class="d">-	int 		i = 0;
</a><a href="#h2-2-8" id="h2-2-8" class="i">+	int i = 0;
</a> 	while (i &lt; p_len &amp;&amp; output == -1) {
 		xcb_randr_output_t *os;
<a href="#h2-2-11" id="h2-2-11" class="d">-		int 		o_len = get_outputs(conn, providers[i], &amp;os);
</a><a href="#h2-2-12" id="h2-2-12" class="i">+		int o_len = get_outputs(conn, providers[i], &amp;os);
</a> 
<a href="#h2-2-14" id="h2-2-14" class="d">-		int 		j = 0;
</a><a href="#h2-2-15" id="h2-2-15" class="i">+		int j = 0;
</a> 		while (j &lt; o_len &amp;&amp; output == -1) {
 			if (strcmp(output_name, (const char *)get_output_name(conn, os[j])) == 0)
 				output = os[j];
<a href="#h2-3" id="h2-3" class="h">@@ -74,7 +73,7 @@ main(int argc, char *argv[])
</a> 		errx(1, &quot;Output not in use&quot;);
 
 	/* print info */
<a href="#h2-3-3" id="h2-3-3" class="d">-	int 		ch;
</a><a href="#h2-3-4" id="h2-3-4" class="i">+	int ch;
</a> 	while ((ch = getopt(argc, argv, &quot;whxy:&quot;)) != -1) {
 		switch (ch) {
 		case &apos;w&apos;:
<b>diff --git a/<a id="h3" href="../file/lsd.c.html">lsd.c</a> b/<a href="../file/lsd.c.html">lsd.c</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -7,11 +7,10 @@
</a> #include &lt;stdio.h&gt;
 #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
<a href="#h3-0-3" id="h3-0-3" class="d">-#include &quot;randr.h&quot;
</a> #include &quot;util.h&quot;
 
 xcb_connection_t *conn;
<a href="#h3-0-7" id="h3-0-7" class="d">-xcb_screen_t   *scrn;
</a><a href="#h3-0-8" id="h3-0-8" class="i">+xcb_screen_t *scrn;
</a> 
 void
 usage(char *name)
<a href="#h3-1" id="h3-1" class="h">@@ -44,11 +43,11 @@ main(int argc, char *argv[])
</a> 	get_screen(conn, &amp;scrn);
 
 	xcb_randr_provider_t *providers;
<a href="#h3-1-3" id="h3-1-3" class="d">-	int 		p_len = get_providers(conn, scrn, &amp;providers);
</a><a href="#h3-1-4" id="h3-1-4" class="i">+	int p_len = get_providers(conn, scrn, &amp;providers);
</a> 
 	for (int i = 0; i &lt; p_len; ++i) {
 		xcb_randr_output_t *os;
<a href="#h3-1-8" id="h3-1-8" class="d">-		int 		o_len = get_outputs(conn, providers[i], &amp;os);
</a><a href="#h3-1-9" id="h3-1-9" class="i">+		int o_len = get_outputs(conn, providers[i], &amp;os);
</a> 
 		/* Print screens from providers */
 		for (int j = 0; j &lt; o_len; ++j) {
<b>diff --git a/<a id="h4" href="../file/man/Makefile.html">man/Makefile</a> b/<a href="../file/man/Makefile.html">man/Makefile</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -5,6 +5,7 @@ MAN =           \
</a> 	pfd.1   \
 	ppd.1   \
 	dattr.1 \
<a href="#h4-0-3" id="h4-0-3" class="i">+	disputils.1 \
</a> 
 .POSIX:
 
<b>diff --git a/<a id="h5" href="../file/man/disputils.1.html">man/disputils.1</a> b/<a href="../file/man/disputils.1.html">man/disputils.1</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,31 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+.Dd August 2, 2016
</a><a href="#h5-0-1" id="h5-0-1" class="i">+.Dt DISPUTILS 1
</a><a href="#h5-0-2" id="h5-0-2" class="i">+.Os disputils
</a><a href="#h5-0-3" id="h5-0-3" class="i">+.Sh NAME
</a><a href="#h5-0-4" id="h5-0-4" class="i">+.Nm disputils
</a><a href="#h5-0-5" id="h5-0-5" class="i">+.Nd utilities for getting information about connected displays
</a><a href="#h5-0-6" id="h5-0-6" class="i">+.Sh DESCRIPTION
</a><a href="#h5-0-7" id="h5-0-7" class="i">+.Nm
</a><a href="#h5-0-8" id="h5-0-8" class="i">+is a compilation of utilities for getting information about displays in C
</a><a href="#h5-0-9" id="h5-0-9" class="i">+.Sh COMMANDS
</a><a href="#h5-0-10" id="h5-0-10" class="i">+.Bl -tag -width Ds -offset 60
</a><a href="#h5-0-11" id="h5-0-11" class="i">+.It dattr
</a><a href="#h5-0-12" id="h5-0-12" class="i">+get display&apos;s attributes
</a><a href="#h5-0-13" id="h5-0-13" class="i">+.It lsd
</a><a href="#h5-0-14" id="h5-0-14" class="i">+list displays in use
</a><a href="#h5-0-15" id="h5-0-15" class="i">+.It pfd
</a><a href="#h5-0-16" id="h5-0-16" class="i">+print focused display
</a><a href="#h5-0-17" id="h5-0-17" class="i">+.It ppd
</a><a href="#h5-0-18" id="h5-0-18" class="i">+print primary display
</a><a href="#h5-0-19" id="h5-0-19" class="i">+.El
</a><a href="#h5-0-20" id="h5-0-20" class="i">+.Sh ENVIRONMENT
</a><a href="#h5-0-21" id="h5-0-21" class="i">+.Nm
</a><a href="#h5-0-22" id="h5-0-22" class="i">+acts on the X display specified by the
</a><a href="#h5-0-23" id="h5-0-23" class="i">+.Ev DISPLAY
</a><a href="#h5-0-24" id="h5-0-24" class="i">+variable.
</a><a href="#h5-0-25" id="h5-0-25" class="i">+.Sh SEE ALSO
</a><a href="#h5-0-26" id="h5-0-26" class="i">+.Xr dattr 1 ,
</a><a href="#h5-0-27" id="h5-0-27" class="i">+.Xr lsd 1 ,
</a><a href="#h5-0-28" id="h5-0-28" class="i">+.Xr pfd 1 ,
</a><a href="#h5-0-29" id="h5-0-29" class="i">+.Xr ppd 1 ,
</a><a href="#h5-0-30" id="h5-0-30" class="i">+.Xr wmutils 1
</a><b>diff --git a/<a id="h6" href="../file/man/pfd.1.html">man/pfd.1</a> b/<a href="../file/man/pfd.1.html">man/pfd.1</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -7,7 +7,7 @@
</a> .Sh SYNOPSIS
 .Nm pfd
 .Sh DESCRIPTION
<a href="#h6-0-3" id="h6-0-3" class="d">-Print the ID of the monitor containing the currently focused window to
</a><a href="#h6-0-4" id="h6-0-4" class="i">+Print the ID of the display containing the currently focused window to
</a> .Dv stdout .
 .Sh ENVIRONMENT
 .Nm
<b>diff --git a/<a id="h7" href="../file/man/ppd.1.html">man/ppd.1</a> b/<a href="../file/man/ppd.1.html">man/ppd.1</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -2,10 +2,10 @@
</a> .Dt PPD 1
 .Os disputils
 .Sh NAME
<a href="#h7-0-3" id="h7-0-3" class="d">-.Nm pfd
</a><a href="#h7-0-4" id="h7-0-4" class="i">+.Nm ppd
</a> .Nd print primary display
 .Sh SYNOPSIS
<a href="#h7-0-7" id="h7-0-7" class="d">-.Nm pfd
</a><a href="#h7-0-8" id="h7-0-8" class="i">+.Nm ppd
</a> .Sh DESCRIPTION
 Print the ID of the current primary display to
 .Dv stdout .
<b>diff --git a/<a id="h8" href="../file/pfd.c.html">pfd.c</a> b/<a href="../file/pfd.c.html">pfd.c</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -8,7 +8,6 @@
</a> #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
 
<a href="#h8-0-3" id="h8-0-3" class="d">-#include &quot;randr.h&quot;
</a> #include &quot;util.h&quot;
 
 xcb_connection_t *conn;
<a href="#h8-1" id="h8-1" class="h">@@ -28,21 +27,21 @@ main(int argc, char *argv[])
</a> 	if (pledge(&quot;stdio rpath unix&quot;, NULL) == -1)
 		err(1, &quot;pledge&quot;);
 #endif
<a href="#h8-1-3" id="h8-1-3" class="d">-	xcb_window_t 	f_window;
</a><a href="#h8-1-4" id="h8-1-4" class="i">+	xcb_window_t f_window;
</a> 	xcb_get_geometry_reply_t *window_geometry = NULL;
 
<a href="#h8-1-7" id="h8-1-7" class="d">-	uint16_t 	window_x;
</a><a href="#h8-1-8" id="h8-1-8" class="d">-	uint16_t 	window_y;
</a><a href="#h8-1-9" id="h8-1-9" class="i">+	uint16_t window_x;
</a><a href="#h8-1-10" id="h8-1-10" class="i">+	uint16_t window_y;
</a> 
 	xcb_randr_get_output_info_reply_t *output_info = NULL;
 	xcb_randr_get_crtc_info_reply_t *output_crtc_info = NULL;
 	xcb_randr_output_t output;
<a href="#h8-1-15" id="h8-1-15" class="d">-	const char     *output_name = NULL;
</a><a href="#h8-1-16" id="h8-1-16" class="i">+	const char *output_name = NULL;
</a> 
<a href="#h8-1-18" id="h8-1-18" class="d">-	uint16_t 	output_w;
</a><a href="#h8-1-19" id="h8-1-19" class="d">-	uint16_t 	output_h;
</a><a href="#h8-1-20" id="h8-1-20" class="d">-	uint16_t 	output_x;
</a><a href="#h8-1-21" id="h8-1-21" class="d">-	uint16_t 	output_y;
</a><a href="#h8-1-22" id="h8-1-22" class="i">+	uint16_t output_w;
</a><a href="#h8-1-23" id="h8-1-23" class="i">+	uint16_t output_h;
</a><a href="#h8-1-24" id="h8-1-24" class="i">+	uint16_t output_x;
</a><a href="#h8-1-25" id="h8-1-25" class="i">+	uint16_t output_y;
</a> 
 	if (argc &gt; 1)
 		usage(argv[0]);
<a href="#h8-2" id="h8-2" class="h">@@ -57,14 +56,14 @@ main(int argc, char *argv[])
</a> 
 	/* Iterate through outputs */
 	xcb_randr_provider_t *providers;
<a href="#h8-2-3" id="h8-2-3" class="d">-	int 		p_len = get_providers(conn, scrn, &amp;providers);
</a><a href="#h8-2-4" id="h8-2-4" class="i">+	int	p_len = get_providers(conn, scrn, &amp;providers);
</a> 
<a href="#h8-2-6" id="h8-2-6" class="d">-	int 		i = 0;
</a><a href="#h8-2-7" id="h8-2-7" class="i">+	int	i = 0;
</a> 	while (i &lt; p_len &amp;&amp; output_name == &apos;\0&apos;) {
 		xcb_randr_output_t *os;
<a href="#h8-2-10" id="h8-2-10" class="d">-		int 		o_len = get_outputs(conn, providers[i], &amp;os);
</a><a href="#h8-2-11" id="h8-2-11" class="i">+		int o_len = get_outputs(conn, providers[i], &amp;os);
</a> 
<a href="#h8-2-13" id="h8-2-13" class="d">-		int 		j = 0;
</a><a href="#h8-2-14" id="h8-2-14" class="i">+		int j = 0;
</a> 		while (j &lt; o_len &amp;&amp; output_name == &apos;\0&apos;) {
 			output = os[j];
 			if (get_output_connection(conn, output) == 0) {
<b>diff --git a/<a id="h9" href="../file/ppd.c.html">ppd.c</a> b/<a href="../file/ppd.c.html">ppd.c</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -8,11 +8,10 @@
</a> #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
 
<a href="#h9-0-3" id="h9-0-3" class="d">-#include &quot;randr.h&quot;
</a> #include &quot;util.h&quot;
 
 xcb_connection_t *conn;
<a href="#h9-0-7" id="h9-0-7" class="d">-xcb_screen_t   *scrn;
</a><a href="#h9-0-8" id="h9-0-8" class="i">+xcb_screen_t *scrn;
</a> 
 void
 usage(char *name)
<b>diff --git a/<a id="h10" href="../file/randr.c.html">randr.c</a> b/<a href="../file/randr.c.html">randr.c</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,142 +0,0 @@
</a><a href="#h10-0-0" id="h10-0-0" class="d">-/*
</a><a href="#h10-0-1" id="h10-0-1" class="d">- * disputils randr.c 04/15/2016 tudurom &lt;xenogenesis@openmailbox.org&gt; ix
</a><a href="#h10-0-2" id="h10-0-2" class="d">- * &lt;arcetera@openmailbox.org
</a><a href="#h10-0-3" id="h10-0-3" class="d">- */
</a><a href="#h10-0-4" id="h10-0-4" class="d">-
</a><a href="#h10-0-5" id="h10-0-5" class="d">-#include &lt;string.h&gt;
</a><a href="#h10-0-6" id="h10-0-6" class="d">-#include &lt;stdio.h&gt;
</a><a href="#h10-0-7" id="h10-0-7" class="d">-#include &lt;xcb/randr.h&gt;
</a><a href="#h10-0-8" id="h10-0-8" class="d">-
</a><a href="#h10-0-9" id="h10-0-9" class="d">-#include &quot;util.h&quot;
</a><a href="#h10-0-10" id="h10-0-10" class="d">-#include &quot;randr.h&quot;
</a><a href="#h10-0-11" id="h10-0-11" class="d">-
</a><a href="#h10-0-12" id="h10-0-12" class="d">-int
</a><a href="#h10-0-13" id="h10-0-13" class="d">-get_providers(xcb_connection_t * conn, xcb_screen_t * scrn, xcb_randr_provider_t ** ps)
</a><a href="#h10-0-14" id="h10-0-14" class="d">-{				/* get all providers */
</a><a href="#h10-0-15" id="h10-0-15" class="d">-	xcb_randr_get_providers_cookie_t pc;
</a><a href="#h10-0-16" id="h10-0-16" class="d">-	pc = xcb_randr_get_providers(conn, scrn-&gt;root);
</a><a href="#h10-0-17" id="h10-0-17" class="d">-
</a><a href="#h10-0-18" id="h10-0-18" class="d">-	xcb_randr_get_providers_reply_t *pr;
</a><a href="#h10-0-19" id="h10-0-19" class="d">-	pr = xcb_randr_get_providers_reply(conn, pc, NULL);
</a><a href="#h10-0-20" id="h10-0-20" class="d">-	if (!pr)
</a><a href="#h10-0-21" id="h10-0-21" class="d">-		errx(1, &quot;Could not aquire the array of providers.&quot;);
</a><a href="#h10-0-22" id="h10-0-22" class="d">-
</a><a href="#h10-0-23" id="h10-0-23" class="d">-	*ps = xcb_randr_get_providers_providers(pr);
</a><a href="#h10-0-24" id="h10-0-24" class="d">-
</a><a href="#h10-0-25" id="h10-0-25" class="d">-	return xcb_randr_get_providers_providers_length(pr);
</a><a href="#h10-0-26" id="h10-0-26" class="d">-}
</a><a href="#h10-0-27" id="h10-0-27" class="d">-
</a><a href="#h10-0-28" id="h10-0-28" class="d">-int
</a><a href="#h10-0-29" id="h10-0-29" class="d">-get_outputs(xcb_connection_t * conn, xcb_randr_provider_t provider, xcb_randr_output_t ** os)
</a><a href="#h10-0-30" id="h10-0-30" class="d">-{				/* get array of outputs */
</a><a href="#h10-0-31" id="h10-0-31" class="d">-	xcb_randr_get_provider_info_cookie_t pic;
</a><a href="#h10-0-32" id="h10-0-32" class="d">-	pic = xcb_randr_get_provider_info(conn, provider, 0);
</a><a href="#h10-0-33" id="h10-0-33" class="d">-
</a><a href="#h10-0-34" id="h10-0-34" class="d">-	xcb_randr_get_provider_info_reply_t *pir;
</a><a href="#h10-0-35" id="h10-0-35" class="d">-	pir = xcb_randr_get_provider_info_reply(conn, pic, NULL);
</a><a href="#h10-0-36" id="h10-0-36" class="d">-	if (!pir)
</a><a href="#h10-0-37" id="h10-0-37" class="d">-		errx(1, &quot;Could not aquire the array of outputs.&quot;);
</a><a href="#h10-0-38" id="h10-0-38" class="d">-
</a><a href="#h10-0-39" id="h10-0-39" class="d">-	*os = xcb_randr_get_provider_info_outputs(pir);
</a><a href="#h10-0-40" id="h10-0-40" class="d">-	return xcb_randr_get_provider_info_outputs_length(pir);
</a><a href="#h10-0-41" id="h10-0-41" class="d">-}
</a><a href="#h10-0-42" id="h10-0-42" class="d">-
</a><a href="#h10-0-43" id="h10-0-43" class="d">-xcb_randr_get_output_info_reply_t *
</a><a href="#h10-0-44" id="h10-0-44" class="d">-get_output_info(xcb_connection_t * conn, xcb_randr_output_t output)
</a><a href="#h10-0-45" id="h10-0-45" class="d">-{				/* get info about the output like crtc, modes
</a><a href="#h10-0-46" id="h10-0-46" class="d">-				 * etc */
</a><a href="#h10-0-47" id="h10-0-47" class="d">-	xcb_randr_get_output_info_cookie_t oic;
</a><a href="#h10-0-48" id="h10-0-48" class="d">-
</a><a href="#h10-0-49" id="h10-0-49" class="d">-	oic = xcb_randr_get_output_info(conn, output, 0);
</a><a href="#h10-0-50" id="h10-0-50" class="d">-	xcb_randr_get_output_info_reply_t *output_info_reply;
</a><a href="#h10-0-51" id="h10-0-51" class="d">-
</a><a href="#h10-0-52" id="h10-0-52" class="d">-	output_info_reply = xcb_randr_get_output_info_reply(conn, oic, NULL);
</a><a href="#h10-0-53" id="h10-0-53" class="d">-	if (!output_info_reply)
</a><a href="#h10-0-54" id="h10-0-54" class="d">-		errx(1, &quot;Could not get output info.&quot;);
</a><a href="#h10-0-55" id="h10-0-55" class="d">-
</a><a href="#h10-0-56" id="h10-0-56" class="d">-	return output_info_reply;
</a><a href="#h10-0-57" id="h10-0-57" class="d">-}
</a><a href="#h10-0-58" id="h10-0-58" class="d">-
</a><a href="#h10-0-59" id="h10-0-59" class="d">-uint8_t        *
</a><a href="#h10-0-60" id="h10-0-60" class="d">-get_output_name(xcb_connection_t * conn, xcb_randr_output_t output)
</a><a href="#h10-0-61" id="h10-0-61" class="d">-{				/* get output&apos;s name, like LVDS-1 */
</a><a href="#h10-0-62" id="h10-0-62" class="d">-	xcb_randr_get_output_info_reply_t *r;
</a><a href="#h10-0-63" id="h10-0-63" class="d">-
</a><a href="#h10-0-64" id="h10-0-64" class="d">-	r = get_output_info(conn, output);
</a><a href="#h10-0-65" id="h10-0-65" class="d">-	uint8_t *name = xcb_randr_get_output_info_name(r);
</a><a href="#h10-0-66" id="h10-0-66" class="d">-    uint8_t *ret  = malloc(sizeof(uint8_t) * xcb_randr_get_output_info_name_length(r));
</a><a href="#h10-0-67" id="h10-0-67" class="d">-    int i;
</a><a href="#h10-0-68" id="h10-0-68" class="d">-    for (i = 0; i &lt; xcb_randr_get_output_info_name_length(r); i++) {
</a><a href="#h10-0-69" id="h10-0-69" class="d">-        ret[i] = name[i];
</a><a href="#h10-0-70" id="h10-0-70" class="d">-    }
</a><a href="#h10-0-71" id="h10-0-71" class="d">-	return ret;
</a><a href="#h10-0-72" id="h10-0-72" class="d">-}
</a><a href="#h10-0-73" id="h10-0-73" class="d">-
</a><a href="#h10-0-74" id="h10-0-74" class="d">-int
</a><a href="#h10-0-75" id="h10-0-75" class="d">-get_output_connection(xcb_connection_t * conn, xcb_randr_output_t output)
</a><a href="#h10-0-76" id="h10-0-76" class="d">-{				/* returns 0 if the output is connected */
</a><a href="#h10-0-77" id="h10-0-77" class="d">-	xcb_randr_get_output_info_reply_t *r;
</a><a href="#h10-0-78" id="h10-0-78" class="d">-	r = get_output_info(conn, output);
</a><a href="#h10-0-79" id="h10-0-79" class="d">-	return r-&gt;connection;
</a><a href="#h10-0-80" id="h10-0-80" class="d">-}
</a><a href="#h10-0-81" id="h10-0-81" class="d">-
</a><a href="#h10-0-82" id="h10-0-82" class="d">-xcb_randr_get_crtc_info_reply_t *
</a><a href="#h10-0-83" id="h10-0-83" class="d">-get_output_crtc_info(xcb_connection_t * conn, xcb_randr_crtc_t crtc)
</a><a href="#h10-0-84" id="h10-0-84" class="d">-{				/* get crtc info (width, height, x, y, ...) */
</a><a href="#h10-0-85" id="h10-0-85" class="d">-	xcb_randr_get_crtc_info_cookie_t cic;
</a><a href="#h10-0-86" id="h10-0-86" class="d">-
</a><a href="#h10-0-87" id="h10-0-87" class="d">-	cic = xcb_randr_get_crtc_info(conn, crtc, 0);
</a><a href="#h10-0-88" id="h10-0-88" class="d">-
</a><a href="#h10-0-89" id="h10-0-89" class="d">-	xcb_randr_get_crtc_info_reply_t *crtc_info_reply;
</a><a href="#h10-0-90" id="h10-0-90" class="d">-	crtc_info_reply = xcb_randr_get_crtc_info_reply(conn, cic, NULL);
</a><a href="#h10-0-91" id="h10-0-91" class="d">-
</a><a href="#h10-0-92" id="h10-0-92" class="d">-	return crtc_info_reply;
</a><a href="#h10-0-93" id="h10-0-93" class="d">-}
</a><a href="#h10-0-94" id="h10-0-94" class="d">-
</a><a href="#h10-0-95" id="h10-0-95" class="d">-xcb_window_t
</a><a href="#h10-0-96" id="h10-0-96" class="d">-get_focused_window(xcb_connection_t * conn)
</a><a href="#h10-0-97" id="h10-0-97" class="d">-{				/* returns the id of the focused window */
</a><a href="#h10-0-98" id="h10-0-98" class="d">-	xcb_window_t 	win = 0;
</a><a href="#h10-0-99" id="h10-0-99" class="d">-	xcb_get_input_focus_cookie_t input_focus_cookie;
</a><a href="#h10-0-100" id="h10-0-100" class="d">-	xcb_get_input_focus_reply_t *input_focus_reply;
</a><a href="#h10-0-101" id="h10-0-101" class="d">-
</a><a href="#h10-0-102" id="h10-0-102" class="d">-	input_focus_cookie = xcb_get_input_focus(conn);
</a><a href="#h10-0-103" id="h10-0-103" class="d">-	input_focus_reply = xcb_get_input_focus_reply(conn, input_focus_cookie, NULL);
</a><a href="#h10-0-104" id="h10-0-104" class="d">-	if (!input_focus_reply)
</a><a href="#h10-0-105" id="h10-0-105" class="d">-		errx(1, &quot;Cannot get focused window.&quot;);
</a><a href="#h10-0-106" id="h10-0-106" class="d">-	win = input_focus_reply-&gt;focus;
</a><a href="#h10-0-107" id="h10-0-107" class="d">-	free(input_focus_reply);
</a><a href="#h10-0-108" id="h10-0-108" class="d">-	return win;
</a><a href="#h10-0-109" id="h10-0-109" class="d">-}
</a><a href="#h10-0-110" id="h10-0-110" class="d">-
</a><a href="#h10-0-111" id="h10-0-111" class="d">-xcb_get_geometry_reply_t *
</a><a href="#h10-0-112" id="h10-0-112" class="d">-get_window_geometry(xcb_connection_t * conn, xcb_window_t window)
</a><a href="#h10-0-113" id="h10-0-113" class="d">-{				/* returns the geometry of a window (width,
</a><a href="#h10-0-114" id="h10-0-114" class="d">-				 * height, x, y) */
</a><a href="#h10-0-115" id="h10-0-115" class="d">-	xcb_get_geometry_cookie_t get_geometry_cookie;
</a><a href="#h10-0-116" id="h10-0-116" class="d">-	xcb_get_geometry_reply_t *get_geometry_reply;
</a><a href="#h10-0-117" id="h10-0-117" class="d">-
</a><a href="#h10-0-118" id="h10-0-118" class="d">-	get_geometry_cookie = xcb_get_geometry(conn, window);
</a><a href="#h10-0-119" id="h10-0-119" class="d">-	get_geometry_reply = xcb_get_geometry_reply(conn, get_geometry_cookie, NULL);
</a><a href="#h10-0-120" id="h10-0-120" class="d">-
</a><a href="#h10-0-121" id="h10-0-121" class="d">-	if (!get_geometry_reply)
</a><a href="#h10-0-122" id="h10-0-122" class="d">-		errx(1, &quot;0x%08x: no such window&quot;, window);
</a><a href="#h10-0-123" id="h10-0-123" class="d">-	return get_geometry_reply;
</a><a href="#h10-0-124" id="h10-0-124" class="d">-}
</a><a href="#h10-0-125" id="h10-0-125" class="d">-
</a><a href="#h10-0-126" id="h10-0-126" class="d">-xcb_randr_get_output_primary_reply_t *
</a><a href="#h10-0-127" id="h10-0-127" class="d">-get_primary_output(xcb_connection_t * conn)
</a><a href="#h10-0-128" id="h10-0-128" class="d">-{				/* returns the primary output (display) */
</a><a href="#h10-0-129" id="h10-0-129" class="d">-	xcb_screen_t   *scrn;
</a><a href="#h10-0-130" id="h10-0-130" class="d">-	xcb_window_t 	root;
</a><a href="#h10-0-131" id="h10-0-131" class="d">-	xcb_randr_get_output_primary_cookie_t c;
</a><a href="#h10-0-132" id="h10-0-132" class="d">-	xcb_randr_get_output_primary_reply_t *primary_output;
</a><a href="#h10-0-133" id="h10-0-133" class="d">-
</a><a href="#h10-0-134" id="h10-0-134" class="d">-	get_screen(conn, &amp;scrn);
</a><a href="#h10-0-135" id="h10-0-135" class="d">-	root = scrn-&gt;root;
</a><a href="#h10-0-136" id="h10-0-136" class="d">-
</a><a href="#h10-0-137" id="h10-0-137" class="d">-	c = xcb_randr_get_output_primary(conn, root);
</a><a href="#h10-0-138" id="h10-0-138" class="d">-	primary_output = xcb_randr_get_output_primary_reply(conn, c, NULL);
</a><a href="#h10-0-139" id="h10-0-139" class="d">-
</a><a href="#h10-0-140" id="h10-0-140" class="d">-	return primary_output;
</a><a href="#h10-0-141" id="h10-0-141" class="d">-}
</a><b>diff --git a/<a id="h11" href="../file/randr.h.html">randr.h</a> b/<a href="../file/randr.h.html">randr.h</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,40 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-/*
</a><a href="#h11-0-1" id="h11-0-1" class="d">- * disputils randr.h 04/15/2016 tudurom &lt;xenogenesis@openmailbox.org&gt; ix
</a><a href="#h11-0-2" id="h11-0-2" class="d">- * &lt;arcetera@openmailbox.org&gt;
</a><a href="#h11-0-3" id="h11-0-3" class="d">- */
</a><a href="#h11-0-4" id="h11-0-4" class="d">-
</a><a href="#h11-0-5" id="h11-0-5" class="d">-#ifndef WMUTILS_RANDR
</a><a href="#h11-0-6" id="h11-0-6" class="d">-#define WMUTILS_RANDR
</a><a href="#h11-0-7" id="h11-0-7" class="d">-
</a><a href="#h11-0-8" id="h11-0-8" class="d">-#include &lt;xcb/xcb.h&gt;
</a><a href="#h11-0-9" id="h11-0-9" class="d">-#include &lt;xcb/randr.h&gt;
</a><a href="#h11-0-10" id="h11-0-10" class="d">-#include &lt;stdlib.h&gt;
</a><a href="#h11-0-11" id="h11-0-11" class="d">-#include &lt;err.h&gt;
</a><a href="#h11-0-12" id="h11-0-12" class="d">-
</a><a href="#h11-0-13" id="h11-0-13" class="d">-/* Return the list of outputs provided by a provider. */
</a><a href="#h11-0-14" id="h11-0-14" class="d">-int 		get_outputs(xcb_connection_t * conn, xcb_randr_provider_t provider, xcb_randr_output_t ** os);
</a><a href="#h11-0-15" id="h11-0-15" class="d">-
</a><a href="#h11-0-16" id="h11-0-16" class="d">-/* Return an array of providers shown by randr. */
</a><a href="#h11-0-17" id="h11-0-17" class="d">-int 		get_providers(xcb_connection_t * con, xcb_screen_t * scrn, xcb_randr_provider_t ** ps);
</a><a href="#h11-0-18" id="h11-0-18" class="d">-
</a><a href="#h11-0-19" id="h11-0-19" class="d">-/* Return info about an output */
</a><a href="#h11-0-20" id="h11-0-20" class="d">-xcb_randr_get_output_info_reply_t *get_output_info(xcb_connection_t * conn, xcb_randr_output_t output);
</a><a href="#h11-0-21" id="h11-0-21" class="d">-
</a><a href="#h11-0-22" id="h11-0-22" class="d">-/* Return an output&apos;s name */
</a><a href="#h11-0-23" id="h11-0-23" class="d">-uint8_t    *get_output_name(xcb_connection_t * conn, xcb_randr_output_t output);
</a><a href="#h11-0-24" id="h11-0-24" class="d">-
</a><a href="#h11-0-25" id="h11-0-25" class="d">-int 		get_output_connection(xcb_connection_t * conn, xcb_randr_output_t output);
</a><a href="#h11-0-26" id="h11-0-26" class="d">-
</a><a href="#h11-0-27" id="h11-0-27" class="d">-/* Return an output&apos;s crtc info */
</a><a href="#h11-0-28" id="h11-0-28" class="d">-xcb_randr_get_crtc_info_reply_t *get_output_crtc_info(xcb_connection_t * conn, xcb_randr_crtc_t crtc);
</a><a href="#h11-0-29" id="h11-0-29" class="d">-
</a><a href="#h11-0-30" id="h11-0-30" class="d">-/* Return the id of the currently focused window */
</a><a href="#h11-0-31" id="h11-0-31" class="d">-xcb_window_t 	get_focused_window(xcb_connection_t * conn);
</a><a href="#h11-0-32" id="h11-0-32" class="d">-
</a><a href="#h11-0-33" id="h11-0-33" class="d">-/* Return a window&apos;s geometry (width, height, x, y) */
</a><a href="#h11-0-34" id="h11-0-34" class="d">-xcb_get_geometry_reply_t *get_window_geometry(xcb_connection_t * conn, xcb_window_t window);
</a><a href="#h11-0-35" id="h11-0-35" class="d">-
</a><a href="#h11-0-36" id="h11-0-36" class="d">-/* Return the primary output (display) */
</a><a href="#h11-0-37" id="h11-0-37" class="d">-xcb_randr_get_output_primary_reply_t *get_primary_output(xcb_connection_t * conn);
</a><a href="#h11-0-38" id="h11-0-38" class="d">-
</a><a href="#h11-0-39" id="h11-0-39" class="d">-#endif				/* end of include guard: WMUTILS_RANDR */
</a><b>diff --git a/<a id="h12" href="../file/util.c.html">util.c</a> b/<a href="../file/util.c.html">util.c</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -9,6 +9,10 @@
</a> 
 #include &quot;util.h&quot;
 
<a href="#h12-0-3" id="h12-0-3" class="i">+/*
</a><a href="#h12-0-4" id="h12-0-4" class="i">+ * Initialize connection to X server.
</a><a href="#h12-0-5" id="h12-0-5" class="i">+ */
</a><a href="#h12-0-6" id="h12-0-6" class="i">+
</a> void
 init_xcb(xcb_connection_t ** con)
 {
<a href="#h12-1" id="h12-1" class="h">@@ -17,6 +21,10 @@ init_xcb(xcb_connection_t ** con)
</a> 		errx(1, &quot;unable connect to the X server&quot;);
 }
 
<a href="#h12-1-3" id="h12-1-3" class="i">+/*
</a><a href="#h12-1-4" id="h12-1-4" class="i">+ * Disconnect from the X server.
</a><a href="#h12-1-5" id="h12-1-5" class="i">+ */
</a><a href="#h12-1-6" id="h12-1-6" class="i">+
</a> void
 kill_xcb(xcb_connection_t ** con)
 {
<a href="#h12-2" id="h12-2" class="h">@@ -24,6 +32,10 @@ kill_xcb(xcb_connection_t ** con)
</a> 		xcb_disconnect(*con);
 }
 
<a href="#h12-2-3" id="h12-2-3" class="i">+/*
</a><a href="#h12-2-4" id="h12-2-4" class="i">+ * Get the current X screen.
</a><a href="#h12-2-5" id="h12-2-5" class="i">+ */
</a><a href="#h12-2-6" id="h12-2-6" class="i">+
</a> void
 get_screen(xcb_connection_t * con, xcb_screen_t ** scr)
 {
<a href="#h12-3" id="h12-3" class="h">@@ -32,76 +44,169 @@ get_screen(xcb_connection_t * con, xcb_screen_t ** scr)
</a> 		errx(1, &quot;unable to retrieve screen informations&quot;);
 }
 
<a href="#h12-3-3" id="h12-3-3" class="i">+/*
</a><a href="#h12-3-4" id="h12-3-4" class="i">+ * Get a list of outputs provided by a provider.
</a><a href="#h12-3-5" id="h12-3-5" class="i">+ */
</a><a href="#h12-3-6" id="h12-3-6" class="i">+
</a> int
<a href="#h12-3-8" id="h12-3-8" class="d">-exists(xcb_connection_t * con, xcb_window_t w)
</a><a href="#h12-3-9" id="h12-3-9" class="i">+get_outputs(xcb_connection_t * conn, xcb_randr_provider_t provider, xcb_randr_output_t ** os)
</a> {
<a href="#h12-3-11" id="h12-3-11" class="d">-	xcb_get_window_attributes_cookie_t c;
</a><a href="#h12-3-12" id="h12-3-12" class="d">-	xcb_get_window_attributes_reply_t *r;
</a><a href="#h12-3-13" id="h12-3-13" class="d">-
</a><a href="#h12-3-14" id="h12-3-14" class="d">-	c = xcb_get_window_attributes(con, w);
</a><a href="#h12-3-15" id="h12-3-15" class="d">-	r = xcb_get_window_attributes_reply(con, c, NULL);
</a><a href="#h12-3-16" id="h12-3-16" class="i">+	xcb_randr_get_provider_info_cookie_t pic;
</a><a href="#h12-3-17" id="h12-3-17" class="i">+	pic = xcb_randr_get_provider_info(conn, provider, 0);
</a> 
<a href="#h12-3-19" id="h12-3-19" class="d">-	if (r == NULL)
</a><a href="#h12-3-20" id="h12-3-20" class="d">-		return 0;
</a><a href="#h12-3-21" id="h12-3-21" class="i">+	xcb_randr_get_provider_info_reply_t *pir;
</a><a href="#h12-3-22" id="h12-3-22" class="i">+	pir = xcb_randr_get_provider_info_reply(conn, pic, NULL);
</a><a href="#h12-3-23" id="h12-3-23" class="i">+	if (!pir)
</a><a href="#h12-3-24" id="h12-3-24" class="i">+		errx(1, &quot;Could not aquire the array of outputs.&quot;);
</a> 
<a href="#h12-3-26" id="h12-3-26" class="d">-	free(r);
</a><a href="#h12-3-27" id="h12-3-27" class="d">-	return 1;
</a><a href="#h12-3-28" id="h12-3-28" class="i">+	*os = xcb_randr_get_provider_info_outputs(pir);
</a><a href="#h12-3-29" id="h12-3-29" class="i">+	return xcb_randr_get_provider_info_outputs_length(pir);
</a> }
 
<a href="#h12-3-32" id="h12-3-32" class="i">+/*
</a><a href="#h12-3-33" id="h12-3-33" class="i">+ * Get an array or providers shown by xrandr.
</a><a href="#h12-3-34" id="h12-3-34" class="i">+ */
</a><a href="#h12-3-35" id="h12-3-35" class="i">+
</a> int
<a href="#h12-3-37" id="h12-3-37" class="d">-mapped(xcb_connection_t * con, xcb_window_t w)
</a><a href="#h12-3-38" id="h12-3-38" class="i">+get_providers(xcb_connection_t * conn, xcb_screen_t * scrn, xcb_randr_provider_t ** ps)
</a> {
<a href="#h12-3-40" id="h12-3-40" class="d">-	int 		ms;
</a><a href="#h12-3-41" id="h12-3-41" class="d">-	xcb_get_window_attributes_cookie_t c;
</a><a href="#h12-3-42" id="h12-3-42" class="d">-	xcb_get_window_attributes_reply_t *r;
</a><a href="#h12-3-43" id="h12-3-43" class="i">+	xcb_randr_get_providers_cookie_t pc;
</a><a href="#h12-3-44" id="h12-3-44" class="i">+	pc = xcb_randr_get_providers(conn, scrn-&gt;root);
</a><a href="#h12-3-45" id="h12-3-45" class="i">+
</a><a href="#h12-3-46" id="h12-3-46" class="i">+	xcb_randr_get_providers_reply_t *pr;
</a><a href="#h12-3-47" id="h12-3-47" class="i">+	pr = xcb_randr_get_providers_reply(conn, pc, NULL);
</a><a href="#h12-3-48" id="h12-3-48" class="i">+	if (!pr)
</a><a href="#h12-3-49" id="h12-3-49" class="i">+		errx(1, &quot;Could not aquire the array of providers.&quot;);
</a><a href="#h12-3-50" id="h12-3-50" class="i">+
</a><a href="#h12-3-51" id="h12-3-51" class="i">+	*ps = xcb_randr_get_providers_providers(pr);
</a><a href="#h12-3-52" id="h12-3-52" class="i">+
</a><a href="#h12-3-53" id="h12-3-53" class="i">+	return xcb_randr_get_providers_providers_length(pr);
</a><a href="#h12-3-54" id="h12-3-54" class="i">+}
</a><a href="#h12-3-55" id="h12-3-55" class="i">+
</a><a href="#h12-3-56" id="h12-3-56" class="i">+/*
</a><a href="#h12-3-57" id="h12-3-57" class="i">+ * Get info about an output.
</a><a href="#h12-3-58" id="h12-3-58" class="i">+ */
</a> 
<a href="#h12-3-60" id="h12-3-60" class="d">-	c = xcb_get_window_attributes(con, w);
</a><a href="#h12-3-61" id="h12-3-61" class="d">-	r = xcb_get_window_attributes_reply(con, c, NULL);
</a><a href="#h12-3-62" id="h12-3-62" class="i">+xcb_randr_get_output_info_reply_t *
</a><a href="#h12-3-63" id="h12-3-63" class="i">+get_output_info(xcb_connection_t * conn, xcb_randr_output_t output)
</a><a href="#h12-3-64" id="h12-3-64" class="i">+{
</a><a href="#h12-3-65" id="h12-3-65" class="i">+	xcb_randr_get_output_info_cookie_t oic;
</a> 
<a href="#h12-3-67" id="h12-3-67" class="d">-	if (r == NULL)
</a><a href="#h12-3-68" id="h12-3-68" class="d">-		return 0;
</a><a href="#h12-3-69" id="h12-3-69" class="i">+	oic = xcb_randr_get_output_info(conn, output, 0);
</a><a href="#h12-3-70" id="h12-3-70" class="i">+	xcb_randr_get_output_info_reply_t *output_info_reply;
</a> 
<a href="#h12-3-72" id="h12-3-72" class="d">-	ms = r-&gt;map_state;
</a><a href="#h12-3-73" id="h12-3-73" class="i">+	output_info_reply = xcb_randr_get_output_info_reply(conn, oic, NULL);
</a><a href="#h12-3-74" id="h12-3-74" class="i">+	if (!output_info_reply)
</a><a href="#h12-3-75" id="h12-3-75" class="i">+		errx(1, &quot;Could not get output info.&quot;);
</a> 
<a href="#h12-3-77" id="h12-3-77" class="d">-	free(r);
</a><a href="#h12-3-78" id="h12-3-78" class="d">-	return ms == XCB_MAP_STATE_VIEWABLE;
</a><a href="#h12-3-79" id="h12-3-79" class="i">+	return output_info_reply;
</a> }
 
<a href="#h12-3-82" id="h12-3-82" class="i">+/*
</a><a href="#h12-3-83" id="h12-3-83" class="i">+ * Get an output&apos;s name.
</a><a href="#h12-3-84" id="h12-3-84" class="i">+ */
</a><a href="#h12-3-85" id="h12-3-85" class="i">+
</a><a href="#h12-3-86" id="h12-3-86" class="i">+uint8_t        *
</a><a href="#h12-3-87" id="h12-3-87" class="i">+get_output_name(xcb_connection_t * conn, xcb_randr_output_t output)
</a><a href="#h12-3-88" id="h12-3-88" class="i">+{
</a><a href="#h12-3-89" id="h12-3-89" class="i">+	xcb_randr_get_output_info_reply_t *r;
</a><a href="#h12-3-90" id="h12-3-90" class="i">+
</a><a href="#h12-3-91" id="h12-3-91" class="i">+	r = get_output_info(conn, output);
</a><a href="#h12-3-92" id="h12-3-92" class="i">+	uint8_t *name = xcb_randr_get_output_info_name(r);
</a><a href="#h12-3-93" id="h12-3-93" class="i">+    uint8_t *ret  = malloc(sizeof(uint8_t) * xcb_randr_get_output_info_name_length(r));
</a><a href="#h12-3-94" id="h12-3-94" class="i">+    int i;
</a><a href="#h12-3-95" id="h12-3-95" class="i">+    for (i = 0; i &lt; xcb_randr_get_output_info_name_length(r); i++) {
</a><a href="#h12-3-96" id="h12-3-96" class="i">+        ret[i] = name[i];
</a><a href="#h12-3-97" id="h12-3-97" class="i">+    }
</a><a href="#h12-3-98" id="h12-3-98" class="i">+	return ret;
</a><a href="#h12-3-99" id="h12-3-99" class="i">+}
</a><a href="#h12-3-100" id="h12-3-100" class="i">+
</a><a href="#h12-3-101" id="h12-3-101" class="i">+/*
</a><a href="#h12-3-102" id="h12-3-102" class="i">+ * Return 0 if output is connected and in use.
</a><a href="#h12-3-103" id="h12-3-103" class="i">+ */
</a><a href="#h12-3-104" id="h12-3-104" class="i">+
</a> int
<a href="#h12-3-106" id="h12-3-106" class="d">-ignore(xcb_connection_t * con, xcb_window_t w)
</a><a href="#h12-3-107" id="h12-3-107" class="i">+get_output_connection(xcb_connection_t * conn, xcb_randr_output_t output)
</a> {
<a href="#h12-3-109" id="h12-3-109" class="d">-	int 		or;
</a><a href="#h12-3-110" id="h12-3-110" class="d">-	xcb_get_window_attributes_cookie_t c;
</a><a href="#h12-3-111" id="h12-3-111" class="d">-	xcb_get_window_attributes_reply_t *r;
</a><a href="#h12-3-112" id="h12-3-112" class="i">+	xcb_randr_get_output_info_reply_t *r;
</a><a href="#h12-3-113" id="h12-3-113" class="i">+	r = get_output_info(conn, output);
</a><a href="#h12-3-114" id="h12-3-114" class="i">+	return r-&gt;connection;
</a><a href="#h12-3-115" id="h12-3-115" class="i">+}
</a><a href="#h12-3-116" id="h12-3-116" class="i">+
</a><a href="#h12-3-117" id="h12-3-117" class="i">+/*
</a><a href="#h12-3-118" id="h12-3-118" class="i">+ * Get an output&apos;s crtc info.
</a><a href="#h12-3-119" id="h12-3-119" class="i">+ * width, height, x, y etc.
</a><a href="#h12-3-120" id="h12-3-120" class="i">+ */
</a> 
<a href="#h12-3-122" id="h12-3-122" class="d">-	c = xcb_get_window_attributes(con, w);
</a><a href="#h12-3-123" id="h12-3-123" class="d">-	r = xcb_get_window_attributes_reply(con, c, NULL);
</a><a href="#h12-3-124" id="h12-3-124" class="i">+xcb_randr_get_crtc_info_reply_t *
</a><a href="#h12-3-125" id="h12-3-125" class="i">+get_output_crtc_info(xcb_connection_t * conn, xcb_randr_crtc_t crtc)
</a><a href="#h12-3-126" id="h12-3-126" class="i">+{
</a><a href="#h12-3-127" id="h12-3-127" class="i">+	xcb_randr_get_crtc_info_cookie_t cic;
</a> 
<a href="#h12-3-129" id="h12-3-129" class="d">-	if (r == NULL)
</a><a href="#h12-3-130" id="h12-3-130" class="d">-		return 0;
</a><a href="#h12-3-131" id="h12-3-131" class="i">+	cic = xcb_randr_get_crtc_info(conn, crtc, 0);
</a> 
<a href="#h12-3-133" id="h12-3-133" class="d">-	or = r-&gt;override_redirect;
</a><a href="#h12-3-134" id="h12-3-134" class="i">+	xcb_randr_get_crtc_info_reply_t *crtc_info_reply;
</a><a href="#h12-3-135" id="h12-3-135" class="i">+	crtc_info_reply = xcb_randr_get_crtc_info_reply(conn, cic, NULL);
</a> 
<a href="#h12-3-137" id="h12-3-137" class="d">-	free(r);
</a><a href="#h12-3-138" id="h12-3-138" class="d">-	return or;
</a><a href="#h12-3-139" id="h12-3-139" class="i">+	return crtc_info_reply;
</a> }
 
<a href="#h12-3-142" id="h12-3-142" class="d">-int
</a><a href="#h12-3-143" id="h12-3-143" class="d">-get_windows(xcb_connection_t * con, xcb_window_t w, xcb_window_t ** l)
</a><a href="#h12-3-144" id="h12-3-144" class="i">+/*
</a><a href="#h12-3-145" id="h12-3-145" class="i">+ * Get the id of the currently focused window.
</a><a href="#h12-3-146" id="h12-3-146" class="i">+ */
</a><a href="#h12-3-147" id="h12-3-147" class="i">+
</a><a href="#h12-3-148" id="h12-3-148" class="i">+xcb_window_t
</a><a href="#h12-3-149" id="h12-3-149" class="i">+get_focused_window(xcb_connection_t * conn)
</a> {
<a href="#h12-3-151" id="h12-3-151" class="d">-	int 		childnum = 0;
</a><a href="#h12-3-152" id="h12-3-152" class="d">-	xcb_query_tree_cookie_t c;
</a><a href="#h12-3-153" id="h12-3-153" class="d">-	xcb_query_tree_reply_t *r;
</a><a href="#h12-3-154" id="h12-3-154" class="i">+	xcb_window_t 	win = 0;
</a><a href="#h12-3-155" id="h12-3-155" class="i">+	xcb_get_input_focus_cookie_t input_focus_cookie;
</a><a href="#h12-3-156" id="h12-3-156" class="i">+	xcb_get_input_focus_reply_t *input_focus_reply;
</a><a href="#h12-3-157" id="h12-3-157" class="i">+
</a><a href="#h12-3-158" id="h12-3-158" class="i">+	input_focus_cookie = xcb_get_input_focus(conn);
</a><a href="#h12-3-159" id="h12-3-159" class="i">+	input_focus_reply = xcb_get_input_focus_reply(conn, input_focus_cookie, NULL);
</a><a href="#h12-3-160" id="h12-3-160" class="i">+	if (!input_focus_reply)
</a><a href="#h12-3-161" id="h12-3-161" class="i">+		errx(1, &quot;Cannot get focused window.&quot;);
</a><a href="#h12-3-162" id="h12-3-162" class="i">+	win = input_focus_reply-&gt;focus;
</a><a href="#h12-3-163" id="h12-3-163" class="i">+	free(input_focus_reply);
</a><a href="#h12-3-164" id="h12-3-164" class="i">+	return win;
</a><a href="#h12-3-165" id="h12-3-165" class="i">+}
</a><a href="#h12-3-166" id="h12-3-166" class="i">+
</a><a href="#h12-3-167" id="h12-3-167" class="i">+/*
</a><a href="#h12-3-168" id="h12-3-168" class="i">+ * Get a window&apos;s geometry.
</a><a href="#h12-3-169" id="h12-3-169" class="i">+ * width, height, x, y etc.
</a><a href="#h12-3-170" id="h12-3-170" class="i">+ */
</a><a href="#h12-3-171" id="h12-3-171" class="i">+
</a><a href="#h12-3-172" id="h12-3-172" class="i">+xcb_get_geometry_reply_t *
</a><a href="#h12-3-173" id="h12-3-173" class="i">+get_window_geometry(xcb_connection_t * conn, xcb_window_t window)
</a><a href="#h12-3-174" id="h12-3-174" class="i">+{
</a><a href="#h12-3-175" id="h12-3-175" class="i">+	xcb_get_geometry_cookie_t get_geometry_cookie;
</a><a href="#h12-3-176" id="h12-3-176" class="i">+	xcb_get_geometry_reply_t *get_geometry_reply;
</a><a href="#h12-3-177" id="h12-3-177" class="i">+
</a><a href="#h12-3-178" id="h12-3-178" class="i">+	get_geometry_cookie = xcb_get_geometry(conn, window);
</a><a href="#h12-3-179" id="h12-3-179" class="i">+	get_geometry_reply = xcb_get_geometry_reply(conn, get_geometry_cookie, NULL);
</a> 
<a href="#h12-3-181" id="h12-3-181" class="d">-	c = xcb_query_tree(con, w);
</a><a href="#h12-3-182" id="h12-3-182" class="d">-	r = xcb_query_tree_reply(con, c, NULL);
</a><a href="#h12-3-183" id="h12-3-183" class="d">-	if (r == NULL)
</a><a href="#h12-3-184" id="h12-3-184" class="d">-		errx(1, &quot;0x%08x: no such window&quot;, w);
</a><a href="#h12-3-185" id="h12-3-185" class="i">+	if (!get_geometry_reply)
</a><a href="#h12-3-186" id="h12-3-186" class="i">+		errx(1, &quot;0x%08x: no such window&quot;, window);
</a><a href="#h12-3-187" id="h12-3-187" class="i">+	return get_geometry_reply;
</a><a href="#h12-3-188" id="h12-3-188" class="i">+}
</a><a href="#h12-3-189" id="h12-3-189" class="i">+
</a><a href="#h12-3-190" id="h12-3-190" class="i">+/*
</a><a href="#h12-3-191" id="h12-3-191" class="i">+ * Get primary output (primary display).
</a><a href="#h12-3-192" id="h12-3-192" class="i">+ */
</a><a href="#h12-3-193" id="h12-3-193" class="i">+
</a><a href="#h12-3-194" id="h12-3-194" class="i">+xcb_randr_get_output_primary_reply_t *
</a><a href="#h12-3-195" id="h12-3-195" class="i">+get_primary_output(xcb_connection_t * conn)
</a><a href="#h12-3-196" id="h12-3-196" class="i">+{
</a><a href="#h12-3-197" id="h12-3-197" class="i">+	xcb_screen_t   *scrn;
</a><a href="#h12-3-198" id="h12-3-198" class="i">+	xcb_window_t 	root;
</a><a href="#h12-3-199" id="h12-3-199" class="i">+	xcb_randr_get_output_primary_cookie_t c;
</a><a href="#h12-3-200" id="h12-3-200" class="i">+	xcb_randr_get_output_primary_reply_t *primary_output;
</a> 
<a href="#h12-3-202" id="h12-3-202" class="d">-	*l = xcb_query_tree_children(r);
</a><a href="#h12-3-203" id="h12-3-203" class="i">+	get_screen(conn, &amp;scrn);
</a><a href="#h12-3-204" id="h12-3-204" class="i">+	root = scrn-&gt;root;
</a> 
<a href="#h12-3-206" id="h12-3-206" class="d">-	childnum = r-&gt;children_len;
</a><a href="#h12-3-207" id="h12-3-207" class="d">-	free(r);
</a><a href="#h12-3-208" id="h12-3-208" class="i">+	c = xcb_randr_get_output_primary(conn, root);
</a><a href="#h12-3-209" id="h12-3-209" class="i">+	primary_output = xcb_randr_get_output_primary_reply(conn, c, NULL);
</a> 
<a href="#h12-3-211" id="h12-3-211" class="d">-	return childnum;
</a><a href="#h12-3-212" id="h12-3-212" class="i">+	return primary_output;
</a> }
<b>diff --git a/<a id="h13" href="../file/util.h.html">util.h</a> b/<a href="../file/util.h.html">util.h</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -6,14 +6,20 @@
</a> #ifndef UTIL_H__
 #define UTIL_H__
 
<a href="#h13-0-3" id="h13-0-3" class="d">-void 		init_xcb (xcb_connection_t **);
</a><a href="#h13-0-4" id="h13-0-4" class="d">-void 		kill_xcb (xcb_connection_t **);
</a><a href="#h13-0-5" id="h13-0-5" class="i">+#include &lt;xcb/xcb.h&gt;
</a><a href="#h13-0-6" id="h13-0-6" class="i">+#include &lt;xcb/randr.h&gt;
</a> 
<a href="#h13-0-8" id="h13-0-8" class="d">-void 		get_screen(xcb_connection_t *, xcb_screen_t **);
</a><a href="#h13-0-9" id="h13-0-9" class="d">-int 		get_windows(xcb_connection_t *, xcb_window_t, xcb_window_t **);
</a><a href="#h13-0-10" id="h13-0-10" class="d">-
</a><a href="#h13-0-11" id="h13-0-11" class="d">-int 		exists    (xcb_connection_t *, xcb_window_t);
</a><a href="#h13-0-12" id="h13-0-12" class="d">-int 		mapped    (xcb_connection_t *, xcb_window_t);
</a><a href="#h13-0-13" id="h13-0-13" class="d">-int 		ignore    (xcb_connection_t *, xcb_window_t);
</a><a href="#h13-0-14" id="h13-0-14" class="i">+void                                  init_xcb(xcb_connection_t **);
</a><a href="#h13-0-15" id="h13-0-15" class="i">+void                                  kill_xcb(xcb_connection_t **);
</a><a href="#h13-0-16" id="h13-0-16" class="i">+void                                  get_screen(xcb_connection_t *, xcb_screen_t **);
</a> 
<a href="#h13-0-18" id="h13-0-18" class="i">+int                                   get_outputs(xcb_connection_t *, xcb_randr_provider_t, xcb_randr_output_t **);
</a><a href="#h13-0-19" id="h13-0-19" class="i">+int                                   get_providers(xcb_connection_t *, xcb_screen_t *, xcb_randr_provider_t **);
</a><a href="#h13-0-20" id="h13-0-20" class="i">+xcb_randr_get_output_info_reply_t*    get_output_info(xcb_connection_t *, xcb_randr_output_t);
</a><a href="#h13-0-21" id="h13-0-21" class="i">+uint8_t*                              get_output_name(xcb_connection_t *, xcb_randr_output_t);
</a><a href="#h13-0-22" id="h13-0-22" class="i">+int                                   get_output_connection(xcb_connection_t *, xcb_randr_output_t);
</a><a href="#h13-0-23" id="h13-0-23" class="i">+xcb_randr_get_crtc_info_reply_t*      get_output_crtc_info(xcb_connection_t *, xcb_randr_crtc_t);
</a><a href="#h13-0-24" id="h13-0-24" class="i">+xcb_window_t                          get_focused_window(xcb_connection_t *);
</a><a href="#h13-0-25" id="h13-0-25" class="i">+xcb_get_geometry_reply_t*             get_window_geometry(xcb_connection_t *, xcb_window_t);
</a><a href="#h13-0-26" id="h13-0-26" class="i">+xcb_randr_get_output_primary_reply_t* get_primary_output(xcb_connection_t *);
</a> #endif
</pre>
</div>
</body>
</html>
