<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>init woooo! the wm itself is currently configured at compile time in config.h - windowchef - windowchef is a stacking window cooker controlled by a remote control program, waitron
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="windowchef.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>windowchef</h1><span class="desc">windowchef is a stacking window cooker controlled by a remote control program, waitron
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/windowchef.git">git://thetudor.ddns.net/windowchef.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/7e76b1b0449adb8c0aacd58fb1854f36008e2368.html">7e76b1b0449adb8c0aacd58fb1854f36008e2368</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Fri Sep  2 23:03:43 +0300

init woooo!
the wm itself is currently configured at compile time in config.h

<b>Diffstat:</b>
<table><tr><td><a href="#h0">.sxhkdrc</a></td><td> | </td><td class="num">41</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h1">.xinitrc</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td><a href="#h2">LICENSE</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h3">Makefile</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h4">README.md</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h5">TODO.md</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td><a href="#h6">client.c</a></td><td> | </td><td class="num">179</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h7">common.h</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h8">config.h</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h9">config.mk</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h10">ipc.h</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h11">list.c</a></td><td> | </td><td class="num">88</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h12">list.h</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h13">types.h</a></td><td> | </td><td class="num">46</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h14">wm.c</a></td><td> | </td><td class="num">2021</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h15">xephyr.sh</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
</table>16 files changed, 2533 insertions(+), 0 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.sxhkdrc.html">.sxhkdrc</a> b/<a href="../file/.sxhkdrc.html">.sxhkdrc</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1,41 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+super + {h,j,k,l}
</a><a href="#h0-0-1" id="h0-0-1" class="i">+  waitron window_move {-20 0, 0 20, 0 -20, 20 0}
</a><a href="#h0-0-2" id="h0-0-2" class="i">+
</a><a href="#h0-0-3" id="h0-0-3" class="i">+super + alt + {h,j,k,l}
</a><a href="#h0-0-4" id="h0-0-4" class="i">+  waitron window_resize {-20 0, 0 20, 0 -20, 20 0}
</a><a href="#h0-0-5" id="h0-0-5" class="i">+
</a><a href="#h0-0-6" id="h0-0-6" class="i">+super + shift + {h,j,k,l}
</a><a href="#h0-0-7" id="h0-0-7" class="i">+  waitron window_move {-50 0, 0 50, 0 -50, 50 0}
</a><a href="#h0-0-8" id="h0-0-8" class="i">+
</a><a href="#h0-0-9" id="h0-0-9" class="i">+super + shift + alt + {h,j,k,l}
</a><a href="#h0-0-10" id="h0-0-10" class="i">+  waitron window_resize {-50 0, 0 50, 0 -50, 50 0}
</a><a href="#h0-0-11" id="h0-0-11" class="i">+
</a><a href="#h0-0-12" id="h0-0-12" class="i">+super + alt + Escape
</a><a href="#h0-0-13" id="h0-0-13" class="i">+  waitron wm_quit 0
</a><a href="#h0-0-14" id="h0-0-14" class="i">+
</a><a href="#h0-0-15" id="h0-0-15" class="i">+super + f
</a><a href="#h0-0-16" id="h0-0-16" class="i">+  waitron window_maximize
</a><a href="#h0-0-17" id="h0-0-17" class="i">+
</a><a href="#h0-0-18" id="h0-0-18" class="i">+super + w
</a><a href="#h0-0-19" id="h0-0-19" class="i">+  waitron window_close
</a><a href="#h0-0-20" id="h0-0-20" class="i">+
</a><a href="#h0-0-21" id="h0-0-21" class="i">+super + b
</a><a href="#h0-0-22" id="h0-0-22" class="i">+  waitron window_hor_maximize
</a><a href="#h0-0-23" id="h0-0-23" class="i">+
</a><a href="#h0-0-24" id="h0-0-24" class="i">+super + v
</a><a href="#h0-0-25" id="h0-0-25" class="i">+  waitron window_ver_maximize
</a><a href="#h0-0-26" id="h0-0-26" class="i">+
</a><a href="#h0-0-27" id="h0-0-27" class="i">+alt + Tab
</a><a href="#h0-0-28" id="h0-0-28" class="i">+  waitron window_cycle
</a><a href="#h0-0-29" id="h0-0-29" class="i">+
</a><a href="#h0-0-30" id="h0-0-30" class="i">+alt + shift + Tab
</a><a href="#h0-0-31" id="h0-0-31" class="i">+  waitron window_rev_cycle
</a><a href="#h0-0-32" id="h0-0-32" class="i">+
</a><a href="#h0-0-33" id="h0-0-33" class="i">+super + {_,shift +}{1-6}
</a><a href="#h0-0-34" id="h0-0-34" class="i">+  waitron {group_toggle,group_add_window} {1-6}
</a><a href="#h0-0-35" id="h0-0-35" class="i">+
</a><a href="#h0-0-36" id="h0-0-36" class="i">+super + ctrl + r
</a><a href="#h0-0-37" id="h0-0-37" class="i">+  waitron group_remove_window
</a><a href="#h0-0-38" id="h0-0-38" class="i">+
</a><a href="#h0-0-39" id="h0-0-39" class="i">+super + Return
</a><a href="#h0-0-40" id="h0-0-40" class="i">+  urxvt
</a><b>diff --git a/<a id="h1" href="../file/.xinitrc.html">.xinitrc</a> b/<a href="../file/.xinitrc.html">.xinitrc</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1,3 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+sxhkd -c .sxhkdrc &amp;
</a><a href="#h1-0-1" id="h1-0-1" class="i">+
</a><a href="#h1-0-2" id="h1-0-2" class="i">+exec ./stwm
</a><b>diff --git a/<a id="h2" href="../file/LICENSE.html">LICENSE</a> b/<a href="../file/LICENSE.html">LICENSE</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,16 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+ISC License
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+Copyright (c) 2016, Tudor Roman &lt;tudurom@gmail.com&gt;
</a><a href="#h2-0-3" id="h2-0-3" class="i">+
</a><a href="#h2-0-4" id="h2-0-4" class="i">+Permission to use, copy, modify, and/or distribute this software for
</a><a href="#h2-0-5" id="h2-0-5" class="i">+any purpose with or without fee is hereby granted, provided that the
</a><a href="#h2-0-6" id="h2-0-6" class="i">+above copyright notice and this permission notice appear in all
</a><a href="#h2-0-7" id="h2-0-7" class="i">+copies.
</a><a href="#h2-0-8" id="h2-0-8" class="i">+
</a><a href="#h2-0-9" id="h2-0-9" class="i">+THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ISC DISCLAIMS ALL WARRANTIES WITH
</a><a href="#h2-0-10" id="h2-0-10" class="i">+REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
</a><a href="#h2-0-11" id="h2-0-11" class="i">+MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL ISC BE LIABLE FOR ANY
</a><a href="#h2-0-12" id="h2-0-12" class="i">+SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
</a><a href="#h2-0-13" id="h2-0-13" class="i">+WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
</a><a href="#h2-0-14" id="h2-0-14" class="i">+ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
</a><a href="#h2-0-15" id="h2-0-15" class="i">+OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
</a><b>diff --git a/<a id="h3" href="../file/Makefile.html">Makefile</a> b/<a href="../file/Makefile.html">Makefile</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+include config.mk
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+__NAME__ = windowchef
</a><a href="#h3-0-3" id="h3-0-3" class="i">+__NAME_CLIENT__ = waitron
</a><a href="#h3-0-4" id="h3-0-4" class="i">+NAME_DEFINES = -D__NAME__=\&quot;$(__NAME__)\&quot; \
</a><a href="#h3-0-5" id="h3-0-5" class="i">+			   -D__NAME_CLIENT__=\&quot;$(__NAME_CLIENT__)\&quot;
</a><a href="#h3-0-6" id="h3-0-6" class="i">+
</a><a href="#h3-0-7" id="h3-0-7" class="i">+SRC = list.c wm.c client.c
</a><a href="#h3-0-8" id="h3-0-8" class="i">+OBJ = $(SRC:.c=.o)
</a><a href="#h3-0-9" id="h3-0-9" class="i">+BIN = $(__NAME__) $(__NAME_CLIENT__)
</a><a href="#h3-0-10" id="h3-0-10" class="i">+CFLAGS += $(NAME_DEFINES) -DD
</a><a href="#h3-0-11" id="h3-0-11" class="i">+
</a><a href="#h3-0-12" id="h3-0-12" class="i">+all: $(BIN)
</a><a href="#h3-0-13" id="h3-0-13" class="i">+
</a><a href="#h3-0-14" id="h3-0-14" class="i">+$(__NAME__): wm.o list.o
</a><a href="#h3-0-15" id="h3-0-15" class="i">+	@echo $@
</a><a href="#h3-0-16" id="h3-0-16" class="i">+	@$(CC) -o $@ $^ $(LDFLAGS)
</a><a href="#h3-0-17" id="h3-0-17" class="i">+
</a><a href="#h3-0-18" id="h3-0-18" class="i">+$(__NAME_CLIENT__): client.o
</a><a href="#h3-0-19" id="h3-0-19" class="i">+	@echo $@
</a><a href="#h3-0-20" id="h3-0-20" class="i">+	@$(CC) -o $@ $^ $(LDFLAGS)
</a><a href="#h3-0-21" id="h3-0-21" class="i">+
</a><a href="#h3-0-22" id="h3-0-22" class="i">+%.o: %.c
</a><a href="#h3-0-23" id="h3-0-23" class="i">+	@echo $@
</a><a href="#h3-0-24" id="h3-0-24" class="i">+	@$(CC) -o $@ -c $(CFLAGS) $&lt;
</a><a href="#h3-0-25" id="h3-0-25" class="i">+
</a><a href="#h3-0-26" id="h3-0-26" class="i">+$(OBJ): common.h list.h ipc.h types.h config.h
</a><a href="#h3-0-27" id="h3-0-27" class="i">+
</a><a href="#h3-0-28" id="h3-0-28" class="i">+install: all
</a><a href="#h3-0-29" id="h3-0-29" class="i">+	install $(__NAME__) $(DESTDIR)$(PREFIX)/bin/$(__NAME__)
</a><a href="#h3-0-30" id="h3-0-30" class="i">+	install $(__NAME_CLIENT__) $(DESTDIR)$(PREFIX)/bin/$(__NAME_CLIENT__)
</a><a href="#h3-0-31" id="h3-0-31" class="i">+
</a><a href="#h3-0-32" id="h3-0-32" class="i">+clean:
</a><a href="#h3-0-33" id="h3-0-33" class="i">+	rm -f $(OBJ) $(BIN)
</a><b>diff --git a/<a id="h4" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+Windowchef
</a><a href="#h4-0-1" id="h4-0-1" class="i">+==========
</a><a href="#h4-0-2" id="h4-0-2" class="i">+
</a><a href="#h4-0-3" id="h4-0-3" class="i">+Cooking windows since 2016
</a><a href="#h4-0-4" id="h4-0-4" class="i">+--------------------------
</a><a href="#h4-0-5" id="h4-0-5" class="i">+
</a><a href="#h4-0-6" id="h4-0-6" class="i">+### Building and installing
</a><a href="#h4-0-7" id="h4-0-7" class="i">+
</a><a href="#h4-0-8" id="h4-0-8" class="i">+```bash
</a><a href="#h4-0-9" id="h4-0-9" class="i">+make
</a><a href="#h4-0-10" id="h4-0-10" class="i">+sudo make install
</a><a href="#h4-0-11" id="h4-0-11" class="i">+```
</a><b>diff --git a/<a id="h5" href="../file/TODO.md.html">TODO.md</a> b/<a href="../file/TODO.md.html">TODO.md</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+- Unlimited borders
</a><b>diff --git a/<a id="h6" href="../file/client.c.html">client.c</a> b/<a href="../file/client.c.html">client.c</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,179 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h6-0-1" id="h6-0-1" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h6-0-2" id="h6-0-2" class="i">+#include &lt;string.h&gt;
</a><a href="#h6-0-3" id="h6-0-3" class="i">+#include &lt;stdbool.h&gt;
</a><a href="#h6-0-4" id="h6-0-4" class="i">+#include &lt;xcb/xcb.h&gt;
</a><a href="#h6-0-5" id="h6-0-5" class="i">+#include &lt;err.h&gt;
</a><a href="#h6-0-6" id="h6-0-6" class="i">+#include &lt;errno.h&gt;
</a><a href="#h6-0-7" id="h6-0-7" class="i">+
</a><a href="#h6-0-8" id="h6-0-8" class="i">+#include &quot;ipc.h&quot;
</a><a href="#h6-0-9" id="h6-0-9" class="i">+
</a><a href="#h6-0-10" id="h6-0-10" class="i">+#ifndef __NAME_CLIENT__
</a><a href="#h6-0-11" id="h6-0-11" class="i">+#define __NAME_CLIENT__ &quot;client&quot;
</a><a href="#h6-0-12" id="h6-0-12" class="i">+#endif
</a><a href="#h6-0-13" id="h6-0-13" class="i">+
</a><a href="#h6-0-14" id="h6-0-14" class="i">+static bool
</a><a href="#h6-0-15" id="h6-0-15" class="i">+fn_offset(uint32_t *data, int argc, char **argv)
</a><a href="#h6-0-16" id="h6-0-16" class="i">+{
</a><a href="#h6-0-17" id="h6-0-17" class="i">+	int i = 0;
</a><a href="#h6-0-18" id="h6-0-18" class="i">+	do {
</a><a href="#h6-0-19" id="h6-0-19" class="i">+		errno = 0;
</a><a href="#h6-0-20" id="h6-0-20" class="i">+		int c = strtol(argv[i], NULL, 10);
</a><a href="#h6-0-21" id="h6-0-21" class="i">+		if (c &gt;= 0)
</a><a href="#h6-0-22" id="h6-0-22" class="i">+			data[i] = IPC_MUL_PLUS;
</a><a href="#h6-0-23" id="h6-0-23" class="i">+		else
</a><a href="#h6-0-24" id="h6-0-24" class="i">+			data[i] = IPC_MUL_MINUS;
</a><a href="#h6-0-25" id="h6-0-25" class="i">+		data[i + 2] = abs(c);
</a><a href="#h6-0-26" id="h6-0-26" class="i">+		i++;
</a><a href="#h6-0-27" id="h6-0-27" class="i">+	} while (i &lt; argc &amp;&amp; errno == 0);
</a><a href="#h6-0-28" id="h6-0-28" class="i">+
</a><a href="#h6-0-29" id="h6-0-29" class="i">+	if (errno != 0)
</a><a href="#h6-0-30" id="h6-0-30" class="i">+		return false;
</a><a href="#h6-0-31" id="h6-0-31" class="i">+	else
</a><a href="#h6-0-32" id="h6-0-32" class="i">+		return true;
</a><a href="#h6-0-33" id="h6-0-33" class="i">+}
</a><a href="#h6-0-34" id="h6-0-34" class="i">+
</a><a href="#h6-0-35" id="h6-0-35" class="i">+static bool
</a><a href="#h6-0-36" id="h6-0-36" class="i">+fn_naturals(uint32_t *data, int argc, char **argv)
</a><a href="#h6-0-37" id="h6-0-37" class="i">+{
</a><a href="#h6-0-38" id="h6-0-38" class="i">+	int i = 0;
</a><a href="#h6-0-39" id="h6-0-39" class="i">+	do {
</a><a href="#h6-0-40" id="h6-0-40" class="i">+		errno = 0;
</a><a href="#h6-0-41" id="h6-0-41" class="i">+		data[i] = strtol(argv[i], NULL, 10);
</a><a href="#h6-0-42" id="h6-0-42" class="i">+		i++;
</a><a href="#h6-0-43" id="h6-0-43" class="i">+	} while (i &lt; argc &amp;&amp; errno == 0);
</a><a href="#h6-0-44" id="h6-0-44" class="i">+
</a><a href="#h6-0-45" id="h6-0-45" class="i">+	if (errno != 0)
</a><a href="#h6-0-46" id="h6-0-46" class="i">+		return false;
</a><a href="#h6-0-47" id="h6-0-47" class="i">+	else
</a><a href="#h6-0-48" id="h6-0-48" class="i">+		return true;
</a><a href="#h6-0-49" id="h6-0-49" class="i">+}
</a><a href="#h6-0-50" id="h6-0-50" class="i">+
</a><a href="#h6-0-51" id="h6-0-51" class="i">+struct Command {
</a><a href="#h6-0-52" id="h6-0-52" class="i">+	char *string_command;
</a><a href="#h6-0-53" id="h6-0-53" class="i">+	enum IPCCommand command;
</a><a href="#h6-0-54" id="h6-0-54" class="i">+	int argc;
</a><a href="#h6-0-55" id="h6-0-55" class="i">+	bool (*handler)(uint32_t *, int , char **);
</a><a href="#h6-0-56" id="h6-0-56" class="i">+};
</a><a href="#h6-0-57" id="h6-0-57" class="i">+
</a><a href="#h6-0-58" id="h6-0-58" class="i">+/* vim-tabularize is cool, i swear */
</a><a href="#h6-0-59" id="h6-0-59" class="i">+static struct Command c[] = {
</a><a href="#h6-0-60" id="h6-0-60" class="i">+	{ &quot;window_move&quot;            , IPCWindowMove           , 2 , fn_offset   }  ,
</a><a href="#h6-0-61" id="h6-0-61" class="i">+	{ &quot;window_move_absolute&quot;   , IPCWindowMoveAbsolute   , 2 , fn_offset   }  ,
</a><a href="#h6-0-62" id="h6-0-62" class="i">+	{ &quot;window_resize&quot;          , IPCWindowResize         , 2 , fn_offset   }  ,
</a><a href="#h6-0-63" id="h6-0-63" class="i">+	{ &quot;window_resize_absolute&quot; , IPCWindowResizeAbsolute , 2 , fn_naturals }  ,
</a><a href="#h6-0-64" id="h6-0-64" class="i">+	{ &quot;window_maximize&quot;        , IPCWindowMaximize       , 0 , NULL        } ,
</a><a href="#h6-0-65" id="h6-0-65" class="i">+	{ &quot;window_hor_maximize&quot;    , IPCWindowHorMaximize    , 0 , NULL        } ,
</a><a href="#h6-0-66" id="h6-0-66" class="i">+	{ &quot;window_ver_maximize&quot;    , IPCWindowVerMaximize    , 0 , NULL        } ,
</a><a href="#h6-0-67" id="h6-0-67" class="i">+	{ &quot;window_close&quot;           , IPCWindowClose          , 0 , NULL        } ,
</a><a href="#h6-0-68" id="h6-0-68" class="i">+	{ &quot;window_put_in_grid&quot;     , IPCWindowPutInGrid      , 4 , fn_naturals } ,
</a><a href="#h6-0-69" id="h6-0-69" class="i">+	{ &quot;window_snap&quot;            , IPCWindowSnap           , 1 , fn_naturals } ,
</a><a href="#h6-0-70" id="h6-0-70" class="i">+	{ &quot;window_cycle&quot;           , IPCWindowCycle          , 0 , NULL        } ,
</a><a href="#h6-0-71" id="h6-0-71" class="i">+	{ &quot;window_rev_cycle&quot;       , IPCWindowRevCycle       , 0 , NULL        } ,
</a><a href="#h6-0-72" id="h6-0-72" class="i">+	{ &quot;group_add_window&quot;       , IPCGroupAddWindow       , 1 , fn_naturals } ,
</a><a href="#h6-0-73" id="h6-0-73" class="i">+	{ &quot;group_remove_window&quot;    , IPCGroupRemoveWindow    , 0 , NULL        } ,
</a><a href="#h6-0-74" id="h6-0-74" class="i">+	{ &quot;group_activate&quot;         , IPCGroupActivate        , 1 , fn_naturals } ,
</a><a href="#h6-0-75" id="h6-0-75" class="i">+	{ &quot;group_deactivate&quot;       , IPCGroupDeactivate      , 1 , fn_naturals } ,
</a><a href="#h6-0-76" id="h6-0-76" class="i">+	{ &quot;group_toggle&quot;           , IPCGroupToggle          , 1 , fn_naturals } ,
</a><a href="#h6-0-77" id="h6-0-77" class="i">+	{ &quot;wm_quit&quot;                , IPCWMQuit               , 1 , fn_naturals } ,
</a><a href="#h6-0-78" id="h6-0-78" class="i">+	{ &quot;wm_change_nr_of_groups&quot; , IPCWMChangeNrOfGroups   , 1 , fn_naturals } ,
</a><a href="#h6-0-79" id="h6-0-79" class="i">+
</a><a href="#h6-0-80" id="h6-0-80" class="i">+};
</a><a href="#h6-0-81" id="h6-0-81" class="i">+
</a><a href="#h6-0-82" id="h6-0-82" class="i">+xcb_connection_t *conn;
</a><a href="#h6-0-83" id="h6-0-83" class="i">+xcb_screen_t *scr;
</a><a href="#h6-0-84" id="h6-0-84" class="i">+
</a><a href="#h6-0-85" id="h6-0-85" class="i">+static void
</a><a href="#h6-0-86" id="h6-0-86" class="i">+init_xcb(xcb_connection_t **conn)
</a><a href="#h6-0-87" id="h6-0-87" class="i">+{
</a><a href="#h6-0-88" id="h6-0-88" class="i">+	*conn = xcb_connect(NULL, NULL);
</a><a href="#h6-0-89" id="h6-0-89" class="i">+	if (xcb_connection_has_error(*conn))
</a><a href="#h6-0-90" id="h6-0-90" class="i">+		errx(EXIT_FAILURE, &quot;unable to connect to X server&quot;);
</a><a href="#h6-0-91" id="h6-0-91" class="i">+	scr = xcb_setup_roots_iterator(xcb_get_setup(*conn)).data;
</a><a href="#h6-0-92" id="h6-0-92" class="i">+}
</a><a href="#h6-0-93" id="h6-0-93" class="i">+
</a><a href="#h6-0-94" id="h6-0-94" class="i">+static xcb_atom_t
</a><a href="#h6-0-95" id="h6-0-95" class="i">+get_atom(char *name)
</a><a href="#h6-0-96" id="h6-0-96" class="i">+{
</a><a href="#h6-0-97" id="h6-0-97" class="i">+	xcb_intern_atom_cookie_t cookie = xcb_intern_atom(conn, 0, strlen(name), name);
</a><a href="#h6-0-98" id="h6-0-98" class="i">+	xcb_intern_atom_reply_t *reply = xcb_intern_atom_reply(conn, cookie, NULL);
</a><a href="#h6-0-99" id="h6-0-99" class="i">+
</a><a href="#h6-0-100" id="h6-0-100" class="i">+	if (!reply)
</a><a href="#h6-0-101" id="h6-0-101" class="i">+		return XCB_ATOM_STRING;
</a><a href="#h6-0-102" id="h6-0-102" class="i">+
</a><a href="#h6-0-103" id="h6-0-103" class="i">+	return reply-&gt;atom;
</a><a href="#h6-0-104" id="h6-0-104" class="i">+}
</a><a href="#h6-0-105" id="h6-0-105" class="i">+
</a><a href="#h6-0-106" id="h6-0-106" class="i">+static void
</a><a href="#h6-0-107" id="h6-0-107" class="i">+send_command(struct Command *c, int argc, char **argv)
</a><a href="#h6-0-108" id="h6-0-108" class="i">+{
</a><a href="#h6-0-109" id="h6-0-109" class="i">+	xcb_client_message_event_t msg;
</a><a href="#h6-0-110" id="h6-0-110" class="i">+	xcb_client_message_data_t data;
</a><a href="#h6-0-111" id="h6-0-111" class="i">+	xcb_generic_error_t *err;
</a><a href="#h6-0-112" id="h6-0-112" class="i">+	xcb_void_cookie_t cookie;
</a><a href="#h6-0-113" id="h6-0-113" class="i">+	bool status = true;
</a><a href="#h6-0-114" id="h6-0-114" class="i">+	size_t str_size;
</a><a href="#h6-0-115" id="h6-0-115" class="i">+
</a><a href="#h6-0-116" id="h6-0-116" class="i">+	msg.response_type = XCB_CLIENT_MESSAGE;
</a><a href="#h6-0-117" id="h6-0-117" class="i">+	msg.type = get_atom(ATOM_COMMAND);
</a><a href="#h6-0-118" id="h6-0-118" class="i">+	msg.format = 32;
</a><a href="#h6-0-119" id="h6-0-119" class="i">+	data.data32[0] = c-&gt;command;
</a><a href="#h6-0-120" id="h6-0-120" class="i">+	if (c-&gt;handler != NULL)
</a><a href="#h6-0-121" id="h6-0-121" class="i">+		status = (c-&gt;handler)(data.data32 + 1, argc, argv);
</a><a href="#h6-0-122" id="h6-0-122" class="i">+	if (status == false)
</a><a href="#h6-0-123" id="h6-0-123" class="i">+		errx(EXIT_FAILURE, &quot;malformed input&quot;);
</a><a href="#h6-0-124" id="h6-0-124" class="i">+
</a><a href="#h6-0-125" id="h6-0-125" class="i">+	msg.data = data;
</a><a href="#h6-0-126" id="h6-0-126" class="i">+
</a><a href="#h6-0-127" id="h6-0-127" class="i">+	cookie = xcb_send_event_checked(conn, false, scr-&gt;root,
</a><a href="#h6-0-128" id="h6-0-128" class="i">+			XCB_EVENT_MASK_SUBSTRUCTURE_REDIRECT, (char *)&amp;msg);
</a><a href="#h6-0-129" id="h6-0-129" class="i">+
</a><a href="#h6-0-130" id="h6-0-130" class="i">+	err = xcb_request_check(conn, cookie);
</a><a href="#h6-0-131" id="h6-0-131" class="i">+	if (err)
</a><a href="#h6-0-132" id="h6-0-132" class="i">+		fprintf(stderr, &quot;oops %d\n&quot;, err-&gt;error_code);
</a><a href="#h6-0-133" id="h6-0-133" class="i">+	xcb_flush(conn);
</a><a href="#h6-0-134" id="h6-0-134" class="i">+}
</a><a href="#h6-0-135" id="h6-0-135" class="i">+
</a><a href="#h6-0-136" id="h6-0-136" class="i">+void
</a><a href="#h6-0-137" id="h6-0-137" class="i">+usage()
</a><a href="#h6-0-138" id="h6-0-138" class="i">+{
</a><a href="#h6-0-139" id="h6-0-139" class="i">+	fprintf(stderr, &quot;Usage: %s &lt;command&gt; [args]...\n&quot;, __NAME_CLIENT__);
</a><a href="#h6-0-140" id="h6-0-140" class="i">+
</a><a href="#h6-0-141" id="h6-0-141" class="i">+	exit(1);
</a><a href="#h6-0-142" id="h6-0-142" class="i">+}
</a><a href="#h6-0-143" id="h6-0-143" class="i">+
</a><a href="#h6-0-144" id="h6-0-144" class="i">+int main(int argc, char **argv)
</a><a href="#h6-0-145" id="h6-0-145" class="i">+{
</a><a href="#h6-0-146" id="h6-0-146" class="i">+	int i;
</a><a href="#h6-0-147" id="h6-0-147" class="i">+	int command_argc;
</a><a href="#h6-0-148" id="h6-0-148" class="i">+	char **command_argv;
</a><a href="#h6-0-149" id="h6-0-149" class="i">+	init_xcb(&amp;conn);
</a><a href="#h6-0-150" id="h6-0-150" class="i">+
</a><a href="#h6-0-151" id="h6-0-151" class="i">+	if (argc == 1)
</a><a href="#h6-0-152" id="h6-0-152" class="i">+		usage();
</a><a href="#h6-0-153" id="h6-0-153" class="i">+
</a><a href="#h6-0-154" id="h6-0-154" class="i">+	/* argc - program name - command to send */
</a><a href="#h6-0-155" id="h6-0-155" class="i">+	command_argc = argc - 2;
</a><a href="#h6-0-156" id="h6-0-156" class="i">+	command_argv = argv + 2;
</a><a href="#h6-0-157" id="h6-0-157" class="i">+
</a><a href="#h6-0-158" id="h6-0-158" class="i">+	i = 0;
</a><a href="#h6-0-159" id="h6-0-159" class="i">+	while (i &lt; NR_IPC_COMMANDS &amp;&amp; strcmp(argv[1], c[i].string_command) != 0)
</a><a href="#h6-0-160" id="h6-0-160" class="i">+		i++;
</a><a href="#h6-0-161" id="h6-0-161" class="i">+
</a><a href="#h6-0-162" id="h6-0-162" class="i">+	if (i &lt; NR_IPC_COMMANDS) {
</a><a href="#h6-0-163" id="h6-0-163" class="i">+		if (command_argc &lt; c[i].argc)
</a><a href="#h6-0-164" id="h6-0-164" class="i">+			errx(EXIT_FAILURE, &quot;not enough argmuents&quot;);
</a><a href="#h6-0-165" id="h6-0-165" class="i">+		else if (command_argc &gt; c[i].argc)
</a><a href="#h6-0-166" id="h6-0-166" class="i">+			warnx(&quot;too many arguments&quot;);
</a><a href="#h6-0-167" id="h6-0-167" class="i">+		else
</a><a href="#h6-0-168" id="h6-0-168" class="i">+			send_command(&amp;c[i], command_argc, command_argv);
</a><a href="#h6-0-169" id="h6-0-169" class="i">+
</a><a href="#h6-0-170" id="h6-0-170" class="i">+	} else {
</a><a href="#h6-0-171" id="h6-0-171" class="i">+		errx(EXIT_FAILURE, &quot;no such command&quot;);
</a><a href="#h6-0-172" id="h6-0-172" class="i">+	}
</a><a href="#h6-0-173" id="h6-0-173" class="i">+
</a><a href="#h6-0-174" id="h6-0-174" class="i">+	if (conn != NULL)
</a><a href="#h6-0-175" id="h6-0-175" class="i">+		xcb_disconnect(conn);
</a><a href="#h6-0-176" id="h6-0-176" class="i">+
</a><a href="#h6-0-177" id="h6-0-177" class="i">+	return 0;
</a><a href="#h6-0-178" id="h6-0-178" class="i">+}
</a><b>diff --git a/<a id="h7" href="../file/common.h.html">common.h</a> b/<a href="../file/common.h.html">common.h</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+#ifndef _COMMON_H
</a><a href="#h7-0-1" id="h7-0-1" class="i">+#define _COMMON_H
</a><a href="#h7-0-2" id="h7-0-2" class="i">+
</a><a href="#h7-0-3" id="h7-0-3" class="i">+#ifdef D
</a><a href="#h7-0-4" id="h7-0-4" class="i">+#define DMSG(fmt, ...) fprintf(stderr, fmt, ##__VA_ARGS__)
</a><a href="#h7-0-5" id="h7-0-5" class="i">+#else
</a><a href="#h7-0-6" id="h7-0-6" class="i">+#define DMSG
</a><a href="#h7-0-7" id="h7-0-7" class="i">+#endif
</a><a href="#h7-0-8" id="h7-0-8" class="i">+
</a><a href="#h7-0-9" id="h7-0-9" class="i">+#endif
</a><b>diff --git a/<a id="h8" href="../file/config.h.html">config.h</a> b/<a href="../file/config.h.html">config.h</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+#ifndef _CONFIG_H
</a><a href="#h8-0-1" id="h8-0-1" class="i">+#define _CONFIG_H
</a><a href="#h8-0-2" id="h8-0-2" class="i">+
</a><a href="#h8-0-3" id="h8-0-3" class="i">+#define BORDER_WIDTH 3
</a><a href="#h8-0-4" id="h8-0-4" class="i">+#define COLOR_FOCUS 0x3d637d
</a><a href="#h8-0-5" id="h8-0-5" class="i">+#define COLOR_UNFOCUS 0x003b4f
</a><a href="#h8-0-6" id="h8-0-6" class="i">+#define GAP 20
</a><a href="#h8-0-7" id="h8-0-7" class="i">+#define CURSOR_POSITION CENTER
</a><a href="#h8-0-8" id="h8-0-8" class="i">+#define GROUPS 4
</a><a href="#h8-0-9" id="h8-0-9" class="i">+
</a><a href="#h8-0-10" id="h8-0-10" class="i">+#endif
</a><b>diff --git a/<a id="h9" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,6 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+PREFIX = /usr/local
</a><a href="#h9-0-1" id="h9-0-1" class="i">+MANPREFIX = /usr/local/share
</a><a href="#h9-0-2" id="h9-0-2" class="i">+MANDIR = $(MANPREFIX)/man/man1
</a><a href="#h9-0-3" id="h9-0-3" class="i">+
</a><a href="#h9-0-4" id="h9-0-4" class="i">+CFLAGS += -std=c99 -Wextra -g
</a><a href="#h9-0-5" id="h9-0-5" class="i">+LDFLAGS += -lxcb -lxcb-ewmh -lxcb-icccm -lxcb-randr
</a><b>diff --git a/<a id="h10" href="../file/ipc.h.html">ipc.h</a> b/<a href="../file/ipc.h.html">ipc.h</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,40 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+#ifndef _WM_IPC_H
</a><a href="#h10-0-1" id="h10-0-1" class="i">+#define _WM_IPC_H
</a><a href="#h10-0-2" id="h10-0-2" class="i">+
</a><a href="#h10-0-3" id="h10-0-3" class="i">+#define ATOM_COMMAND &quot;__WM_IPC_COMMAND&quot;
</a><a href="#h10-0-4" id="h10-0-4" class="i">+
</a><a href="#h10-0-5" id="h10-0-5" class="i">+#define IPC_MUL_PLUS 0
</a><a href="#h10-0-6" id="h10-0-6" class="i">+#define IPC_MUL_MINUS 1
</a><a href="#h10-0-7" id="h10-0-7" class="i">+
</a><a href="#h10-0-8" id="h10-0-8" class="i">+enum IPCCommand {
</a><a href="#h10-0-9" id="h10-0-9" class="i">+	IPCWindowMove,
</a><a href="#h10-0-10" id="h10-0-10" class="i">+	IPCWindowMoveAbsolute,
</a><a href="#h10-0-11" id="h10-0-11" class="i">+	IPCWindowResize,
</a><a href="#h10-0-12" id="h10-0-12" class="i">+	IPCWindowResizeAbsolute,
</a><a href="#h10-0-13" id="h10-0-13" class="i">+	IPCWindowMaximize,
</a><a href="#h10-0-14" id="h10-0-14" class="i">+	IPCWindowHorMaximize,
</a><a href="#h10-0-15" id="h10-0-15" class="i">+	IPCWindowVerMaximize,
</a><a href="#h10-0-16" id="h10-0-16" class="i">+	IPCWindowClose,
</a><a href="#h10-0-17" id="h10-0-17" class="i">+	IPCWindowPutInGrid,
</a><a href="#h10-0-18" id="h10-0-18" class="i">+	IPCWindowSnap,
</a><a href="#h10-0-19" id="h10-0-19" class="i">+	IPCWindowCycle,
</a><a href="#h10-0-20" id="h10-0-20" class="i">+	IPCWindowRevCycle,
</a><a href="#h10-0-21" id="h10-0-21" class="i">+	IPCGroupAddWindow,
</a><a href="#h10-0-22" id="h10-0-22" class="i">+	IPCGroupRemoveWindow,
</a><a href="#h10-0-23" id="h10-0-23" class="i">+	IPCGroupActivate,
</a><a href="#h10-0-24" id="h10-0-24" class="i">+	IPCGroupDeactivate,
</a><a href="#h10-0-25" id="h10-0-25" class="i">+	IPCGroupToggle,
</a><a href="#h10-0-26" id="h10-0-26" class="i">+	IPCWMQuit,
</a><a href="#h10-0-27" id="h10-0-27" class="i">+	IPCWMChangeNrOfGroups,
</a><a href="#h10-0-28" id="h10-0-28" class="i">+	NR_IPC_COMMANDS,
</a><a href="#h10-0-29" id="h10-0-29" class="i">+};
</a><a href="#h10-0-30" id="h10-0-30" class="i">+
</a><a href="#h10-0-31" id="h10-0-31" class="i">+enum SnapPosition {
</a><a href="#h10-0-32" id="h10-0-32" class="i">+	SnapTopLeft = 0,
</a><a href="#h10-0-33" id="h10-0-33" class="i">+	SnapTopRight,
</a><a href="#h10-0-34" id="h10-0-34" class="i">+	SnapBottomLeft,
</a><a href="#h10-0-35" id="h10-0-35" class="i">+	SnapBottomRight,
</a><a href="#h10-0-36" id="h10-0-36" class="i">+	SnapMiddle,
</a><a href="#h10-0-37" id="h10-0-37" class="i">+};
</a><a href="#h10-0-38" id="h10-0-38" class="i">+
</a><a href="#h10-0-39" id="h10-0-39" class="i">+#endif
</a><b>diff --git a/<a id="h11" href="../file/list.c.html">list.c</a> b/<a href="../file/list.c.html">list.c</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,88 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h11-0-1" id="h11-0-1" class="i">+
</a><a href="#h11-0-2" id="h11-0-2" class="i">+#include &quot;list.h&quot;
</a><a href="#h11-0-3" id="h11-0-3" class="i">+
</a><a href="#h11-0-4" id="h11-0-4" class="i">+/*
</a><a href="#h11-0-5" id="h11-0-5" class="i">+ * Move list item to the beginning (head) of the list.
</a><a href="#h11-0-6" id="h11-0-6" class="i">+ */
</a><a href="#h11-0-7" id="h11-0-7" class="i">+
</a><a href="#h11-0-8" id="h11-0-8" class="i">+void
</a><a href="#h11-0-9" id="h11-0-9" class="i">+list_move_to_head(struct list_item **list, struct list_item *item)
</a><a href="#h11-0-10" id="h11-0-10" class="i">+{
</a><a href="#h11-0-11" id="h11-0-11" class="i">+	if (list == NULL || *list == NULL || *list == item || item == NULL)
</a><a href="#h11-0-12" id="h11-0-12" class="i">+		return;
</a><a href="#h11-0-13" id="h11-0-13" class="i">+
</a><a href="#h11-0-14" id="h11-0-14" class="i">+	/* fill the hole */
</a><a href="#h11-0-15" id="h11-0-15" class="i">+	item-&gt;prev-&gt;next = item-&gt;next;
</a><a href="#h11-0-16" id="h11-0-16" class="i">+	item-&gt;next-&gt;prev = item-&gt;prev;
</a><a href="#h11-0-17" id="h11-0-17" class="i">+
</a><a href="#h11-0-18" id="h11-0-18" class="i">+	/* we are at the head, nothing is behind us now */
</a><a href="#h11-0-19" id="h11-0-19" class="i">+	item-&gt;prev = NULL;
</a><a href="#h11-0-20" id="h11-0-20" class="i">+	item-&gt;next = *list;
</a><a href="#h11-0-21" id="h11-0-21" class="i">+	item-&gt;next-&gt;prev = item;
</a><a href="#h11-0-22" id="h11-0-22" class="i">+	*list = item;
</a><a href="#h11-0-23" id="h11-0-23" class="i">+}
</a><a href="#h11-0-24" id="h11-0-24" class="i">+
</a><a href="#h11-0-25" id="h11-0-25" class="i">+/*
</a><a href="#h11-0-26" id="h11-0-26" class="i">+ * Allocate item at the head of the list.
</a><a href="#h11-0-27" id="h11-0-27" class="i">+ */
</a><a href="#h11-0-28" id="h11-0-28" class="i">+
</a><a href="#h11-0-29" id="h11-0-29" class="i">+struct list_item*
</a><a href="#h11-0-30" id="h11-0-30" class="i">+list_add_item(struct list_item **list)
</a><a href="#h11-0-31" id="h11-0-31" class="i">+{
</a><a href="#h11-0-32" id="h11-0-32" class="i">+	struct list_item *item;
</a><a href="#h11-0-33" id="h11-0-33" class="i">+
</a><a href="#h11-0-34" id="h11-0-34" class="i">+	item = malloc(sizeof(struct list_item));
</a><a href="#h11-0-35" id="h11-0-35" class="i">+	if (item == NULL)
</a><a href="#h11-0-36" id="h11-0-36" class="i">+		return NULL;
</a><a href="#h11-0-37" id="h11-0-37" class="i">+
</a><a href="#h11-0-38" id="h11-0-38" class="i">+	if (*list == NULL) {
</a><a href="#h11-0-39" id="h11-0-39" class="i">+		item-&gt;prev = item-&gt;next = NULL;
</a><a href="#h11-0-40" id="h11-0-40" class="i">+	} else {
</a><a href="#h11-0-41" id="h11-0-41" class="i">+		item-&gt;prev = NULL;
</a><a href="#h11-0-42" id="h11-0-42" class="i">+		item-&gt;next = *list;
</a><a href="#h11-0-43" id="h11-0-43" class="i">+		item-&gt;next-&gt;prev = item;
</a><a href="#h11-0-44" id="h11-0-44" class="i">+	}
</a><a href="#h11-0-45" id="h11-0-45" class="i">+
</a><a href="#h11-0-46" id="h11-0-46" class="i">+	*list = item;
</a><a href="#h11-0-47" id="h11-0-47" class="i">+
</a><a href="#h11-0-48" id="h11-0-48" class="i">+	return item;
</a><a href="#h11-0-49" id="h11-0-49" class="i">+}
</a><a href="#h11-0-50" id="h11-0-50" class="i">+
</a><a href="#h11-0-51" id="h11-0-51" class="i">+/*
</a><a href="#h11-0-52" id="h11-0-52" class="i">+ * Delete item from the list.
</a><a href="#h11-0-53" id="h11-0-53" class="i">+ * Data must be freed manually.
</a><a href="#h11-0-54" id="h11-0-54" class="i">+ */
</a><a href="#h11-0-55" id="h11-0-55" class="i">+
</a><a href="#h11-0-56" id="h11-0-56" class="i">+void
</a><a href="#h11-0-57" id="h11-0-57" class="i">+list_delete_item(struct list_item **list, struct list_item *item)
</a><a href="#h11-0-58" id="h11-0-58" class="i">+{
</a><a href="#h11-0-59" id="h11-0-59" class="i">+	if (list == NULL || *list == NULL || item == NULL)
</a><a href="#h11-0-60" id="h11-0-60" class="i">+		return;
</a><a href="#h11-0-61" id="h11-0-61" class="i">+
</a><a href="#h11-0-62" id="h11-0-62" class="i">+	if (*list == item) {
</a><a href="#h11-0-63" id="h11-0-63" class="i">+		*list = item-&gt;next;
</a><a href="#h11-0-64" id="h11-0-64" class="i">+	} else {
</a><a href="#h11-0-65" id="h11-0-65" class="i">+		item-&gt;prev-&gt;next = item-&gt;next;
</a><a href="#h11-0-66" id="h11-0-66" class="i">+		if (item-&gt;next != NULL)
</a><a href="#h11-0-67" id="h11-0-67" class="i">+			item-&gt;next-&gt;prev = item-&gt;prev;
</a><a href="#h11-0-68" id="h11-0-68" class="i">+	}
</a><a href="#h11-0-69" id="h11-0-69" class="i">+
</a><a href="#h11-0-70" id="h11-0-70" class="i">+	free(item);
</a><a href="#h11-0-71" id="h11-0-71" class="i">+}
</a><a href="#h11-0-72" id="h11-0-72" class="i">+
</a><a href="#h11-0-73" id="h11-0-73" class="i">+/*
</a><a href="#h11-0-74" id="h11-0-74" class="i">+ * Deletes a whole list.
</a><a href="#h11-0-75" id="h11-0-75" class="i">+ */
</a><a href="#h11-0-76" id="h11-0-76" class="i">+
</a><a href="#h11-0-77" id="h11-0-77" class="i">+void
</a><a href="#h11-0-78" id="h11-0-78" class="i">+list_delete_all_items(struct list_item **list)
</a><a href="#h11-0-79" id="h11-0-79" class="i">+{
</a><a href="#h11-0-80" id="h11-0-80" class="i">+	struct list_item *item, *next;
</a><a href="#h11-0-81" id="h11-0-81" class="i">+
</a><a href="#h11-0-82" id="h11-0-82" class="i">+	for (item = *list; item-&gt;next != NULL; item = next) {
</a><a href="#h11-0-83" id="h11-0-83" class="i">+		next = item-&gt;next;
</a><a href="#h11-0-84" id="h11-0-84" class="i">+		free(item-&gt;data);
</a><a href="#h11-0-85" id="h11-0-85" class="i">+		list_delete_item(list, item);
</a><a href="#h11-0-86" id="h11-0-86" class="i">+	}
</a><a href="#h11-0-87" id="h11-0-87" class="i">+}
</a><b>diff --git a/<a id="h12" href="../file/list.h.html">list.h</a> b/<a href="../file/list.h.html">list.h</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,15 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+#ifndef _LIST_H
</a><a href="#h12-0-1" id="h12-0-1" class="i">+#define _LIST_H
</a><a href="#h12-0-2" id="h12-0-2" class="i">+
</a><a href="#h12-0-3" id="h12-0-3" class="i">+struct list_item {
</a><a href="#h12-0-4" id="h12-0-4" class="i">+	void *data;
</a><a href="#h12-0-5" id="h12-0-5" class="i">+	struct list_item *prev;
</a><a href="#h12-0-6" id="h12-0-6" class="i">+	struct list_item *next;
</a><a href="#h12-0-7" id="h12-0-7" class="i">+};
</a><a href="#h12-0-8" id="h12-0-8" class="i">+
</a><a href="#h12-0-9" id="h12-0-9" class="i">+void list_move_to_head(struct list_item **, struct list_item *);
</a><a href="#h12-0-10" id="h12-0-10" class="i">+struct list_item* list_add_item(struct list_item **);
</a><a href="#h12-0-11" id="h12-0-11" class="i">+void list_delete_item(struct list_item **, struct list_item *);
</a><a href="#h12-0-12" id="h12-0-12" class="i">+void list_delete_all_items(struct list_item **);
</a><a href="#h12-0-13" id="h12-0-13" class="i">+
</a><a href="#h12-0-14" id="h12-0-14" class="i">+#endif
</a><b>diff --git a/<a id="h13" href="../file/types.h.html">types.h</a> b/<a href="../file/types.h.html">types.h</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,46 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+#ifndef _TYPES_H
</a><a href="#h13-0-1" id="h13-0-1" class="i">+#define _TYPES_H
</a><a href="#h13-0-2" id="h13-0-2" class="i">+
</a><a href="#h13-0-3" id="h13-0-3" class="i">+enum cursor_position {
</a><a href="#h13-0-4" id="h13-0-4" class="i">+	BOTTOM_LEFT,
</a><a href="#h13-0-5" id="h13-0-5" class="i">+	BOTTOM_RIGHT,
</a><a href="#h13-0-6" id="h13-0-6" class="i">+	TOP_LEFT,
</a><a href="#h13-0-7" id="h13-0-7" class="i">+	TOP_RIGHT,
</a><a href="#h13-0-8" id="h13-0-8" class="i">+	CENTER
</a><a href="#h13-0-9" id="h13-0-9" class="i">+};
</a><a href="#h13-0-10" id="h13-0-10" class="i">+
</a><a href="#h13-0-11" id="h13-0-11" class="i">+struct window_geom {
</a><a href="#h13-0-12" id="h13-0-12" class="i">+    int16_t x, y;
</a><a href="#h13-0-13" id="h13-0-13" class="i">+    uint16_t width, height;
</a><a href="#h13-0-14" id="h13-0-14" class="i">+    bool set_by_user;
</a><a href="#h13-0-15" id="h13-0-15" class="i">+};
</a><a href="#h13-0-16" id="h13-0-16" class="i">+
</a><a href="#h13-0-17" id="h13-0-17" class="i">+struct client {
</a><a href="#h13-0-18" id="h13-0-18" class="i">+    xcb_window_t window;
</a><a href="#h13-0-19" id="h13-0-19" class="i">+    struct window_geom geom;
</a><a href="#h13-0-20" id="h13-0-20" class="i">+    struct window_geom orig_geom;
</a><a href="#h13-0-21" id="h13-0-21" class="i">+    bool maxed, hmaxed, vmaxed;
</a><a href="#h13-0-22" id="h13-0-22" class="i">+    struct list_item *item;
</a><a href="#h13-0-23" id="h13-0-23" class="i">+    struct monitor *monitor;
</a><a href="#h13-0-24" id="h13-0-24" class="i">+    uint16_t min_width, min_height;
</a><a href="#h13-0-25" id="h13-0-25" class="i">+    uint16_t max_width, max_height;
</a><a href="#h13-0-26" id="h13-0-26" class="i">+    bool mapped;
</a><a href="#h13-0-27" id="h13-0-27" class="i">+    uint32_t group;
</a><a href="#h13-0-28" id="h13-0-28" class="i">+};
</a><a href="#h13-0-29" id="h13-0-29" class="i">+
</a><a href="#h13-0-30" id="h13-0-30" class="i">+struct monitor {
</a><a href="#h13-0-31" id="h13-0-31" class="i">+    xcb_randr_output_t monitor;
</a><a href="#h13-0-32" id="h13-0-32" class="i">+    char *name;
</a><a href="#h13-0-33" id="h13-0-33" class="i">+    int16_t x, y;
</a><a href="#h13-0-34" id="h13-0-34" class="i">+    uint16_t width, height;
</a><a href="#h13-0-35" id="h13-0-35" class="i">+    struct list_item *item;
</a><a href="#h13-0-36" id="h13-0-36" class="i">+};
</a><a href="#h13-0-37" id="h13-0-37" class="i">+
</a><a href="#h13-0-38" id="h13-0-38" class="i">+struct conf {
</a><a href="#h13-0-39" id="h13-0-39" class="i">+    int8_t border_width, gap;
</a><a href="#h13-0-40" id="h13-0-40" class="i">+    uint32_t focus_color, unfocus_color;
</a><a href="#h13-0-41" id="h13-0-41" class="i">+    enum cursor_position cursor_position;
</a><a href="#h13-0-42" id="h13-0-42" class="i">+    uint32_t groups;
</a><a href="#h13-0-43" id="h13-0-43" class="i">+};
</a><a href="#h13-0-44" id="h13-0-44" class="i">+
</a><a href="#h13-0-45" id="h13-0-45" class="i">+#endif
</a><b>diff --git a/<a id="h14" href="../file/wm.c.html">wm.c</a> b/<a href="../file/wm.c.html">wm.c</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,2021 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+#include &lt;xcb/xcb.h&gt;
</a><a href="#h14-0-1" id="h14-0-1" class="i">+#include &lt;xcb/xcb_icccm.h&gt;
</a><a href="#h14-0-2" id="h14-0-2" class="i">+#include &lt;xcb/xcb_ewmh.h&gt;
</a><a href="#h14-0-3" id="h14-0-3" class="i">+#include &lt;xcb/randr.h&gt;
</a><a href="#h14-0-4" id="h14-0-4" class="i">+
</a><a href="#h14-0-5" id="h14-0-5" class="i">+#include &lt;assert.h&gt;
</a><a href="#h14-0-6" id="h14-0-6" class="i">+#include &lt;err.h&gt;
</a><a href="#h14-0-7" id="h14-0-7" class="i">+#include &lt;stdbool.h&gt;
</a><a href="#h14-0-8" id="h14-0-8" class="i">+#include &lt;stdio.h&gt;
</a><a href="#h14-0-9" id="h14-0-9" class="i">+#include &lt;stdlib.h&gt;
</a><a href="#h14-0-10" id="h14-0-10" class="i">+#include &lt;string.h&gt;
</a><a href="#h14-0-11" id="h14-0-11" class="i">+#include &lt;unistd.h&gt;
</a><a href="#h14-0-12" id="h14-0-12" class="i">+
</a><a href="#h14-0-13" id="h14-0-13" class="i">+#include &quot;common.h&quot;
</a><a href="#h14-0-14" id="h14-0-14" class="i">+#include &quot;ipc.h&quot;
</a><a href="#h14-0-15" id="h14-0-15" class="i">+#include &quot;list.h&quot;
</a><a href="#h14-0-16" id="h14-0-16" class="i">+#include &quot;types.h&quot;
</a><a href="#h14-0-17" id="h14-0-17" class="i">+#include &quot;config.h&quot;
</a><a href="#h14-0-18" id="h14-0-18" class="i">+
</a><a href="#h14-0-19" id="h14-0-19" class="i">+#ifndef __NAME__
</a><a href="#h14-0-20" id="h14-0-20" class="i">+#define __NAME__ &quot;wm&quot;
</a><a href="#h14-0-21" id="h14-0-21" class="i">+#endif
</a><a href="#h14-0-22" id="h14-0-22" class="i">+
</a><a href="#h14-0-23" id="h14-0-23" class="i">+#define EVENT_MASK(ev) ((ev &amp; ~0x80))
</a><a href="#h14-0-24" id="h14-0-24" class="i">+/* XCB event with the biggest values */
</a><a href="#h14-0-25" id="h14-0-25" class="i">+#define LAST_XCB_EVENT XCB_GET_MODIFIER_MAPPING
</a><a href="#h14-0-26" id="h14-0-26" class="i">+#define NULL_GROUP 0xffffffff
</a><a href="#h14-0-27" id="h14-0-27" class="i">+
</a><a href="#h14-0-28" id="h14-0-28" class="i">+/* atoms identifiers */
</a><a href="#h14-0-29" id="h14-0-29" class="i">+enum { WM_DELETE_WINDOW, _IPC_ATOM_COMMAND, NR_ATOMS };
</a><a href="#h14-0-30" id="h14-0-30" class="i">+
</a><a href="#h14-0-31" id="h14-0-31" class="i">+/* connection to the X server */
</a><a href="#h14-0-32" id="h14-0-32" class="i">+static xcb_connection_t *conn;
</a><a href="#h14-0-33" id="h14-0-33" class="i">+static xcb_ewmh_connection_t*ewmh;
</a><a href="#h14-0-34" id="h14-0-34" class="i">+static xcb_screen_t *scr;
</a><a href="#h14-0-35" id="h14-0-35" class="i">+static struct client *focused_win;
</a><a href="#h14-0-36" id="h14-0-36" class="i">+static struct conf conf;
</a><a href="#h14-0-37" id="h14-0-37" class="i">+/* number of the screen we&apos;re using */
</a><a href="#h14-0-38" id="h14-0-38" class="i">+static int scrno;
</a><a href="#h14-0-39" id="h14-0-39" class="i">+/* base for checking randr events */
</a><a href="#h14-0-40" id="h14-0-40" class="i">+static int  randr_base;
</a><a href="#h14-0-41" id="h14-0-41" class="i">+static bool halt;
</a><a href="#h14-0-42" id="h14-0-42" class="i">+static int  exit_code;
</a><a href="#h14-0-43" id="h14-0-43" class="i">+static bool *group_in_use;
</a><a href="#h14-0-44" id="h14-0-44" class="i">+/* list of all windows. NULL is the empty list */
</a><a href="#h14-0-45" id="h14-0-45" class="i">+static struct list_item *win_list   = NULL;
</a><a href="#h14-0-46" id="h14-0-46" class="i">+static struct list_item *mon_list   = NULL;
</a><a href="#h14-0-47" id="h14-0-47" class="i">+static char *atom_names[NR_ATOMS] = {
</a><a href="#h14-0-48" id="h14-0-48" class="i">+	&quot;WM_DELETE_WINDOW&quot;,
</a><a href="#h14-0-49" id="h14-0-49" class="i">+	ATOM_COMMAND,
</a><a href="#h14-0-50" id="h14-0-50" class="i">+};
</a><a href="#h14-0-51" id="h14-0-51" class="i">+static xcb_atom_t ATOMS[NR_ATOMS];
</a><a href="#h14-0-52" id="h14-0-52" class="i">+/* function handlers for ipc commands */
</a><a href="#h14-0-53" id="h14-0-53" class="i">+static void (*ipc_handlers[NR_IPC_COMMANDS])(uint32_t *);
</a><a href="#h14-0-54" id="h14-0-54" class="i">+/* function handlers for events received from the X server */
</a><a href="#h14-0-55" id="h14-0-55" class="i">+static void (*events[LAST_XCB_EVENT + 1])(xcb_generic_event_t *);
</a><a href="#h14-0-56" id="h14-0-56" class="i">+
</a><a href="#h14-0-57" id="h14-0-57" class="i">+static void cleanup(void);
</a><a href="#h14-0-58" id="h14-0-58" class="i">+static int  setup(void);
</a><a href="#h14-0-59" id="h14-0-59" class="i">+static int  setup_randr(void);
</a><a href="#h14-0-60" id="h14-0-60" class="i">+static void get_randr(void);
</a><a href="#h14-0-61" id="h14-0-61" class="i">+static void get_outputs(xcb_randr_output_t *, int len, xcb_timestamp_t);
</a><a href="#h14-0-62" id="h14-0-62" class="i">+static struct monitor * find_monitor(xcb_randr_output_t);
</a><a href="#h14-0-63" id="h14-0-63" class="i">+static struct monitor * find_monitor_by_coord(int16_t, int16_t);
</a><a href="#h14-0-64" id="h14-0-64" class="i">+static struct monitor * find_clones(xcb_randr_output_t, int16_t, int16_t);
</a><a href="#h14-0-65" id="h14-0-65" class="i">+static struct monitor * add_monitor(xcb_randr_output_t, char *, int16_t, int16_t, uint16_t, uint16_t);
</a><a href="#h14-0-66" id="h14-0-66" class="i">+static void free_monitor(struct monitor *);
</a><a href="#h14-0-67" id="h14-0-67" class="i">+static void get_monitor_size(struct client *, int16_t *, int16_t *, uint16_t *, uint16_t *);
</a><a href="#h14-0-68" id="h14-0-68" class="i">+static void arrange_by_monitor(struct monitor *);
</a><a href="#h14-0-69" id="h14-0-69" class="i">+static void handle_events(void);
</a><a href="#h14-0-70" id="h14-0-70" class="i">+static struct client * setup_window(xcb_window_t);
</a><a href="#h14-0-71" id="h14-0-71" class="i">+static void set_focused_no_raise(struct client *);
</a><a href="#h14-0-72" id="h14-0-72" class="i">+static void set_focused(struct client *);
</a><a href="#h14-0-73" id="h14-0-73" class="i">+static void raise_window(xcb_window_t);
</a><a href="#h14-0-74" id="h14-0-74" class="i">+static void close_window(struct client *);
</a><a href="#h14-0-75" id="h14-0-75" class="i">+static void delete_window(xcb_window_t);
</a><a href="#h14-0-76" id="h14-0-76" class="i">+static void teleport_window(xcb_window_t, int16_t, int16_t);
</a><a href="#h14-0-77" id="h14-0-77" class="i">+static void move_window(xcb_window_t , int16_t, int16_t);
</a><a href="#h14-0-78" id="h14-0-78" class="i">+static void resize_window_absolute(xcb_window_t, uint16_t, uint16_t);
</a><a href="#h14-0-79" id="h14-0-79" class="i">+static void resize_window(xcb_window_t, int16_t, int16_t);
</a><a href="#h14-0-80" id="h14-0-80" class="i">+static void resize_window_limit(struct client *);
</a><a href="#h14-0-81" id="h14-0-81" class="i">+static void fit_on_screen(struct client *);
</a><a href="#h14-0-82" id="h14-0-82" class="i">+static void maximize_window(struct client *, int16_t, int16_t, uint16_t, uint16_t);
</a><a href="#h14-0-83" id="h14-0-83" class="i">+static void hmaximize_window(struct client *, int16_t, uint16_t);
</a><a href="#h14-0-84" id="h14-0-84" class="i">+static void vmaximize_window(struct client *, int16_t, uint16_t);
</a><a href="#h14-0-85" id="h14-0-85" class="i">+static void unmaximize_window(struct client *);
</a><a href="#h14-0-86" id="h14-0-86" class="i">+static void cycle_window(struct client *);
</a><a href="#h14-0-87" id="h14-0-87" class="i">+static void rcycle_window(struct client *);
</a><a href="#h14-0-88" id="h14-0-88" class="i">+static void save_original_size(struct client *);
</a><a href="#h14-0-89" id="h14-0-89" class="i">+static xcb_atom_t get_atom(char *);
</a><a href="#h14-0-90" id="h14-0-90" class="i">+static bool get_pointer_location(xcb_window_t *, int16_t *, int16_t *);
</a><a href="#h14-0-91" id="h14-0-91" class="i">+static void center_pointer(struct client *);
</a><a href="#h14-0-92" id="h14-0-92" class="i">+static struct client * find_client(xcb_window_t *);
</a><a href="#h14-0-93" id="h14-0-93" class="i">+static bool get_geometry(xcb_window_t *, int16_t *, int16_t *, uint16_t *, uint16_t *);
</a><a href="#h14-0-94" id="h14-0-94" class="i">+static void set_borders(struct client *client, uint32_t);
</a><a href="#h14-0-95" id="h14-0-95" class="i">+static bool is_mapped(xcb_window_t);
</a><a href="#h14-0-96" id="h14-0-96" class="i">+static uint16_t get_border_width(xcb_window_t);
</a><a href="#h14-0-97" id="h14-0-97" class="i">+static void free_window(struct client *);
</a><a href="#h14-0-98" id="h14-0-98" class="i">+static void add_to_client_list(xcb_window_t);
</a><a href="#h14-0-99" id="h14-0-99" class="i">+static void update_client_list(void);
</a><a href="#h14-0-100" id="h14-0-100" class="i">+static void update_wm_desktop(struct client *);
</a><a href="#h14-0-101" id="h14-0-101" class="i">+static void group_add_window(struct client *, uint32_t);
</a><a href="#h14-0-102" id="h14-0-102" class="i">+static void group_remove_window(struct client *);
</a><a href="#h14-0-103" id="h14-0-103" class="i">+static void group_activate(uint32_t);
</a><a href="#h14-0-104" id="h14-0-104" class="i">+static void group_deactivate(uint32_t);
</a><a href="#h14-0-105" id="h14-0-105" class="i">+static void group_toggle(uint32_t);
</a><a href="#h14-0-106" id="h14-0-106" class="i">+static void change_nr_of_groups(uint32_t);
</a><a href="#h14-0-107" id="h14-0-107" class="i">+static void register_event_handlers(void);
</a><a href="#h14-0-108" id="h14-0-108" class="i">+static void event_configure_request(xcb_generic_event_t *);
</a><a href="#h14-0-109" id="h14-0-109" class="i">+static void event_destroy_notify(xcb_generic_event_t *);
</a><a href="#h14-0-110" id="h14-0-110" class="i">+static void event_enter_notify(xcb_generic_event_t *);
</a><a href="#h14-0-111" id="h14-0-111" class="i">+static void event_map_request(xcb_generic_event_t *);
</a><a href="#h14-0-112" id="h14-0-112" class="i">+static void event_map_notify(xcb_generic_event_t *);
</a><a href="#h14-0-113" id="h14-0-113" class="i">+static void event_unmap_notify(xcb_generic_event_t *);
</a><a href="#h14-0-114" id="h14-0-114" class="i">+static void event_configure_notify(xcb_generic_event_t *);
</a><a href="#h14-0-115" id="h14-0-115" class="i">+static void event_circulate_request(xcb_generic_event_t *);
</a><a href="#h14-0-116" id="h14-0-116" class="i">+static void event_client_message(xcb_generic_event_t *);
</a><a href="#h14-0-117" id="h14-0-117" class="i">+static void register_ipc_handlers(void);
</a><a href="#h14-0-118" id="h14-0-118" class="i">+static void ipc_window_move(uint32_t *);
</a><a href="#h14-0-119" id="h14-0-119" class="i">+static void ipc_window_move_absolute(uint32_t *);
</a><a href="#h14-0-120" id="h14-0-120" class="i">+static void ipc_window_resize(uint32_t *);
</a><a href="#h14-0-121" id="h14-0-121" class="i">+static void ipc_window_resize_absolute(uint32_t *);
</a><a href="#h14-0-122" id="h14-0-122" class="i">+static void ipc_window_maximize(uint32_t *);
</a><a href="#h14-0-123" id="h14-0-123" class="i">+static void ipc_window_hor_maximize(uint32_t *);
</a><a href="#h14-0-124" id="h14-0-124" class="i">+static void ipc_window_ver_maximize(uint32_t *);
</a><a href="#h14-0-125" id="h14-0-125" class="i">+static void ipc_window_unmaximize(uint32_t *);
</a><a href="#h14-0-126" id="h14-0-126" class="i">+static void ipc_window_close(uint32_t *);
</a><a href="#h14-0-127" id="h14-0-127" class="i">+static void ipc_window_put_in_grid(uint32_t *);
</a><a href="#h14-0-128" id="h14-0-128" class="i">+static void ipc_window_snap(uint32_t *);
</a><a href="#h14-0-129" id="h14-0-129" class="i">+static void ipc_window_cycle(uint32_t *);
</a><a href="#h14-0-130" id="h14-0-130" class="i">+static void ipc_window_rev_cycle(uint32_t *);
</a><a href="#h14-0-131" id="h14-0-131" class="i">+static void ipc_group_add_window(uint32_t *);
</a><a href="#h14-0-132" id="h14-0-132" class="i">+static void ipc_group_remove_window(uint32_t *);
</a><a href="#h14-0-133" id="h14-0-133" class="i">+static void ipc_group_activate(uint32_t *);
</a><a href="#h14-0-134" id="h14-0-134" class="i">+static void ipc_group_deactivate(uint32_t *);
</a><a href="#h14-0-135" id="h14-0-135" class="i">+static void ipc_group_toggle(uint32_t *);
</a><a href="#h14-0-136" id="h14-0-136" class="i">+static void ipc_wm_quit(uint32_t *);
</a><a href="#h14-0-137" id="h14-0-137" class="i">+static void ipc_wm_change_nr_of_groups(uint32_t *);
</a><a href="#h14-0-138" id="h14-0-138" class="i">+
</a><a href="#h14-0-139" id="h14-0-139" class="i">+/*
</a><a href="#h14-0-140" id="h14-0-140" class="i">+ * Gracefully disconnect.
</a><a href="#h14-0-141" id="h14-0-141" class="i">+ */
</a><a href="#h14-0-142" id="h14-0-142" class="i">+
</a><a href="#h14-0-143" id="h14-0-143" class="i">+static void
</a><a href="#h14-0-144" id="h14-0-144" class="i">+cleanup(void)
</a><a href="#h14-0-145" id="h14-0-145" class="i">+{
</a><a href="#h14-0-146" id="h14-0-146" class="i">+	if (ewmh != NULL)
</a><a href="#h14-0-147" id="h14-0-147" class="i">+		xcb_ewmh_connection_wipe(ewmh);
</a><a href="#h14-0-148" id="h14-0-148" class="i">+	if (conn != NULL)
</a><a href="#h14-0-149" id="h14-0-149" class="i">+		xcb_disconnect(conn);
</a><a href="#h14-0-150" id="h14-0-150" class="i">+	if (win_list != NULL)
</a><a href="#h14-0-151" id="h14-0-151" class="i">+		list_delete_all_items(&amp;win_list);
</a><a href="#h14-0-152" id="h14-0-152" class="i">+}
</a><a href="#h14-0-153" id="h14-0-153" class="i">+
</a><a href="#h14-0-154" id="h14-0-154" class="i">+/*
</a><a href="#h14-0-155" id="h14-0-155" class="i">+ * Connect to the X server and initialize some things.
</a><a href="#h14-0-156" id="h14-0-156" class="i">+ */
</a><a href="#h14-0-157" id="h14-0-157" class="i">+
</a><a href="#h14-0-158" id="h14-0-158" class="i">+static int
</a><a href="#h14-0-159" id="h14-0-159" class="i">+setup(void)
</a><a href="#h14-0-160" id="h14-0-160" class="i">+{
</a><a href="#h14-0-161" id="h14-0-161" class="i">+	/* init xcb and grab events */
</a><a href="#h14-0-162" id="h14-0-162" class="i">+	unsigned int values[1];
</a><a href="#h14-0-163" id="h14-0-163" class="i">+	int mask;
</a><a href="#h14-0-164" id="h14-0-164" class="i">+
</a><a href="#h14-0-165" id="h14-0-165" class="i">+	conn = xcb_connect(NULL, &amp;scrno);
</a><a href="#h14-0-166" id="h14-0-166" class="i">+	if (xcb_connection_has_error(conn)) {
</a><a href="#h14-0-167" id="h14-0-167" class="i">+		return -1;
</a><a href="#h14-0-168" id="h14-0-168" class="i">+	}
</a><a href="#h14-0-169" id="h14-0-169" class="i">+
</a><a href="#h14-0-170" id="h14-0-170" class="i">+	/* get the first screen. hope it&apos;s the last one too */
</a><a href="#h14-0-171" id="h14-0-171" class="i">+	scr = xcb_setup_roots_iterator(xcb_get_setup(conn)).data;
</a><a href="#h14-0-172" id="h14-0-172" class="i">+	focused_win = NULL;
</a><a href="#h14-0-173" id="h14-0-173" class="i">+
</a><a href="#h14-0-174" id="h14-0-174" class="i">+	mask = XCB_CW_EVENT_MASK;
</a><a href="#h14-0-175" id="h14-0-175" class="i">+	values[0] = XCB_EVENT_MASK_SUBSTRUCTURE_NOTIFY | \
</a><a href="#h14-0-176" id="h14-0-176" class="i">+		XCB_EVENT_MASK_SUBSTRUCTURE_REDIRECT;
</a><a href="#h14-0-177" id="h14-0-177" class="i">+	xcb_generic_error_t *e = xcb_request_check(conn,
</a><a href="#h14-0-178" id="h14-0-178" class="i">+			xcb_change_window_attributes_checked(conn, scr-&gt;root,
</a><a href="#h14-0-179" id="h14-0-179" class="i">+				mask, values));
</a><a href="#h14-0-180" id="h14-0-180" class="i">+	if (e != NULL)
</a><a href="#h14-0-181" id="h14-0-181" class="i">+		errx(EXIT_FAILURE, &quot;Another window manager is already running.&quot;);
</a><a href="#h14-0-182" id="h14-0-182" class="i">+
</a><a href="#h14-0-183" id="h14-0-183" class="i">+	/* initialize ewmh variables */
</a><a href="#h14-0-184" id="h14-0-184" class="i">+	ewmh = calloc(1, sizeof(xcb_ewmh_connection_t));
</a><a href="#h14-0-185" id="h14-0-185" class="i">+	if (!ewmh)
</a><a href="#h14-0-186" id="h14-0-186" class="i">+		warnx(&quot;couldn&apos;t set up ewmh connection&quot;);
</a><a href="#h14-0-187" id="h14-0-187" class="i">+	xcb_intern_atom_cookie_t *cookie = xcb_ewmh_init_atoms(conn, ewmh);
</a><a href="#h14-0-188" id="h14-0-188" class="i">+	xcb_ewmh_init_atoms_replies(ewmh, cookie, (void *)0);
</a><a href="#h14-0-189" id="h14-0-189" class="i">+	xcb_ewmh_set_wm_pid(ewmh, scr-&gt;root, getpid());
</a><a href="#h14-0-190" id="h14-0-190" class="i">+	xcb_ewmh_set_wm_name(ewmh, scr-&gt;root, strlen(__NAME__), __NAME__);
</a><a href="#h14-0-191" id="h14-0-191" class="i">+	xcb_ewmh_set_current_desktop(ewmh, 0, 0);
</a><a href="#h14-0-192" id="h14-0-192" class="i">+	xcb_ewmh_set_number_of_desktops(ewmh, 0, GROUPS);
</a><a href="#h14-0-193" id="h14-0-193" class="i">+
</a><a href="#h14-0-194" id="h14-0-194" class="i">+	xcb_atom_t supported_atoms[] = {
</a><a href="#h14-0-195" id="h14-0-195" class="i">+		ewmh-&gt;_NET_SUPPORTED              , ewmh-&gt;_NET_WM_DESKTOP      ,
</a><a href="#h14-0-196" id="h14-0-196" class="i">+		ewmh-&gt;_NET_NUMBER_OF_DESKTOPS     , ewmh-&gt;_NET_CURRENT_DESKTOP ,
</a><a href="#h14-0-197" id="h14-0-197" class="i">+		ewmh-&gt;_NET_ACTIVE_WINDOW          , ewmh-&gt;_NET_WM_STATE        ,
</a><a href="#h14-0-198" id="h14-0-198" class="i">+		ewmh-&gt;_NET_WM_STATE_FULLSCREEN    , ewmh-&gt;_NET_WM_NAME         ,
</a><a href="#h14-0-199" id="h14-0-199" class="i">+		ewmh-&gt;_NET_WM_ICON_NAME           , ewmh-&gt;_NET_WM_WINDOW_TYPE  ,
</a><a href="#h14-0-200" id="h14-0-200" class="i">+		ewmh-&gt;_NET_WM_WINDOW_TYPE_DOCK    , ewmh-&gt;_NET_WM_PID          ,
</a><a href="#h14-0-201" id="h14-0-201" class="i">+		ewmh-&gt;_NET_WM_WINDOW_TYPE_TOOLBAR ,
</a><a href="#h14-0-202" id="h14-0-202" class="i">+	};
</a><a href="#h14-0-203" id="h14-0-203" class="i">+	xcb_ewmh_set_supported(ewmh, scrno, sizeof(supported_atoms) / sizeof(xcb_atom_t), supported_atoms);
</a><a href="#h14-0-204" id="h14-0-204" class="i">+
</a><a href="#h14-0-205" id="h14-0-205" class="i">+	/* send requests */
</a><a href="#h14-0-206" id="h14-0-206" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-207" id="h14-0-207" class="i">+
</a><a href="#h14-0-208" id="h14-0-208" class="i">+	/* get various atoms for icccm and ewmh */
</a><a href="#h14-0-209" id="h14-0-209" class="i">+	for (int i = 0; i &lt; NR_ATOMS; i++)
</a><a href="#h14-0-210" id="h14-0-210" class="i">+		ATOMS[i] = get_atom(atom_names[i]);
</a><a href="#h14-0-211" id="h14-0-211" class="i">+
</a><a href="#h14-0-212" id="h14-0-212" class="i">+	randr_base = setup_randr();
</a><a href="#h14-0-213" id="h14-0-213" class="i">+
</a><a href="#h14-0-214" id="h14-0-214" class="i">+	conf.border_width    = BORDER_WIDTH;
</a><a href="#h14-0-215" id="h14-0-215" class="i">+	conf.focus_color     = COLOR_FOCUS;
</a><a href="#h14-0-216" id="h14-0-216" class="i">+	conf.unfocus_color   = COLOR_UNFOCUS;
</a><a href="#h14-0-217" id="h14-0-217" class="i">+	conf.gap             = GAP;
</a><a href="#h14-0-218" id="h14-0-218" class="i">+	conf.cursor_position = CURSOR_POSITION;
</a><a href="#h14-0-219" id="h14-0-219" class="i">+	conf.groups          = GROUPS;
</a><a href="#h14-0-220" id="h14-0-220" class="i">+
</a><a href="#h14-0-221" id="h14-0-221" class="i">+	group_in_use = malloc(conf.groups * sizeof(bool));
</a><a href="#h14-0-222" id="h14-0-222" class="i">+	for (uint32_t i = 0; i &lt; conf.groups; i++)
</a><a href="#h14-0-223" id="h14-0-223" class="i">+		group_in_use[i] = false;
</a><a href="#h14-0-224" id="h14-0-224" class="i">+
</a><a href="#h14-0-225" id="h14-0-225" class="i">+	return 0;
</a><a href="#h14-0-226" id="h14-0-226" class="i">+}
</a><a href="#h14-0-227" id="h14-0-227" class="i">+
</a><a href="#h14-0-228" id="h14-0-228" class="i">+static int
</a><a href="#h14-0-229" id="h14-0-229" class="i">+setup_randr(void)
</a><a href="#h14-0-230" id="h14-0-230" class="i">+{
</a><a href="#h14-0-231" id="h14-0-231" class="i">+	int base;
</a><a href="#h14-0-232" id="h14-0-232" class="i">+	const xcb_query_extension_reply_t *r = xcb_get_extension_data(conn, &amp;xcb_randr_id);
</a><a href="#h14-0-233" id="h14-0-233" class="i">+
</a><a href="#h14-0-234" id="h14-0-234" class="i">+	if (!r-&gt;present)
</a><a href="#h14-0-235" id="h14-0-235" class="i">+		return -1;
</a><a href="#h14-0-236" id="h14-0-236" class="i">+	else
</a><a href="#h14-0-237" id="h14-0-237" class="i">+		get_randr();
</a><a href="#h14-0-238" id="h14-0-238" class="i">+
</a><a href="#h14-0-239" id="h14-0-239" class="i">+	base = r-&gt;first_event;
</a><a href="#h14-0-240" id="h14-0-240" class="i">+	xcb_randr_select_input(conn, scr-&gt;root,
</a><a href="#h14-0-241" id="h14-0-241" class="i">+			XCB_RANDR_NOTIFY_MASK_SCREEN_CHANGE
</a><a href="#h14-0-242" id="h14-0-242" class="i">+			| XCB_RANDR_NOTIFY_MASK_OUTPUT_CHANGE
</a><a href="#h14-0-243" id="h14-0-243" class="i">+			| XCB_RANDR_NOTIFY_MASK_CRTC_CHANGE
</a><a href="#h14-0-244" id="h14-0-244" class="i">+			| XCB_RANDR_NOTIFY_MASK_OUTPUT_PROPERTY);
</a><a href="#h14-0-245" id="h14-0-245" class="i">+
</a><a href="#h14-0-246" id="h14-0-246" class="i">+	return base;
</a><a href="#h14-0-247" id="h14-0-247" class="i">+}
</a><a href="#h14-0-248" id="h14-0-248" class="i">+
</a><a href="#h14-0-249" id="h14-0-249" class="i">+static void
</a><a href="#h14-0-250" id="h14-0-250" class="i">+get_randr(void)
</a><a href="#h14-0-251" id="h14-0-251" class="i">+{
</a><a href="#h14-0-252" id="h14-0-252" class="i">+	int len;
</a><a href="#h14-0-253" id="h14-0-253" class="i">+	xcb_randr_get_screen_resources_current_cookie_t c
</a><a href="#h14-0-254" id="h14-0-254" class="i">+		= xcb_randr_get_screen_resources_current(conn, scr-&gt;root);
</a><a href="#h14-0-255" id="h14-0-255" class="i">+	xcb_randr_get_screen_resources_current_reply_t *r
</a><a href="#h14-0-256" id="h14-0-256" class="i">+		= xcb_randr_get_screen_resources_current_reply(conn, c, NULL);
</a><a href="#h14-0-257" id="h14-0-257" class="i">+
</a><a href="#h14-0-258" id="h14-0-258" class="i">+	if (r == NULL)
</a><a href="#h14-0-259" id="h14-0-259" class="i">+		return;
</a><a href="#h14-0-260" id="h14-0-260" class="i">+
</a><a href="#h14-0-261" id="h14-0-261" class="i">+	xcb_timestamp_t timestamp = r-&gt;config_timestamp;
</a><a href="#h14-0-262" id="h14-0-262" class="i">+	len = xcb_randr_get_screen_resources_current_outputs_length(r);
</a><a href="#h14-0-263" id="h14-0-263" class="i">+	xcb_randr_output_t *outputs
</a><a href="#h14-0-264" id="h14-0-264" class="i">+		= xcb_randr_get_screen_resources_current_outputs(r);
</a><a href="#h14-0-265" id="h14-0-265" class="i">+
</a><a href="#h14-0-266" id="h14-0-266" class="i">+	/* Request information for all outputs */
</a><a href="#h14-0-267" id="h14-0-267" class="i">+	get_outputs(outputs, len, timestamp);
</a><a href="#h14-0-268" id="h14-0-268" class="i">+	free(r);
</a><a href="#h14-0-269" id="h14-0-269" class="i">+}
</a><a href="#h14-0-270" id="h14-0-270" class="i">+
</a><a href="#h14-0-271" id="h14-0-271" class="i">+static void
</a><a href="#h14-0-272" id="h14-0-272" class="i">+get_outputs(xcb_randr_output_t *outputs, int len, xcb_timestamp_t timestamp)
</a><a href="#h14-0-273" id="h14-0-273" class="i">+{
</a><a href="#h14-0-274" id="h14-0-274" class="i">+	int name_len;
</a><a href="#h14-0-275" id="h14-0-275" class="i">+	char *name;
</a><a href="#h14-0-276" id="h14-0-276" class="i">+	xcb_randr_get_crtc_info_cookie_t info_c;
</a><a href="#h14-0-277" id="h14-0-277" class="i">+	xcb_randr_get_crtc_info_reply_t *crtc;
</a><a href="#h14-0-278" id="h14-0-278" class="i">+	xcb_randr_get_output_info_reply_t *output;
</a><a href="#h14-0-279" id="h14-0-279" class="i">+	struct monitor *mon, *clonemon;
</a><a href="#h14-0-280" id="h14-0-280" class="i">+	struct list_item *item;
</a><a href="#h14-0-281" id="h14-0-281" class="i">+	xcb_randr_get_output_info_cookie_t out_cookie[len];
</a><a href="#h14-0-282" id="h14-0-282" class="i">+
</a><a href="#h14-0-283" id="h14-0-283" class="i">+	for (int i = 0; i &lt; len; i++)
</a><a href="#h14-0-284" id="h14-0-284" class="i">+		out_cookie[i] = xcb_randr_get_output_info(conn, outputs[i],
</a><a href="#h14-0-285" id="h14-0-285" class="i">+				timestamp);
</a><a href="#h14-0-286" id="h14-0-286" class="i">+
</a><a href="#h14-0-287" id="h14-0-287" class="i">+	for (int i = 0; i &lt; len; i++) {
</a><a href="#h14-0-288" id="h14-0-288" class="i">+		output = xcb_randr_get_output_info_reply(conn, out_cookie[i], NULL);
</a><a href="#h14-0-289" id="h14-0-289" class="i">+		if (output == NULL)
</a><a href="#h14-0-290" id="h14-0-290" class="i">+			continue;
</a><a href="#h14-0-291" id="h14-0-291" class="i">+
</a><a href="#h14-0-292" id="h14-0-292" class="i">+		name_len = xcb_randr_get_output_info_name_length(output);
</a><a href="#h14-0-293" id="h14-0-293" class="i">+		if (16 &lt; name_len)
</a><a href="#h14-0-294" id="h14-0-294" class="i">+			name_len = 16;
</a><a href="#h14-0-295" id="h14-0-295" class="i">+
</a><a href="#h14-0-296" id="h14-0-296" class="i">+		/* +1 for the null character */
</a><a href="#h14-0-297" id="h14-0-297" class="i">+		name = malloc(name_len + 1);
</a><a href="#h14-0-298" id="h14-0-298" class="i">+		/* make sure the name is at most name_len + 1 length
</a><a href="#h14-0-299" id="h14-0-299" class="i">+		 * or we may run into problems. */
</a><a href="#h14-0-300" id="h14-0-300" class="i">+		snprintf(name, name_len + 1, &quot;%.*s&quot;, name_len,
</a><a href="#h14-0-301" id="h14-0-301" class="i">+				xcb_randr_get_output_info_name(output));
</a><a href="#h14-0-302" id="h14-0-302" class="i">+
</a><a href="#h14-0-303" id="h14-0-303" class="i">+		if (output-&gt;crtc != XCB_NONE) {
</a><a href="#h14-0-304" id="h14-0-304" class="i">+			info_c = xcb_randr_get_crtc_info(conn, output-&gt;crtc,
</a><a href="#h14-0-305" id="h14-0-305" class="i">+					timestamp);
</a><a href="#h14-0-306" id="h14-0-306" class="i">+			crtc = xcb_randr_get_crtc_info_reply(conn, info_c, NULL);
</a><a href="#h14-0-307" id="h14-0-307" class="i">+
</a><a href="#h14-0-308" id="h14-0-308" class="i">+			if (crtc == NULL)
</a><a href="#h14-0-309" id="h14-0-309" class="i">+				return;
</a><a href="#h14-0-310" id="h14-0-310" class="i">+
</a><a href="#h14-0-311" id="h14-0-311" class="i">+			clonemon = find_clones(outputs[i], crtc-&gt;x, crtc-&gt;y);
</a><a href="#h14-0-312" id="h14-0-312" class="i">+			if (clonemon != NULL)
</a><a href="#h14-0-313" id="h14-0-313" class="i">+				continue;
</a><a href="#h14-0-314" id="h14-0-314" class="i">+
</a><a href="#h14-0-315" id="h14-0-315" class="i">+			mon = find_monitor(outputs[i]);
</a><a href="#h14-0-316" id="h14-0-316" class="i">+			if (mon == NULL) {
</a><a href="#h14-0-317" id="h14-0-317" class="i">+				add_monitor(outputs[i], name, crtc-&gt;x, crtc-&gt;y,
</a><a href="#h14-0-318" id="h14-0-318" class="i">+						crtc-&gt;width, crtc-&gt;height);
</a><a href="#h14-0-319" id="h14-0-319" class="i">+			} else {
</a><a href="#h14-0-320" id="h14-0-320" class="i">+				mon-&gt;x = crtc-&gt;x;
</a><a href="#h14-0-321" id="h14-0-321" class="i">+				mon-&gt;y = crtc-&gt;y;
</a><a href="#h14-0-322" id="h14-0-322" class="i">+				mon-&gt;width = crtc-&gt;width;
</a><a href="#h14-0-323" id="h14-0-323" class="i">+				mon-&gt;height = crtc-&gt;height;
</a><a href="#h14-0-324" id="h14-0-324" class="i">+
</a><a href="#h14-0-325" id="h14-0-325" class="i">+				arrange_by_monitor(mon);
</a><a href="#h14-0-326" id="h14-0-326" class="i">+			}
</a><a href="#h14-0-327" id="h14-0-327" class="i">+
</a><a href="#h14-0-328" id="h14-0-328" class="i">+			free(crtc);
</a><a href="#h14-0-329" id="h14-0-329" class="i">+		} else {
</a><a href="#h14-0-330" id="h14-0-330" class="i">+			/* Check if the monitor was used before
</a><a href="#h14-0-331" id="h14-0-331" class="i">+			 * becoming disabled. */
</a><a href="#h14-0-332" id="h14-0-332" class="i">+			mon = find_monitor(outputs[i]);
</a><a href="#h14-0-333" id="h14-0-333" class="i">+			if (mon) {
</a><a href="#h14-0-334" id="h14-0-334" class="i">+				struct client *client;
</a><a href="#h14-0-335" id="h14-0-335" class="i">+				for (item = win_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-336" id="h14-0-336" class="i">+					/* Move window from this monitor to
</a><a href="#h14-0-337" id="h14-0-337" class="i">+					 * either the next one or the first one. */
</a><a href="#h14-0-338" id="h14-0-338" class="i">+					client = item-&gt;data;
</a><a href="#h14-0-339" id="h14-0-339" class="i">+
</a><a href="#h14-0-340" id="h14-0-340" class="i">+					if (client-&gt;monitor == mon) {
</a><a href="#h14-0-341" id="h14-0-341" class="i">+						if (client-&gt;monitor-&gt;item-&gt;next)
</a><a href="#h14-0-342" id="h14-0-342" class="i">+							// If at end, take from the beginning
</a><a href="#h14-0-343" id="h14-0-343" class="i">+							if (mon_list == NULL)
</a><a href="#h14-0-344" id="h14-0-344" class="i">+								client-&gt;monitor = NULL;
</a><a href="#h14-0-345" id="h14-0-345" class="i">+							else
</a><a href="#h14-0-346" id="h14-0-346" class="i">+								client-&gt;monitor = mon_list-&gt;data;
</a><a href="#h14-0-347" id="h14-0-347" class="i">+						else
</a><a href="#h14-0-348" id="h14-0-348" class="i">+							client-&gt;monitor = client-&gt;monitor-&gt;item-&gt;next-&gt;data;
</a><a href="#h14-0-349" id="h14-0-349" class="i">+						fit_on_screen(client);
</a><a href="#h14-0-350" id="h14-0-350" class="i">+					}
</a><a href="#h14-0-351" id="h14-0-351" class="i">+				}
</a><a href="#h14-0-352" id="h14-0-352" class="i">+
</a><a href="#h14-0-353" id="h14-0-353" class="i">+				/* Monitor not active. Delete it. */
</a><a href="#h14-0-354" id="h14-0-354" class="i">+				free_monitor(mon);
</a><a href="#h14-0-355" id="h14-0-355" class="i">+			}
</a><a href="#h14-0-356" id="h14-0-356" class="i">+		}
</a><a href="#h14-0-357" id="h14-0-357" class="i">+
</a><a href="#h14-0-358" id="h14-0-358" class="i">+		if (output != NULL)
</a><a href="#h14-0-359" id="h14-0-359" class="i">+			free(output);
</a><a href="#h14-0-360" id="h14-0-360" class="i">+		free(name);
</a><a href="#h14-0-361" id="h14-0-361" class="i">+	}
</a><a href="#h14-0-362" id="h14-0-362" class="i">+}
</a><a href="#h14-0-363" id="h14-0-363" class="i">+
</a><a href="#h14-0-364" id="h14-0-364" class="i">+struct monitor *
</a><a href="#h14-0-365" id="h14-0-365" class="i">+find_monitor(xcb_randr_output_t mon)
</a><a href="#h14-0-366" id="h14-0-366" class="i">+{
</a><a href="#h14-0-367" id="h14-0-367" class="i">+	struct list_item *item;
</a><a href="#h14-0-368" id="h14-0-368" class="i">+	struct monitor *m;
</a><a href="#h14-0-369" id="h14-0-369" class="i">+
</a><a href="#h14-0-370" id="h14-0-370" class="i">+	item = mon_list;
</a><a href="#h14-0-371" id="h14-0-371" class="i">+	while (item != NULL &amp;&amp; (m = item-&gt;data)-&gt;monitor != mon)
</a><a href="#h14-0-372" id="h14-0-372" class="i">+		item = item-&gt;next;
</a><a href="#h14-0-373" id="h14-0-373" class="i">+
</a><a href="#h14-0-374" id="h14-0-374" class="i">+	if (item == NULL)
</a><a href="#h14-0-375" id="h14-0-375" class="i">+		return NULL;
</a><a href="#h14-0-376" id="h14-0-376" class="i">+	else
</a><a href="#h14-0-377" id="h14-0-377" class="i">+		return item-&gt;data;
</a><a href="#h14-0-378" id="h14-0-378" class="i">+}
</a><a href="#h14-0-379" id="h14-0-379" class="i">+
</a><a href="#h14-0-380" id="h14-0-380" class="i">+static struct monitor *
</a><a href="#h14-0-381" id="h14-0-381" class="i">+find_monitor_by_coord(int16_t x, int16_t y)
</a><a href="#h14-0-382" id="h14-0-382" class="i">+{
</a><a href="#h14-0-383" id="h14-0-383" class="i">+	struct list_item *item;
</a><a href="#h14-0-384" id="h14-0-384" class="i">+	struct monitor *m = NULL;
</a><a href="#h14-0-385" id="h14-0-385" class="i">+
</a><a href="#h14-0-386" id="h14-0-386" class="i">+	for (item = mon_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-387" id="h14-0-387" class="i">+		m = item-&gt;data;
</a><a href="#h14-0-388" id="h14-0-388" class="i">+
</a><a href="#h14-0-389" id="h14-0-389" class="i">+		if (x &gt;= m-&gt;x &amp;&amp; x &lt;= m-&gt;x + m-&gt;width
</a><a href="#h14-0-390" id="h14-0-390" class="i">+			&amp;&amp; y &gt;= m-&gt;y &amp;&amp; y &lt;= m-&gt;y + m-&gt;height)
</a><a href="#h14-0-391" id="h14-0-391" class="i">+			break;
</a><a href="#h14-0-392" id="h14-0-392" class="i">+	}
</a><a href="#h14-0-393" id="h14-0-393" class="i">+
</a><a href="#h14-0-394" id="h14-0-394" class="i">+	return m;
</a><a href="#h14-0-395" id="h14-0-395" class="i">+}
</a><a href="#h14-0-396" id="h14-0-396" class="i">+
</a><a href="#h14-0-397" id="h14-0-397" class="i">+struct monitor *
</a><a href="#h14-0-398" id="h14-0-398" class="i">+find_clones(xcb_randr_output_t mon, int16_t x, int16_t y)
</a><a href="#h14-0-399" id="h14-0-399" class="i">+{
</a><a href="#h14-0-400" id="h14-0-400" class="i">+	struct monitor *clonemon;
</a><a href="#h14-0-401" id="h14-0-401" class="i">+	struct list_item *item;
</a><a href="#h14-0-402" id="h14-0-402" class="i">+
</a><a href="#h14-0-403" id="h14-0-403" class="i">+	item = mon_list;
</a><a href="#h14-0-404" id="h14-0-404" class="i">+	while (item != NULL &amp;&amp; ((clonemon = item-&gt;data)-&gt;monitor == mon
</a><a href="#h14-0-405" id="h14-0-405" class="i">+						|| clonemon-&gt;x != x
</a><a href="#h14-0-406" id="h14-0-406" class="i">+						|| clonemon-&gt;y != y)) {
</a><a href="#h14-0-407" id="h14-0-407" class="i">+		item = item-&gt;next;
</a><a href="#h14-0-408" id="h14-0-408" class="i">+	}
</a><a href="#h14-0-409" id="h14-0-409" class="i">+
</a><a href="#h14-0-410" id="h14-0-410" class="i">+	if (item == NULL)
</a><a href="#h14-0-411" id="h14-0-411" class="i">+		return NULL;
</a><a href="#h14-0-412" id="h14-0-412" class="i">+	else
</a><a href="#h14-0-413" id="h14-0-413" class="i">+		return clonemon;
</a><a href="#h14-0-414" id="h14-0-414" class="i">+}
</a><a href="#h14-0-415" id="h14-0-415" class="i">+
</a><a href="#h14-0-416" id="h14-0-416" class="i">+static struct monitor *
</a><a href="#h14-0-417" id="h14-0-417" class="i">+add_monitor(xcb_randr_output_t mon, char *name, int16_t x, int16_t y, uint16_t width, uint16_t height)
</a><a href="#h14-0-418" id="h14-0-418" class="i">+{
</a><a href="#h14-0-419" id="h14-0-419" class="i">+	struct list_item *item;
</a><a href="#h14-0-420" id="h14-0-420" class="i">+	struct monitor *monitor = malloc(sizeof(struct monitor));
</a><a href="#h14-0-421" id="h14-0-421" class="i">+
</a><a href="#h14-0-422" id="h14-0-422" class="i">+	item = list_add_item(&amp;mon_list);
</a><a href="#h14-0-423" id="h14-0-423" class="i">+	if (item == NULL || monitor == NULL)
</a><a href="#h14-0-424" id="h14-0-424" class="i">+		return NULL;
</a><a href="#h14-0-425" id="h14-0-425" class="i">+
</a><a href="#h14-0-426" id="h14-0-426" class="i">+	item-&gt;data = monitor;
</a><a href="#h14-0-427" id="h14-0-427" class="i">+	monitor-&gt;item = item;
</a><a href="#h14-0-428" id="h14-0-428" class="i">+	monitor-&gt;monitor = mon;
</a><a href="#h14-0-429" id="h14-0-429" class="i">+	monitor-&gt;name = name;
</a><a href="#h14-0-430" id="h14-0-430" class="i">+	monitor-&gt;x = x;
</a><a href="#h14-0-431" id="h14-0-431" class="i">+	monitor-&gt;y = y;
</a><a href="#h14-0-432" id="h14-0-432" class="i">+	monitor-&gt;width = width;
</a><a href="#h14-0-433" id="h14-0-433" class="i">+	monitor-&gt;height = height;
</a><a href="#h14-0-434" id="h14-0-434" class="i">+
</a><a href="#h14-0-435" id="h14-0-435" class="i">+	return monitor;
</a><a href="#h14-0-436" id="h14-0-436" class="i">+}
</a><a href="#h14-0-437" id="h14-0-437" class="i">+
</a><a href="#h14-0-438" id="h14-0-438" class="i">+static void
</a><a href="#h14-0-439" id="h14-0-439" class="i">+free_monitor(struct monitor *mon)
</a><a href="#h14-0-440" id="h14-0-440" class="i">+{
</a><a href="#h14-0-441" id="h14-0-441" class="i">+	struct list_item *item = mon-&gt;item;
</a><a href="#h14-0-442" id="h14-0-442" class="i">+
</a><a href="#h14-0-443" id="h14-0-443" class="i">+	free(mon);
</a><a href="#h14-0-444" id="h14-0-444" class="i">+	list_delete_item(&amp;mon_list, item);
</a><a href="#h14-0-445" id="h14-0-445" class="i">+}
</a><a href="#h14-0-446" id="h14-0-446" class="i">+
</a><a href="#h14-0-447" id="h14-0-447" class="i">+static void
</a><a href="#h14-0-448" id="h14-0-448" class="i">+get_monitor_size(struct client *client, int16_t *mon_x, int16_t *mon_y, uint16_t *mon_width, uint16_t *mon_height)
</a><a href="#h14-0-449" id="h14-0-449" class="i">+{
</a><a href="#h14-0-450" id="h14-0-450" class="i">+	if (client == NULL || client-&gt;monitor == NULL) {
</a><a href="#h14-0-451" id="h14-0-451" class="i">+		if (mon_x != NULL &amp;&amp; mon_y != NULL)
</a><a href="#h14-0-452" id="h14-0-452" class="i">+			*mon_x = *mon_y = 0;
</a><a href="#h14-0-453" id="h14-0-453" class="i">+		if (mon_width != NULL)
</a><a href="#h14-0-454" id="h14-0-454" class="i">+			*mon_width = scr-&gt;width_in_pixels;
</a><a href="#h14-0-455" id="h14-0-455" class="i">+		if (mon_height != NULL)
</a><a href="#h14-0-456" id="h14-0-456" class="i">+			*mon_height = scr-&gt;height_in_pixels;
</a><a href="#h14-0-457" id="h14-0-457" class="i">+	} else {
</a><a href="#h14-0-458" id="h14-0-458" class="i">+		if (mon_x != NULL)
</a><a href="#h14-0-459" id="h14-0-459" class="i">+			*mon_x = client-&gt;monitor-&gt;x;
</a><a href="#h14-0-460" id="h14-0-460" class="i">+		if (mon_y != NULL)
</a><a href="#h14-0-461" id="h14-0-461" class="i">+			*mon_y = client-&gt;monitor-&gt;y;
</a><a href="#h14-0-462" id="h14-0-462" class="i">+		if (mon_width != NULL)
</a><a href="#h14-0-463" id="h14-0-463" class="i">+			*mon_width = client-&gt;monitor-&gt;width;
</a><a href="#h14-0-464" id="h14-0-464" class="i">+		if (mon_height != NULL)
</a><a href="#h14-0-465" id="h14-0-465" class="i">+			*mon_height = client-&gt;monitor-&gt;height;
</a><a href="#h14-0-466" id="h14-0-466" class="i">+	}
</a><a href="#h14-0-467" id="h14-0-467" class="i">+}
</a><a href="#h14-0-468" id="h14-0-468" class="i">+
</a><a href="#h14-0-469" id="h14-0-469" class="i">+static void
</a><a href="#h14-0-470" id="h14-0-470" class="i">+arrange_by_monitor(struct monitor *mon)
</a><a href="#h14-0-471" id="h14-0-471" class="i">+{
</a><a href="#h14-0-472" id="h14-0-472" class="i">+	struct client *client;
</a><a href="#h14-0-473" id="h14-0-473" class="i">+	struct list_item *item;
</a><a href="#h14-0-474" id="h14-0-474" class="i">+
</a><a href="#h14-0-475" id="h14-0-475" class="i">+	for (item = win_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-476" id="h14-0-476" class="i">+		client = item-&gt;data;
</a><a href="#h14-0-477" id="h14-0-477" class="i">+
</a><a href="#h14-0-478" id="h14-0-478" class="i">+		if (client-&gt;monitor == mon)
</a><a href="#h14-0-479" id="h14-0-479" class="i">+			fit_on_screen(client);
</a><a href="#h14-0-480" id="h14-0-480" class="i">+	}
</a><a href="#h14-0-481" id="h14-0-481" class="i">+}
</a><a href="#h14-0-482" id="h14-0-482" class="i">+
</a><a href="#h14-0-483" id="h14-0-483" class="i">+/*
</a><a href="#h14-0-484" id="h14-0-484" class="i">+ * Waits for events and handles them.
</a><a href="#h14-0-485" id="h14-0-485" class="i">+ */
</a><a href="#h14-0-486" id="h14-0-486" class="i">+
</a><a href="#h14-0-487" id="h14-0-487" class="i">+static void
</a><a href="#h14-0-488" id="h14-0-488" class="i">+run(void)
</a><a href="#h14-0-489" id="h14-0-489" class="i">+{
</a><a href="#h14-0-490" id="h14-0-490" class="i">+	xcb_generic_event_t *ev;
</a><a href="#h14-0-491" id="h14-0-491" class="i">+
</a><a href="#h14-0-492" id="h14-0-492" class="i">+	halt = false;
</a><a href="#h14-0-493" id="h14-0-493" class="i">+	exit_code = 0;
</a><a href="#h14-0-494" id="h14-0-494" class="i">+	while (!halt) {
</a><a href="#h14-0-495" id="h14-0-495" class="i">+		xcb_flush(conn);
</a><a href="#h14-0-496" id="h14-0-496" class="i">+		ev = xcb_wait_for_event(conn);
</a><a href="#h14-0-497" id="h14-0-497" class="i">+		if (ev) {
</a><a href="#h14-0-498" id="h14-0-498" class="i">+			DMSG(&quot;%d\n&quot;, ev-&gt;response_type &amp; ~0x80);
</a><a href="#h14-0-499" id="h14-0-499" class="i">+			if (ev-&gt;response_type == randr_base + XCB_RANDR_SCREEN_CHANGE_NOTIFY) {
</a><a href="#h14-0-500" id="h14-0-500" class="i">+				get_randr();
</a><a href="#h14-0-501" id="h14-0-501" class="i">+				DMSG(&quot;Screen layout changed\n&quot;);
</a><a href="#h14-0-502" id="h14-0-502" class="i">+			}
</a><a href="#h14-0-503" id="h14-0-503" class="i">+			if (events[EVENT_MASK(ev-&gt;response_type)] != NULL)
</a><a href="#h14-0-504" id="h14-0-504" class="i">+				(events[EVENT_MASK(ev-&gt;response_type)])(ev);
</a><a href="#h14-0-505" id="h14-0-505" class="i">+			free(ev);
</a><a href="#h14-0-506" id="h14-0-506" class="i">+		}
</a><a href="#h14-0-507" id="h14-0-507" class="i">+	}
</a><a href="#h14-0-508" id="h14-0-508" class="i">+}
</a><a href="#h14-0-509" id="h14-0-509" class="i">+
</a><a href="#h14-0-510" id="h14-0-510" class="i">+/*
</a><a href="#h14-0-511" id="h14-0-511" class="i">+ * Initialize a window for further work.
</a><a href="#h14-0-512" id="h14-0-512" class="i">+ */
</a><a href="#h14-0-513" id="h14-0-513" class="i">+
</a><a href="#h14-0-514" id="h14-0-514" class="i">+static struct client *
</a><a href="#h14-0-515" id="h14-0-515" class="i">+setup_window(xcb_window_t win)
</a><a href="#h14-0-516" id="h14-0-516" class="i">+{
</a><a href="#h14-0-517" id="h14-0-517" class="i">+	uint32_t values[2];
</a><a href="#h14-0-518" id="h14-0-518" class="i">+	xcb_ewmh_get_atoms_reply_t win_type;
</a><a href="#h14-0-519" id="h14-0-519" class="i">+	xcb_atom_t atom;
</a><a href="#h14-0-520" id="h14-0-520" class="i">+	struct client *client;
</a><a href="#h14-0-521" id="h14-0-521" class="i">+	struct list_item *item;
</a><a href="#h14-0-522" id="h14-0-522" class="i">+	xcb_size_hints_t hints;
</a><a href="#h14-0-523" id="h14-0-523" class="i">+
</a><a href="#h14-0-524" id="h14-0-524" class="i">+	if (xcb_ewmh_get_wm_window_type_reply(ewmh,
</a><a href="#h14-0-525" id="h14-0-525" class="i">+				xcb_ewmh_get_wm_window_type(ewmh, win),
</a><a href="#h14-0-526" id="h14-0-526" class="i">+				&amp;win_type, NULL) == 1) {
</a><a href="#h14-0-527" id="h14-0-527" class="i">+		unsigned int i = 0;
</a><a href="#h14-0-528" id="h14-0-528" class="i">+		/* if the window is a toolbar or a dock, map it and ignore it */
</a><a href="#h14-0-529" id="h14-0-529" class="i">+		while (i &lt; win_type.atoms_len &amp;&amp;
</a><a href="#h14-0-530" id="h14-0-530" class="i">+			(atom = win_type.atoms[i]) != ewmh-&gt;_NET_WM_WINDOW_TYPE_TOOLBAR &amp;&amp;
</a><a href="#h14-0-531" id="h14-0-531" class="i">+			atom != ewmh-&gt;_NET_WM_WINDOW_TYPE_DOCK)
</a><a href="#h14-0-532" id="h14-0-532" class="i">+			i++;
</a><a href="#h14-0-533" id="h14-0-533" class="i">+
</a><a href="#h14-0-534" id="h14-0-534" class="i">+		if (i &lt; win_type.atoms_len) {
</a><a href="#h14-0-535" id="h14-0-535" class="i">+			xcb_ewmh_get_atoms_reply_wipe(&amp;win_type);
</a><a href="#h14-0-536" id="h14-0-536" class="i">+			xcb_map_window(conn, win);
</a><a href="#h14-0-537" id="h14-0-537" class="i">+			return NULL;
</a><a href="#h14-0-538" id="h14-0-538" class="i">+		}
</a><a href="#h14-0-539" id="h14-0-539" class="i">+	}
</a><a href="#h14-0-540" id="h14-0-540" class="i">+
</a><a href="#h14-0-541" id="h14-0-541" class="i">+	/* subscribe to events */
</a><a href="#h14-0-542" id="h14-0-542" class="i">+	values[0] = XCB_EVENT_MASK_ENTER_WINDOW;
</a><a href="#h14-0-543" id="h14-0-543" class="i">+	xcb_change_window_attributes(conn, win, XCB_CW_EVENT_MASK, values);
</a><a href="#h14-0-544" id="h14-0-544" class="i">+
</a><a href="#h14-0-545" id="h14-0-545" class="i">+	/* in case of fire */
</a><a href="#h14-0-546" id="h14-0-546" class="i">+	xcb_change_save_set(conn, XCB_SET_MODE_INSERT, win);
</a><a href="#h14-0-547" id="h14-0-547" class="i">+
</a><a href="#h14-0-548" id="h14-0-548" class="i">+	/* assign to the null group */
</a><a href="#h14-0-549" id="h14-0-549" class="i">+	xcb_ewmh_set_wm_desktop(ewmh, win, NULL_GROUP);
</a><a href="#h14-0-550" id="h14-0-550" class="i">+
</a><a href="#h14-0-551" id="h14-0-551" class="i">+	item = list_add_item(&amp;win_list);
</a><a href="#h14-0-552" id="h14-0-552" class="i">+	if (item == NULL)
</a><a href="#h14-0-553" id="h14-0-553" class="i">+		return NULL;
</a><a href="#h14-0-554" id="h14-0-554" class="i">+
</a><a href="#h14-0-555" id="h14-0-555" class="i">+	client = malloc(sizeof(struct client));
</a><a href="#h14-0-556" id="h14-0-556" class="i">+	if (client == NULL)
</a><a href="#h14-0-557" id="h14-0-557" class="i">+		return NULL;
</a><a href="#h14-0-558" id="h14-0-558" class="i">+
</a><a href="#h14-0-559" id="h14-0-559" class="i">+	item-&gt;data = client;
</a><a href="#h14-0-560" id="h14-0-560" class="i">+	client-&gt;item = item;
</a><a href="#h14-0-561" id="h14-0-561" class="i">+	client-&gt;window = win;
</a><a href="#h14-0-562" id="h14-0-562" class="i">+	client-&gt;geom.x = client-&gt;geom.y = client-&gt;geom.width
</a><a href="#h14-0-563" id="h14-0-563" class="i">+				   = client-&gt;geom.height
</a><a href="#h14-0-564" id="h14-0-564" class="i">+				   = client-&gt;min_width = client-&gt;min_height
</a><a href="#h14-0-565" id="h14-0-565" class="i">+				   = client-&gt;max_width = client-&gt;max_height = 0;
</a><a href="#h14-0-566" id="h14-0-566" class="i">+	client-&gt;max_width  = scr-&gt;width_in_pixels;
</a><a href="#h14-0-567" id="h14-0-567" class="i">+	client-&gt;max_height = scr-&gt;height_in_pixels;
</a><a href="#h14-0-568" id="h14-0-568" class="i">+	client-&gt;maxed   = client-&gt;hmaxed = client-&gt;vmaxed = client-&gt;geom.set_by_user = false;
</a><a href="#h14-0-569" id="h14-0-569" class="i">+	client-&gt;monitor = NULL;
</a><a href="#h14-0-570" id="h14-0-570" class="i">+	client-&gt;mapped  = false;
</a><a href="#h14-0-571" id="h14-0-571" class="i">+	client-&gt;group   = NULL_GROUP;
</a><a href="#h14-0-572" id="h14-0-572" class="i">+	get_geometry(&amp;client-&gt;window, &amp;client-&gt;geom.x, &amp;client-&gt;geom.y,
</a><a href="#h14-0-573" id="h14-0-573" class="i">+			&amp;client-&gt;geom.width, &amp;client-&gt;geom.height);
</a><a href="#h14-0-574" id="h14-0-574" class="i">+
</a><a href="#h14-0-575" id="h14-0-575" class="i">+	xcb_icccm_get_wm_normal_hints_reply(conn,
</a><a href="#h14-0-576" id="h14-0-576" class="i">+			xcb_icccm_get_wm_normal_hints_unchecked(conn, win),
</a><a href="#h14-0-577" id="h14-0-577" class="i">+			&amp;hints, NULL);
</a><a href="#h14-0-578" id="h14-0-578" class="i">+
</a><a href="#h14-0-579" id="h14-0-579" class="i">+	if (hints.flags &amp; XCB_ICCCM_SIZE_HINT_US_POSITION)
</a><a href="#h14-0-580" id="h14-0-580" class="i">+		client-&gt;geom.set_by_user = true;
</a><a href="#h14-0-581" id="h14-0-581" class="i">+
</a><a href="#h14-0-582" id="h14-0-582" class="i">+	if (hints.flags &amp; XCB_ICCCM_SIZE_HINT_P_MIN_SIZE) {
</a><a href="#h14-0-583" id="h14-0-583" class="i">+		client-&gt;min_width = hints.min_width;
</a><a href="#h14-0-584" id="h14-0-584" class="i">+		client-&gt;min_height = hints.min_height;
</a><a href="#h14-0-585" id="h14-0-585" class="i">+	}
</a><a href="#h14-0-586" id="h14-0-586" class="i">+
</a><a href="#h14-0-587" id="h14-0-587" class="i">+	if (hints.flags &amp; XCB_ICCCM_SIZE_HINT_P_MAX_SIZE) {
</a><a href="#h14-0-588" id="h14-0-588" class="i">+		client-&gt;max_width = hints.max_width;
</a><a href="#h14-0-589" id="h14-0-589" class="i">+		client-&gt;max_height = hints.max_height;
</a><a href="#h14-0-590" id="h14-0-590" class="i">+	}
</a><a href="#h14-0-591" id="h14-0-591" class="i">+
</a><a href="#h14-0-592" id="h14-0-592" class="i">+	return client;
</a><a href="#h14-0-593" id="h14-0-593" class="i">+}
</a><a href="#h14-0-594" id="h14-0-594" class="i">+
</a><a href="#h14-0-595" id="h14-0-595" class="i">+/*
</a><a href="#h14-0-596" id="h14-0-596" class="i">+ * Set focus state to active or inactive without raising the window.
</a><a href="#h14-0-597" id="h14-0-597" class="i">+ */
</a><a href="#h14-0-598" id="h14-0-598" class="i">+
</a><a href="#h14-0-599" id="h14-0-599" class="i">+static void
</a><a href="#h14-0-600" id="h14-0-600" class="i">+set_focused_no_raise(struct client *client)
</a><a href="#h14-0-601" id="h14-0-601" class="i">+{
</a><a href="#h14-0-602" id="h14-0-602" class="i">+	long data[] = {
</a><a href="#h14-0-603" id="h14-0-603" class="i">+		XCB_ICCCM_WM_STATE_NORMAL,
</a><a href="#h14-0-604" id="h14-0-604" class="i">+		XCB_NONE,
</a><a href="#h14-0-605" id="h14-0-605" class="i">+	};
</a><a href="#h14-0-606" id="h14-0-606" class="i">+	if (client == NULL)
</a><a href="#h14-0-607" id="h14-0-607" class="i">+		return;
</a><a href="#h14-0-608" id="h14-0-608" class="i">+
</a><a href="#h14-0-609" id="h14-0-609" class="i">+	if (!client-&gt;maxed)
</a><a href="#h14-0-610" id="h14-0-610" class="i">+		set_borders(client, conf.focus_color);
</a><a href="#h14-0-611" id="h14-0-611" class="i">+
</a><a href="#h14-0-612" id="h14-0-612" class="i">+	/* revert state to normal */
</a><a href="#h14-0-613" id="h14-0-613" class="i">+	xcb_change_property(conn, XCB_PROP_MODE_REPLACE, client-&gt;window,
</a><a href="#h14-0-614" id="h14-0-614" class="i">+			ewmh-&gt;_NET_WM_STATE, ewmh-&gt;_NET_WM_STATE, 32, 2, data);
</a><a href="#h14-0-615" id="h14-0-615" class="i">+
</a><a href="#h14-0-616" id="h14-0-616" class="i">+	/* focus the window */
</a><a href="#h14-0-617" id="h14-0-617" class="i">+	xcb_set_input_focus(conn, XCB_INPUT_FOCUS_POINTER_ROOT,
</a><a href="#h14-0-618" id="h14-0-618" class="i">+			client-&gt;window, XCB_CURRENT_TIME);
</a><a href="#h14-0-619" id="h14-0-619" class="i">+
</a><a href="#h14-0-620" id="h14-0-620" class="i">+	/* set ewmh property */
</a><a href="#h14-0-621" id="h14-0-621" class="i">+	xcb_change_property(conn, XCB_PROP_MODE_REPLACE, scr-&gt;root,
</a><a href="#h14-0-622" id="h14-0-622" class="i">+			ewmh-&gt;_NET_ACTIVE_WINDOW, XCB_ATOM_WINDOW, 32, 1, &amp;client-&gt;window);
</a><a href="#h14-0-623" id="h14-0-623" class="i">+
</a><a href="#h14-0-624" id="h14-0-624" class="i">+	/* set the focus state to inactive on the previously focused window */
</a><a href="#h14-0-625" id="h14-0-625" class="i">+	if (client != focused_win) {
</a><a href="#h14-0-626" id="h14-0-626" class="i">+		if (focused_win != NULL &amp;&amp; !focused_win-&gt;maxed)
</a><a href="#h14-0-627" id="h14-0-627" class="i">+			set_borders(focused_win, conf.unfocus_color);
</a><a href="#h14-0-628" id="h14-0-628" class="i">+		focused_win = client;
</a><a href="#h14-0-629" id="h14-0-629" class="i">+	}
</a><a href="#h14-0-630" id="h14-0-630" class="i">+}
</a><a href="#h14-0-631" id="h14-0-631" class="i">+
</a><a href="#h14-0-632" id="h14-0-632" class="i">+/*
</a><a href="#h14-0-633" id="h14-0-633" class="i">+ * Focus and raise.
</a><a href="#h14-0-634" id="h14-0-634" class="i">+ */
</a><a href="#h14-0-635" id="h14-0-635" class="i">+
</a><a href="#h14-0-636" id="h14-0-636" class="i">+static void
</a><a href="#h14-0-637" id="h14-0-637" class="i">+set_focused(struct client *client)
</a><a href="#h14-0-638" id="h14-0-638" class="i">+{
</a><a href="#h14-0-639" id="h14-0-639" class="i">+	set_focused_no_raise(client);
</a><a href="#h14-0-640" id="h14-0-640" class="i">+	raise_window(client-&gt;window);
</a><a href="#h14-0-641" id="h14-0-641" class="i">+}
</a><a href="#h14-0-642" id="h14-0-642" class="i">+
</a><a href="#h14-0-643" id="h14-0-643" class="i">+/*
</a><a href="#h14-0-644" id="h14-0-644" class="i">+ * Put window at the top of the window stack.
</a><a href="#h14-0-645" id="h14-0-645" class="i">+ */
</a><a href="#h14-0-646" id="h14-0-646" class="i">+
</a><a href="#h14-0-647" id="h14-0-647" class="i">+static void
</a><a href="#h14-0-648" id="h14-0-648" class="i">+raise_window(xcb_window_t win)
</a><a href="#h14-0-649" id="h14-0-649" class="i">+{
</a><a href="#h14-0-650" id="h14-0-650" class="i">+	uint32_t values[1] = { XCB_STACK_MODE_ABOVE };
</a><a href="#h14-0-651" id="h14-0-651" class="i">+	xcb_configure_window(conn, win, XCB_CONFIG_WINDOW_STACK_MODE, values);
</a><a href="#h14-0-652" id="h14-0-652" class="i">+}
</a><a href="#h14-0-653" id="h14-0-653" class="i">+
</a><a href="#h14-0-654" id="h14-0-654" class="i">+/*
</a><a href="#h14-0-655" id="h14-0-655" class="i">+ * Ask window to close gracefully. If the window doesn&apos;t respond, kill it.
</a><a href="#h14-0-656" id="h14-0-656" class="i">+ */
</a><a href="#h14-0-657" id="h14-0-657" class="i">+
</a><a href="#h14-0-658" id="h14-0-658" class="i">+static void
</a><a href="#h14-0-659" id="h14-0-659" class="i">+close_window(struct client *client)
</a><a href="#h14-0-660" id="h14-0-660" class="i">+{
</a><a href="#h14-0-661" id="h14-0-661" class="i">+	if (client == NULL)
</a><a href="#h14-0-662" id="h14-0-662" class="i">+		return;
</a><a href="#h14-0-663" id="h14-0-663" class="i">+
</a><a href="#h14-0-664" id="h14-0-664" class="i">+	xcb_window_t win = client-&gt;window;
</a><a href="#h14-0-665" id="h14-0-665" class="i">+	xcb_get_property_cookie_t cookie =
</a><a href="#h14-0-666" id="h14-0-666" class="i">+		xcb_icccm_get_wm_protocols_unchecked(conn,
</a><a href="#h14-0-667" id="h14-0-667" class="i">+				win, ewmh-&gt;WM_PROTOCOLS);
</a><a href="#h14-0-668" id="h14-0-668" class="i">+	xcb_icccm_get_wm_protocols_reply_t reply;
</a><a href="#h14-0-669" id="h14-0-669" class="i">+	unsigned int i = 0;
</a><a href="#h14-0-670" id="h14-0-670" class="i">+	bool got = false;
</a><a href="#h14-0-671" id="h14-0-671" class="i">+
</a><a href="#h14-0-672" id="h14-0-672" class="i">+	if (xcb_icccm_get_wm_protocols_reply(conn, cookie, &amp;reply, NULL)) {
</a><a href="#h14-0-673" id="h14-0-673" class="i">+		for (i = 0; i &lt; reply.atoms_len; i++) {
</a><a href="#h14-0-674" id="h14-0-674" class="i">+			got = (reply.atoms[i] = ATOMS[WM_DELETE_WINDOW]);
</a><a href="#h14-0-675" id="h14-0-675" class="i">+			if (got)
</a><a href="#h14-0-676" id="h14-0-676" class="i">+				break;
</a><a href="#h14-0-677" id="h14-0-677" class="i">+		}
</a><a href="#h14-0-678" id="h14-0-678" class="i">+
</a><a href="#h14-0-679" id="h14-0-679" class="i">+		xcb_icccm_get_wm_protocols_reply_wipe(&amp;reply);
</a><a href="#h14-0-680" id="h14-0-680" class="i">+	}
</a><a href="#h14-0-681" id="h14-0-681" class="i">+
</a><a href="#h14-0-682" id="h14-0-682" class="i">+	if (got)
</a><a href="#h14-0-683" id="h14-0-683" class="i">+		delete_window(win);
</a><a href="#h14-0-684" id="h14-0-684" class="i">+	else
</a><a href="#h14-0-685" id="h14-0-685" class="i">+		xcb_kill_client(conn, win);
</a><a href="#h14-0-686" id="h14-0-686" class="i">+
</a><a href="#h14-0-687" id="h14-0-687" class="i">+	free_window(client);
</a><a href="#h14-0-688" id="h14-0-688" class="i">+}
</a><a href="#h14-0-689" id="h14-0-689" class="i">+
</a><a href="#h14-0-690" id="h14-0-690" class="i">+/*
</a><a href="#h14-0-691" id="h14-0-691" class="i">+ * Gracefully ask a window to close.
</a><a href="#h14-0-692" id="h14-0-692" class="i">+ */
</a><a href="#h14-0-693" id="h14-0-693" class="i">+
</a><a href="#h14-0-694" id="h14-0-694" class="i">+static void
</a><a href="#h14-0-695" id="h14-0-695" class="i">+delete_window(xcb_window_t win)
</a><a href="#h14-0-696" id="h14-0-696" class="i">+{
</a><a href="#h14-0-697" id="h14-0-697" class="i">+	xcb_client_message_event_t ev;
</a><a href="#h14-0-698" id="h14-0-698" class="i">+
</a><a href="#h14-0-699" id="h14-0-699" class="i">+	ev.response_type = XCB_CLIENT_MESSAGE;
</a><a href="#h14-0-700" id="h14-0-700" class="i">+	ev.sequence = 0;
</a><a href="#h14-0-701" id="h14-0-701" class="i">+	ev.format = 32;
</a><a href="#h14-0-702" id="h14-0-702" class="i">+	ev.window = win;
</a><a href="#h14-0-703" id="h14-0-703" class="i">+	ev.type = ewmh-&gt;WM_PROTOCOLS;
</a><a href="#h14-0-704" id="h14-0-704" class="i">+	ev.data.data32[0] = ATOMS[WM_DELETE_WINDOW];
</a><a href="#h14-0-705" id="h14-0-705" class="i">+	ev.data.data32[1] = XCB_CURRENT_TIME;
</a><a href="#h14-0-706" id="h14-0-706" class="i">+
</a><a href="#h14-0-707" id="h14-0-707" class="i">+	xcb_send_event(conn, 0, win, XCB_EVENT_MASK_NO_EVENT, (char *)&amp;ev);
</a><a href="#h14-0-708" id="h14-0-708" class="i">+}
</a><a href="#h14-0-709" id="h14-0-709" class="i">+
</a><a href="#h14-0-710" id="h14-0-710" class="i">+/*
</a><a href="#h14-0-711" id="h14-0-711" class="i">+ * Teleports window absolutely to the given coordinates.
</a><a href="#h14-0-712" id="h14-0-712" class="i">+ */
</a><a href="#h14-0-713" id="h14-0-713" class="i">+
</a><a href="#h14-0-714" id="h14-0-714" class="i">+static void
</a><a href="#h14-0-715" id="h14-0-715" class="i">+teleport_window(xcb_window_t win, int16_t x, int16_t y)
</a><a href="#h14-0-716" id="h14-0-716" class="i">+{
</a><a href="#h14-0-717" id="h14-0-717" class="i">+	uint32_t values[2] = {x, y};
</a><a href="#h14-0-718" id="h14-0-718" class="i">+
</a><a href="#h14-0-719" id="h14-0-719" class="i">+	if (win == scr-&gt;root || win == 0)
</a><a href="#h14-0-720" id="h14-0-720" class="i">+		return;
</a><a href="#h14-0-721" id="h14-0-721" class="i">+
</a><a href="#h14-0-722" id="h14-0-722" class="i">+	xcb_configure_window(conn, win, XCB_CONFIG_WINDOW_X | XCB_CONFIG_WINDOW_Y, values);
</a><a href="#h14-0-723" id="h14-0-723" class="i">+
</a><a href="#h14-0-724" id="h14-0-724" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-725" id="h14-0-725" class="i">+}
</a><a href="#h14-0-726" id="h14-0-726" class="i">+
</a><a href="#h14-0-727" id="h14-0-727" class="i">+/*
</a><a href="#h14-0-728" id="h14-0-728" class="i">+ * Moves the window by a certain amount.
</a><a href="#h14-0-729" id="h14-0-729" class="i">+ */
</a><a href="#h14-0-730" id="h14-0-730" class="i">+
</a><a href="#h14-0-731" id="h14-0-731" class="i">+static void
</a><a href="#h14-0-732" id="h14-0-732" class="i">+move_window(xcb_window_t win, int16_t x, int16_t y)
</a><a href="#h14-0-733" id="h14-0-733" class="i">+{
</a><a href="#h14-0-734" id="h14-0-734" class="i">+	int16_t win_x, win_y;
</a><a href="#h14-0-735" id="h14-0-735" class="i">+	uint16_t win_w, win_h, win_b;
</a><a href="#h14-0-736" id="h14-0-736" class="i">+
</a><a href="#h14-0-737" id="h14-0-737" class="i">+	if (!is_mapped(win) || win == scr-&gt;root)
</a><a href="#h14-0-738" id="h14-0-738" class="i">+		return;
</a><a href="#h14-0-739" id="h14-0-739" class="i">+
</a><a href="#h14-0-740" id="h14-0-740" class="i">+	win_b = get_border_width(win);
</a><a href="#h14-0-741" id="h14-0-741" class="i">+	get_geometry(&amp;win, &amp;win_x, &amp;win_y, &amp;win_w, &amp;win_h);
</a><a href="#h14-0-742" id="h14-0-742" class="i">+
</a><a href="#h14-0-743" id="h14-0-743" class="i">+	win_x += x;
</a><a href="#h14-0-744" id="h14-0-744" class="i">+	win_y += y;
</a><a href="#h14-0-745" id="h14-0-745" class="i">+
</a><a href="#h14-0-746" id="h14-0-746" class="i">+	teleport_window(win, win_x, win_y);
</a><a href="#h14-0-747" id="h14-0-747" class="i">+}
</a><a href="#h14-0-748" id="h14-0-748" class="i">+
</a><a href="#h14-0-749" id="h14-0-749" class="i">+/*
</a><a href="#h14-0-750" id="h14-0-750" class="i">+ * Resizes window to the given size.
</a><a href="#h14-0-751" id="h14-0-751" class="i">+ */
</a><a href="#h14-0-752" id="h14-0-752" class="i">+
</a><a href="#h14-0-753" id="h14-0-753" class="i">+static void
</a><a href="#h14-0-754" id="h14-0-754" class="i">+resize_window_absolute(xcb_window_t win, uint16_t w, uint16_t h)
</a><a href="#h14-0-755" id="h14-0-755" class="i">+{
</a><a href="#h14-0-756" id="h14-0-756" class="i">+	uint16_t val[2];
</a><a href="#h14-0-757" id="h14-0-757" class="i">+	uint16_t mask = XCB_CONFIG_WINDOW_WIDTH
</a><a href="#h14-0-758" id="h14-0-758" class="i">+				  | XCB_CONFIG_WINDOW_HEIGHT;
</a><a href="#h14-0-759" id="h14-0-759" class="i">+
</a><a href="#h14-0-760" id="h14-0-760" class="i">+	val[0] = w;
</a><a href="#h14-0-761" id="h14-0-761" class="i">+	val[1] = h;
</a><a href="#h14-0-762" id="h14-0-762" class="i">+
</a><a href="#h14-0-763" id="h14-0-763" class="i">+	xcb_configure_window(conn, win, mask, val);
</a><a href="#h14-0-764" id="h14-0-764" class="i">+}
</a><a href="#h14-0-765" id="h14-0-765" class="i">+
</a><a href="#h14-0-766" id="h14-0-766" class="i">+/*
</a><a href="#h14-0-767" id="h14-0-767" class="i">+ * Resizes window by a certain amount.
</a><a href="#h14-0-768" id="h14-0-768" class="i">+ */
</a><a href="#h14-0-769" id="h14-0-769" class="i">+
</a><a href="#h14-0-770" id="h14-0-770" class="i">+static void
</a><a href="#h14-0-771" id="h14-0-771" class="i">+resize_window(xcb_window_t win, int16_t w, int16_t h)
</a><a href="#h14-0-772" id="h14-0-772" class="i">+{
</a><a href="#h14-0-773" id="h14-0-773" class="i">+	uint16_t win_w, win_h;
</a><a href="#h14-0-774" id="h14-0-774" class="i">+
</a><a href="#h14-0-775" id="h14-0-775" class="i">+	get_geometry(&amp;win, NULL, NULL, &amp;win_w, &amp;win_h);
</a><a href="#h14-0-776" id="h14-0-776" class="i">+	resize_window_absolute(win, win_w + w, win_h + h);
</a><a href="#h14-0-777" id="h14-0-777" class="i">+}
</a><a href="#h14-0-778" id="h14-0-778" class="i">+
</a><a href="#h14-0-779" id="h14-0-779" class="i">+static void
</a><a href="#h14-0-780" id="h14-0-780" class="i">+resize_window_limit(struct client *client)
</a><a href="#h14-0-781" id="h14-0-781" class="i">+{
</a><a href="#h14-0-782" id="h14-0-782" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-783" id="h14-0-783" class="i">+	uint16_t mon_width, mon_height;
</a><a href="#h14-0-784" id="h14-0-784" class="i">+
</a><a href="#h14-0-785" id="h14-0-785" class="i">+	get_monitor_size(client, &amp;mon_x, &amp;mon_y, &amp;mon_width, &amp;mon_height);
</a><a href="#h14-0-786" id="h14-0-786" class="i">+}
</a><a href="#h14-0-787" id="h14-0-787" class="i">+
</a><a href="#h14-0-788" id="h14-0-788" class="i">+static void
</a><a href="#h14-0-789" id="h14-0-789" class="i">+fit_on_screen(struct client *client)
</a><a href="#h14-0-790" id="h14-0-790" class="i">+{
</a><a href="#h14-0-791" id="h14-0-791" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-792" id="h14-0-792" class="i">+	uint16_t mon_width, mon_height;
</a><a href="#h14-0-793" id="h14-0-793" class="i">+	bool will_resize, will_move;
</a><a href="#h14-0-794" id="h14-0-794" class="i">+
</a><a href="#h14-0-795" id="h14-0-795" class="i">+	will_resize = will_move = false;
</a><a href="#h14-0-796" id="h14-0-796" class="i">+	client-&gt;hmaxed = client-&gt;vmaxed = false;
</a><a href="#h14-0-797" id="h14-0-797" class="i">+	get_monitor_size(client, &amp;mon_x, &amp;mon_y, &amp;mon_width, &amp;mon_height);
</a><a href="#h14-0-798" id="h14-0-798" class="i">+	if (client-&gt;maxed) {
</a><a href="#h14-0-799" id="h14-0-799" class="i">+		client-&gt;maxed = false;
</a><a href="#h14-0-800" id="h14-0-800" class="i">+	} else if (client-&gt;geom.width == mon_width &amp;&amp; client-&gt;geom.height == mon_height) {
</a><a href="#h14-0-801" id="h14-0-801" class="i">+		client-&gt;geom.x = mon_x;
</a><a href="#h14-0-802" id="h14-0-802" class="i">+		client-&gt;geom.y = mon_y;
</a><a href="#h14-0-803" id="h14-0-803" class="i">+		client-&gt;geom.width -= 2 * conf.border_width;
</a><a href="#h14-0-804" id="h14-0-804" class="i">+		client-&gt;geom.height -= 2 * conf.border_width;
</a><a href="#h14-0-805" id="h14-0-805" class="i">+		maximize_window(client, mon_x, mon_y, mon_width, mon_height);
</a><a href="#h14-0-806" id="h14-0-806" class="i">+		return;
</a><a href="#h14-0-807" id="h14-0-807" class="i">+	}
</a><a href="#h14-0-808" id="h14-0-808" class="i">+
</a><a href="#h14-0-809" id="h14-0-809" class="i">+	/* Is it outside the display? */
</a><a href="#h14-0-810" id="h14-0-810" class="i">+	if (client-&gt;geom.x &gt; mon_x + mon_width || client-&gt;geom.y &gt; mon_y + mon_height
</a><a href="#h14-0-811" id="h14-0-811" class="i">+			|| client-&gt;geom.x &lt; mon_x || client-&gt;geom.y &lt; mon_y) {
</a><a href="#h14-0-812" id="h14-0-812" class="i">+		will_move = true;
</a><a href="#h14-0-813" id="h14-0-813" class="i">+		if (client-&gt;geom.x &gt; mon_x + mon_width)
</a><a href="#h14-0-814" id="h14-0-814" class="i">+			client-&gt;geom.x = mon_x + mon_width - client-&gt;geom.width - 2 * conf.border_width;
</a><a href="#h14-0-815" id="h14-0-815" class="i">+		else if (client-&gt;geom.x &lt; mon_x)
</a><a href="#h14-0-816" id="h14-0-816" class="i">+			client-&gt;geom.x = mon_x;
</a><a href="#h14-0-817" id="h14-0-817" class="i">+		if (client-&gt;geom.y &gt; mon_y + mon_height)
</a><a href="#h14-0-818" id="h14-0-818" class="i">+			client-&gt;geom.y = mon_y + mon_height - client-&gt;geom.height - 2 * conf.border_width;
</a><a href="#h14-0-819" id="h14-0-819" class="i">+		else if (client-&gt;geom.y &lt; mon_y)
</a><a href="#h14-0-820" id="h14-0-820" class="i">+			client-&gt;geom.y = mon_y;
</a><a href="#h14-0-821" id="h14-0-821" class="i">+	}
</a><a href="#h14-0-822" id="h14-0-822" class="i">+
</a><a href="#h14-0-823" id="h14-0-823" class="i">+	/* Is it smaller than it wants to be? */
</a><a href="#h14-0-824" id="h14-0-824" class="i">+	if (client-&gt;min_width != 0 &amp;&amp; client-&gt;geom.width &lt; client-&gt;min_width) {
</a><a href="#h14-0-825" id="h14-0-825" class="i">+		client-&gt;geom.width = client-&gt;min_width;
</a><a href="#h14-0-826" id="h14-0-826" class="i">+		will_resize = true;
</a><a href="#h14-0-827" id="h14-0-827" class="i">+	}
</a><a href="#h14-0-828" id="h14-0-828" class="i">+	if (client-&gt;min_height != 0 &amp;&amp; client-&gt;geom.height &lt; client-&gt;min_height) {
</a><a href="#h14-0-829" id="h14-0-829" class="i">+		client-&gt;geom.height = client-&gt;min_height;
</a><a href="#h14-0-830" id="h14-0-830" class="i">+
</a><a href="#h14-0-831" id="h14-0-831" class="i">+		will_resize = true;
</a><a href="#h14-0-832" id="h14-0-832" class="i">+	}
</a><a href="#h14-0-833" id="h14-0-833" class="i">+
</a><a href="#h14-0-834" id="h14-0-834" class="i">+	/* If the window is larger than the screen or is a bit in the outside,
</a><a href="#h14-0-835" id="h14-0-835" class="i">+	 * move it to the corner and resize it accordingly. */
</a><a href="#h14-0-836" id="h14-0-836" class="i">+	if (client-&gt;geom.width + 2 * conf.border_width &gt; mon_width) {
</a><a href="#h14-0-837" id="h14-0-837" class="i">+		client-&gt;geom.x = mon_x;
</a><a href="#h14-0-838" id="h14-0-838" class="i">+		client-&gt;geom.width = mon_width - 2 * conf.border_width;
</a><a href="#h14-0-839" id="h14-0-839" class="i">+		will_move = will_resize = true;
</a><a href="#h14-0-840" id="h14-0-840" class="i">+	} else if (client-&gt;geom.x + client-&gt;geom.width + 2 * conf.border_width
</a><a href="#h14-0-841" id="h14-0-841" class="i">+			&gt; mon_x + mon_width) {
</a><a href="#h14-0-842" id="h14-0-842" class="i">+		client-&gt;geom.x = mon_x + mon_width - client-&gt;geom.width - 2 * conf.border_width;
</a><a href="#h14-0-843" id="h14-0-843" class="i">+		will_move = true;
</a><a href="#h14-0-844" id="h14-0-844" class="i">+	}
</a><a href="#h14-0-845" id="h14-0-845" class="i">+
</a><a href="#h14-0-846" id="h14-0-846" class="i">+	if (client-&gt;geom.height + 2 * conf.border_width &gt; mon_height) {
</a><a href="#h14-0-847" id="h14-0-847" class="i">+		client-&gt;geom.y = mon_y;
</a><a href="#h14-0-848" id="h14-0-848" class="i">+		client-&gt;geom.height = mon_height - 2 * conf.border_width;
</a><a href="#h14-0-849" id="h14-0-849" class="i">+		will_move = will_resize = true;
</a><a href="#h14-0-850" id="h14-0-850" class="i">+	} else if (client-&gt;geom.y + client-&gt;geom.height + 2 * conf.border_width
</a><a href="#h14-0-851" id="h14-0-851" class="i">+			&gt; mon_y + mon_height) {
</a><a href="#h14-0-852" id="h14-0-852" class="i">+		client-&gt;geom.y = mon_y + mon_height - client-&gt;geom.height - 2 * conf.border_width;
</a><a href="#h14-0-853" id="h14-0-853" class="i">+		will_move = true;
</a><a href="#h14-0-854" id="h14-0-854" class="i">+	}
</a><a href="#h14-0-855" id="h14-0-855" class="i">+
</a><a href="#h14-0-856" id="h14-0-856" class="i">+	if (will_move)
</a><a href="#h14-0-857" id="h14-0-857" class="i">+		teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-858" id="h14-0-858" class="i">+	if (will_resize)
</a><a href="#h14-0-859" id="h14-0-859" class="i">+		resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
</a><a href="#h14-0-860" id="h14-0-860" class="i">+}
</a><a href="#h14-0-861" id="h14-0-861" class="i">+
</a><a href="#h14-0-862" id="h14-0-862" class="i">+static void
</a><a href="#h14-0-863" id="h14-0-863" class="i">+maximize_window(struct client *client, int16_t mon_x, int16_t mon_y, uint16_t mon_width, uint16_t mon_height)
</a><a href="#h14-0-864" id="h14-0-864" class="i">+{
</a><a href="#h14-0-865" id="h14-0-865" class="i">+	uint32_t values[1];
</a><a href="#h14-0-866" id="h14-0-866" class="i">+
</a><a href="#h14-0-867" id="h14-0-867" class="i">+	if ((client-&gt;max_width != 0 &amp;&amp; mon_width &gt; client-&gt;max_width)
</a><a href="#h14-0-868" id="h14-0-868" class="i">+			|| (client-&gt;max_height != 0 &amp;&amp; mon_height &gt; client-&gt;max_height))
</a><a href="#h14-0-869" id="h14-0-869" class="i">+		return;
</a><a href="#h14-0-870" id="h14-0-870" class="i">+
</a><a href="#h14-0-871" id="h14-0-871" class="i">+	/* maximized windows don&apos;t have borders */
</a><a href="#h14-0-872" id="h14-0-872" class="i">+	values[0] = 0;
</a><a href="#h14-0-873" id="h14-0-873" class="i">+	if (client-&gt;geom.width != mon_width || client-&gt;geom.height != mon_height)
</a><a href="#h14-0-874" id="h14-0-874" class="i">+		save_original_size(client);
</a><a href="#h14-0-875" id="h14-0-875" class="i">+	xcb_configure_window(conn, client-&gt;window, XCB_CONFIG_WINDOW_BORDER_WIDTH,
</a><a href="#h14-0-876" id="h14-0-876" class="i">+			values);
</a><a href="#h14-0-877" id="h14-0-877" class="i">+
</a><a href="#h14-0-878" id="h14-0-878" class="i">+	client-&gt;geom.x = mon_x;
</a><a href="#h14-0-879" id="h14-0-879" class="i">+	client-&gt;geom.y = mon_y;
</a><a href="#h14-0-880" id="h14-0-880" class="i">+	client-&gt;geom.width = mon_width;
</a><a href="#h14-0-881" id="h14-0-881" class="i">+	client-&gt;geom.height = mon_height;
</a><a href="#h14-0-882" id="h14-0-882" class="i">+	client-&gt;vmaxed = client-&gt;hmaxed = false;
</a><a href="#h14-0-883" id="h14-0-883" class="i">+
</a><a href="#h14-0-884" id="h14-0-884" class="i">+	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-885" id="h14-0-885" class="i">+	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
</a><a href="#h14-0-886" id="h14-0-886" class="i">+	client-&gt;maxed = true;
</a><a href="#h14-0-887" id="h14-0-887" class="i">+}
</a><a href="#h14-0-888" id="h14-0-888" class="i">+
</a><a href="#h14-0-889" id="h14-0-889" class="i">+static void
</a><a href="#h14-0-890" id="h14-0-890" class="i">+hmaximize_window(struct client *client, int16_t mon_x, uint16_t mon_width) {
</a><a href="#h14-0-891" id="h14-0-891" class="i">+	if (client-&gt;max_width != 0 &amp;&amp; mon_width &gt; client-&gt;max_width)
</a><a href="#h14-0-892" id="h14-0-892" class="i">+		return;
</a><a href="#h14-0-893" id="h14-0-893" class="i">+
</a><a href="#h14-0-894" id="h14-0-894" class="i">+	if (client-&gt;geom.width != mon_width)
</a><a href="#h14-0-895" id="h14-0-895" class="i">+		save_original_size(client);
</a><a href="#h14-0-896" id="h14-0-896" class="i">+	client-&gt;geom.x = mon_x + conf.gap - conf.border_width;
</a><a href="#h14-0-897" id="h14-0-897" class="i">+	client-&gt;geom.width = mon_width - 2 * conf.gap;
</a><a href="#h14-0-898" id="h14-0-898" class="i">+	client-&gt;vmaxed = client-&gt;maxed = false;
</a><a href="#h14-0-899" id="h14-0-899" class="i">+
</a><a href="#h14-0-900" id="h14-0-900" class="i">+	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-901" id="h14-0-901" class="i">+	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
</a><a href="#h14-0-902" id="h14-0-902" class="i">+	client-&gt;hmaxed = true;
</a><a href="#h14-0-903" id="h14-0-903" class="i">+}
</a><a href="#h14-0-904" id="h14-0-904" class="i">+
</a><a href="#h14-0-905" id="h14-0-905" class="i">+static void
</a><a href="#h14-0-906" id="h14-0-906" class="i">+vmaximize_window(struct client *client, int16_t mon_y, uint16_t mon_height) {
</a><a href="#h14-0-907" id="h14-0-907" class="i">+	if (client-&gt;max_height != 0 &amp;&amp; mon_height &gt; client-&gt;max_height)
</a><a href="#h14-0-908" id="h14-0-908" class="i">+		return;
</a><a href="#h14-0-909" id="h14-0-909" class="i">+
</a><a href="#h14-0-910" id="h14-0-910" class="i">+	if (client-&gt;geom.height != mon_height)
</a><a href="#h14-0-911" id="h14-0-911" class="i">+		save_original_size(client);
</a><a href="#h14-0-912" id="h14-0-912" class="i">+
</a><a href="#h14-0-913" id="h14-0-913" class="i">+	client-&gt;geom.y = mon_y + conf.gap - conf.border_width;
</a><a href="#h14-0-914" id="h14-0-914" class="i">+	client-&gt;geom.height = mon_height - 2 * conf.gap;
</a><a href="#h14-0-915" id="h14-0-915" class="i">+	client-&gt;hmaxed = client-&gt;maxed = false;
</a><a href="#h14-0-916" id="h14-0-916" class="i">+
</a><a href="#h14-0-917" id="h14-0-917" class="i">+	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-918" id="h14-0-918" class="i">+	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
</a><a href="#h14-0-919" id="h14-0-919" class="i">+	client-&gt;vmaxed = true;
</a><a href="#h14-0-920" id="h14-0-920" class="i">+}
</a><a href="#h14-0-921" id="h14-0-921" class="i">+
</a><a href="#h14-0-922" id="h14-0-922" class="i">+static void
</a><a href="#h14-0-923" id="h14-0-923" class="i">+unmaximize_window(struct client *client) {
</a><a href="#h14-0-924" id="h14-0-924" class="i">+	client-&gt;geom.x = client-&gt;orig_geom.x;
</a><a href="#h14-0-925" id="h14-0-925" class="i">+	client-&gt;geom.y = client-&gt;orig_geom.y;
</a><a href="#h14-0-926" id="h14-0-926" class="i">+	client-&gt;geom.width = client-&gt;orig_geom.width;
</a><a href="#h14-0-927" id="h14-0-927" class="i">+	client-&gt;geom.height = client-&gt;orig_geom.height;
</a><a href="#h14-0-928" id="h14-0-928" class="i">+	client-&gt;maxed = client-&gt;hmaxed = client-&gt;vmaxed = false;
</a><a href="#h14-0-929" id="h14-0-929" class="i">+
</a><a href="#h14-0-930" id="h14-0-930" class="i">+	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-931" id="h14-0-931" class="i">+	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
</a><a href="#h14-0-932" id="h14-0-932" class="i">+}
</a><a href="#h14-0-933" id="h14-0-933" class="i">+
</a><a href="#h14-0-934" id="h14-0-934" class="i">+static void
</a><a href="#h14-0-935" id="h14-0-935" class="i">+cycle_window(struct client *client)
</a><a href="#h14-0-936" id="h14-0-936" class="i">+{
</a><a href="#h14-0-937" id="h14-0-937" class="i">+	struct list_item *item;
</a><a href="#h14-0-938" id="h14-0-938" class="i">+	struct client *data;
</a><a href="#h14-0-939" id="h14-0-939" class="i">+
</a><a href="#h14-0-940" id="h14-0-940" class="i">+	item = win_list;
</a><a href="#h14-0-941" id="h14-0-941" class="i">+	if (client != NULL)
</a><a href="#h14-0-942" id="h14-0-942" class="i">+		while (item != NULL &amp;&amp; item-&gt;data != client)
</a><a href="#h14-0-943" id="h14-0-943" class="i">+			item = item-&gt;next;
</a><a href="#h14-0-944" id="h14-0-944" class="i">+
</a><a href="#h14-0-945" id="h14-0-945" class="i">+	/* if item is not found item will be null
</a><a href="#h14-0-946" id="h14-0-946" class="i">+	 * and we&apos;ll get a nice segmentation fault. may the debugger be with you */
</a><a href="#h14-0-947" id="h14-0-947" class="i">+	if (item != NULL)
</a><a href="#h14-0-948" id="h14-0-948" class="i">+		do {
</a><a href="#h14-0-949" id="h14-0-949" class="i">+			item = item-&gt;next;
</a><a href="#h14-0-950" id="h14-0-950" class="i">+			if (item == NULL)
</a><a href="#h14-0-951" id="h14-0-951" class="i">+				item = win_list;
</a><a href="#h14-0-952" id="h14-0-952" class="i">+			data = item-&gt;data;
</a><a href="#h14-0-953" id="h14-0-953" class="i">+		} while (item != NULL &amp;&amp; !data-&gt;mapped);
</a><a href="#h14-0-954" id="h14-0-954" class="i">+
</a><a href="#h14-0-955" id="h14-0-955" class="i">+	if (item != NULL &amp;&amp; item-&gt;data != client)
</a><a href="#h14-0-956" id="h14-0-956" class="i">+		set_focused(item-&gt;data);
</a><a href="#h14-0-957" id="h14-0-957" class="i">+}
</a><a href="#h14-0-958" id="h14-0-958" class="i">+
</a><a href="#h14-0-959" id="h14-0-959" class="i">+static void
</a><a href="#h14-0-960" id="h14-0-960" class="i">+rcycle_window(struct client *client)
</a><a href="#h14-0-961" id="h14-0-961" class="i">+{
</a><a href="#h14-0-962" id="h14-0-962" class="i">+	struct list_item *item;
</a><a href="#h14-0-963" id="h14-0-963" class="i">+	struct list_item *last_item;
</a><a href="#h14-0-964" id="h14-0-964" class="i">+	struct client *data;
</a><a href="#h14-0-965" id="h14-0-965" class="i">+
</a><a href="#h14-0-966" id="h14-0-966" class="i">+	item = win_list;
</a><a href="#h14-0-967" id="h14-0-967" class="i">+	if (client != NULL) {
</a><a href="#h14-0-968" id="h14-0-968" class="i">+		while (item != NULL &amp;&amp; item-&gt;data != client)
</a><a href="#h14-0-969" id="h14-0-969" class="i">+			item = item-&gt;next;
</a><a href="#h14-0-970" id="h14-0-970" class="i">+
</a><a href="#h14-0-971" id="h14-0-971" class="i">+		last_item = item;
</a><a href="#h14-0-972" id="h14-0-972" class="i">+		while (last_item-&gt;next != NULL)
</a><a href="#h14-0-973" id="h14-0-973" class="i">+			last_item = last_item-&gt;next;
</a><a href="#h14-0-974" id="h14-0-974" class="i">+
</a><a href="#h14-0-975" id="h14-0-975" class="i">+		do {
</a><a href="#h14-0-976" id="h14-0-976" class="i">+			item = item-&gt;prev;
</a><a href="#h14-0-977" id="h14-0-977" class="i">+			if (item == NULL)
</a><a href="#h14-0-978" id="h14-0-978" class="i">+				item = last_item;
</a><a href="#h14-0-979" id="h14-0-979" class="i">+			data = item-&gt;data;
</a><a href="#h14-0-980" id="h14-0-980" class="i">+		} while (item != NULL &amp;&amp; !data-&gt;mapped);
</a><a href="#h14-0-981" id="h14-0-981" class="i">+	}
</a><a href="#h14-0-982" id="h14-0-982" class="i">+
</a><a href="#h14-0-983" id="h14-0-983" class="i">+	if (item != NULL &amp;&amp; item-&gt;data != client)
</a><a href="#h14-0-984" id="h14-0-984" class="i">+		set_focused(item-&gt;data);
</a><a href="#h14-0-985" id="h14-0-985" class="i">+}
</a><a href="#h14-0-986" id="h14-0-986" class="i">+
</a><a href="#h14-0-987" id="h14-0-987" class="i">+static void
</a><a href="#h14-0-988" id="h14-0-988" class="i">+save_original_size(struct client *client)
</a><a href="#h14-0-989" id="h14-0-989" class="i">+{
</a><a href="#h14-0-990" id="h14-0-990" class="i">+	client-&gt;orig_geom.x = client-&gt;geom.x;
</a><a href="#h14-0-991" id="h14-0-991" class="i">+	client-&gt;orig_geom.y = client-&gt;geom.y;
</a><a href="#h14-0-992" id="h14-0-992" class="i">+	client-&gt;orig_geom.width = client-&gt;geom.width;
</a><a href="#h14-0-993" id="h14-0-993" class="i">+	client-&gt;orig_geom.height = client-&gt;geom.height;
</a><a href="#h14-0-994" id="h14-0-994" class="i">+}
</a><a href="#h14-0-995" id="h14-0-995" class="i">+
</a><a href="#h14-0-996" id="h14-0-996" class="i">+/*
</a><a href="#h14-0-997" id="h14-0-997" class="i">+ * Get atom by name.
</a><a href="#h14-0-998" id="h14-0-998" class="i">+ */
</a><a href="#h14-0-999" id="h14-0-999" class="i">+
</a><a href="#h14-0-1000" id="h14-0-1000" class="i">+static xcb_atom_t
</a><a href="#h14-0-1001" id="h14-0-1001" class="i">+get_atom(char *name)
</a><a href="#h14-0-1002" id="h14-0-1002" class="i">+{
</a><a href="#h14-0-1003" id="h14-0-1003" class="i">+	xcb_intern_atom_cookie_t cookie = xcb_intern_atom(conn, 0, strlen(name), name);
</a><a href="#h14-0-1004" id="h14-0-1004" class="i">+	xcb_intern_atom_reply_t *reply = xcb_intern_atom_reply(conn, cookie, NULL);
</a><a href="#h14-0-1005" id="h14-0-1005" class="i">+
</a><a href="#h14-0-1006" id="h14-0-1006" class="i">+	if (!reply)
</a><a href="#h14-0-1007" id="h14-0-1007" class="i">+		return XCB_ATOM_STRING;
</a><a href="#h14-0-1008" id="h14-0-1008" class="i">+
</a><a href="#h14-0-1009" id="h14-0-1009" class="i">+	return reply-&gt;atom;
</a><a href="#h14-0-1010" id="h14-0-1010" class="i">+}
</a><a href="#h14-0-1011" id="h14-0-1011" class="i">+
</a><a href="#h14-0-1012" id="h14-0-1012" class="i">+/*
</a><a href="#h14-0-1013" id="h14-0-1013" class="i">+ * Get the mouse pointer&apos;s coordinates.
</a><a href="#h14-0-1014" id="h14-0-1014" class="i">+ */
</a><a href="#h14-0-1015" id="h14-0-1015" class="i">+
</a><a href="#h14-0-1016" id="h14-0-1016" class="i">+static bool
</a><a href="#h14-0-1017" id="h14-0-1017" class="i">+get_pointer_location(xcb_window_t *win, int16_t *x, int16_t *y)
</a><a href="#h14-0-1018" id="h14-0-1018" class="i">+{
</a><a href="#h14-0-1019" id="h14-0-1019" class="i">+	xcb_query_pointer_reply_t *pointer;
</a><a href="#h14-0-1020" id="h14-0-1020" class="i">+
</a><a href="#h14-0-1021" id="h14-0-1021" class="i">+	pointer = xcb_query_pointer_reply(conn,
</a><a href="#h14-0-1022" id="h14-0-1022" class="i">+			xcb_query_pointer(conn, *win), 0);
</a><a href="#h14-0-1023" id="h14-0-1023" class="i">+
</a><a href="#h14-0-1024" id="h14-0-1024" class="i">+	*x = pointer-&gt;win_x;
</a><a href="#h14-0-1025" id="h14-0-1025" class="i">+	*y = pointer-&gt;win_y;
</a><a href="#h14-0-1026" id="h14-0-1026" class="i">+
</a><a href="#h14-0-1027" id="h14-0-1027" class="i">+	free(pointer);
</a><a href="#h14-0-1028" id="h14-0-1028" class="i">+
</a><a href="#h14-0-1029" id="h14-0-1029" class="i">+	return pointer != NULL;
</a><a href="#h14-0-1030" id="h14-0-1030" class="i">+}
</a><a href="#h14-0-1031" id="h14-0-1031" class="i">+
</a><a href="#h14-0-1032" id="h14-0-1032" class="i">+static void
</a><a href="#h14-0-1033" id="h14-0-1033" class="i">+center_pointer(struct client *client)
</a><a href="#h14-0-1034" id="h14-0-1034" class="i">+{
</a><a href="#h14-0-1035" id="h14-0-1035" class="i">+	int16_t cur_x, cur_y;
</a><a href="#h14-0-1036" id="h14-0-1036" class="i">+
</a><a href="#h14-0-1037" id="h14-0-1037" class="i">+	cur_x = cur_y = 0;
</a><a href="#h14-0-1038" id="h14-0-1038" class="i">+
</a><a href="#h14-0-1039" id="h14-0-1039" class="i">+	switch (conf.cursor_position) {
</a><a href="#h14-0-1040" id="h14-0-1040" class="i">+	case TOP_LEFT:
</a><a href="#h14-0-1041" id="h14-0-1041" class="i">+		cur_x = 0;
</a><a href="#h14-0-1042" id="h14-0-1042" class="i">+		cur_y = 0;
</a><a href="#h14-0-1043" id="h14-0-1043" class="i">+		break;
</a><a href="#h14-0-1044" id="h14-0-1044" class="i">+	case TOP_RIGHT:
</a><a href="#h14-0-1045" id="h14-0-1045" class="i">+		cur_x = client-&gt;geom.width;
</a><a href="#h14-0-1046" id="h14-0-1046" class="i">+		cur_y = 0;
</a><a href="#h14-0-1047" id="h14-0-1047" class="i">+		break;
</a><a href="#h14-0-1048" id="h14-0-1048" class="i">+	case BOTTOM_LEFT:
</a><a href="#h14-0-1049" id="h14-0-1049" class="i">+		cur_x = client-&gt;geom.width;
</a><a href="#h14-0-1050" id="h14-0-1050" class="i">+		break;
</a><a href="#h14-0-1051" id="h14-0-1051" class="i">+	case BOTTOM_RIGHT:
</a><a href="#h14-0-1052" id="h14-0-1052" class="i">+		cur_x = client-&gt;geom.width;
</a><a href="#h14-0-1053" id="h14-0-1053" class="i">+		cur_y = client-&gt;geom.height;
</a><a href="#h14-0-1054" id="h14-0-1054" class="i">+		break;
</a><a href="#h14-0-1055" id="h14-0-1055" class="i">+	case CENTER:
</a><a href="#h14-0-1056" id="h14-0-1056" class="i">+		cur_x = client-&gt;geom.width / 2;
</a><a href="#h14-0-1057" id="h14-0-1057" class="i">+		cur_y = client-&gt;geom.height / 2;
</a><a href="#h14-0-1058" id="h14-0-1058" class="i">+	}
</a><a href="#h14-0-1059" id="h14-0-1059" class="i">+
</a><a href="#h14-0-1060" id="h14-0-1060" class="i">+	xcb_warp_pointer(conn, XCB_NONE, client-&gt;window, 0, 0, 0, 0, cur_x, cur_y);
</a><a href="#h14-0-1061" id="h14-0-1061" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-1062" id="h14-0-1062" class="i">+}
</a><a href="#h14-0-1063" id="h14-0-1063" class="i">+
</a><a href="#h14-0-1064" id="h14-0-1064" class="i">+/*
</a><a href="#h14-0-1065" id="h14-0-1065" class="i">+ * Get the client instance with a given window id.
</a><a href="#h14-0-1066" id="h14-0-1066" class="i">+ */
</a><a href="#h14-0-1067" id="h14-0-1067" class="i">+
</a><a href="#h14-0-1068" id="h14-0-1068" class="i">+static struct client*
</a><a href="#h14-0-1069" id="h14-0-1069" class="i">+find_client(xcb_window_t *win)
</a><a href="#h14-0-1070" id="h14-0-1070" class="i">+{
</a><a href="#h14-0-1071" id="h14-0-1071" class="i">+	struct list_item *item;
</a><a href="#h14-0-1072" id="h14-0-1072" class="i">+
</a><a href="#h14-0-1073" id="h14-0-1073" class="i">+	item = win_list;
</a><a href="#h14-0-1074" id="h14-0-1074" class="i">+	while (item != NULL &amp;&amp; ((struct client *)item-&gt;data)-&gt;window != *win)
</a><a href="#h14-0-1075" id="h14-0-1075" class="i">+		item = item -&gt;next;
</a><a href="#h14-0-1076" id="h14-0-1076" class="i">+
</a><a href="#h14-0-1077" id="h14-0-1077" class="i">+	if (item == NULL)
</a><a href="#h14-0-1078" id="h14-0-1078" class="i">+		return NULL;
</a><a href="#h14-0-1079" id="h14-0-1079" class="i">+	else
</a><a href="#h14-0-1080" id="h14-0-1080" class="i">+		return item-&gt;data;
</a><a href="#h14-0-1081" id="h14-0-1081" class="i">+}
</a><a href="#h14-0-1082" id="h14-0-1082" class="i">+
</a><a href="#h14-0-1083" id="h14-0-1083" class="i">+/*
</a><a href="#h14-0-1084" id="h14-0-1084" class="i">+ * Get a window&apos;s geometry.
</a><a href="#h14-0-1085" id="h14-0-1085" class="i">+ */
</a><a href="#h14-0-1086" id="h14-0-1086" class="i">+
</a><a href="#h14-0-1087" id="h14-0-1087" class="i">+static bool
</a><a href="#h14-0-1088" id="h14-0-1088" class="i">+get_geometry(xcb_window_t *win, int16_t *x, int16_t *y, uint16_t *width, uint16_t *height)
</a><a href="#h14-0-1089" id="h14-0-1089" class="i">+{
</a><a href="#h14-0-1090" id="h14-0-1090" class="i">+	xcb_get_geometry_reply_t *reply = xcb_get_geometry_reply(conn, xcb_get_geometry(conn, *win), NULL);
</a><a href="#h14-0-1091" id="h14-0-1091" class="i">+
</a><a href="#h14-0-1092" id="h14-0-1092" class="i">+	if (reply == NULL)
</a><a href="#h14-0-1093" id="h14-0-1093" class="i">+		return false;
</a><a href="#h14-0-1094" id="h14-0-1094" class="i">+	if (x != NULL)
</a><a href="#h14-0-1095" id="h14-0-1095" class="i">+		*x = reply-&gt;x;
</a><a href="#h14-0-1096" id="h14-0-1096" class="i">+	if (y != NULL)
</a><a href="#h14-0-1097" id="h14-0-1097" class="i">+		*y = reply-&gt;y;
</a><a href="#h14-0-1098" id="h14-0-1098" class="i">+	if (width != NULL)
</a><a href="#h14-0-1099" id="h14-0-1099" class="i">+		*width = reply-&gt;width;
</a><a href="#h14-0-1100" id="h14-0-1100" class="i">+	if (height != NULL)
</a><a href="#h14-0-1101" id="h14-0-1101" class="i">+		*height = reply-&gt;height;
</a><a href="#h14-0-1102" id="h14-0-1102" class="i">+
</a><a href="#h14-0-1103" id="h14-0-1103" class="i">+	free(reply);
</a><a href="#h14-0-1104" id="h14-0-1104" class="i">+	return true;
</a><a href="#h14-0-1105" id="h14-0-1105" class="i">+}
</a><a href="#h14-0-1106" id="h14-0-1106" class="i">+
</a><a href="#h14-0-1107" id="h14-0-1107" class="i">+/*
</a><a href="#h14-0-1108" id="h14-0-1108" class="i">+ * Set the color of the border.
</a><a href="#h14-0-1109" id="h14-0-1109" class="i">+ */
</a><a href="#h14-0-1110" id="h14-0-1110" class="i">+
</a><a href="#h14-0-1111" id="h14-0-1111" class="i">+static void
</a><a href="#h14-0-1112" id="h14-0-1112" class="i">+set_borders(struct client *client, uint32_t color) {
</a><a href="#h14-0-1113" id="h14-0-1113" class="i">+	if (client == NULL)
</a><a href="#h14-0-1114" id="h14-0-1114" class="i">+		return;
</a><a href="#h14-0-1115" id="h14-0-1115" class="i">+	uint32_t values[1];
</a><a href="#h14-0-1116" id="h14-0-1116" class="i">+	values[0] = conf.border_width;
</a><a href="#h14-0-1117" id="h14-0-1117" class="i">+	xcb_configure_window(conn, client-&gt;window,
</a><a href="#h14-0-1118" id="h14-0-1118" class="i">+			XCB_CONFIG_WINDOW_BORDER_WIDTH, values);
</a><a href="#h14-0-1119" id="h14-0-1119" class="i">+	values[0] = color;
</a><a href="#h14-0-1120" id="h14-0-1120" class="i">+	xcb_change_window_attributes(conn, client-&gt;window, XCB_CW_BORDER_PIXEL, values);
</a><a href="#h14-0-1121" id="h14-0-1121" class="i">+}
</a><a href="#h14-0-1122" id="h14-0-1122" class="i">+
</a><a href="#h14-0-1123" id="h14-0-1123" class="i">+/*
</a><a href="#h14-0-1124" id="h14-0-1124" class="i">+ * Returns true if window is mapped.
</a><a href="#h14-0-1125" id="h14-0-1125" class="i">+ */
</a><a href="#h14-0-1126" id="h14-0-1126" class="i">+
</a><a href="#h14-0-1127" id="h14-0-1127" class="i">+static bool
</a><a href="#h14-0-1128" id="h14-0-1128" class="i">+is_mapped(xcb_window_t win)
</a><a href="#h14-0-1129" id="h14-0-1129" class="i">+{
</a><a href="#h14-0-1130" id="h14-0-1130" class="i">+	bool yes;
</a><a href="#h14-0-1131" id="h14-0-1131" class="i">+	xcb_get_window_attributes_reply_t *r =
</a><a href="#h14-0-1132" id="h14-0-1132" class="i">+		xcb_get_window_attributes_reply(conn,
</a><a href="#h14-0-1133" id="h14-0-1133" class="i">+				xcb_get_window_attributes(conn, win),
</a><a href="#h14-0-1134" id="h14-0-1134" class="i">+				NULL);
</a><a href="#h14-0-1135" id="h14-0-1135" class="i">+	if (r == NULL)
</a><a href="#h14-0-1136" id="h14-0-1136" class="i">+		return false;
</a><a href="#h14-0-1137" id="h14-0-1137" class="i">+
</a><a href="#h14-0-1138" id="h14-0-1138" class="i">+	yes = r-&gt;map_state == XCB_MAP_STATE_VIEWABLE;
</a><a href="#h14-0-1139" id="h14-0-1139" class="i">+	free(r);
</a><a href="#h14-0-1140" id="h14-0-1140" class="i">+
</a><a href="#h14-0-1141" id="h14-0-1141" class="i">+	return yes;
</a><a href="#h14-0-1142" id="h14-0-1142" class="i">+}
</a><a href="#h14-0-1143" id="h14-0-1143" class="i">+
</a><a href="#h14-0-1144" id="h14-0-1144" class="i">+/*
</a><a href="#h14-0-1145" id="h14-0-1145" class="i">+ * Returns the widht of the window border in pixels.
</a><a href="#h14-0-1146" id="h14-0-1146" class="i">+ */
</a><a href="#h14-0-1147" id="h14-0-1147" class="i">+
</a><a href="#h14-0-1148" id="h14-0-1148" class="i">+static uint16_t
</a><a href="#h14-0-1149" id="h14-0-1149" class="i">+get_border_width(xcb_window_t win)
</a><a href="#h14-0-1150" id="h14-0-1150" class="i">+{
</a><a href="#h14-0-1151" id="h14-0-1151" class="i">+	xcb_get_geometry_reply_t *r = xcb_get_geometry_reply(conn,
</a><a href="#h14-0-1152" id="h14-0-1152" class="i">+			xcb_get_geometry(conn, win),
</a><a href="#h14-0-1153" id="h14-0-1153" class="i">+			NULL);
</a><a href="#h14-0-1154" id="h14-0-1154" class="i">+	uint16_t w = r-&gt;border_width;
</a><a href="#h14-0-1155" id="h14-0-1155" class="i">+
</a><a href="#h14-0-1156" id="h14-0-1156" class="i">+	free(r);
</a><a href="#h14-0-1157" id="h14-0-1157" class="i">+
</a><a href="#h14-0-1158" id="h14-0-1158" class="i">+	return w;
</a><a href="#h14-0-1159" id="h14-0-1159" class="i">+}
</a><a href="#h14-0-1160" id="h14-0-1160" class="i">+
</a><a href="#h14-0-1161" id="h14-0-1161" class="i">+/*
</a><a href="#h14-0-1162" id="h14-0-1162" class="i">+ * Deletes and frees a client from the list.
</a><a href="#h14-0-1163" id="h14-0-1163" class="i">+ */
</a><a href="#h14-0-1164" id="h14-0-1164" class="i">+
</a><a href="#h14-0-1165" id="h14-0-1165" class="i">+static void
</a><a href="#h14-0-1166" id="h14-0-1166" class="i">+free_window(struct client *client)
</a><a href="#h14-0-1167" id="h14-0-1167" class="i">+{
</a><a href="#h14-0-1168" id="h14-0-1168" class="i">+	struct list_item *item;
</a><a href="#h14-0-1169" id="h14-0-1169" class="i">+
</a><a href="#h14-0-1170" id="h14-0-1170" class="i">+	item = client-&gt;item;
</a><a href="#h14-0-1171" id="h14-0-1171" class="i">+
</a><a href="#h14-0-1172" id="h14-0-1172" class="i">+	free(client);
</a><a href="#h14-0-1173" id="h14-0-1173" class="i">+	list_delete_item(&amp;win_list, item);
</a><a href="#h14-0-1174" id="h14-0-1174" class="i">+}
</a><a href="#h14-0-1175" id="h14-0-1175" class="i">+
</a><a href="#h14-0-1176" id="h14-0-1176" class="i">+/*
</a><a href="#h14-0-1177" id="h14-0-1177" class="i">+ * Add window to the ewmh client list.
</a><a href="#h14-0-1178" id="h14-0-1178" class="i">+ */
</a><a href="#h14-0-1179" id="h14-0-1179" class="i">+
</a><a href="#h14-0-1180" id="h14-0-1180" class="i">+static void
</a><a href="#h14-0-1181" id="h14-0-1181" class="i">+add_to_client_list(xcb_window_t win)
</a><a href="#h14-0-1182" id="h14-0-1182" class="i">+{
</a><a href="#h14-0-1183" id="h14-0-1183" class="i">+	xcb_change_property(conn, XCB_PROP_MODE_APPEND, scr-&gt;root,
</a><a href="#h14-0-1184" id="h14-0-1184" class="i">+			ewmh-&gt;_NET_CLIENT_LIST, XCB_ATOM_WINDOW, 32, 1, &amp;win);
</a><a href="#h14-0-1185" id="h14-0-1185" class="i">+	xcb_change_property(conn, XCB_PROP_MODE_APPEND, scr-&gt;root, ewmh-&gt;_NET_CLIENT_LIST_STACKING, XCB_ATOM_WINDOW, 32, 1, &amp;win);
</a><a href="#h14-0-1186" id="h14-0-1186" class="i">+}
</a><a href="#h14-0-1187" id="h14-0-1187" class="i">+
</a><a href="#h14-0-1188" id="h14-0-1188" class="i">+/*
</a><a href="#h14-0-1189" id="h14-0-1189" class="i">+ * Adds all windows to the ewmh client list.
</a><a href="#h14-0-1190" id="h14-0-1190" class="i">+ */
</a><a href="#h14-0-1191" id="h14-0-1191" class="i">+
</a><a href="#h14-0-1192" id="h14-0-1192" class="i">+static void
</a><a href="#h14-0-1193" id="h14-0-1193" class="i">+update_client_list(void)
</a><a href="#h14-0-1194" id="h14-0-1194" class="i">+{
</a><a href="#h14-0-1195" id="h14-0-1195" class="i">+	xcb_window_t *children;
</a><a href="#h14-0-1196" id="h14-0-1196" class="i">+	struct client *client;
</a><a href="#h14-0-1197" id="h14-0-1197" class="i">+	uint32_t len;
</a><a href="#h14-0-1198" id="h14-0-1198" class="i">+
</a><a href="#h14-0-1199" id="h14-0-1199" class="i">+	xcb_query_tree_reply_t *reply = xcb_query_tree_reply(conn,
</a><a href="#h14-0-1200" id="h14-0-1200" class="i">+			xcb_query_tree(conn, scr-&gt;root), NULL);
</a><a href="#h14-0-1201" id="h14-0-1201" class="i">+	xcb_delete_property(conn, scr-&gt;root, ewmh-&gt;_NET_CLIENT_LIST);
</a><a href="#h14-0-1202" id="h14-0-1202" class="i">+	xcb_delete_property(conn, scr-&gt;root, ewmh-&gt;_NET_CLIENT_LIST_STACKING);
</a><a href="#h14-0-1203" id="h14-0-1203" class="i">+
</a><a href="#h14-0-1204" id="h14-0-1204" class="i">+	if (reply == NULL) {
</a><a href="#h14-0-1205" id="h14-0-1205" class="i">+		add_to_client_list(0);
</a><a href="#h14-0-1206" id="h14-0-1206" class="i">+		return;
</a><a href="#h14-0-1207" id="h14-0-1207" class="i">+	}
</a><a href="#h14-0-1208" id="h14-0-1208" class="i">+
</a><a href="#h14-0-1209" id="h14-0-1209" class="i">+	len = xcb_query_tree_children_length(reply);
</a><a href="#h14-0-1210" id="h14-0-1210" class="i">+	children = xcb_query_tree_children(reply);
</a><a href="#h14-0-1211" id="h14-0-1211" class="i">+
</a><a href="#h14-0-1212" id="h14-0-1212" class="i">+	for (unsigned int i = 0; i &lt; len; i++) {
</a><a href="#h14-0-1213" id="h14-0-1213" class="i">+		client = find_client(&amp;children[i]);
</a><a href="#h14-0-1214" id="h14-0-1214" class="i">+		if (client != NULL)
</a><a href="#h14-0-1215" id="h14-0-1215" class="i">+			add_to_client_list(client-&gt;window);
</a><a href="#h14-0-1216" id="h14-0-1216" class="i">+	}
</a><a href="#h14-0-1217" id="h14-0-1217" class="i">+
</a><a href="#h14-0-1218" id="h14-0-1218" class="i">+	free(reply);
</a><a href="#h14-0-1219" id="h14-0-1219" class="i">+}
</a><a href="#h14-0-1220" id="h14-0-1220" class="i">+
</a><a href="#h14-0-1221" id="h14-0-1221" class="i">+static void
</a><a href="#h14-0-1222" id="h14-0-1222" class="i">+update_wm_desktop(struct client *client) {
</a><a href="#h14-0-1223" id="h14-0-1223" class="i">+	if (client != NULL)
</a><a href="#h14-0-1224" id="h14-0-1224" class="i">+		xcb_ewmh_set_wm_desktop(ewmh, client-&gt;window, client-&gt;group);
</a><a href="#h14-0-1225" id="h14-0-1225" class="i">+}
</a><a href="#h14-0-1226" id="h14-0-1226" class="i">+
</a><a href="#h14-0-1227" id="h14-0-1227" class="i">+static void
</a><a href="#h14-0-1228" id="h14-0-1228" class="i">+group_add_window(struct client *client, uint32_t group) {
</a><a href="#h14-0-1229" id="h14-0-1229" class="i">+	if (client != NULL &amp;&amp; group &lt; conf.groups) {
</a><a href="#h14-0-1230" id="h14-0-1230" class="i">+		client-&gt;group = group;
</a><a href="#h14-0-1231" id="h14-0-1231" class="i">+		update_wm_desktop(client);
</a><a href="#h14-0-1232" id="h14-0-1232" class="i">+		group_in_use[group] = true;
</a><a href="#h14-0-1233" id="h14-0-1233" class="i">+	}
</a><a href="#h14-0-1234" id="h14-0-1234" class="i">+}
</a><a href="#h14-0-1235" id="h14-0-1235" class="i">+
</a><a href="#h14-0-1236" id="h14-0-1236" class="i">+static void
</a><a href="#h14-0-1237" id="h14-0-1237" class="i">+group_remove_window(struct client *client) {
</a><a href="#h14-0-1238" id="h14-0-1238" class="i">+	if (client != NULL) {
</a><a href="#h14-0-1239" id="h14-0-1239" class="i">+		client-&gt;group = NULL_GROUP;
</a><a href="#h14-0-1240" id="h14-0-1240" class="i">+		update_wm_desktop(client);
</a><a href="#h14-0-1241" id="h14-0-1241" class="i">+	}
</a><a href="#h14-0-1242" id="h14-0-1242" class="i">+}
</a><a href="#h14-0-1243" id="h14-0-1243" class="i">+
</a><a href="#h14-0-1244" id="h14-0-1244" class="i">+static void
</a><a href="#h14-0-1245" id="h14-0-1245" class="i">+group_activate(uint32_t group) {
</a><a href="#h14-0-1246" id="h14-0-1246" class="i">+	struct list_item *item;
</a><a href="#h14-0-1247" id="h14-0-1247" class="i">+	struct client *client;
</a><a href="#h14-0-1248" id="h14-0-1248" class="i">+
</a><a href="#h14-0-1249" id="h14-0-1249" class="i">+	for (item = win_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-1250" id="h14-0-1250" class="i">+		client = item-&gt;data;
</a><a href="#h14-0-1251" id="h14-0-1251" class="i">+		if (client-&gt;group == group)
</a><a href="#h14-0-1252" id="h14-0-1252" class="i">+			xcb_map_window(conn, client-&gt;window);
</a><a href="#h14-0-1253" id="h14-0-1253" class="i">+	}
</a><a href="#h14-0-1254" id="h14-0-1254" class="i">+	group_in_use[group] = true;
</a><a href="#h14-0-1255" id="h14-0-1255" class="i">+}
</a><a href="#h14-0-1256" id="h14-0-1256" class="i">+
</a><a href="#h14-0-1257" id="h14-0-1257" class="i">+static void
</a><a href="#h14-0-1258" id="h14-0-1258" class="i">+group_deactivate(uint32_t group) {
</a><a href="#h14-0-1259" id="h14-0-1259" class="i">+	struct list_item *item;
</a><a href="#h14-0-1260" id="h14-0-1260" class="i">+	struct client *client;
</a><a href="#h14-0-1261" id="h14-0-1261" class="i">+
</a><a href="#h14-0-1262" id="h14-0-1262" class="i">+	for (item = win_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-1263" id="h14-0-1263" class="i">+		client = item-&gt;data;
</a><a href="#h14-0-1264" id="h14-0-1264" class="i">+		if (client-&gt;group == group)
</a><a href="#h14-0-1265" id="h14-0-1265" class="i">+			xcb_unmap_window(conn, client-&gt;window);
</a><a href="#h14-0-1266" id="h14-0-1266" class="i">+	}
</a><a href="#h14-0-1267" id="h14-0-1267" class="i">+	group_in_use[group] = false;
</a><a href="#h14-0-1268" id="h14-0-1268" class="i">+}
</a><a href="#h14-0-1269" id="h14-0-1269" class="i">+
</a><a href="#h14-0-1270" id="h14-0-1270" class="i">+static void
</a><a href="#h14-0-1271" id="h14-0-1271" class="i">+group_toggle(uint32_t group) {
</a><a href="#h14-0-1272" id="h14-0-1272" class="i">+	if (group_in_use[group])
</a><a href="#h14-0-1273" id="h14-0-1273" class="i">+		group_deactivate(group);
</a><a href="#h14-0-1274" id="h14-0-1274" class="i">+	else
</a><a href="#h14-0-1275" id="h14-0-1275" class="i">+		group_activate(group);
</a><a href="#h14-0-1276" id="h14-0-1276" class="i">+}
</a><a href="#h14-0-1277" id="h14-0-1277" class="i">+
</a><a href="#h14-0-1278" id="h14-0-1278" class="i">+static void
</a><a href="#h14-0-1279" id="h14-0-1279" class="i">+change_nr_of_groups(uint32_t groups) {
</a><a href="#h14-0-1280" id="h14-0-1280" class="i">+	bool *copy = malloc(groups * sizeof(bool));
</a><a href="#h14-0-1281" id="h14-0-1281" class="i">+	uint32_t until = groups &lt; conf.groups ? groups : conf.groups;
</a><a href="#h14-0-1282" id="h14-0-1282" class="i">+	struct list_item *item;
</a><a href="#h14-0-1283" id="h14-0-1283" class="i">+	struct client *client;
</a><a href="#h14-0-1284" id="h14-0-1284" class="i">+
</a><a href="#h14-0-1285" id="h14-0-1285" class="i">+	for (uint32_t i = 0; i &lt; until; i++)
</a><a href="#h14-0-1286" id="h14-0-1286" class="i">+		copy[i] = group_in_use[i];
</a><a href="#h14-0-1287" id="h14-0-1287" class="i">+
</a><a href="#h14-0-1288" id="h14-0-1288" class="i">+	free(group_in_use);
</a><a href="#h14-0-1289" id="h14-0-1289" class="i">+	group_in_use = copy;
</a><a href="#h14-0-1290" id="h14-0-1290" class="i">+
</a><a href="#h14-0-1291" id="h14-0-1291" class="i">+	if (groups &lt; conf.groups)
</a><a href="#h14-0-1292" id="h14-0-1292" class="i">+		for (item = win_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-1293" id="h14-0-1293" class="i">+			client = item-&gt;data;
</a><a href="#h14-0-1294" id="h14-0-1294" class="i">+			if (client-&gt;group &gt;= groups) {
</a><a href="#h14-0-1295" id="h14-0-1295" class="i">+				client-&gt;group = NULL_GROUP;
</a><a href="#h14-0-1296" id="h14-0-1296" class="i">+				update_wm_desktop(client);
</a><a href="#h14-0-1297" id="h14-0-1297" class="i">+			}
</a><a href="#h14-0-1298" id="h14-0-1298" class="i">+		}
</a><a href="#h14-0-1299" id="h14-0-1299" class="i">+
</a><a href="#h14-0-1300" id="h14-0-1300" class="i">+	conf.groups = groups;
</a><a href="#h14-0-1301" id="h14-0-1301" class="i">+
</a><a href="#h14-0-1302" id="h14-0-1302" class="i">+}
</a><a href="#h14-0-1303" id="h14-0-1303" class="i">+/*
</a><a href="#h14-0-1304" id="h14-0-1304" class="i">+ * Adds X event handlers to the array.
</a><a href="#h14-0-1305" id="h14-0-1305" class="i">+ */
</a><a href="#h14-0-1306" id="h14-0-1306" class="i">+
</a><a href="#h14-0-1307" id="h14-0-1307" class="i">+static void
</a><a href="#h14-0-1308" id="h14-0-1308" class="i">+register_event_handlers(void)
</a><a href="#h14-0-1309" id="h14-0-1309" class="i">+{
</a><a href="#h14-0-1310" id="h14-0-1310" class="i">+	for (int i = 0; i &lt;= LAST_XCB_EVENT; i++)
</a><a href="#h14-0-1311" id="h14-0-1311" class="i">+		events[i] = NULL;
</a><a href="#h14-0-1312" id="h14-0-1312" class="i">+
</a><a href="#h14-0-1313" id="h14-0-1313" class="i">+	events[XCB_CONFIGURE_REQUEST] = event_configure_request;
</a><a href="#h14-0-1314" id="h14-0-1314" class="i">+	events[XCB_DESTROY_NOTIFY] = event_destroy_notify;
</a><a href="#h14-0-1315" id="h14-0-1315" class="i">+	events[XCB_ENTER_NOTIFY] = event_enter_notify;
</a><a href="#h14-0-1316" id="h14-0-1316" class="i">+	events[XCB_MAP_REQUEST] = event_map_request;
</a><a href="#h14-0-1317" id="h14-0-1317" class="i">+	events[XCB_MAP_NOTIFY] = event_map_notify;
</a><a href="#h14-0-1318" id="h14-0-1318" class="i">+	events[XCB_UNMAP_NOTIFY] = event_unmap_notify;
</a><a href="#h14-0-1319" id="h14-0-1319" class="i">+	events[XCB_CLIENT_MESSAGE] = event_client_message;
</a><a href="#h14-0-1320" id="h14-0-1320" class="i">+	events[XCB_CONFIGURE_NOTIFY] = event_configure_notify;
</a><a href="#h14-0-1321" id="h14-0-1321" class="i">+}
</a><a href="#h14-0-1322" id="h14-0-1322" class="i">+
</a><a href="#h14-0-1323" id="h14-0-1323" class="i">+/*
</a><a href="#h14-0-1324" id="h14-0-1324" class="i">+ * A window wants to be configured.
</a><a href="#h14-0-1325" id="h14-0-1325" class="i">+ */
</a><a href="#h14-0-1326" id="h14-0-1326" class="i">+
</a><a href="#h14-0-1327" id="h14-0-1327" class="i">+static void
</a><a href="#h14-0-1328" id="h14-0-1328" class="i">+event_configure_request(xcb_generic_event_t *ev)
</a><a href="#h14-0-1329" id="h14-0-1329" class="i">+{
</a><a href="#h14-0-1330" id="h14-0-1330" class="i">+	xcb_configure_request_event_t *e = (xcb_configure_request_event_t *)ev;
</a><a href="#h14-0-1331" id="h14-0-1331" class="i">+	struct client *client;
</a><a href="#h14-0-1332" id="h14-0-1332" class="i">+	uint32_t values[7];
</a><a href="#h14-0-1333" id="h14-0-1333" class="i">+	int i = 0;
</a><a href="#h14-0-1334" id="h14-0-1334" class="i">+
</a><a href="#h14-0-1335" id="h14-0-1335" class="i">+	client = find_client(&amp;e-&gt;window);
</a><a href="#h14-0-1336" id="h14-0-1336" class="i">+	if (client != NULL) {
</a><a href="#h14-0-1337" id="h14-0-1337" class="i">+
</a><a href="#h14-0-1338" id="h14-0-1338" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_X
</a><a href="#h14-0-1339" id="h14-0-1339" class="i">+				&amp;&amp; !client-&gt;maxed &amp;&amp; !client-&gt;hmaxed)
</a><a href="#h14-0-1340" id="h14-0-1340" class="i">+			client-&gt;geom.x = e-&gt;x;
</a><a href="#h14-0-1341" id="h14-0-1341" class="i">+
</a><a href="#h14-0-1342" id="h14-0-1342" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_Y
</a><a href="#h14-0-1343" id="h14-0-1343" class="i">+				&amp;&amp; !client-&gt;maxed &amp;&amp; !client-&gt;vmaxed)
</a><a href="#h14-0-1344" id="h14-0-1344" class="i">+			client-&gt;geom.y = e-&gt;y;
</a><a href="#h14-0-1345" id="h14-0-1345" class="i">+
</a><a href="#h14-0-1346" id="h14-0-1346" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_WIDTH
</a><a href="#h14-0-1347" id="h14-0-1347" class="i">+				&amp;&amp; !client-&gt;maxed &amp;&amp; !client-&gt;hmaxed)
</a><a href="#h14-0-1348" id="h14-0-1348" class="i">+			client-&gt;geom.width= e-&gt;width;
</a><a href="#h14-0-1349" id="h14-0-1349" class="i">+
</a><a href="#h14-0-1350" id="h14-0-1350" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_HEIGHT
</a><a href="#h14-0-1351" id="h14-0-1351" class="i">+				&amp;&amp; !client-&gt;maxed &amp;&amp; !client-&gt;vmaxed)
</a><a href="#h14-0-1352" id="h14-0-1352" class="i">+			client-&gt;geom.height = e-&gt;height;
</a><a href="#h14-0-1353" id="h14-0-1353" class="i">+
</a><a href="#h14-0-1354" id="h14-0-1354" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_STACK_MODE) {
</a><a href="#h14-0-1355" id="h14-0-1355" class="i">+			values[0] = e-&gt;stack_mode;
</a><a href="#h14-0-1356" id="h14-0-1356" class="i">+			xcb_configure_window(conn, e-&gt;window,
</a><a href="#h14-0-1357" id="h14-0-1357" class="i">+					XCB_CONFIG_WINDOW_STACK_MODE, values);
</a><a href="#h14-0-1358" id="h14-0-1358" class="i">+		}
</a><a href="#h14-0-1359" id="h14-0-1359" class="i">+
</a><a href="#h14-0-1360" id="h14-0-1360" class="i">+		if (!client-&gt;maxed) {
</a><a href="#h14-0-1361" id="h14-0-1361" class="i">+			fit_on_screen(client);
</a><a href="#h14-0-1362" id="h14-0-1362" class="i">+		}
</a><a href="#h14-0-1363" id="h14-0-1363" class="i">+
</a><a href="#h14-0-1364" id="h14-0-1364" class="i">+		teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-1365" id="h14-0-1365" class="i">+		resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
</a><a href="#h14-0-1366" id="h14-0-1366" class="i">+		if (!client-&gt;maxed)
</a><a href="#h14-0-1367" id="h14-0-1367" class="i">+			set_borders(client, conf.focus_color);
</a><a href="#h14-0-1368" id="h14-0-1368" class="i">+	} else {
</a><a href="#h14-0-1369" id="h14-0-1369" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_X) {
</a><a href="#h14-0-1370" id="h14-0-1370" class="i">+			values[i] = e-&gt;x;
</a><a href="#h14-0-1371" id="h14-0-1371" class="i">+			i++;
</a><a href="#h14-0-1372" id="h14-0-1372" class="i">+		}
</a><a href="#h14-0-1373" id="h14-0-1373" class="i">+
</a><a href="#h14-0-1374" id="h14-0-1374" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_Y) {
</a><a href="#h14-0-1375" id="h14-0-1375" class="i">+			values[i] = e-&gt;y;
</a><a href="#h14-0-1376" id="h14-0-1376" class="i">+			i++;
</a><a href="#h14-0-1377" id="h14-0-1377" class="i">+		}
</a><a href="#h14-0-1378" id="h14-0-1378" class="i">+
</a><a href="#h14-0-1379" id="h14-0-1379" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_WIDTH) {
</a><a href="#h14-0-1380" id="h14-0-1380" class="i">+			values[i] = e-&gt;width;
</a><a href="#h14-0-1381" id="h14-0-1381" class="i">+			i++;
</a><a href="#h14-0-1382" id="h14-0-1382" class="i">+		}
</a><a href="#h14-0-1383" id="h14-0-1383" class="i">+
</a><a href="#h14-0-1384" id="h14-0-1384" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_HEIGHT) {
</a><a href="#h14-0-1385" id="h14-0-1385" class="i">+			values[i] = e-&gt;height;
</a><a href="#h14-0-1386" id="h14-0-1386" class="i">+			i++;
</a><a href="#h14-0-1387" id="h14-0-1387" class="i">+		}
</a><a href="#h14-0-1388" id="h14-0-1388" class="i">+
</a><a href="#h14-0-1389" id="h14-0-1389" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_SIBLING) {
</a><a href="#h14-0-1390" id="h14-0-1390" class="i">+			values[i] = e-&gt;sibling;
</a><a href="#h14-0-1391" id="h14-0-1391" class="i">+			i++;
</a><a href="#h14-0-1392" id="h14-0-1392" class="i">+		}
</a><a href="#h14-0-1393" id="h14-0-1393" class="i">+
</a><a href="#h14-0-1394" id="h14-0-1394" class="i">+		if (e-&gt;value_mask &amp; XCB_CONFIG_WINDOW_STACK_MODE) {
</a><a href="#h14-0-1395" id="h14-0-1395" class="i">+			values[i] = e-&gt;stack_mode;
</a><a href="#h14-0-1396" id="h14-0-1396" class="i">+			i++;
</a><a href="#h14-0-1397" id="h14-0-1397" class="i">+		}
</a><a href="#h14-0-1398" id="h14-0-1398" class="i">+
</a><a href="#h14-0-1399" id="h14-0-1399" class="i">+		if (i == 0)
</a><a href="#h14-0-1400" id="h14-0-1400" class="i">+			return;
</a><a href="#h14-0-1401" id="h14-0-1401" class="i">+		xcb_configure_window(conn, e-&gt;window, e-&gt;value_mask, values);
</a><a href="#h14-0-1402" id="h14-0-1402" class="i">+	}
</a><a href="#h14-0-1403" id="h14-0-1403" class="i">+}
</a><a href="#h14-0-1404" id="h14-0-1404" class="i">+
</a><a href="#h14-0-1405" id="h14-0-1405" class="i">+/*
</a><a href="#h14-0-1406" id="h14-0-1406" class="i">+ * Window has been destroyed.
</a><a href="#h14-0-1407" id="h14-0-1407" class="i">+ */
</a><a href="#h14-0-1408" id="h14-0-1408" class="i">+
</a><a href="#h14-0-1409" id="h14-0-1409" class="i">+static void
</a><a href="#h14-0-1410" id="h14-0-1410" class="i">+event_destroy_notify(xcb_generic_event_t *ev)
</a><a href="#h14-0-1411" id="h14-0-1411" class="i">+{
</a><a href="#h14-0-1412" id="h14-0-1412" class="i">+	struct client *client;
</a><a href="#h14-0-1413" id="h14-0-1413" class="i">+	xcb_destroy_notify_event_t *e = (xcb_destroy_notify_event_t *)ev;
</a><a href="#h14-0-1414" id="h14-0-1414" class="i">+
</a><a href="#h14-0-1415" id="h14-0-1415" class="i">+	client = find_client(&amp;e-&gt;window);
</a><a href="#h14-0-1416" id="h14-0-1416" class="i">+	if (focused_win != NULL &amp;&amp; focused_win == client)
</a><a href="#h14-0-1417" id="h14-0-1417" class="i">+		focused_win = NULL;
</a><a href="#h14-0-1418" id="h14-0-1418" class="i">+
</a><a href="#h14-0-1419" id="h14-0-1419" class="i">+	if (client != NULL) {
</a><a href="#h14-0-1420" id="h14-0-1420" class="i">+		free_window(client);
</a><a href="#h14-0-1421" id="h14-0-1421" class="i">+	}
</a><a href="#h14-0-1422" id="h14-0-1422" class="i">+
</a><a href="#h14-0-1423" id="h14-0-1423" class="i">+	update_client_list();
</a><a href="#h14-0-1424" id="h14-0-1424" class="i">+}
</a><a href="#h14-0-1425" id="h14-0-1425" class="i">+
</a><a href="#h14-0-1426" id="h14-0-1426" class="i">+/*
</a><a href="#h14-0-1427" id="h14-0-1427" class="i">+ * The mouse pointer has entered the window.
</a><a href="#h14-0-1428" id="h14-0-1428" class="i">+ */
</a><a href="#h14-0-1429" id="h14-0-1429" class="i">+
</a><a href="#h14-0-1430" id="h14-0-1430" class="i">+static void
</a><a href="#h14-0-1431" id="h14-0-1431" class="i">+event_enter_notify(xcb_generic_event_t *ev)
</a><a href="#h14-0-1432" id="h14-0-1432" class="i">+{
</a><a href="#h14-0-1433" id="h14-0-1433" class="i">+	xcb_enter_notify_event_t *e = (xcb_enter_notify_event_t *)ev;
</a><a href="#h14-0-1434" id="h14-0-1434" class="i">+	struct client *client;
</a><a href="#h14-0-1435" id="h14-0-1435" class="i">+
</a><a href="#h14-0-1436" id="h14-0-1436" class="i">+	if (e-&gt;mode == XCB_NOTIFY_MODE_NORMAL ||
</a><a href="#h14-0-1437" id="h14-0-1437" class="i">+			e-&gt;mode == XCB_NOTIFY_MODE_UNGRAB) {
</a><a href="#h14-0-1438" id="h14-0-1438" class="i">+		if (focused_win != NULL &amp;&amp; e-&gt;event == focused_win-&gt;window)
</a><a href="#h14-0-1439" id="h14-0-1439" class="i">+			return;
</a><a href="#h14-0-1440" id="h14-0-1440" class="i">+
</a><a href="#h14-0-1441" id="h14-0-1441" class="i">+		client = find_client(&amp;e-&gt;event);
</a><a href="#h14-0-1442" id="h14-0-1442" class="i">+		if (client == NULL || client-&gt;maxed)
</a><a href="#h14-0-1443" id="h14-0-1443" class="i">+			return;
</a><a href="#h14-0-1444" id="h14-0-1444" class="i">+
</a><a href="#h14-0-1445" id="h14-0-1445" class="i">+		set_focused_no_raise(client);
</a><a href="#h14-0-1446" id="h14-0-1446" class="i">+	}
</a><a href="#h14-0-1447" id="h14-0-1447" class="i">+}
</a><a href="#h14-0-1448" id="h14-0-1448" class="i">+
</a><a href="#h14-0-1449" id="h14-0-1449" class="i">+/*
</a><a href="#h14-0-1450" id="h14-0-1450" class="i">+ * A window wants to show up on the screen.
</a><a href="#h14-0-1451" id="h14-0-1451" class="i">+ */
</a><a href="#h14-0-1452" id="h14-0-1452" class="i">+
</a><a href="#h14-0-1453" id="h14-0-1453" class="i">+static void
</a><a href="#h14-0-1454" id="h14-0-1454" class="i">+event_map_request(xcb_generic_event_t *ev)
</a><a href="#h14-0-1455" id="h14-0-1455" class="i">+{
</a><a href="#h14-0-1456" id="h14-0-1456" class="i">+	xcb_map_request_event_t *e = (xcb_map_request_event_t *)ev;
</a><a href="#h14-0-1457" id="h14-0-1457" class="i">+	struct client *client;
</a><a href="#h14-0-1458" id="h14-0-1458" class="i">+	long data[] = {
</a><a href="#h14-0-1459" id="h14-0-1459" class="i">+		XCB_ICCCM_WM_STATE_NORMAL,
</a><a href="#h14-0-1460" id="h14-0-1460" class="i">+		XCB_NONE,
</a><a href="#h14-0-1461" id="h14-0-1461" class="i">+	};
</a><a href="#h14-0-1462" id="h14-0-1462" class="i">+
</a><a href="#h14-0-1463" id="h14-0-1463" class="i">+	/* window wants to magically show up. we prohibit that */
</a><a href="#h14-0-1464" id="h14-0-1464" class="i">+	if (find_client(&amp;e-&gt;window) != NULL)
</a><a href="#h14-0-1465" id="h14-0-1465" class="i">+		return;
</a><a href="#h14-0-1466" id="h14-0-1466" class="i">+
</a><a href="#h14-0-1467" id="h14-0-1467" class="i">+	client = setup_window(e-&gt;window);
</a><a href="#h14-0-1468" id="h14-0-1468" class="i">+
</a><a href="#h14-0-1469" id="h14-0-1469" class="i">+	if (!client-&gt;geom.set_by_user) {
</a><a href="#h14-0-1470" id="h14-0-1470" class="i">+		if (!get_pointer_location(&amp;scr-&gt;root, &amp;client-&gt;geom.x, &amp;client-&gt;geom.y))
</a><a href="#h14-0-1471" id="h14-0-1471" class="i">+			client-&gt;geom.x = client-&gt;geom.y = 0;
</a><a href="#h14-0-1472" id="h14-0-1472" class="i">+
</a><a href="#h14-0-1473" id="h14-0-1473" class="i">+		client-&gt;geom.x -= client-&gt;geom.width / 2;
</a><a href="#h14-0-1474" id="h14-0-1474" class="i">+		client-&gt;geom.y -= client-&gt;geom.height / 2;
</a><a href="#h14-0-1475" id="h14-0-1475" class="i">+		teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-1476" id="h14-0-1476" class="i">+	}
</a><a href="#h14-0-1477" id="h14-0-1477" class="i">+
</a><a href="#h14-0-1478" id="h14-0-1478" class="i">+	if (randr_base != -1) {
</a><a href="#h14-0-1479" id="h14-0-1479" class="i">+		client-&gt;monitor = find_monitor_by_coord(client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-1480" id="h14-0-1480" class="i">+		if (client-&gt;monitor == NULL &amp;&amp; mon_list != NULL)
</a><a href="#h14-0-1481" id="h14-0-1481" class="i">+			client-&gt;monitor = mon_list-&gt;data;
</a><a href="#h14-0-1482" id="h14-0-1482" class="i">+	}
</a><a href="#h14-0-1483" id="h14-0-1483" class="i">+
</a><a href="#h14-0-1484" id="h14-0-1484" class="i">+	fit_on_screen(client);
</a><a href="#h14-0-1485" id="h14-0-1485" class="i">+
</a><a href="#h14-0-1486" id="h14-0-1486" class="i">+	xcb_map_window(conn, client-&gt;window);
</a><a href="#h14-0-1487" id="h14-0-1487" class="i">+	xcb_change_property(conn, XCB_PROP_MODE_REPLACE, client-&gt;window,
</a><a href="#h14-0-1488" id="h14-0-1488" class="i">+			ewmh-&gt;_NET_WM_STATE, ewmh-&gt;_NET_WM_STATE, 32, 2, data);
</a><a href="#h14-0-1489" id="h14-0-1489" class="i">+
</a><a href="#h14-0-1490" id="h14-0-1490" class="i">+	center_pointer(client);
</a><a href="#h14-0-1491" id="h14-0-1491" class="i">+	update_client_list();
</a><a href="#h14-0-1492" id="h14-0-1492" class="i">+
</a><a href="#h14-0-1493" id="h14-0-1493" class="i">+	if (!client-&gt;maxed)
</a><a href="#h14-0-1494" id="h14-0-1494" class="i">+		set_borders(client, conf.focus_color);
</a><a href="#h14-0-1495" id="h14-0-1495" class="i">+}
</a><a href="#h14-0-1496" id="h14-0-1496" class="i">+
</a><a href="#h14-0-1497" id="h14-0-1497" class="i">+static void
</a><a href="#h14-0-1498" id="h14-0-1498" class="i">+event_map_notify(xcb_generic_event_t *ev)
</a><a href="#h14-0-1499" id="h14-0-1499" class="i">+{
</a><a href="#h14-0-1500" id="h14-0-1500" class="i">+	xcb_map_notify_event_t *e = (xcb_map_notify_event_t *)ev;
</a><a href="#h14-0-1501" id="h14-0-1501" class="i">+	struct client *client = find_client(&amp;e-&gt;window);
</a><a href="#h14-0-1502" id="h14-0-1502" class="i">+
</a><a href="#h14-0-1503" id="h14-0-1503" class="i">+	if (client != NULL)
</a><a href="#h14-0-1504" id="h14-0-1504" class="i">+		client-&gt;mapped = true;
</a><a href="#h14-0-1505" id="h14-0-1505" class="i">+}
</a><a href="#h14-0-1506" id="h14-0-1506" class="i">+
</a><a href="#h14-0-1507" id="h14-0-1507" class="i">+/*
</a><a href="#h14-0-1508" id="h14-0-1508" class="i">+ * Window has been unmapped (became invisible).
</a><a href="#h14-0-1509" id="h14-0-1509" class="i">+ */
</a><a href="#h14-0-1510" id="h14-0-1510" class="i">+
</a><a href="#h14-0-1511" id="h14-0-1511" class="i">+static void
</a><a href="#h14-0-1512" id="h14-0-1512" class="i">+event_unmap_notify(xcb_generic_event_t *ev)
</a><a href="#h14-0-1513" id="h14-0-1513" class="i">+{
</a><a href="#h14-0-1514" id="h14-0-1514" class="i">+	xcb_map_request_event_t *e = (xcb_map_request_event_t *)ev;
</a><a href="#h14-0-1515" id="h14-0-1515" class="i">+	struct client *client = NULL;
</a><a href="#h14-0-1516" id="h14-0-1516" class="i">+
</a><a href="#h14-0-1517" id="h14-0-1517" class="i">+	client = find_client(&amp;e-&gt;window);
</a><a href="#h14-0-1518" id="h14-0-1518" class="i">+	if (client == NULL)
</a><a href="#h14-0-1519" id="h14-0-1519" class="i">+		return;
</a><a href="#h14-0-1520" id="h14-0-1520" class="i">+
</a><a href="#h14-0-1521" id="h14-0-1521" class="i">+	if (focused_win != NULL &amp;&amp; client-&gt;window == focused_win-&gt;window)
</a><a href="#h14-0-1522" id="h14-0-1522" class="i">+		focused_win = NULL;
</a><a href="#h14-0-1523" id="h14-0-1523" class="i">+
</a><a href="#h14-0-1524" id="h14-0-1524" class="i">+	client-&gt;mapped = false;
</a><a href="#h14-0-1525" id="h14-0-1525" class="i">+
</a><a href="#h14-0-1526" id="h14-0-1526" class="i">+	update_client_list();
</a><a href="#h14-0-1527" id="h14-0-1527" class="i">+}
</a><a href="#h14-0-1528" id="h14-0-1528" class="i">+
</a><a href="#h14-0-1529" id="h14-0-1529" class="i">+/*
</a><a href="#h14-0-1530" id="h14-0-1530" class="i">+ * Window has been configured.
</a><a href="#h14-0-1531" id="h14-0-1531" class="i">+ */
</a><a href="#h14-0-1532" id="h14-0-1532" class="i">+
</a><a href="#h14-0-1533" id="h14-0-1533" class="i">+static void
</a><a href="#h14-0-1534" id="h14-0-1534" class="i">+event_configure_notify(xcb_generic_event_t *ev)
</a><a href="#h14-0-1535" id="h14-0-1535" class="i">+{
</a><a href="#h14-0-1536" id="h14-0-1536" class="i">+	xcb_configure_notify_event_t *e = (xcb_configure_notify_event_t *)ev;
</a><a href="#h14-0-1537" id="h14-0-1537" class="i">+	struct client *client;
</a><a href="#h14-0-1538" id="h14-0-1538" class="i">+	struct list_item *item;
</a><a href="#h14-0-1539" id="h14-0-1539" class="i">+
</a><a href="#h14-0-1540" id="h14-0-1540" class="i">+	/* The root window changes its geometry when the
</a><a href="#h14-0-1541" id="h14-0-1541" class="i">+	 * user adds/removes/tilts screens */
</a><a href="#h14-0-1542" id="h14-0-1542" class="i">+	if (e-&gt;window == scr-&gt;root) {
</a><a href="#h14-0-1543" id="h14-0-1543" class="i">+		if (e-&gt;window != scr-&gt;width_in_pixels
</a><a href="#h14-0-1544" id="h14-0-1544" class="i">+				|| e-&gt;height != scr-&gt;height_in_pixels) {
</a><a href="#h14-0-1545" id="h14-0-1545" class="i">+			scr-&gt;width_in_pixels = e-&gt;width;
</a><a href="#h14-0-1546" id="h14-0-1546" class="i">+			scr-&gt;height_in_pixels = e-&gt;height;
</a><a href="#h14-0-1547" id="h14-0-1547" class="i">+
</a><a href="#h14-0-1548" id="h14-0-1548" class="i">+			if (randr_base != -1) {
</a><a href="#h14-0-1549" id="h14-0-1549" class="i">+				get_randr();
</a><a href="#h14-0-1550" id="h14-0-1550" class="i">+				for (item = win_list; item != NULL; item = item-&gt;next) {
</a><a href="#h14-0-1551" id="h14-0-1551" class="i">+					client = item-&gt;data;
</a><a href="#h14-0-1552" id="h14-0-1552" class="i">+					fit_on_screen(client);
</a><a href="#h14-0-1553" id="h14-0-1553" class="i">+				}
</a><a href="#h14-0-1554" id="h14-0-1554" class="i">+			}
</a><a href="#h14-0-1555" id="h14-0-1555" class="i">+		}
</a><a href="#h14-0-1556" id="h14-0-1556" class="i">+	} else {
</a><a href="#h14-0-1557" id="h14-0-1557" class="i">+		client = find_client(&amp;e-&gt;window);
</a><a href="#h14-0-1558" id="h14-0-1558" class="i">+		if (client != NULL)
</a><a href="#h14-0-1559" id="h14-0-1559" class="i">+			client-&gt;monitor = find_monitor_by_coord(client-&gt;geom.x, client-&gt;geom.y);
</a><a href="#h14-0-1560" id="h14-0-1560" class="i">+	}
</a><a href="#h14-0-1561" id="h14-0-1561" class="i">+}
</a><a href="#h14-0-1562" id="h14-0-1562" class="i">+
</a><a href="#h14-0-1563" id="h14-0-1563" class="i">+/*
</a><a href="#h14-0-1564" id="h14-0-1564" class="i">+ * Window wants to change its position in the stacking order.
</a><a href="#h14-0-1565" id="h14-0-1565" class="i">+ */
</a><a href="#h14-0-1566" id="h14-0-1566" class="i">+
</a><a href="#h14-0-1567" id="h14-0-1567" class="i">+static void
</a><a href="#h14-0-1568" id="h14-0-1568" class="i">+event_circulate_request(xcb_generic_event_t *ev)
</a><a href="#h14-0-1569" id="h14-0-1569" class="i">+{
</a><a href="#h14-0-1570" id="h14-0-1570" class="i">+	xcb_circulate_request_event_t *e = (xcb_circulate_request_event_t *)ev;
</a><a href="#h14-0-1571" id="h14-0-1571" class="i">+
</a><a href="#h14-0-1572" id="h14-0-1572" class="i">+	xcb_circulate_window(conn, e-&gt;window, e-&gt;place);
</a><a href="#h14-0-1573" id="h14-0-1573" class="i">+}
</a><a href="#h14-0-1574" id="h14-0-1574" class="i">+
</a><a href="#h14-0-1575" id="h14-0-1575" class="i">+/*
</a><a href="#h14-0-1576" id="h14-0-1576" class="i">+ * Received client message. Either ewmh/icccm thing or
</a><a href="#h14-0-1577" id="h14-0-1577" class="i">+ * message from the client.
</a><a href="#h14-0-1578" id="h14-0-1578" class="i">+ */
</a><a href="#h14-0-1579" id="h14-0-1579" class="i">+
</a><a href="#h14-0-1580" id="h14-0-1580" class="i">+static void
</a><a href="#h14-0-1581" id="h14-0-1581" class="i">+event_client_message(xcb_generic_event_t *ev)
</a><a href="#h14-0-1582" id="h14-0-1582" class="i">+{
</a><a href="#h14-0-1583" id="h14-0-1583" class="i">+	xcb_client_message_event_t *e = (xcb_client_message_event_t *)ev;
</a><a href="#h14-0-1584" id="h14-0-1584" class="i">+	uint32_t ipc_command;
</a><a href="#h14-0-1585" id="h14-0-1585" class="i">+	uint32_t *data;
</a><a href="#h14-0-1586" id="h14-0-1586" class="i">+	bool maxed, vmaxed, hmaxed;
</a><a href="#h14-0-1587" id="h14-0-1587" class="i">+	struct client *client;
</a><a href="#h14-0-1588" id="h14-0-1588" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-1589" id="h14-0-1589" class="i">+	uint16_t mon_w, mon_h;
</a><a href="#h14-0-1590" id="h14-0-1590" class="i">+
</a><a href="#h14-0-1591" id="h14-0-1591" class="i">+	if (e-&gt;type == ATOMS[_IPC_ATOM_COMMAND] &amp;&amp; e-&gt;format == 32) {
</a><a href="#h14-0-1592" id="h14-0-1592" class="i">+		/* Message from the client */
</a><a href="#h14-0-1593" id="h14-0-1593" class="i">+		data = e-&gt;data.data32;
</a><a href="#h14-0-1594" id="h14-0-1594" class="i">+		ipc_command = data[0];
</a><a href="#h14-0-1595" id="h14-0-1595" class="i">+		if (ipc_handlers[ipc_command] != NULL)
</a><a href="#h14-0-1596" id="h14-0-1596" class="i">+			(ipc_handlers[ipc_command])(data + 1);
</a><a href="#h14-0-1597" id="h14-0-1597" class="i">+		DMSG(&quot;%u %u %u %u %u\n&quot;, data[0], data[1], data[2], data[3], data[4]);
</a><a href="#h14-0-1598" id="h14-0-1598" class="i">+	} else if (e-&gt;type == ewmh-&gt;_NET_WM_STATE &amp;&amp; e-&gt;format == 32) {
</a><a href="#h14-0-1599" id="h14-0-1599" class="i">+		/* A window change its state */
</a><a href="#h14-0-1600" id="h14-0-1600" class="i">+		client = find_client(&amp;e-&gt;window);
</a><a href="#h14-0-1601" id="h14-0-1601" class="i">+		maxed = vmaxed = hmaxed = false;
</a><a href="#h14-0-1602" id="h14-0-1602" class="i">+		/* We handle only two states at the same time */
</a><a href="#h14-0-1603" id="h14-0-1603" class="i">+		for (int i = 0; i &lt; 2; i++) {
</a><a href="#h14-0-1604" id="h14-0-1604" class="i">+			xcb_atom_t state = e-&gt;data.data32[i];
</a><a href="#h14-0-1605" id="h14-0-1605" class="i">+			if (state == ewmh-&gt;_NET_WM_STATE_FULLSCREEN)
</a><a href="#h14-0-1606" id="h14-0-1606" class="i">+				maxed = true;
</a><a href="#h14-0-1607" id="h14-0-1607" class="i">+			else if (state == ewmh-&gt;_NET_WM_STATE_MAXIMIZED_VERT)
</a><a href="#h14-0-1608" id="h14-0-1608" class="i">+				vmaxed = true;
</a><a href="#h14-0-1609" id="h14-0-1609" class="i">+			else if (state == ewmh-&gt;_NET_WM_STATE_MAXIMIZED_HORZ)
</a><a href="#h14-0-1610" id="h14-0-1610" class="i">+				hmaxed = true;
</a><a href="#h14-0-1611" id="h14-0-1611" class="i">+		}
</a><a href="#h14-0-1612" id="h14-0-1612" class="i">+		/* max/unmax the window if needed */
</a><a href="#h14-0-1613" id="h14-0-1613" class="i">+		if (client != NULL &amp;&amp; (maxed || vmaxed || hmaxed)) {
</a><a href="#h14-0-1614" id="h14-0-1614" class="i">+			get_monitor_size(client, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
</a><a href="#h14-0-1615" id="h14-0-1615" class="i">+			if (client-&gt;maxed || client-&gt;vmaxed || client-&gt;hmaxed) {
</a><a href="#h14-0-1616" id="h14-0-1616" class="i">+				unmaximize_window(client);
</a><a href="#h14-0-1617" id="h14-0-1617" class="i">+				set_focused(client);
</a><a href="#h14-0-1618" id="h14-0-1618" class="i">+			} else if (maxed) {
</a><a href="#h14-0-1619" id="h14-0-1619" class="i">+				maximize_window(client, mon_x, mon_y, mon_w, mon_h);
</a><a href="#h14-0-1620" id="h14-0-1620" class="i">+			} else if (vmaxed) {
</a><a href="#h14-0-1621" id="h14-0-1621" class="i">+				vmaximize_window(client, mon_y, mon_h);
</a><a href="#h14-0-1622" id="h14-0-1622" class="i">+			} else if (hmaxed) {
</a><a href="#h14-0-1623" id="h14-0-1623" class="i">+				hmaximize_window(client, mon_x, mon_w);
</a><a href="#h14-0-1624" id="h14-0-1624" class="i">+			}
</a><a href="#h14-0-1625" id="h14-0-1625" class="i">+		}
</a><a href="#h14-0-1626" id="h14-0-1626" class="i">+	}
</a><a href="#h14-0-1627" id="h14-0-1627" class="i">+}
</a><a href="#h14-0-1628" id="h14-0-1628" class="i">+
</a><a href="#h14-0-1629" id="h14-0-1629" class="i">+/*
</a><a href="#h14-0-1630" id="h14-0-1630" class="i">+ * Populates array with functions for handling IPC commands.
</a><a href="#h14-0-1631" id="h14-0-1631" class="i">+ */
</a><a href="#h14-0-1632" id="h14-0-1632" class="i">+
</a><a href="#h14-0-1633" id="h14-0-1633" class="i">+static void
</a><a href="#h14-0-1634" id="h14-0-1634" class="i">+register_ipc_handlers(void)
</a><a href="#h14-0-1635" id="h14-0-1635" class="i">+{
</a><a href="#h14-0-1636" id="h14-0-1636" class="i">+	ipc_handlers[IPCWindowMove]           = ipc_window_move;
</a><a href="#h14-0-1637" id="h14-0-1637" class="i">+	ipc_handlers[IPCWindowMoveAbsolute]   = ipc_window_move_absolute;
</a><a href="#h14-0-1638" id="h14-0-1638" class="i">+	ipc_handlers[IPCWindowResize]         = ipc_window_resize;
</a><a href="#h14-0-1639" id="h14-0-1639" class="i">+	ipc_handlers[IPCWindowResizeAbsolute] = ipc_window_resize_absolute;
</a><a href="#h14-0-1640" id="h14-0-1640" class="i">+	ipc_handlers[IPCWindowMaximize]       = ipc_window_maximize;
</a><a href="#h14-0-1641" id="h14-0-1641" class="i">+	ipc_handlers[IPCWindowHorMaximize]    = ipc_window_hor_maximize;
</a><a href="#h14-0-1642" id="h14-0-1642" class="i">+	ipc_handlers[IPCWindowVerMaximize]    = ipc_window_ver_maximize;
</a><a href="#h14-0-1643" id="h14-0-1643" class="i">+	ipc_handlers[IPCWindowClose]          = ipc_window_close;
</a><a href="#h14-0-1644" id="h14-0-1644" class="i">+	ipc_handlers[IPCWindowPutInGrid]      = ipc_window_put_in_grid;
</a><a href="#h14-0-1645" id="h14-0-1645" class="i">+	ipc_handlers[IPCWindowSnap]           = ipc_window_snap;
</a><a href="#h14-0-1646" id="h14-0-1646" class="i">+	ipc_handlers[IPCWindowCycle]          = ipc_window_cycle;
</a><a href="#h14-0-1647" id="h14-0-1647" class="i">+	ipc_handlers[IPCWindowRevCycle]       = ipc_window_rev_cycle;
</a><a href="#h14-0-1648" id="h14-0-1648" class="i">+	ipc_handlers[IPCGroupAddWindow]       = ipc_group_add_window;
</a><a href="#h14-0-1649" id="h14-0-1649" class="i">+	ipc_handlers[IPCGroupRemoveWindow]    = ipc_group_remove_window;
</a><a href="#h14-0-1650" id="h14-0-1650" class="i">+	ipc_handlers[IPCGroupActivate]        = ipc_group_activate;
</a><a href="#h14-0-1651" id="h14-0-1651" class="i">+	ipc_handlers[IPCGroupDeactivate]      = ipc_group_deactivate;
</a><a href="#h14-0-1652" id="h14-0-1652" class="i">+	ipc_handlers[IPCGroupToggle]          = ipc_group_toggle;
</a><a href="#h14-0-1653" id="h14-0-1653" class="i">+	ipc_handlers[IPCWMQuit]               = ipc_wm_quit;
</a><a href="#h14-0-1654" id="h14-0-1654" class="i">+	ipc_handlers[IPCWMChangeNrOfGroups]   = ipc_wm_change_nr_of_groups;
</a><a href="#h14-0-1655" id="h14-0-1655" class="i">+}
</a><a href="#h14-0-1656" id="h14-0-1656" class="i">+
</a><a href="#h14-0-1657" id="h14-0-1657" class="i">+static void
</a><a href="#h14-0-1658" id="h14-0-1658" class="i">+ipc_window_move(uint32_t *d)
</a><a href="#h14-0-1659" id="h14-0-1659" class="i">+{
</a><a href="#h14-0-1660" id="h14-0-1660" class="i">+	int16_t x, y;
</a><a href="#h14-0-1661" id="h14-0-1661" class="i">+
</a><a href="#h14-0-1662" id="h14-0-1662" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1663" id="h14-0-1663" class="i">+		return;
</a><a href="#h14-0-1664" id="h14-0-1664" class="i">+
</a><a href="#h14-0-1665" id="h14-0-1665" class="i">+	x = d[2];
</a><a href="#h14-0-1666" id="h14-0-1666" class="i">+	y = d[3];
</a><a href="#h14-0-1667" id="h14-0-1667" class="i">+if (d[0])
</a><a href="#h14-0-1668" id="h14-0-1668" class="i">+		x = -x;
</a><a href="#h14-0-1669" id="h14-0-1669" class="i">+	if (d[1])
</a><a href="#h14-0-1670" id="h14-0-1670" class="i">+		y = -y;
</a><a href="#h14-0-1671" id="h14-0-1671" class="i">+
</a><a href="#h14-0-1672" id="h14-0-1672" class="i">+	focused_win-&gt;geom.x += x;
</a><a href="#h14-0-1673" id="h14-0-1673" class="i">+	focused_win-&gt;geom.y += y;
</a><a href="#h14-0-1674" id="h14-0-1674" class="i">+
</a><a href="#h14-0-1675" id="h14-0-1675" class="i">+	move_window(focused_win-&gt;window, x, y);
</a><a href="#h14-0-1676" id="h14-0-1676" class="i">+	center_pointer(focused_win);
</a><a href="#h14-0-1677" id="h14-0-1677" class="i">+}
</a><a href="#h14-0-1678" id="h14-0-1678" class="i">+
</a><a href="#h14-0-1679" id="h14-0-1679" class="i">+static void
</a><a href="#h14-0-1680" id="h14-0-1680" class="i">+ipc_window_move_absolute(uint32_t *d)
</a><a href="#h14-0-1681" id="h14-0-1681" class="i">+{
</a><a href="#h14-0-1682" id="h14-0-1682" class="i">+	int16_t x, y;
</a><a href="#h14-0-1683" id="h14-0-1683" class="i">+
</a><a href="#h14-0-1684" id="h14-0-1684" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1685" id="h14-0-1685" class="i">+		return;
</a><a href="#h14-0-1686" id="h14-0-1686" class="i">+
</a><a href="#h14-0-1687" id="h14-0-1687" class="i">+	x = d[2];
</a><a href="#h14-0-1688" id="h14-0-1688" class="i">+	y = d[3];
</a><a href="#h14-0-1689" id="h14-0-1689" class="i">+
</a><a href="#h14-0-1690" id="h14-0-1690" class="i">+	if (d[0])
</a><a href="#h14-0-1691" id="h14-0-1691" class="i">+		x = -x;
</a><a href="#h14-0-1692" id="h14-0-1692" class="i">+	if (d[1])
</a><a href="#h14-0-1693" id="h14-0-1693" class="i">+		y = -y;
</a><a href="#h14-0-1694" id="h14-0-1694" class="i">+
</a><a href="#h14-0-1695" id="h14-0-1695" class="i">+	focused_win-&gt;geom.x = x;
</a><a href="#h14-0-1696" id="h14-0-1696" class="i">+	focused_win-&gt;geom.y = y;
</a><a href="#h14-0-1697" id="h14-0-1697" class="i">+
</a><a href="#h14-0-1698" id="h14-0-1698" class="i">+	teleport_window(focused_win-&gt;window, x, y);
</a><a href="#h14-0-1699" id="h14-0-1699" class="i">+	center_pointer(focused_win);
</a><a href="#h14-0-1700" id="h14-0-1700" class="i">+}
</a><a href="#h14-0-1701" id="h14-0-1701" class="i">+
</a><a href="#h14-0-1702" id="h14-0-1702" class="i">+static void
</a><a href="#h14-0-1703" id="h14-0-1703" class="i">+ipc_window_resize(uint32_t *d)
</a><a href="#h14-0-1704" id="h14-0-1704" class="i">+{
</a><a href="#h14-0-1705" id="h14-0-1705" class="i">+	int16_t w, h;
</a><a href="#h14-0-1706" id="h14-0-1706" class="i">+	int32_t aw, ah;
</a><a href="#h14-0-1707" id="h14-0-1707" class="i">+
</a><a href="#h14-0-1708" id="h14-0-1708" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1709" id="h14-0-1709" class="i">+		return;
</a><a href="#h14-0-1710" id="h14-0-1710" class="i">+
</a><a href="#h14-0-1711" id="h14-0-1711" class="i">+	w = d[2];
</a><a href="#h14-0-1712" id="h14-0-1712" class="i">+	h = d[3];
</a><a href="#h14-0-1713" id="h14-0-1713" class="i">+
</a><a href="#h14-0-1714" id="h14-0-1714" class="i">+	if (d[0])
</a><a href="#h14-0-1715" id="h14-0-1715" class="i">+		w = -w;
</a><a href="#h14-0-1716" id="h14-0-1716" class="i">+	if (d[1])
</a><a href="#h14-0-1717" id="h14-0-1717" class="i">+		h = -h;
</a><a href="#h14-0-1718" id="h14-0-1718" class="i">+
</a><a href="#h14-0-1719" id="h14-0-1719" class="i">+	aw = focused_win-&gt;geom.width;
</a><a href="#h14-0-1720" id="h14-0-1720" class="i">+	ah = focused_win-&gt;geom.height;
</a><a href="#h14-0-1721" id="h14-0-1721" class="i">+	if (aw + w &gt; 0)
</a><a href="#h14-0-1722" id="h14-0-1722" class="i">+		aw += w;
</a><a href="#h14-0-1723" id="h14-0-1723" class="i">+	if (ah + h &gt; 0)
</a><a href="#h14-0-1724" id="h14-0-1724" class="i">+		ah += h;
</a><a href="#h14-0-1725" id="h14-0-1725" class="i">+
</a><a href="#h14-0-1726" id="h14-0-1726" class="i">+	if (aw &lt; 0)
</a><a href="#h14-0-1727" id="h14-0-1727" class="i">+		aw = 0;
</a><a href="#h14-0-1728" id="h14-0-1728" class="i">+	if (ah &lt; 0)
</a><a href="#h14-0-1729" id="h14-0-1729" class="i">+		ah = 0;
</a><a href="#h14-0-1730" id="h14-0-1730" class="i">+	DMSG(&quot;aw: %d\tah: %d\n&quot;, aw, ah);
</a><a href="#h14-0-1731" id="h14-0-1731" class="i">+
</a><a href="#h14-0-1732" id="h14-0-1732" class="i">+	if (focused_win-&gt;max_width != 0 &amp;&amp; aw &gt; focused_win-&gt;max_width)
</a><a href="#h14-0-1733" id="h14-0-1733" class="i">+		aw = focused_win-&gt;max_width;
</a><a href="#h14-0-1734" id="h14-0-1734" class="i">+
</a><a href="#h14-0-1735" id="h14-0-1735" class="i">+	if (focused_win-&gt;max_height != 0 &amp;&amp; ah &gt; focused_win-&gt;max_height)
</a><a href="#h14-0-1736" id="h14-0-1736" class="i">+		ah = focused_win-&gt;max_height;
</a><a href="#h14-0-1737" id="h14-0-1737" class="i">+
</a><a href="#h14-0-1738" id="h14-0-1738" class="i">+	if (focused_win-&gt;min_width != 0 &amp;&amp; aw &lt; focused_win-&gt;min_width)
</a><a href="#h14-0-1739" id="h14-0-1739" class="i">+		aw = focused_win-&gt;min_width;
</a><a href="#h14-0-1740" id="h14-0-1740" class="i">+
</a><a href="#h14-0-1741" id="h14-0-1741" class="i">+	if (focused_win-&gt;min_height != 0 &amp;&amp; ah &lt; focused_win-&gt;min_height)
</a><a href="#h14-0-1742" id="h14-0-1742" class="i">+		ah = focused_win-&gt;min_height;
</a><a href="#h14-0-1743" id="h14-0-1743" class="i">+
</a><a href="#h14-0-1744" id="h14-0-1744" class="i">+	focused_win-&gt;geom.width  = aw;
</a><a href="#h14-0-1745" id="h14-0-1745" class="i">+	focused_win-&gt;geom.height = ah;
</a><a href="#h14-0-1746" id="h14-0-1746" class="i">+
</a><a href="#h14-0-1747" id="h14-0-1747" class="i">+	resize_window_absolute(focused_win-&gt;window, aw, ah);
</a><a href="#h14-0-1748" id="h14-0-1748" class="i">+	center_pointer(focused_win);
</a><a href="#h14-0-1749" id="h14-0-1749" class="i">+}
</a><a href="#h14-0-1750" id="h14-0-1750" class="i">+
</a><a href="#h14-0-1751" id="h14-0-1751" class="i">+static void
</a><a href="#h14-0-1752" id="h14-0-1752" class="i">+ipc_window_resize_absolute(uint32_t *d)
</a><a href="#h14-0-1753" id="h14-0-1753" class="i">+{
</a><a href="#h14-0-1754" id="h14-0-1754" class="i">+	int16_t w, h;
</a><a href="#h14-0-1755" id="h14-0-1755" class="i">+
</a><a href="#h14-0-1756" id="h14-0-1756" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1757" id="h14-0-1757" class="i">+		return;
</a><a href="#h14-0-1758" id="h14-0-1758" class="i">+
</a><a href="#h14-0-1759" id="h14-0-1759" class="i">+	w = d[0];
</a><a href="#h14-0-1760" id="h14-0-1760" class="i">+	h = d[1];
</a><a href="#h14-0-1761" id="h14-0-1761" class="i">+
</a><a href="#h14-0-1762" id="h14-0-1762" class="i">+	if (focused_win-&gt;max_width != 0 &amp;&amp; w &gt; focused_win-&gt;max_width)
</a><a href="#h14-0-1763" id="h14-0-1763" class="i">+		w = focused_win-&gt;max_width;
</a><a href="#h14-0-1764" id="h14-0-1764" class="i">+
</a><a href="#h14-0-1765" id="h14-0-1765" class="i">+	if (focused_win-&gt;max_height != 0 &amp;&amp; h &gt; focused_win-&gt;max_height)
</a><a href="#h14-0-1766" id="h14-0-1766" class="i">+		h = focused_win-&gt;max_height;
</a><a href="#h14-0-1767" id="h14-0-1767" class="i">+
</a><a href="#h14-0-1768" id="h14-0-1768" class="i">+	if (focused_win-&gt;min_width != 0 &amp;&amp; w &lt; focused_win-&gt;min_width)
</a><a href="#h14-0-1769" id="h14-0-1769" class="i">+		w = focused_win-&gt;min_width;
</a><a href="#h14-0-1770" id="h14-0-1770" class="i">+
</a><a href="#h14-0-1771" id="h14-0-1771" class="i">+	if (focused_win-&gt;min_height != 0 &amp;&amp; h &lt; focused_win-&gt;min_height)
</a><a href="#h14-0-1772" id="h14-0-1772" class="i">+		h = focused_win-&gt;min_height;
</a><a href="#h14-0-1773" id="h14-0-1773" class="i">+
</a><a href="#h14-0-1774" id="h14-0-1774" class="i">+	focused_win-&gt;geom.width = w;
</a><a href="#h14-0-1775" id="h14-0-1775" class="i">+	focused_win-&gt;geom.height = h;
</a><a href="#h14-0-1776" id="h14-0-1776" class="i">+
</a><a href="#h14-0-1777" id="h14-0-1777" class="i">+	resize_window_absolute(focused_win-&gt;window, w, h);
</a><a href="#h14-0-1778" id="h14-0-1778" class="i">+	center_pointer(focused_win);
</a><a href="#h14-0-1779" id="h14-0-1779" class="i">+}
</a><a href="#h14-0-1780" id="h14-0-1780" class="i">+
</a><a href="#h14-0-1781" id="h14-0-1781" class="i">+static void
</a><a href="#h14-0-1782" id="h14-0-1782" class="i">+ipc_window_maximize(uint32_t *d) {
</a><a href="#h14-0-1783" id="h14-0-1783" class="i">+	(void)(d);
</a><a href="#h14-0-1784" id="h14-0-1784" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-1785" id="h14-0-1785" class="i">+	uint16_t mon_w, mon_h;
</a><a href="#h14-0-1786" id="h14-0-1786" class="i">+
</a><a href="#h14-0-1787" id="h14-0-1787" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1788" id="h14-0-1788" class="i">+		return;
</a><a href="#h14-0-1789" id="h14-0-1789" class="i">+
</a><a href="#h14-0-1790" id="h14-0-1790" class="i">+	if (focused_win-&gt;maxed || focused_win-&gt;hmaxed || focused_win-&gt;vmaxed) {
</a><a href="#h14-0-1791" id="h14-0-1791" class="i">+		unmaximize_window(focused_win);
</a><a href="#h14-0-1792" id="h14-0-1792" class="i">+		set_focused(focused_win);
</a><a href="#h14-0-1793" id="h14-0-1793" class="i">+	} else {
</a><a href="#h14-0-1794" id="h14-0-1794" class="i">+		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
</a><a href="#h14-0-1795" id="h14-0-1795" class="i">+		maximize_window(focused_win, mon_x, mon_y, mon_w, mon_h);
</a><a href="#h14-0-1796" id="h14-0-1796" class="i">+	}
</a><a href="#h14-0-1797" id="h14-0-1797" class="i">+
</a><a href="#h14-0-1798" id="h14-0-1798" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-1799" id="h14-0-1799" class="i">+}
</a><a href="#h14-0-1800" id="h14-0-1800" class="i">+
</a><a href="#h14-0-1801" id="h14-0-1801" class="i">+static void
</a><a href="#h14-0-1802" id="h14-0-1802" class="i">+ipc_window_hor_maximize(uint32_t *d)
</a><a href="#h14-0-1803" id="h14-0-1803" class="i">+{
</a><a href="#h14-0-1804" id="h14-0-1804" class="i">+	(void)(d);
</a><a href="#h14-0-1805" id="h14-0-1805" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-1806" id="h14-0-1806" class="i">+	uint16_t mon_w;
</a><a href="#h14-0-1807" id="h14-0-1807" class="i">+	bool was_hmaxed;
</a><a href="#h14-0-1808" id="h14-0-1808" class="i">+
</a><a href="#h14-0-1809" id="h14-0-1809" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1810" id="h14-0-1810" class="i">+		return;
</a><a href="#h14-0-1811" id="h14-0-1811" class="i">+
</a><a href="#h14-0-1812" id="h14-0-1812" class="i">+	was_hmaxed = focused_win-&gt;hmaxed;
</a><a href="#h14-0-1813" id="h14-0-1813" class="i">+
</a><a href="#h14-0-1814" id="h14-0-1814" class="i">+	if (focused_win-&gt;maxed || focused_win-&gt;vmaxed || focused_win-&gt;hmaxed) {
</a><a href="#h14-0-1815" id="h14-0-1815" class="i">+		unmaximize_window(focused_win);
</a><a href="#h14-0-1816" id="h14-0-1816" class="i">+		set_focused(focused_win);
</a><a href="#h14-0-1817" id="h14-0-1817" class="i">+	} else {
</a><a href="#h14-0-1818" id="h14-0-1818" class="i">+		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, NULL);
</a><a href="#h14-0-1819" id="h14-0-1819" class="i">+		hmaximize_window(focused_win, mon_x, mon_w);
</a><a href="#h14-0-1820" id="h14-0-1820" class="i">+	}
</a><a href="#h14-0-1821" id="h14-0-1821" class="i">+
</a><a href="#h14-0-1822" id="h14-0-1822" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-1823" id="h14-0-1823" class="i">+}
</a><a href="#h14-0-1824" id="h14-0-1824" class="i">+
</a><a href="#h14-0-1825" id="h14-0-1825" class="i">+static void
</a><a href="#h14-0-1826" id="h14-0-1826" class="i">+ipc_window_ver_maximize(uint32_t *d)
</a><a href="#h14-0-1827" id="h14-0-1827" class="i">+{
</a><a href="#h14-0-1828" id="h14-0-1828" class="i">+	(void)(d);
</a><a href="#h14-0-1829" id="h14-0-1829" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-1830" id="h14-0-1830" class="i">+	uint16_t mon_h;
</a><a href="#h14-0-1831" id="h14-0-1831" class="i">+	bool was_hmaxed;
</a><a href="#h14-0-1832" id="h14-0-1832" class="i">+
</a><a href="#h14-0-1833" id="h14-0-1833" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1834" id="h14-0-1834" class="i">+		return;
</a><a href="#h14-0-1835" id="h14-0-1835" class="i">+
</a><a href="#h14-0-1836" id="h14-0-1836" class="i">+	was_hmaxed = focused_win-&gt;hmaxed;
</a><a href="#h14-0-1837" id="h14-0-1837" class="i">+
</a><a href="#h14-0-1838" id="h14-0-1838" class="i">+	if (focused_win-&gt;maxed || focused_win-&gt;vmaxed || focused_win-&gt;hmaxed) {
</a><a href="#h14-0-1839" id="h14-0-1839" class="i">+		unmaximize_window(focused_win);
</a><a href="#h14-0-1840" id="h14-0-1840" class="i">+		set_focused(focused_win);
</a><a href="#h14-0-1841" id="h14-0-1841" class="i">+	} else {
</a><a href="#h14-0-1842" id="h14-0-1842" class="i">+		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, NULL, &amp;mon_h);
</a><a href="#h14-0-1843" id="h14-0-1843" class="i">+		vmaximize_window(focused_win, mon_y, mon_h);
</a><a href="#h14-0-1844" id="h14-0-1844" class="i">+	}
</a><a href="#h14-0-1845" id="h14-0-1845" class="i">+
</a><a href="#h14-0-1846" id="h14-0-1846" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-1847" id="h14-0-1847" class="i">+}
</a><a href="#h14-0-1848" id="h14-0-1848" class="i">+
</a><a href="#h14-0-1849" id="h14-0-1849" class="i">+static void
</a><a href="#h14-0-1850" id="h14-0-1850" class="i">+ipc_window_close(uint32_t *d)
</a><a href="#h14-0-1851" id="h14-0-1851" class="i">+{
</a><a href="#h14-0-1852" id="h14-0-1852" class="i">+	(void)(d);
</a><a href="#h14-0-1853" id="h14-0-1853" class="i">+	close_window(focused_win);
</a><a href="#h14-0-1854" id="h14-0-1854" class="i">+	focused_win = NULL;
</a><a href="#h14-0-1855" id="h14-0-1855" class="i">+}
</a><a href="#h14-0-1856" id="h14-0-1856" class="i">+
</a><a href="#h14-0-1857" id="h14-0-1857" class="i">+static void
</a><a href="#h14-0-1858" id="h14-0-1858" class="i">+ipc_window_put_in_grid(uint32_t *d)
</a><a href="#h14-0-1859" id="h14-0-1859" class="i">+{
</a><a href="#h14-0-1860" id="h14-0-1860" class="i">+	uint32_t grid_width, grid_height;
</a><a href="#h14-0-1861" id="h14-0-1861" class="i">+	uint32_t grid_x, grid_y;
</a><a href="#h14-0-1862" id="h14-0-1862" class="i">+	int step_x, step_y;
</a><a href="#h14-0-1863" id="h14-0-1863" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h14-0-1864" id="h14-0-1864" class="i">+	uint16_t mon_w, mon_h;
</a><a href="#h14-0-1865" id="h14-0-1865" class="i">+
</a><a href="#h14-0-1866" id="h14-0-1866" class="i">+	grid_width  = d[0];
</a><a href="#h14-0-1867" id="h14-0-1867" class="i">+	grid_height = d[1];
</a><a href="#h14-0-1868" id="h14-0-1868" class="i">+	grid_x      = d[2];
</a><a href="#h14-0-1869" id="h14-0-1869" class="i">+	grid_y      = d[3];
</a><a href="#h14-0-1870" id="h14-0-1870" class="i">+
</a><a href="#h14-0-1871" id="h14-0-1871" class="i">+	if (focused_win == NULL || grid_x &gt;= grid_width || grid_y &gt;= grid_height)
</a><a href="#h14-0-1872" id="h14-0-1872" class="i">+		return;
</a><a href="#h14-0-1873" id="h14-0-1873" class="i">+
</a><a href="#h14-0-1874" id="h14-0-1874" class="i">+	if (focused_win-&gt;maxed || focused_win-&gt;vmaxed || focused_win-&gt;hmaxed) {
</a><a href="#h14-0-1875" id="h14-0-1875" class="i">+		unmaximize_window(focused_win);
</a><a href="#h14-0-1876" id="h14-0-1876" class="i">+		set_focused(focused_win);
</a><a href="#h14-0-1877" id="h14-0-1877" class="i">+	}
</a><a href="#h14-0-1878" id="h14-0-1878" class="i">+
</a><a href="#h14-0-1879" id="h14-0-1879" class="i">+	get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
</a><a href="#h14-0-1880" id="h14-0-1880" class="i">+	step_x = mon_w / grid_width;
</a><a href="#h14-0-1881" id="h14-0-1881" class="i">+	step_y = mon_h / grid_height;
</a><a href="#h14-0-1882" id="h14-0-1882" class="i">+	DMSG(&quot;%d %d %d %d %d %d\n&quot;, grid_width, grid_height, grid_x, grid_y, step_x, step_y);
</a><a href="#h14-0-1883" id="h14-0-1883" class="i">+
</a><a href="#h14-0-1884" id="h14-0-1884" class="i">+	focused_win-&gt;geom.width = step_x;
</a><a href="#h14-0-1885" id="h14-0-1885" class="i">+	focused_win-&gt;geom.height = step_y;
</a><a href="#h14-0-1886" id="h14-0-1886" class="i">+
</a><a href="#h14-0-1887" id="h14-0-1887" class="i">+	focused_win-&gt;geom.x = mon_x + grid_x * step_x;
</a><a href="#h14-0-1888" id="h14-0-1888" class="i">+	focused_win-&gt;geom.y = mon_y + grid_y * step_y;
</a><a href="#h14-0-1889" id="h14-0-1889" class="i">+
</a><a href="#h14-0-1890" id="h14-0-1890" class="i">+	teleport_window(focused_win-&gt;window, focused_win-&gt;geom.x, focused_win-&gt;geom.y);
</a><a href="#h14-0-1891" id="h14-0-1891" class="i">+	resize_window_absolute(focused_win-&gt;window, focused_win-&gt;geom.width, focused_win-&gt;geom.height);
</a><a href="#h14-0-1892" id="h14-0-1892" class="i">+
</a><a href="#h14-0-1893" id="h14-0-1893" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-1894" id="h14-0-1894" class="i">+}
</a><a href="#h14-0-1895" id="h14-0-1895" class="i">+
</a><a href="#h14-0-1896" id="h14-0-1896" class="i">+static void
</a><a href="#h14-0-1897" id="h14-0-1897" class="i">+ipc_window_snap(uint32_t *d)
</a><a href="#h14-0-1898" id="h14-0-1898" class="i">+{
</a><a href="#h14-0-1899" id="h14-0-1899" class="i">+	uint32_t mode = d[0];
</a><a href="#h14-0-1900" id="h14-0-1900" class="i">+	int16_t mon_x, mon_y, win_x, win_y;
</a><a href="#h14-0-1901" id="h14-0-1901" class="i">+	uint16_t mon_w, mon_h, win_w, win_h;
</a><a href="#h14-0-1902" id="h14-0-1902" class="i">+
</a><a href="#h14-0-1903" id="h14-0-1903" class="i">+	if (focused_win == NULL)
</a><a href="#h14-0-1904" id="h14-0-1904" class="i">+		return;
</a><a href="#h14-0-1905" id="h14-0-1905" class="i">+
</a><a href="#h14-0-1906" id="h14-0-1906" class="i">+	fit_on_screen(focused_win);
</a><a href="#h14-0-1907" id="h14-0-1907" class="i">+
</a><a href="#h14-0-1908" id="h14-0-1908" class="i">+	win_x = focused_win-&gt;geom.x;
</a><a href="#h14-0-1909" id="h14-0-1909" class="i">+	win_y = focused_win-&gt;geom.y;
</a><a href="#h14-0-1910" id="h14-0-1910" class="i">+	win_w = focused_win-&gt;geom.width + 2 * conf.border_width;
</a><a href="#h14-0-1911" id="h14-0-1911" class="i">+	win_h = focused_win-&gt;geom.height + 2 * conf.border_width;
</a><a href="#h14-0-1912" id="h14-0-1912" class="i">+
</a><a href="#h14-0-1913" id="h14-0-1913" class="i">+	get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
</a><a href="#h14-0-1914" id="h14-0-1914" class="i">+
</a><a href="#h14-0-1915" id="h14-0-1915" class="i">+	switch (mode) {
</a><a href="#h14-0-1916" id="h14-0-1916" class="i">+		case SnapTopLeft:
</a><a href="#h14-0-1917" id="h14-0-1917" class="i">+			win_x = mon_x + conf.gap;
</a><a href="#h14-0-1918" id="h14-0-1918" class="i">+			win_y = mon_y + conf.gap;
</a><a href="#h14-0-1919" id="h14-0-1919" class="i">+			break;
</a><a href="#h14-0-1920" id="h14-0-1920" class="i">+
</a><a href="#h14-0-1921" id="h14-0-1921" class="i">+		case SnapTopRight:
</a><a href="#h14-0-1922" id="h14-0-1922" class="i">+			win_x = mon_x + mon_w - conf.gap - win_w;
</a><a href="#h14-0-1923" id="h14-0-1923" class="i">+			win_y = mon_y + conf.gap;
</a><a href="#h14-0-1924" id="h14-0-1924" class="i">+			break;
</a><a href="#h14-0-1925" id="h14-0-1925" class="i">+
</a><a href="#h14-0-1926" id="h14-0-1926" class="i">+		case SnapBottomLeft:
</a><a href="#h14-0-1927" id="h14-0-1927" class="i">+			win_x = mon_x + conf.gap;
</a><a href="#h14-0-1928" id="h14-0-1928" class="i">+			win_y = mon_y + mon_h - conf.gap - win_h;
</a><a href="#h14-0-1929" id="h14-0-1929" class="i">+			break;
</a><a href="#h14-0-1930" id="h14-0-1930" class="i">+
</a><a href="#h14-0-1931" id="h14-0-1931" class="i">+		case SnapBottomRight:
</a><a href="#h14-0-1932" id="h14-0-1932" class="i">+			win_x = mon_x + mon_w - conf.gap - win_w;
</a><a href="#h14-0-1933" id="h14-0-1933" class="i">+			win_y = mon_y + mon_h - conf.gap - win_h;
</a><a href="#h14-0-1934" id="h14-0-1934" class="i">+			break;
</a><a href="#h14-0-1935" id="h14-0-1935" class="i">+
</a><a href="#h14-0-1936" id="h14-0-1936" class="i">+		case SnapMiddle:
</a><a href="#h14-0-1937" id="h14-0-1937" class="i">+			win_x = mon_x + (mon_w - win_w) / 2;
</a><a href="#h14-0-1938" id="h14-0-1938" class="i">+			win_y = mon_y + (mon_h - win_h) / 2;
</a><a href="#h14-0-1939" id="h14-0-1939" class="i">+			break;
</a><a href="#h14-0-1940" id="h14-0-1940" class="i">+
</a><a href="#h14-0-1941" id="h14-0-1941" class="i">+		default:
</a><a href="#h14-0-1942" id="h14-0-1942" class="i">+		 	return;
</a><a href="#h14-0-1943" id="h14-0-1943" class="i">+	}
</a><a href="#h14-0-1944" id="h14-0-1944" class="i">+
</a><a href="#h14-0-1945" id="h14-0-1945" class="i">+	focused_win-&gt;geom.x = win_x;
</a><a href="#h14-0-1946" id="h14-0-1946" class="i">+	focused_win-&gt;geom.y = win_y;
</a><a href="#h14-0-1947" id="h14-0-1947" class="i">+	teleport_window(focused_win-&gt;window, win_x, win_y);
</a><a href="#h14-0-1948" id="h14-0-1948" class="i">+	center_pointer(focused_win);
</a><a href="#h14-0-1949" id="h14-0-1949" class="i">+	xcb_flush(conn);
</a><a href="#h14-0-1950" id="h14-0-1950" class="i">+}
</a><a href="#h14-0-1951" id="h14-0-1951" class="i">+
</a><a href="#h14-0-1952" id="h14-0-1952" class="i">+static
</a><a href="#h14-0-1953" id="h14-0-1953" class="i">+void ipc_window_cycle(uint32_t *d)
</a><a href="#h14-0-1954" id="h14-0-1954" class="i">+{
</a><a href="#h14-0-1955" id="h14-0-1955" class="i">+	(void)(d);
</a><a href="#h14-0-1956" id="h14-0-1956" class="i">+
</a><a href="#h14-0-1957" id="h14-0-1957" class="i">+	cycle_window(focused_win);
</a><a href="#h14-0-1958" id="h14-0-1958" class="i">+}
</a><a href="#h14-0-1959" id="h14-0-1959" class="i">+
</a><a href="#h14-0-1960" id="h14-0-1960" class="i">+static
</a><a href="#h14-0-1961" id="h14-0-1961" class="i">+void ipc_window_rev_cycle(uint32_t *d)
</a><a href="#h14-0-1962" id="h14-0-1962" class="i">+{
</a><a href="#h14-0-1963" id="h14-0-1963" class="i">+	(void)(d);
</a><a href="#h14-0-1964" id="h14-0-1964" class="i">+
</a><a href="#h14-0-1965" id="h14-0-1965" class="i">+	rcycle_window(focused_win);
</a><a href="#h14-0-1966" id="h14-0-1966" class="i">+}
</a><a href="#h14-0-1967" id="h14-0-1967" class="i">+
</a><a href="#h14-0-1968" id="h14-0-1968" class="i">+static void
</a><a href="#h14-0-1969" id="h14-0-1969" class="i">+ipc_group_add_window(uint32_t *d) {
</a><a href="#h14-0-1970" id="h14-0-1970" class="i">+	if (focused_win != NULL)
</a><a href="#h14-0-1971" id="h14-0-1971" class="i">+		group_add_window(focused_win, d[0]);
</a><a href="#h14-0-1972" id="h14-0-1972" class="i">+}
</a><a href="#h14-0-1973" id="h14-0-1973" class="i">+
</a><a href="#h14-0-1974" id="h14-0-1974" class="i">+static void
</a><a href="#h14-0-1975" id="h14-0-1975" class="i">+ipc_group_remove_window(uint32_t *d) {
</a><a href="#h14-0-1976" id="h14-0-1976" class="i">+	(void)(d);
</a><a href="#h14-0-1977" id="h14-0-1977" class="i">+	if (focused_win != NULL)
</a><a href="#h14-0-1978" id="h14-0-1978" class="i">+		group_remove_window(focused_win);
</a><a href="#h14-0-1979" id="h14-0-1979" class="i">+}
</a><a href="#h14-0-1980" id="h14-0-1980" class="i">+
</a><a href="#h14-0-1981" id="h14-0-1981" class="i">+static void
</a><a href="#h14-0-1982" id="h14-0-1982" class="i">+ipc_group_activate(uint32_t *d) {
</a><a href="#h14-0-1983" id="h14-0-1983" class="i">+	group_activate(d[0]);
</a><a href="#h14-0-1984" id="h14-0-1984" class="i">+}
</a><a href="#h14-0-1985" id="h14-0-1985" class="i">+
</a><a href="#h14-0-1986" id="h14-0-1986" class="i">+static void
</a><a href="#h14-0-1987" id="h14-0-1987" class="i">+ipc_group_deactivate(uint32_t *d) {
</a><a href="#h14-0-1988" id="h14-0-1988" class="i">+	group_activate(d[0]);
</a><a href="#h14-0-1989" id="h14-0-1989" class="i">+}
</a><a href="#h14-0-1990" id="h14-0-1990" class="i">+
</a><a href="#h14-0-1991" id="h14-0-1991" class="i">+static void
</a><a href="#h14-0-1992" id="h14-0-1992" class="i">+ipc_group_toggle(uint32_t *d) {
</a><a href="#h14-0-1993" id="h14-0-1993" class="i">+	group_toggle(d[0]);
</a><a href="#h14-0-1994" id="h14-0-1994" class="i">+}
</a><a href="#h14-0-1995" id="h14-0-1995" class="i">+
</a><a href="#h14-0-1996" id="h14-0-1996" class="i">+static void
</a><a href="#h14-0-1997" id="h14-0-1997" class="i">+ipc_wm_quit(uint32_t *d) {
</a><a href="#h14-0-1998" id="h14-0-1998" class="i">+	uint32_t code = d[0];
</a><a href="#h14-0-1999" id="h14-0-1999" class="i">+	halt = true;
</a><a href="#h14-0-2000" id="h14-0-2000" class="i">+	exit_code = code;
</a><a href="#h14-0-2001" id="h14-0-2001" class="i">+}
</a><a href="#h14-0-2002" id="h14-0-2002" class="i">+
</a><a href="#h14-0-2003" id="h14-0-2003" class="i">+static void
</a><a href="#h14-0-2004" id="h14-0-2004" class="i">+ipc_wm_change_nr_of_groups(uint32_t *d)
</a><a href="#h14-0-2005" id="h14-0-2005" class="i">+{
</a><a href="#h14-0-2006" id="h14-0-2006" class="i">+	change_nr_of_groups(d[0]);
</a><a href="#h14-0-2007" id="h14-0-2007" class="i">+}
</a><a href="#h14-0-2008" id="h14-0-2008" class="i">+
</a><a href="#h14-0-2009" id="h14-0-2009" class="i">+int main(int argc, char **argv)
</a><a href="#h14-0-2010" id="h14-0-2010" class="i">+{
</a><a href="#h14-0-2011" id="h14-0-2011" class="i">+	atexit(cleanup);
</a><a href="#h14-0-2012" id="h14-0-2012" class="i">+
</a><a href="#h14-0-2013" id="h14-0-2013" class="i">+	register_event_handlers();
</a><a href="#h14-0-2014" id="h14-0-2014" class="i">+	register_ipc_handlers();
</a><a href="#h14-0-2015" id="h14-0-2015" class="i">+	if (setup() &lt; 0)
</a><a href="#h14-0-2016" id="h14-0-2016" class="i">+		errx(EXIT_FAILURE, &quot;error connecting to X&quot;);
</a><a href="#h14-0-2017" id="h14-0-2017" class="i">+	run();
</a><a href="#h14-0-2018" id="h14-0-2018" class="i">+
</a><a href="#h14-0-2019" id="h14-0-2019" class="i">+	return exit_code;
</a><a href="#h14-0-2020" id="h14-0-2020" class="i">+}
</a><b>diff --git a/<a id="h15" href="../file/xephyr.sh.html">xephyr.sh</a> b/<a href="../file/xephyr.sh.html">xephyr.sh</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+#!/bin/sh
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+D=${D:-80}
</a><a href="#h15-0-3" id="h15-0-3" class="i">+
</a><a href="#h15-0-4" id="h15-0-4" class="i">+Xephyr -screen 1280x720 :$D&amp;
</a><a href="#h15-0-5" id="h15-0-5" class="i">+sleep 1
</a><a href="#h15-0-6" id="h15-0-6" class="i">+
</a><a href="#h15-0-7" id="h15-0-7" class="i">+export DISPLAY=:$D
</a><a href="#h15-0-8" id="h15-0-8" class="i">+sxhkd -c .sxhkdrc &amp;
</a><a href="#h15-0-9" id="h15-0-9" class="i">+exec ./windowchef
</a></pre>
</div>
</body>
</html>
