<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>mouse! (the beginning) - windowchef - windowchef is a stacking window cooker controlled by a remote control program, waitron
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="windowchef.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>windowchef</h1><span class="desc">windowchef is a stacking window cooker controlled by a remote control program, waitron
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/windowchef.git">git://thetudor.ddns.net/windowchef.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/44a4d5b04557e151d99f313e9f930814edc6f11d.html">44a4d5b04557e151d99f313e9f930814edc6f11d</a>
<b>parent</b> <a href="../commit/6b1fa383d165f920e2b1c8c689e116e19f879f24.html">6b1fa383d165f920e2b1c8c689e116e19f879f24</a>
<b>Author:</b> Tudor Roman &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Tue Oct  4 23:14:21 +0300

mouse! (the beginning)

<b>Diffstat:</b>
<table><tr><td><a href="#h0">.sxhkdrc</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td><a href="#h1">client.c</a></td><td> | </td><td class="num">23</td><td><span class="i">+++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h2">config.mk</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td><a href="#h3">ipc.h</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td><a href="#h4">man/waitron.1</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h5">man/waitron.1.html</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h6">man/waitron.1.md</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h7">types.h</a></td><td> | </td><td class="num">52</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
<tr><td><a href="#h8">wm.c</a></td><td> | </td><td class="num">128</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---</span></td></tr>
</table>9 files changed, 215 insertions(+), 28 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.sxhkdrc.html">.sxhkdrc</a> b/<a href="../file/.sxhkdrc.html">.sxhkdrc</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -42,3 +42,6 @@ super + Return
</a> 
 super + {Insert,Prior,Delete,Next,End}
   ./waitron window_snap {topleft,topright,bottomleft,bottomright,middle}
<a href="#h0-0-3" id="h0-0-3" class="i">+
</a><a href="#h0-0-4" id="h0-0-4" class="i">+super + {_,alt +}t
</a><a href="#h0-0-5" id="h0-0-5" class="i">+  ./waitron mouse_toggle {move,resize}
</a><b>diff --git a/<a id="h1" href="../file/client.c.html">client.c</a> b/<a href="../file/client.c.html">client.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -22,6 +22,7 @@ static bool fn_bool(uint32_t *, int, char **);
</a> static bool fn_config(uint32_t *, int, char **);
 static bool fn_hex(uint32_t *, int, char **);
 static bool fn_position(uint32_t *, int, char **);
<a href="#h1-0-3" id="h1-0-3" class="i">+static bool fn_mouse(uint32_t *, int, char **);
</a> 
 struct Command {
 	char *string_command;
<a href="#h1-1" id="h1-1" class="h">@@ -58,6 +59,9 @@ static struct Command c[] = {
</a> 	{ &quot;group_activate&quot;            , IPCGroupActivate         ,  1 , fn_naturals } ,
 	{ &quot;group_deactivate&quot;          , IPCGroupDeactivate       ,  1 , fn_naturals } ,
 	{ &quot;group_toggle&quot;              , IPCGroupToggle           ,  1 , fn_naturals } ,
<a href="#h1-1-3" id="h1-1-3" class="i">+	{ &quot;mouse_start&quot;               , IPCMouseStart            ,  1 , fn_mouse    } ,
</a><a href="#h1-1-4" id="h1-1-4" class="i">+	{ &quot;mouse_stop&quot;                , IPCMouseStop             ,  0 , NULL        } ,
</a><a href="#h1-1-5" id="h1-1-5" class="i">+	{ &quot;mouse_toggle&quot;              , IPCMouseToggle           ,  1 , fn_mouse    } ,
</a> 	{ &quot;wm_quit&quot;                   , IPCWMQuit                ,  1 , fn_naturals } ,
 	{ &quot;wm_config&quot;                 , IPCWMConfig              ,  2 , fn_config   },
 };
<a href="#h1-2" id="h1-2" class="h">@@ -197,6 +201,25 @@ fn_position(uint32_t *data, int argc, char **argv)
</a> 	return true;
 }
 
<a href="#h1-2-3" id="h1-2-3" class="i">+static bool
</a><a href="#h1-2-4" id="h1-2-4" class="i">+fn_mouse(uint32_t *data, int argc, char **argv)
</a><a href="#h1-2-5" id="h1-2-5" class="i">+{
</a><a href="#h1-2-6" id="h1-2-6" class="i">+	char *pos = argv[0];
</a><a href="#h1-2-7" id="h1-2-7" class="i">+	enum mouse_mode mode;
</a><a href="#h1-2-8" id="h1-2-8" class="i">+
</a><a href="#h1-2-9" id="h1-2-9" class="i">+	if (strcasecmp(pos, &quot;move&quot;) == 0)
</a><a href="#h1-2-10" id="h1-2-10" class="i">+		mode = MOUSE_MOVE;
</a><a href="#h1-2-11" id="h1-2-11" class="i">+	else if (strcasecmp(pos, &quot;resize&quot;) == 0)
</a><a href="#h1-2-12" id="h1-2-12" class="i">+		mode = MOUSE_RESIZE;
</a><a href="#h1-2-13" id="h1-2-13" class="i">+	else
</a><a href="#h1-2-14" id="h1-2-14" class="i">+		return false;
</a><a href="#h1-2-15" id="h1-2-15" class="i">+
</a><a href="#h1-2-16" id="h1-2-16" class="i">+	(void)(argc);
</a><a href="#h1-2-17" id="h1-2-17" class="i">+	data[0] = mode;
</a><a href="#h1-2-18" id="h1-2-18" class="i">+
</a><a href="#h1-2-19" id="h1-2-19" class="i">+	return true;
</a><a href="#h1-2-20" id="h1-2-20" class="i">+}
</a><a href="#h1-2-21" id="h1-2-21" class="i">+
</a> static void
 init_xcb(xcb_connection_t **conn)
 {
<b>diff --git a/<a id="h2" href="../file/config.mk.html">config.mk</a> b/<a href="../file/config.mk.html">config.mk</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -2,5 +2,5 @@ PREFIX = /usr/local
</a> MANPREFIX = $(PREFIX)/share/man
 MANDIR = $(MANPREFIX)/man1
 
<a href="#h2-0-3" id="h2-0-3" class="d">-CFLAGS += -std=c99 -Wextra -g
</a><a href="#h2-0-4" id="h2-0-4" class="i">+CFLAGS += -std=c99 -Wextra -g -DD
</a> LDFLAGS += -lxcb -lxcb-ewmh -lxcb-icccm -lxcb-randr
<b>diff --git a/<a id="h3" href="../file/ipc.h.html">ipc.h</a> b/<a href="../file/ipc.h.html">ipc.h</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -29,6 +29,9 @@ enum IPCCommand {
</a> 	IPCGroupActivate,
 	IPCGroupDeactivate,
 	IPCGroupToggle,
<a href="#h3-0-3" id="h3-0-3" class="i">+	IPCMouseStart,
</a><a href="#h3-0-4" id="h3-0-4" class="i">+	IPCMouseStop,
</a><a href="#h3-0-5" id="h3-0-5" class="i">+	IPCMouseToggle,
</a> 	IPCWMQuit,
 	IPCWMConfig,
 	NR_IPC_COMMANDS
<b>diff --git a/<a id="h4" href="../file/man/waitron.1.html">man/waitron.1</a> b/<a href="../file/man/waitron.1.html">man/waitron.1</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -31,6 +31,10 @@ true values: \fBtrue\fR | \fBt\fR | \fByes\fR | \fBy\fR | \fB1\fR
</a> .IP
 false values: \fBfalse\fR | \fBf\fR | \fBno\fR | \fBn\fR | \fB0\fR
 .
<a href="#h4-0-3" id="h4-0-3" class="i">+.TP
</a><a href="#h4-0-4" id="h4-0-4" class="i">+\fBMOUSE\fR
</a><a href="#h4-0-5" id="h4-0-5" class="i">+move | resize
</a><a href="#h4-0-6" id="h4-0-6" class="i">+.
</a> .SH &quot;COMMANDS&quot;
 .
 .TP
<a href="#h4-1" id="h4-1" class="h">@@ -117,6 +121,18 @@ Unmap all windows that belong to the \fIgroup_nr\fR group\.
</a> Toggle the \fIgroup_nr\fR group\.
 .
 .TP
<a href="#h4-1-3" id="h4-1-3" class="i">+\fBmouse_start\fR \fIMOUSE\fR
</a><a href="#h4-1-4" id="h4-1-4" class="i">+Start tracking the pointer to move/resize the mouse\.
</a><a href="#h4-1-5" id="h4-1-5" class="i">+.
</a><a href="#h4-1-6" id="h4-1-6" class="i">+.TP
</a><a href="#h4-1-7" id="h4-1-7" class="i">+\fBmouse_stop\fR
</a><a href="#h4-1-8" id="h4-1-8" class="i">+Stop tracking the pointer\.
</a><a href="#h4-1-9" id="h4-1-9" class="i">+.
</a><a href="#h4-1-10" id="h4-1-10" class="i">+.TP
</a><a href="#h4-1-11" id="h4-1-11" class="i">+\fBmouse_toggle\fR \fIMOUSE\fR
</a><a href="#h4-1-12" id="h4-1-12" class="i">+If already tracking, stop\. Else, track\.
</a><a href="#h4-1-13" id="h4-1-13" class="i">+.
</a><a href="#h4-1-14" id="h4-1-14" class="i">+.TP
</a> \fBwm_quit\fR \fIexit_status\fR
 Quit windowchef with exit_status \fIexit_status\fR\.
 .
<b>diff --git a/<a id="h5" href="../file/man/waitron.1.html.html">man/waitron.1.html</a> b/<a href="../file/man/waitron.1.html.html">man/waitron.1.html</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -99,6 +99,7 @@ anything on &lt;code&gt;stdout&lt;/code&gt;.&lt;/p&gt;
</a> &lt;dt class=&quot;flush&quot;&gt;&lt;code&gt;BOOL&lt;/code&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  true values: &lt;code&gt;true&lt;/code&gt; | &lt;code&gt;t&lt;/code&gt; | &lt;code&gt;yes&lt;/code&gt; | &lt;code&gt;y&lt;/code&gt; | &lt;code&gt;1&lt;/code&gt;&lt;/p&gt;
 
 &lt;p&gt;  false values: &lt;code&gt;false&lt;/code&gt; | &lt;code&gt;f&lt;/code&gt; | &lt;code&gt;no&lt;/code&gt; | &lt;code&gt;n&lt;/code&gt; | &lt;code&gt;0&lt;/code&gt;&lt;/p&gt;&lt;/dd&gt;
<a href="#h5-0-3" id="h5-0-3" class="i">+&lt;dt class=&quot;flush&quot;&gt;&lt;code&gt;MOUSE&lt;/code&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  move | resize&lt;/p&gt;&lt;/dd&gt;
</a> &lt;/dl&gt;
 
 
<a href="#h5-1" id="h5-1" class="h">@@ -139,6 +140,9 @@ anything on &lt;code&gt;stdout&lt;/code&gt;.&lt;/p&gt;
</a> &lt;dt&gt;&lt;code&gt;group_activate&lt;/code&gt; &lt;var&gt;group_nr&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Map all windows that belong to the &lt;var&gt;group_nr&lt;/var&gt; group.&lt;/p&gt;&lt;/dd&gt;
 &lt;dt&gt;&lt;code&gt;group_deactivate&lt;/code&gt; &lt;var&gt;group_nr&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Unmap all windows that belong to the &lt;var&gt;group_nr&lt;/var&gt; group.&lt;/p&gt;&lt;/dd&gt;
 &lt;dt&gt;&lt;code&gt;group_toggle&lt;/code&gt; &lt;var&gt;group_nr&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Toggle the &lt;var&gt;group_nr&lt;/var&gt; group.&lt;/p&gt;&lt;/dd&gt;
<a href="#h5-1-3" id="h5-1-3" class="i">+&lt;dt&gt;&lt;code&gt;mouse_start&lt;/code&gt; &lt;var&gt;MOUSE&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Start tracking the pointer to move/resize the mouse.&lt;/p&gt;&lt;/dd&gt;
</a><a href="#h5-1-4" id="h5-1-4" class="i">+&lt;dt&gt;&lt;code&gt;mouse_stop&lt;/code&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Stop tracking the pointer.&lt;/p&gt;&lt;/dd&gt;
</a><a href="#h5-1-5" id="h5-1-5" class="i">+&lt;dt&gt;&lt;code&gt;mouse_toggle&lt;/code&gt; &lt;var&gt;MOUSE&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  If already tracking, stop. Else, track.&lt;/p&gt;&lt;/dd&gt;
</a> &lt;dt&gt;&lt;code&gt;wm_quit&lt;/code&gt; &lt;var&gt;exit_status&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Quit windowchef with exit_status &lt;var&gt;exit_status&lt;/var&gt;.&lt;/p&gt;&lt;/dd&gt;
 &lt;dt&gt;&lt;code&gt;wm_change_number_of_groups&lt;/code&gt; &lt;var&gt;number_of_groups&lt;/var&gt;&lt;/dt&gt;&lt;dd&gt;&lt;p&gt;  Change the number of maximum groups to &lt;var&gt;number_of_groups&lt;/var&gt;.&lt;/p&gt;
 
<b>diff --git a/<a id="h6" href="../file/man/waitron.1.md.html">man/waitron.1.md</a> b/<a href="../file/man/waitron.1.md.html">man/waitron.1.md</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -26,6 +26,9 @@ anything on `stdout`.
</a> 
 	false values: `false` | `f` | `no` | `n` | `0`
 
<a href="#h6-0-3" id="h6-0-3" class="i">+* `MOUSE`:
</a><a href="#h6-0-4" id="h6-0-4" class="i">+	move | resize
</a><a href="#h6-0-5" id="h6-0-5" class="i">+
</a> ## COMMANDS
 
 * `window_move` &lt;x&gt; &lt;y&gt;:
<a href="#h6-1" id="h6-1" class="h">@@ -102,6 +105,15 @@ anything on `stdout`.
</a> * `group_toggle` &lt;group_nr&gt;:
 	Toggle the &lt;group_nr&gt; group.
 
<a href="#h6-1-3" id="h6-1-3" class="i">+* `mouse_start` &lt;MOUSE&gt;:
</a><a href="#h6-1-4" id="h6-1-4" class="i">+	Start tracking the pointer to move/resize the mouse.
</a><a href="#h6-1-5" id="h6-1-5" class="i">+
</a><a href="#h6-1-6" id="h6-1-6" class="i">+* `mouse_stop`:
</a><a href="#h6-1-7" id="h6-1-7" class="i">+	Stop tracking the pointer.
</a><a href="#h6-1-8" id="h6-1-8" class="i">+
</a><a href="#h6-1-9" id="h6-1-9" class="i">+* `mouse_toggle` &lt;MOUSE&gt;:
</a><a href="#h6-1-10" id="h6-1-10" class="i">+	If already tracking, stop. Else, track.
</a><a href="#h6-1-11" id="h6-1-11" class="i">+
</a> * `wm_quit` &lt;exit_status&gt;:
 	Quit windowchef with exit_status &lt;exit_status&gt;.
 
<b>diff --git a/<a id="h7" href="../file/types.h.html">types.h</a> b/<a href="../file/types.h.html">types.h</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -13,39 +13,45 @@ enum position {
</a> 	CENTER
 };
 
<a href="#h7-0-3" id="h7-0-3" class="i">+enum mouse_mode {
</a><a href="#h7-0-4" id="h7-0-4" class="i">+	MOUSE_NONE,
</a><a href="#h7-0-5" id="h7-0-5" class="i">+	MOUSE_MOVE,
</a><a href="#h7-0-6" id="h7-0-6" class="i">+	MOUSE_RESIZE,
</a><a href="#h7-0-7" id="h7-0-7" class="i">+};
</a><a href="#h7-0-8" id="h7-0-8" class="i">+
</a> struct window_geom {
<a href="#h7-0-10" id="h7-0-10" class="d">-    int16_t x, y;
</a><a href="#h7-0-11" id="h7-0-11" class="d">-    uint16_t width, height;
</a><a href="#h7-0-12" id="h7-0-12" class="d">-    bool set_by_user;
</a><a href="#h7-0-13" id="h7-0-13" class="i">+	int16_t x, y;
</a><a href="#h7-0-14" id="h7-0-14" class="i">+	uint16_t width, height;
</a><a href="#h7-0-15" id="h7-0-15" class="i">+	bool set_by_user;
</a> };
 
 struct client {
<a href="#h7-0-19" id="h7-0-19" class="d">-    xcb_window_t window;
</a><a href="#h7-0-20" id="h7-0-20" class="d">-    struct window_geom geom;
</a><a href="#h7-0-21" id="h7-0-21" class="d">-    struct window_geom orig_geom;
</a><a href="#h7-0-22" id="h7-0-22" class="d">-    bool maxed, hmaxed, vmaxed;
</a><a href="#h7-0-23" id="h7-0-23" class="d">-    struct list_item *item;
</a><a href="#h7-0-24" id="h7-0-24" class="d">-    struct monitor *monitor;
</a><a href="#h7-0-25" id="h7-0-25" class="d">-    uint16_t min_width, min_height;
</a><a href="#h7-0-26" id="h7-0-26" class="d">-    uint16_t max_width, max_height;
</a><a href="#h7-0-27" id="h7-0-27" class="d">-    bool mapped;
</a><a href="#h7-0-28" id="h7-0-28" class="d">-    uint32_t group;
</a><a href="#h7-0-29" id="h7-0-29" class="i">+	xcb_window_t window;
</a><a href="#h7-0-30" id="h7-0-30" class="i">+	struct window_geom geom;
</a><a href="#h7-0-31" id="h7-0-31" class="i">+	struct window_geom orig_geom;
</a><a href="#h7-0-32" id="h7-0-32" class="i">+	bool maxed, hmaxed, vmaxed;
</a><a href="#h7-0-33" id="h7-0-33" class="i">+	struct list_item *item;
</a><a href="#h7-0-34" id="h7-0-34" class="i">+	struct monitor *monitor;
</a><a href="#h7-0-35" id="h7-0-35" class="i">+	uint16_t min_width, min_height;
</a><a href="#h7-0-36" id="h7-0-36" class="i">+	uint16_t max_width, max_height;
</a><a href="#h7-0-37" id="h7-0-37" class="i">+	bool mapped;
</a><a href="#h7-0-38" id="h7-0-38" class="i">+	uint32_t group;
</a> };
 
 struct monitor {
<a href="#h7-0-42" id="h7-0-42" class="d">-    xcb_randr_output_t monitor;
</a><a href="#h7-0-43" id="h7-0-43" class="d">-    char *name;
</a><a href="#h7-0-44" id="h7-0-44" class="d">-    int16_t x, y;
</a><a href="#h7-0-45" id="h7-0-45" class="d">-    uint16_t width, height;
</a><a href="#h7-0-46" id="h7-0-46" class="d">-    struct list_item *item;
</a><a href="#h7-0-47" id="h7-0-47" class="i">+	xcb_randr_output_t monitor;
</a><a href="#h7-0-48" id="h7-0-48" class="i">+	char *name;
</a><a href="#h7-0-49" id="h7-0-49" class="i">+	int16_t x, y;
</a><a href="#h7-0-50" id="h7-0-50" class="i">+	uint16_t width, height;
</a><a href="#h7-0-51" id="h7-0-51" class="i">+	struct list_item *item;
</a> };
 
 struct conf {
<a href="#h7-0-55" id="h7-0-55" class="d">-    int8_t border_width, gap, grid_gap;
</a><a href="#h7-0-56" id="h7-0-56" class="d">-    uint32_t focus_color, unfocus_color;
</a><a href="#h7-0-57" id="h7-0-57" class="d">-    enum position cursor_position;
</a><a href="#h7-0-58" id="h7-0-58" class="d">-    uint32_t groups;
</a><a href="#h7-0-59" id="h7-0-59" class="d">-    bool sloppy_focus;
</a><a href="#h7-0-60" id="h7-0-60" class="i">+	int8_t border_width, gap, grid_gap;
</a><a href="#h7-0-61" id="h7-0-61" class="i">+	uint32_t focus_color, unfocus_color;
</a><a href="#h7-0-62" id="h7-0-62" class="i">+	enum position cursor_position;
</a><a href="#h7-0-63" id="h7-0-63" class="i">+	uint32_t groups;
</a><a href="#h7-0-64" id="h7-0-64" class="i">+	bool sloppy_focus;
</a> };
 
 #endif
<b>diff --git a/<a id="h8" href="../file/wm.c.html">wm.c</a> b/<a href="../file/wm.c.html">wm.c</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -30,7 +30,7 @@ enum { WM_DELETE_WINDOW, _IPC_ATOM_COMMAND, NR_ATOMS };
</a> 
 /* connection to the X server */
 static xcb_connection_t *conn;
<a href="#h8-0-3" id="h8-0-3" class="d">-static xcb_ewmh_connection_t*ewmh;
</a><a href="#h8-0-4" id="h8-0-4" class="i">+static xcb_ewmh_connection_t *ewmh;
</a> static xcb_screen_t *scr;
 static struct client *focused_win;
 static struct conf conf;
<a href="#h8-1" id="h8-1" class="h">@@ -40,7 +40,10 @@ static int scrno;
</a> static int  randr_base;
 static bool halt;
 static int  exit_code;
<a href="#h8-1-3" id="h8-1-3" class="d">-static bool *group_in_use;
</a><a href="#h8-1-4" id="h8-1-4" class="i">+static bool *group_in_use = NULL;
</a><a href="#h8-1-5" id="h8-1-5" class="i">+static enum mouse_mode current_mouse_mode = MOUSE_NONE;
</a><a href="#h8-1-6" id="h8-1-6" class="i">+static struct client * hovered_client = NULL;
</a><a href="#h8-1-7" id="h8-1-7" class="i">+static bool hovering_mouse = false;
</a> /* list of all windows. NULL is the empty list */
 static struct list_item *win_list   = NULL;
 static struct list_item *mon_list   = NULL;
<a href="#h8-2" id="h8-2" class="h">@@ -105,6 +108,9 @@ static void group_activate(uint32_t);
</a> static void group_deactivate(uint32_t);
 static void group_toggle(uint32_t);
 static void change_nr_of_groups(uint32_t);
<a href="#h8-2-3" id="h8-2-3" class="i">+static void mouse_start(enum mouse_mode);
</a><a href="#h8-2-4" id="h8-2-4" class="i">+static void mouse_stop(void);
</a><a href="#h8-2-5" id="h8-2-5" class="i">+static void mouse_toggle(enum mouse_mode);
</a> static void register_event_handlers(void);
 static void event_configure_request(xcb_generic_event_t *);
 static void event_destroy_notify(xcb_generic_event_t *);
<a href="#h8-3" id="h8-3" class="h">@@ -116,6 +122,7 @@ static void event_configure_notify(xcb_generic_event_t *);
</a> static void event_circulate_request(xcb_generic_event_t *);
 static void event_client_message(xcb_generic_event_t *);
 static void event_focus_out(xcb_generic_event_t *);
<a href="#h8-3-3" id="h8-3-3" class="i">+static void event_motion_notify(xcb_generic_event_t *);
</a> static void register_ipc_handlers(void);
 static void ipc_window_move(uint32_t *);
 static void ipc_window_move_absolute(uint32_t *);
<a href="#h8-4" id="h8-4" class="h">@@ -138,6 +145,9 @@ static void ipc_group_remove_window(uint32_t *);
</a> static void ipc_group_activate(uint32_t *);
 static void ipc_group_deactivate(uint32_t *);
 static void ipc_group_toggle(uint32_t *);
<a href="#h8-4-3" id="h8-4-3" class="i">+static void ipc_mouse_start(uint32_t *);
</a><a href="#h8-4-4" id="h8-4-4" class="i">+static void ipc_mouse_stop(uint32_t *);
</a><a href="#h8-4-5" id="h8-4-5" class="i">+static void ipc_mouse_toggle(uint32_t *);
</a> static void ipc_wm_quit(uint32_t *);
 static void ipc_wm_config(uint32_t *);
 
<a href="#h8-5" id="h8-5" class="h">@@ -152,12 +162,14 @@ static void load_config(char *);
</a> static void
 cleanup(void)
 {
<a href="#h8-5-3" id="h8-5-3" class="i">+	xcb_set_input_focus(conn, XCB_NONE, XCB_INPUT_FOCUS_POINTER_ROOT,
</a><a href="#h8-5-4" id="h8-5-4" class="i">+			XCB_CURRENT_TIME);
</a> 	if (ewmh != NULL)
 		xcb_ewmh_connection_wipe(ewmh);
<a href="#h8-5-7" id="h8-5-7" class="d">-	if (conn != NULL)
</a><a href="#h8-5-8" id="h8-5-8" class="d">-		xcb_disconnect(conn);
</a> 	if (win_list != NULL)
 		list_delete_all_items(&amp;win_list);
<a href="#h8-5-11" id="h8-5-11" class="i">+	if (conn != NULL)
</a><a href="#h8-5-12" id="h8-5-12" class="i">+		xcb_disconnect(conn);
</a> }
 
 /*
<a href="#h8-6" id="h8-6" class="h">@@ -1415,6 +1427,43 @@ change_nr_of_groups(uint32_t groups)
</a> 	group_in_use = copy;
 }
 
<a href="#h8-6-3" id="h8-6-3" class="i">+static void
</a><a href="#h8-6-4" id="h8-6-4" class="i">+mouse_start(enum mouse_mode mode)
</a><a href="#h8-6-5" id="h8-6-5" class="i">+{
</a><a href="#h8-6-6" id="h8-6-6" class="i">+	hovering_mouse = true;
</a><a href="#h8-6-7" id="h8-6-7" class="i">+	xcb_query_pointer_reply_t *ptr;
</a><a href="#h8-6-8" id="h8-6-8" class="i">+	ptr = xcb_query_pointer_reply(conn,
</a><a href="#h8-6-9" id="h8-6-9" class="i">+			xcb_query_pointer(conn, scr-&gt;root), NULL);
</a><a href="#h8-6-10" id="h8-6-10" class="i">+	hovered_client = find_client(&amp;ptr-&gt;child);
</a><a href="#h8-6-11" id="h8-6-11" class="i">+	if (hovered_client != NULL &amp;&amp; ptr != NULL) {
</a><a href="#h8-6-12" id="h8-6-12" class="i">+		current_mouse_mode = mode;
</a><a href="#h8-6-13" id="h8-6-13" class="i">+		xcb_grab_pointer(conn, false, scr-&gt;root,
</a><a href="#h8-6-14" id="h8-6-14" class="i">+				XCB_EVENT_MASK_BUTTON_RELEASE
</a><a href="#h8-6-15" id="h8-6-15" class="i">+				| XCB_EVENT_MASK_BUTTON_MOTION
</a><a href="#h8-6-16" id="h8-6-16" class="i">+				| XCB_EVENT_MASK_POINTER_MOTION_HINT,
</a><a href="#h8-6-17" id="h8-6-17" class="i">+				XCB_GRAB_MODE_ASYNC, XCB_GRAB_MODE_ASYNC,
</a><a href="#h8-6-18" id="h8-6-18" class="i">+				XCB_NONE, XCB_NONE, XCB_CURRENT_TIME);
</a><a href="#h8-6-19" id="h8-6-19" class="i">+	}
</a><a href="#h8-6-20" id="h8-6-20" class="i">+}
</a><a href="#h8-6-21" id="h8-6-21" class="i">+
</a><a href="#h8-6-22" id="h8-6-22" class="i">+static void
</a><a href="#h8-6-23" id="h8-6-23" class="i">+mouse_stop(void)
</a><a href="#h8-6-24" id="h8-6-24" class="i">+{
</a><a href="#h8-6-25" id="h8-6-25" class="i">+	hovering_mouse = false;
</a><a href="#h8-6-26" id="h8-6-26" class="i">+	current_mouse_mode = MOUSE_NONE;
</a><a href="#h8-6-27" id="h8-6-27" class="i">+	xcb_ungrab_pointer(conn, XCB_CURRENT_TIME);
</a><a href="#h8-6-28" id="h8-6-28" class="i">+	hovered_client = NULL;
</a><a href="#h8-6-29" id="h8-6-29" class="i">+}
</a><a href="#h8-6-30" id="h8-6-30" class="i">+
</a><a href="#h8-6-31" id="h8-6-31" class="i">+static void
</a><a href="#h8-6-32" id="h8-6-32" class="i">+mouse_toggle(enum mouse_mode mode)
</a><a href="#h8-6-33" id="h8-6-33" class="i">+{
</a><a href="#h8-6-34" id="h8-6-34" class="i">+	if (hovering_mouse)
</a><a href="#h8-6-35" id="h8-6-35" class="i">+		mouse_stop();
</a><a href="#h8-6-36" id="h8-6-36" class="i">+	else
</a><a href="#h8-6-37" id="h8-6-37" class="i">+		mouse_start(mode);
</a><a href="#h8-6-38" id="h8-6-38" class="i">+}
</a><a href="#h8-6-39" id="h8-6-39" class="i">+
</a> /*
  * Adds X event handlers to the array.
  */
<a href="#h8-7" id="h8-7" class="h">@@ -1435,6 +1484,7 @@ register_event_handlers(void)
</a> 	events[XCB_CONFIGURE_NOTIFY]  = event_configure_notify;
 	events[XCB_CIRCULATE_REQUEST] = event_circulate_request;
 	events[XCB_FOCUS_OUT]         = event_focus_out;
<a href="#h8-7-3" id="h8-7-3" class="i">+	events[XCB_MOTION_NOTIFY]     = event_motion_notify;
</a> }
 
 /*
<a href="#h8-8" id="h8-8" class="h">@@ -1790,6 +1840,54 @@ event_focus_out(xcb_generic_event_t *ev)
</a> 	}
 }
 
<a href="#h8-8-3" id="h8-8-3" class="i">+static void
</a><a href="#h8-8-4" id="h8-8-4" class="i">+event_motion_notify(xcb_generic_event_t *ev)
</a><a href="#h8-8-5" id="h8-8-5" class="i">+{
</a><a href="#h8-8-6" id="h8-8-6" class="i">+	int16_t to_x, to_y;
</a><a href="#h8-8-7" id="h8-8-7" class="i">+
</a><a href="#h8-8-8" id="h8-8-8" class="i">+	(void)(ev);
</a><a href="#h8-8-9" id="h8-8-9" class="i">+	xcb_query_pointer_reply_t *ptr;
</a><a href="#h8-8-10" id="h8-8-10" class="i">+	ptr = xcb_query_pointer_reply(conn,
</a><a href="#h8-8-11" id="h8-8-11" class="i">+			xcb_query_pointer(conn, scr-&gt;root), NULL);
</a><a href="#h8-8-12" id="h8-8-12" class="i">+
</a><a href="#h8-8-13" id="h8-8-13" class="i">+	if (hovered_client == NULL || ptr == NULL)
</a><a href="#h8-8-14" id="h8-8-14" class="i">+		return;
</a><a href="#h8-8-15" id="h8-8-15" class="i">+
</a><a href="#h8-8-16" id="h8-8-16" class="i">+	switch (current_mouse_mode) {
</a><a href="#h8-8-17" id="h8-8-17" class="i">+		case MOUSE_MOVE:
</a><a href="#h8-8-18" id="h8-8-18" class="i">+			if (ptr-&gt;root_x + hovered_client-&gt;geom.width / 2
</a><a href="#h8-8-19" id="h8-8-19" class="i">+					&gt; scr-&gt;width_in_pixels - 2 * conf.border_width)
</a><a href="#h8-8-20" id="h8-8-20" class="i">+				to_x = scr-&gt;width_in_pixels - hovered_client-&gt;geom.width
</a><a href="#h8-8-21" id="h8-8-21" class="i">+					- 2 * conf.border_width;
</a><a href="#h8-8-22" id="h8-8-22" class="i">+			else
</a><a href="#h8-8-23" id="h8-8-23" class="i">+				to_x = ptr-&gt;root_x - hovered_client-&gt;geom.width / 2;
</a><a href="#h8-8-24" id="h8-8-24" class="i">+
</a><a href="#h8-8-25" id="h8-8-25" class="i">+			if (ptr-&gt;root_y + hovered_client-&gt;geom.height / 2
</a><a href="#h8-8-26" id="h8-8-26" class="i">+					&gt; scr-&gt;height_in_pixels - 2 * conf.border_width)
</a><a href="#h8-8-27" id="h8-8-27" class="i">+				to_y = scr-&gt;height_in_pixels - hovered_client-&gt;geom.height
</a><a href="#h8-8-28" id="h8-8-28" class="i">+					- 2 * conf.border_width;
</a><a href="#h8-8-29" id="h8-8-29" class="i">+			else
</a><a href="#h8-8-30" id="h8-8-30" class="i">+				to_y = ptr-&gt;root_y - hovered_client-&gt;geom.height / 2;
</a><a href="#h8-8-31" id="h8-8-31" class="i">+
</a><a href="#h8-8-32" id="h8-8-32" class="i">+			if (ptr-&gt;root_x &lt; hovered_client-&gt;geom.width / 2)
</a><a href="#h8-8-33" id="h8-8-33" class="i">+				to_x = 0;
</a><a href="#h8-8-34" id="h8-8-34" class="i">+			if (ptr-&gt;root_y &lt; hovered_client-&gt;geom.height / 2)
</a><a href="#h8-8-35" id="h8-8-35" class="i">+				to_y = 0;
</a><a href="#h8-8-36" id="h8-8-36" class="i">+
</a><a href="#h8-8-37" id="h8-8-37" class="i">+			teleport_window(hovered_client-&gt;window, to_x, to_y);
</a><a href="#h8-8-38" id="h8-8-38" class="i">+			hovered_client-&gt;geom.x = to_x;
</a><a href="#h8-8-39" id="h8-8-39" class="i">+			hovered_client-&gt;geom.y = to_y;
</a><a href="#h8-8-40" id="h8-8-40" class="i">+			break;
</a><a href="#h8-8-41" id="h8-8-41" class="i">+
</a><a href="#h8-8-42" id="h8-8-42" class="i">+		case MOUSE_RESIZE:
</a><a href="#h8-8-43" id="h8-8-43" class="i">+			resize_window_absolute(hovered_client-&gt;window,
</a><a href="#h8-8-44" id="h8-8-44" class="i">+					ptr-&gt;root_x - hovered_client-&gt;geom.x,
</a><a href="#h8-8-45" id="h8-8-45" class="i">+					ptr-&gt;root_y - hovered_client-&gt;geom.y);
</a><a href="#h8-8-46" id="h8-8-46" class="i">+		default:
</a><a href="#h8-8-47" id="h8-8-47" class="i">+			break;
</a><a href="#h8-8-48" id="h8-8-48" class="i">+	}
</a><a href="#h8-8-49" id="h8-8-49" class="i">+}
</a><a href="#h8-8-50" id="h8-8-50" class="i">+
</a> /*
  * Populates array with functions for handling IPC commands.
  */
<a href="#h8-9" id="h8-9" class="h">@@ -1817,6 +1915,9 @@ register_ipc_handlers(void)
</a> 	ipc_handlers[IPCGroupActivate]         = ipc_group_activate;
 	ipc_handlers[IPCGroupDeactivate]       = ipc_group_deactivate;
 	ipc_handlers[IPCGroupToggle]           = ipc_group_toggle;
<a href="#h8-9-3" id="h8-9-3" class="i">+	ipc_handlers[IPCMouseStart]            = ipc_mouse_start;
</a><a href="#h8-9-4" id="h8-9-4" class="i">+	ipc_handlers[IPCMouseStop]             = ipc_mouse_stop;
</a><a href="#h8-9-5" id="h8-9-5" class="i">+	ipc_handlers[IPCMouseToggle]           = ipc_mouse_toggle;
</a> 	ipc_handlers[IPCWMQuit]                = ipc_wm_quit;
 	ipc_handlers[IPCWMConfig]              = ipc_wm_config;
 }
<a href="#h8-10" id="h8-10" class="h">@@ -2199,6 +2300,25 @@ ipc_group_toggle(uint32_t *d)
</a> }
 
 static void
<a href="#h8-10-3" id="h8-10-3" class="i">+ipc_mouse_start(uint32_t *d)
</a><a href="#h8-10-4" id="h8-10-4" class="i">+{
</a><a href="#h8-10-5" id="h8-10-5" class="i">+	mouse_start(d[0]);
</a><a href="#h8-10-6" id="h8-10-6" class="i">+}
</a><a href="#h8-10-7" id="h8-10-7" class="i">+
</a><a href="#h8-10-8" id="h8-10-8" class="i">+static void
</a><a href="#h8-10-9" id="h8-10-9" class="i">+ipc_mouse_stop(uint32_t *d)
</a><a href="#h8-10-10" id="h8-10-10" class="i">+{
</a><a href="#h8-10-11" id="h8-10-11" class="i">+	(void)(d);
</a><a href="#h8-10-12" id="h8-10-12" class="i">+	mouse_stop();
</a><a href="#h8-10-13" id="h8-10-13" class="i">+}
</a><a href="#h8-10-14" id="h8-10-14" class="i">+
</a><a href="#h8-10-15" id="h8-10-15" class="i">+static void
</a><a href="#h8-10-16" id="h8-10-16" class="i">+ipc_mouse_toggle(uint32_t *d)
</a><a href="#h8-10-17" id="h8-10-17" class="i">+{
</a><a href="#h8-10-18" id="h8-10-18" class="i">+	mouse_toggle(d[0]);
</a><a href="#h8-10-19" id="h8-10-19" class="i">+}
</a><a href="#h8-10-20" id="h8-10-20" class="i">+
</a><a href="#h8-10-21" id="h8-10-21" class="i">+static void
</a> ipc_wm_quit(uint32_t *d)
 {
 	uint32_t code = d[0];
</pre>
</div>
</body>
</html>
