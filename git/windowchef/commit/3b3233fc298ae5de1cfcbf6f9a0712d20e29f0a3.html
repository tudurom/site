<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>proper configuration support - windowchef - windowchef is a stacking window cooker controlled by a remote control program, waitron
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="windowchef.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>windowchef</h1><span class="desc">windowchef is a stacking window cooker controlled by a remote control program, waitron
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/windowchef.git">git://thetudor.ddns.net/windowchef.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/3b3233fc298ae5de1cfcbf6f9a0712d20e29f0a3.html">3b3233fc298ae5de1cfcbf6f9a0712d20e29f0a3</a>
<b>parent</b> <a href="../commit/fcc4dd192f7c242e84b7a155d4bcd9fcd1021504.html">fcc4dd192f7c242e84b7a155d4bcd9fcd1021504</a>
<b>Author:</b> Tudor &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Thu Sep 15 22:18:12 +0300

proper configuration support

<b>Diffstat:</b>
<table><tr><td><a href="#h0">Makefile</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++</span><span class="d">---</span></td></tr>
<tr><td><a href="#h1">client.c</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d">--------</span></td></tr>
<tr><td><a href="#h2">common.h</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h3">ipc.h</a></td><td> | </td><td class="num">8</td><td><span class="i"></span><span class="d">--------</span></td></tr>
<tr><td><a href="#h4">types.h</a></td><td> | </td><td class="num">6</td><td><span class="i">++++</span><span class="d">--</span></td></tr>
<tr><td><a href="#h5">windowchefrc</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td><a href="#h6">wm.c</a></td><td> | </td><td class="num">86</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------</span></td></tr>
</table>7 files changed, 128 insertions(+), 43 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/Makefile.html">Makefile</a> b/<a href="../file/Makefile.html">Makefile</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -2,10 +2,12 @@ include config.mk
</a> 
 __NAME__ = windowchef
 __NAME_CLIENT__ = waitron
<a href="#h0-0-3" id="h0-0-3" class="i">+__CONFIG_NAME__ = windowchefrc
</a> __THIS_VERSION__ = 0.1
<a href="#h0-0-5" id="h0-0-5" class="d">-NAME_DEFINES = -D__NAME__=\&quot;$(__NAME__)\&quot; \
</a><a href="#h0-0-6" id="h0-0-6" class="d">-			   -D__NAME_CLIENT__=\&quot;$(__NAME_CLIENT__)\&quot; \
</a><a href="#h0-0-7" id="h0-0-7" class="d">-			   -D__THIS_VERSION__=\&quot;$(__THIS_VERSION__)\&quot;
</a><a href="#h0-0-8" id="h0-0-8" class="i">+NAME_DEFINES = -D__NAME__=\&quot;$(__NAME__)\&quot;                 \
</a><a href="#h0-0-9" id="h0-0-9" class="i">+			   -D__NAME_CLIENT__=\&quot;$(__NAME_CLIENT__)\&quot;   \
</a><a href="#h0-0-10" id="h0-0-10" class="i">+			   -D__THIS_VERSION__=\&quot;$(__THIS_VERSION__)\&quot; \
</a><a href="#h0-0-11" id="h0-0-11" class="i">+			   -D__CONFIG_NAME__=\&quot;$(__CONFIG_NAME__)\&quot;   \
</a> 
 SRC = list.c wm.c client.c
 OBJ = $(SRC:.c=.o)
<b>diff --git a/<a id="h1" href="../file/client.c.html">client.c</a> b/<a href="../file/client.c.html">client.c</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -11,12 +11,14 @@
</a> 
 #include &quot;ipc.h&quot;
 #include &quot;common.h&quot;
<a href="#h1-0-3" id="h1-0-3" class="i">+#include &quot;types.h&quot;
</a> 
 static bool fn_offset(uint32_t *, int, char **);
 static bool fn_naturals(uint32_t *, int, char **);
 static bool fn_bool(uint32_t *, int, char **);
 static bool fn_config(uint32_t *, int, char **);
 static bool fn_hex(uint32_t *, int, char **);
<a href="#h1-0-10" id="h1-0-10" class="i">+static bool fn_curpos(uint32_t *, int, char **);
</a> 
 struct Command {
 	char *string_command;
<a href="#h1-1" id="h1-1" class="h">@@ -57,10 +59,10 @@ static struct Command c[] = {
</a> 
 static struct ConfigEntry configs[] = {
 	{ &quot;border_width&quot;        , IPCConfigBorderWidth       , fn_naturals } ,
<a href="#h1-1-3" id="h1-1-3" class="d">-	{ &quot;color_focused&quot;       , IPCConfigColorFocused      , fn_hex} ,
</a><a href="#h1-1-4" id="h1-1-4" class="d">-	{ &quot;color_unfocused&quot;     , IPCConfigColorUnfocused    , fn_hex} ,
</a><a href="#h1-1-5" id="h1-1-5" class="i">+	{ &quot;color_focused&quot;       , IPCConfigColorFocused      , fn_hex      } ,
</a><a href="#h1-1-6" id="h1-1-6" class="i">+	{ &quot;color_unfocused&quot;     , IPCConfigColorUnfocused    , fn_hex      } ,
</a> 	{ &quot;gap_width&quot;           , IPCConfigGapWidth          , fn_naturals } ,
<a href="#h1-1-8" id="h1-1-8" class="d">-	{ &quot;cursor_position&quot;     , IPCConfigCursorPosition    , fn_naturals } ,
</a><a href="#h1-1-9" id="h1-1-9" class="i">+	{ &quot;cursor_position&quot;     , IPCConfigCursorPosition    , fn_curpos   } ,
</a> 	{ &quot;groups_nr&quot;           , IPCConfigGroupsNr          , fn_naturals } ,
 	{ &quot;enable_sloppy_focus&quot; , IPCConfigEnableSloppyFocus , fn_bool     } ,
 };
<a href="#h1-2" id="h1-2" class="h">@@ -108,14 +110,15 @@ fn_bool(uint32_t *data, int argc, char **argv) {
</a> 	char *arg;
 	do {
 		arg = argv[i];
<a href="#h1-2-3" id="h1-2-3" class="d">-		if (strcasecmp(argv[i], &quot;true&quot;)
</a><a href="#h1-2-4" id="h1-2-4" class="d">-					|| strcasecmp(arg, &quot;yes&quot;)
</a><a href="#h1-2-5" id="h1-2-5" class="d">-					|| strcasecmp(arg, &quot;t&quot;)
</a><a href="#h1-2-6" id="h1-2-6" class="d">-					|| strcasecmp(arg, &quot;y&quot;)
</a><a href="#h1-2-7" id="h1-2-7" class="d">-					|| strcasecmp(arg, &quot;1&quot;))
</a><a href="#h1-2-8" id="h1-2-8" class="i">+		if (strcasecmp(argv[i], &quot;true&quot;)       == 0
</a><a href="#h1-2-9" id="h1-2-9" class="i">+					|| strcasecmp(arg, &quot;yes&quot;) == 0
</a><a href="#h1-2-10" id="h1-2-10" class="i">+					|| strcasecmp(arg, &quot;t&quot;)   == 0
</a><a href="#h1-2-11" id="h1-2-11" class="i">+					|| strcasecmp(arg, &quot;y&quot;)   == 0
</a><a href="#h1-2-12" id="h1-2-12" class="i">+					|| strcasecmp(arg, &quot;1&quot;)   == 0)
</a> 				data[i] = true;
 		else
 			data[i] = false;
<a href="#h1-2-16" id="h1-2-16" class="i">+		i++;
</a> 	} while (i &lt; argc);
 
 	return true;
<a href="#h1-3" id="h1-3" class="h">@@ -163,6 +166,31 @@ fn_hex(uint32_t *data, int argc, char **argv)
</a> 		return true;
 }
 
<a href="#h1-3-3" id="h1-3-3" class="i">+static bool
</a><a href="#h1-3-4" id="h1-3-4" class="i">+fn_curpos(uint32_t *data, int argc, char **argv)
</a><a href="#h1-3-5" id="h1-3-5" class="i">+{
</a><a href="#h1-3-6" id="h1-3-6" class="i">+	char *pos = argv[0];
</a><a href="#h1-3-7" id="h1-3-7" class="i">+	enum position snap_pos;
</a><a href="#h1-3-8" id="h1-3-8" class="i">+
</a><a href="#h1-3-9" id="h1-3-9" class="i">+	if (strcasecmp(pos, &quot;topleft&quot;) == 0)
</a><a href="#h1-3-10" id="h1-3-10" class="i">+		snap_pos = TOP_LEFT;
</a><a href="#h1-3-11" id="h1-3-11" class="i">+	else if (strcasecmp(pos, &quot;topright&quot;) == 0)
</a><a href="#h1-3-12" id="h1-3-12" class="i">+		snap_pos = TOP_RIGHT;
</a><a href="#h1-3-13" id="h1-3-13" class="i">+	else if (strcasecmp(pos, &quot;bottomleft&quot;) == 0)
</a><a href="#h1-3-14" id="h1-3-14" class="i">+		snap_pos = BOTTOM_LEFT;
</a><a href="#h1-3-15" id="h1-3-15" class="i">+	else if (strcasecmp(pos, &quot;bottomright&quot;) == 0)
</a><a href="#h1-3-16" id="h1-3-16" class="i">+		snap_pos = BOTTOM_RIGHT;
</a><a href="#h1-3-17" id="h1-3-17" class="i">+	else if (strcasecmp(pos, &quot;middle&quot;) == 0)
</a><a href="#h1-3-18" id="h1-3-18" class="i">+		snap_pos = CENTER;
</a><a href="#h1-3-19" id="h1-3-19" class="i">+	else
</a><a href="#h1-3-20" id="h1-3-20" class="i">+		return false;
</a><a href="#h1-3-21" id="h1-3-21" class="i">+
</a><a href="#h1-3-22" id="h1-3-22" class="i">+	(void)(argc);
</a><a href="#h1-3-23" id="h1-3-23" class="i">+	data[0] = snap_pos;
</a><a href="#h1-3-24" id="h1-3-24" class="i">+
</a><a href="#h1-3-25" id="h1-3-25" class="i">+	return true;
</a><a href="#h1-3-26" id="h1-3-26" class="i">+}
</a><a href="#h1-3-27" id="h1-3-27" class="i">+
</a> xcb_connection_t *conn;
 xcb_screen_t *scr;
 
<b>diff --git a/<a id="h2" href="../file/common.h.html">common.h</a> b/<a href="../file/common.h.html">common.h</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -13,8 +13,18 @@
</a> #define __NAME__ &quot;wm&quot;
 #endif
 
<a href="#h2-0-3" id="h2-0-3" class="i">+#ifndef __NAME_CLIENT__
</a><a href="#h2-0-4" id="h2-0-4" class="i">+#define __NAME_CLIENT__ &quot;wmc&quot;
</a><a href="#h2-0-5" id="h2-0-5" class="i">+#endif
</a><a href="#h2-0-6" id="h2-0-6" class="i">+
</a><a href="#h2-0-7" id="h2-0-7" class="i">+#ifndef __CONFIG_NAME__
</a><a href="#h2-0-8" id="h2-0-8" class="i">+#define __CONFIG_NAME__ &quot;wmrc&quot;
</a><a href="#h2-0-9" id="h2-0-9" class="i">+#endif
</a><a href="#h2-0-10" id="h2-0-10" class="i">+
</a> #ifndef __THIS_VERSION__
 #define __THIS_VERSION__ &quot;&quot;
 #endif
 
<a href="#h2-0-15" id="h2-0-15" class="i">+#define MAXLEN 256
</a><a href="#h2-0-16" id="h2-0-16" class="i">+
</a> #endif
<b>diff --git a/<a id="h3" href="../file/ipc.h.html">ipc.h</a> b/<a href="../file/ipc.h.html">ipc.h</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -43,12 +43,4 @@ enum IPCConfig {
</a> 	NR_IPC_CONFIGS
 };
 
<a href="#h3-0-3" id="h3-0-3" class="d">-enum SnapPosition {
</a><a href="#h3-0-4" id="h3-0-4" class="d">-	SnapTopLeft = 0,
</a><a href="#h3-0-5" id="h3-0-5" class="d">-	SnapTopRight,
</a><a href="#h3-0-6" id="h3-0-6" class="d">-	SnapBottomLeft,
</a><a href="#h3-0-7" id="h3-0-7" class="d">-	SnapBottomRight,
</a><a href="#h3-0-8" id="h3-0-8" class="d">-	SnapMiddle,
</a><a href="#h3-0-9" id="h3-0-9" class="d">-};
</a><a href="#h3-0-10" id="h3-0-10" class="d">-
</a> #endif
<b>diff --git a/<a id="h4" href="../file/types.h.html">types.h</a> b/<a href="../file/types.h.html">types.h</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -3,7 +3,9 @@
</a> #ifndef _TYPES_H
 #define _TYPES_H
 
<a href="#h4-0-3" id="h4-0-3" class="d">-enum cursor_position {
</a><a href="#h4-0-4" id="h4-0-4" class="i">+#include &lt;xcb/randr.h&gt;
</a><a href="#h4-0-5" id="h4-0-5" class="i">+
</a><a href="#h4-0-6" id="h4-0-6" class="i">+enum position {
</a> 	BOTTOM_LEFT,
 	BOTTOM_RIGHT,
 	TOP_LEFT,
<a href="#h4-1" id="h4-1" class="h">@@ -41,7 +43,7 @@ struct monitor {
</a> struct conf {
     int8_t border_width, gap;
     uint32_t focus_color, unfocus_color;
<a href="#h4-1-3" id="h4-1-3" class="d">-    enum cursor_position cursor_position;
</a><a href="#h4-1-4" id="h4-1-4" class="i">+    enum position cursor_position;
</a>     uint32_t groups;
     bool sloppy_focus;
 };
<b>diff --git a/<a id="h5" href="../file/windowchefrc.html">windowchefrc</a> b/<a href="../file/windowchefrc.html">windowchefrc</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,9 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+#!/bin/sh
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+waitron wm_config border_width 10
</a><a href="#h5-0-3" id="h5-0-3" class="i">+waitron wm_config color_focused 0x3d637d
</a><a href="#h5-0-4" id="h5-0-4" class="i">+waitron wm_config color_unfocused 0x003b4f
</a><a href="#h5-0-5" id="h5-0-5" class="i">+waitron wm_config gap_width 20
</a><a href="#h5-0-6" id="h5-0-6" class="i">+waitron wm_config cursor_position bottomleft
</a><a href="#h5-0-7" id="h5-0-7" class="i">+waitron wm_config groups_nr 4
</a><a href="#h5-0-8" id="h5-0-8" class="i">+waitron wm_config enable_sloppy_focus true
</a><b>diff --git a/<a id="h6" href="../file/wm.c.html">wm.c</a> b/<a href="../file/wm.c.html">wm.c</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -12,6 +12,7 @@
</a> #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 #include &lt;unistd.h&gt;
<a href="#h6-0-3" id="h6-0-3" class="i">+#include &lt;getopt.h&gt;
</a> 
 #include &quot;common.h&quot;
 #include &quot;ipc.h&quot;
<a href="#h6-1" id="h6-1" class="h">@@ -137,6 +138,8 @@ static void ipc_wm_change_nr_of_groups(uint32_t *);
</a> static void ipc_wm_config(uint32_t *);
 
 static void usage(char *);
<a href="#h6-1-3" id="h6-1-3" class="i">+static void load_defaults(void);
</a><a href="#h6-1-4" id="h6-1-4" class="i">+static void load_config(char *);
</a> 
 /*
  * Gracefully disconnect.
<a href="#h6-2" id="h6-2" class="h">@@ -214,14 +217,6 @@ setup(void)
</a> 
 	randr_base = setup_randr();
 
<a href="#h6-2-3" id="h6-2-3" class="d">-	conf.border_width    = BORDER_WIDTH;
</a><a href="#h6-2-4" id="h6-2-4" class="d">-	conf.focus_color     = COLOR_FOCUS;
</a><a href="#h6-2-5" id="h6-2-5" class="d">-	conf.unfocus_color   = COLOR_UNFOCUS;
</a><a href="#h6-2-6" id="h6-2-6" class="d">-	conf.gap             = GAP;
</a><a href="#h6-2-7" id="h6-2-7" class="d">-	conf.cursor_position = CURSOR_POSITION;
</a><a href="#h6-2-8" id="h6-2-8" class="d">-	conf.groups          = GROUPS;
</a><a href="#h6-2-9" id="h6-2-9" class="d">-	conf.sloppy_focus    = SLOPPY_FOCUS;
</a><a href="#h6-2-10" id="h6-2-10" class="d">-
</a> 	group_in_use = malloc(conf.groups * sizeof(bool));
 	for (uint32_t i = 0; i &lt; conf.groups; i++)
 		group_in_use[i] = false;
<a href="#h6-3" id="h6-3" class="h">@@ -1075,19 +1070,20 @@ center_pointer(struct client *client)
</a> 
 	switch (conf.cursor_position) {
 	case TOP_LEFT:
<a href="#h6-3-3" id="h6-3-3" class="d">-		cur_x = 0;
</a><a href="#h6-3-4" id="h6-3-4" class="d">-		cur_y = 0;
</a><a href="#h6-3-5" id="h6-3-5" class="i">+		cur_x = -conf.border_width;
</a><a href="#h6-3-6" id="h6-3-6" class="i">+		cur_y = -conf.border_width;
</a> 		break;
 	case TOP_RIGHT:
<a href="#h6-3-9" id="h6-3-9" class="d">-		cur_x = client-&gt;geom.width;
</a><a href="#h6-3-10" id="h6-3-10" class="d">-		cur_y = 0;
</a><a href="#h6-3-11" id="h6-3-11" class="i">+		cur_x = client-&gt;geom.width + conf.border_width;
</a><a href="#h6-3-12" id="h6-3-12" class="i">+		cur_y = 0 - conf.border_width;
</a> 		break;
 	case BOTTOM_LEFT:
<a href="#h6-3-15" id="h6-3-15" class="d">-		cur_x = client-&gt;geom.width;
</a><a href="#h6-3-16" id="h6-3-16" class="i">+		cur_x = 0 - conf.border_width;
</a><a href="#h6-3-17" id="h6-3-17" class="i">+		cur_y = client-&gt;geom.height + conf.border_width;
</a> 		break;
 	case BOTTOM_RIGHT:
<a href="#h6-3-20" id="h6-3-20" class="d">-		cur_x = client-&gt;geom.width;
</a><a href="#h6-3-21" id="h6-3-21" class="d">-		cur_y = client-&gt;geom.height;
</a><a href="#h6-3-22" id="h6-3-22" class="i">+		cur_x = client-&gt;geom.width + conf.border_width;
</a><a href="#h6-3-23" id="h6-3-23" class="i">+		cur_y = client-&gt;geom.height + conf.border_width;
</a> 		break;
 	case CENTER:
 		cur_x = client-&gt;geom.width / 2;
<a href="#h6-4" id="h6-4" class="h">@@ -1981,27 +1977,27 @@ ipc_window_snap(uint32_t *d)
</a> 	get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
 
 	switch (mode) {
<a href="#h6-4-3" id="h6-4-3" class="d">-		case SnapTopLeft:
</a><a href="#h6-4-4" id="h6-4-4" class="i">+		case TOP_LEFT:
</a> 			win_x = mon_x + conf.gap;
 			win_y = mon_y + conf.gap;
 			break;
 
<a href="#h6-4-9" id="h6-4-9" class="d">-		case SnapTopRight:
</a><a href="#h6-4-10" id="h6-4-10" class="i">+		case TOP_RIGHT:
</a> 			win_x = mon_x + mon_w - conf.gap - win_w;
 			win_y = mon_y + conf.gap;
 			break;
 
<a href="#h6-4-15" id="h6-4-15" class="d">-		case SnapBottomLeft:
</a><a href="#h6-4-16" id="h6-4-16" class="i">+		case BOTTOM_LEFT:
</a> 			win_x = mon_x + conf.gap;
 			win_y = mon_y + mon_h - conf.gap - win_h;
 			break;
 
<a href="#h6-4-21" id="h6-4-21" class="d">-		case SnapBottomRight:
</a><a href="#h6-4-22" id="h6-4-22" class="i">+		case BOTTOM_RIGHT:
</a> 			win_x = mon_x + mon_w - conf.gap - win_w;
 			win_y = mon_y + mon_h - conf.gap - win_h;
 			break;
 
<a href="#h6-4-27" id="h6-4-27" class="d">-		case SnapMiddle:
</a><a href="#h6-4-28" id="h6-4-28" class="i">+		case CENTER:
</a> 			win_x = mon_x + (mon_w - win_w) / 2;
 			win_y = mon_y + (mon_h - win_h) / 2;
 			break;
<a href="#h6-5" id="h6-5" class="h">@@ -2120,16 +2116,62 @@ usage(char *name)
</a> 	exit(EXIT_FAILURE);
 }
 
<a href="#h6-5-3" id="h6-5-3" class="i">+static void
</a><a href="#h6-5-4" id="h6-5-4" class="i">+load_defaults(void)
</a><a href="#h6-5-5" id="h6-5-5" class="i">+{
</a><a href="#h6-5-6" id="h6-5-6" class="i">+	conf.border_width    = BORDER_WIDTH;
</a><a href="#h6-5-7" id="h6-5-7" class="i">+	conf.focus_color     = COLOR_FOCUS;
</a><a href="#h6-5-8" id="h6-5-8" class="i">+	conf.unfocus_color   = COLOR_UNFOCUS;
</a><a href="#h6-5-9" id="h6-5-9" class="i">+	conf.gap             = GAP;
</a><a href="#h6-5-10" id="h6-5-10" class="i">+	conf.cursor_position = CURSOR_POSITION;
</a><a href="#h6-5-11" id="h6-5-11" class="i">+	conf.groups          = GROUPS;
</a><a href="#h6-5-12" id="h6-5-12" class="i">+	conf.sloppy_focus    = SLOPPY_FOCUS;
</a><a href="#h6-5-13" id="h6-5-13" class="i">+}
</a><a href="#h6-5-14" id="h6-5-14" class="i">+
</a><a href="#h6-5-15" id="h6-5-15" class="i">+static void
</a><a href="#h6-5-16" id="h6-5-16" class="i">+load_config(char *config_path)
</a><a href="#h6-5-17" id="h6-5-17" class="i">+{
</a><a href="#h6-5-18" id="h6-5-18" class="i">+	if (fork() == 0) {
</a><a href="#h6-5-19" id="h6-5-19" class="i">+		setsid();
</a><a href="#h6-5-20" id="h6-5-20" class="i">+		DMSG(&quot;loading %s\n&quot;, config_path);
</a><a href="#h6-5-21" id="h6-5-21" class="i">+		execl(config_path, config_path, NULL);
</a><a href="#h6-5-22" id="h6-5-22" class="i">+		errx(EXIT_FAILURE, &quot;fork&quot;);
</a><a href="#h6-5-23" id="h6-5-23" class="i">+	}
</a><a href="#h6-5-24" id="h6-5-24" class="i">+}
</a><a href="#h6-5-25" id="h6-5-25" class="i">+
</a> int main(int argc, char *argv[])
 {
<a href="#h6-5-28" id="h6-5-28" class="d">-	if (argc == 2 &amp;&amp; strcmp(argv[1], &quot;-h&quot;) == 0)
</a><a href="#h6-5-29" id="h6-5-29" class="d">-		usage(argv[0]);
</a><a href="#h6-5-30" id="h6-5-30" class="i">+	int opt;
</a><a href="#h6-5-31" id="h6-5-31" class="i">+	char *config_path = malloc(MAXLEN * sizeof(char));
</a><a href="#h6-5-32" id="h6-5-32" class="i">+	config_path[0] = &apos;\0&apos;;
</a><a href="#h6-5-33" id="h6-5-33" class="i">+	while ((opt = getopt(argc, argv, &quot;hc:&quot;)) != -1) {
</a><a href="#h6-5-34" id="h6-5-34" class="i">+		switch (opt) {
</a><a href="#h6-5-35" id="h6-5-35" class="i">+			case &apos;h&apos;:
</a><a href="#h6-5-36" id="h6-5-36" class="i">+				usage(argv[0]);
</a><a href="#h6-5-37" id="h6-5-37" class="i">+				break;
</a><a href="#h6-5-38" id="h6-5-38" class="i">+			case &apos;c&apos;:
</a><a href="#h6-5-39" id="h6-5-39" class="i">+				snprintf(config_path, MAXLEN * sizeof(char), &quot;%s&quot;, optarg);
</a><a href="#h6-5-40" id="h6-5-40" class="i">+				break;
</a><a href="#h6-5-41" id="h6-5-41" class="i">+		}
</a><a href="#h6-5-42" id="h6-5-42" class="i">+	}
</a> 	atexit(cleanup);
 
 	register_event_handlers();
 	register_ipc_handlers();
 	if (setup() &lt; 0)
 		errx(EXIT_FAILURE, &quot;error connecting to X&quot;);
<a href="#h6-5-49" id="h6-5-49" class="i">+	/* if not set, get path of the rc file */
</a><a href="#h6-5-50" id="h6-5-50" class="i">+	if (config_path[0] == &apos;\0&apos;) {
</a><a href="#h6-5-51" id="h6-5-51" class="i">+		char *xdg_home = getenv(&quot;XDG_CONFIG_HOME&quot;);
</a><a href="#h6-5-52" id="h6-5-52" class="i">+		if (xdg_home != NULL)
</a><a href="#h6-5-53" id="h6-5-53" class="i">+			snprintf(config_path, MAXLEN * sizeof(char), &quot;%s/%s/%s&quot;, xdg_home, __NAME__, __CONFIG_NAME__);
</a><a href="#h6-5-54" id="h6-5-54" class="i">+		else
</a><a href="#h6-5-55" id="h6-5-55" class="i">+			snprintf(config_path, MAXLEN * sizeof(char), &quot;%s/%s/%s/%s&quot;, getenv(&quot;HOME&quot;), &quot;.config&quot;,
</a><a href="#h6-5-56" id="h6-5-56" class="i">+					__NAME__, __CONFIG_NAME__);
</a><a href="#h6-5-57" id="h6-5-57" class="i">+	}
</a><a href="#h6-5-58" id="h6-5-58" class="i">+	/* execute config file */
</a><a href="#h6-5-59" id="h6-5-59" class="i">+	load_defaults();
</a><a href="#h6-5-60" id="h6-5-60" class="i">+	load_config(config_path);
</a> 	run();
 
 	return exit_code;
</pre>
</div>
</body>
</html>
