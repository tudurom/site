<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<title>reworked ewmh window states - windowchef - windowchef is a stacking window cooker controlled by a remote control program, waitron
</title>
<link rel="icon" type="image/png" href="../favicon.png" />
<link rel="alternate" type="application/atom+xml" title="windowchef.git Atom Feed" href="../atom.xml" />
<link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
<table><tr><td><a href="../../"><img src="../logo.png" alt="" width="32" height="32" /></a></td><td><h1>windowchef</h1><span class="desc">windowchef is a stacking window cooker controlled by a remote control program, waitron
</span></td></tr><tr class="url"><td></td><td>git clone <a href="git://thetudor.ddns.net/windowchef.git">git://thetudor.ddns.net/windowchef.git</a></td></tr><tr><td></td><td>
<a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">LICENSE</a></td></tr></table>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/abd0cf2f9929e755ee114052d3431680c012d66e.html">abd0cf2f9929e755ee114052d3431680c012d66e</a>
<b>parent</b> <a href="../commit/d25a369a650c9a4f363bbf097b1a5019f6ca6527.html">d25a369a650c9a4f363bbf097b1a5019f6ca6527</a>
<b>Author:</b> Tudor Roman &lt;<a href="mailto:xenogenesis@openmailbox.org">xenogenesis@openmailbox.org</a>&gt;
<b>Date:</b>   Sat Dec  3 19:20:40 +0200

reworked ewmh window states

<b>Diffstat:</b>
<table><tr><td><a href="#h0">wm.c</a></td><td> | </td><td class="num">224</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------</span></td></tr>
</table>1 file changed, 140 insertions(+), 84 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/wm.c.html">wm.c</a> b/<a href="../file/wm.c.html">wm.c</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -87,6 +87,7 @@ static void hmaximize_window(struct client *, int16_t, uint16_t);
</a> static void vmaximize_window(struct client *, int16_t, uint16_t);
 static void monocle_window(struct client *, int16_t, int16_t, uint16_t, uint16_t);
 static void unmaximize_window(struct client *);
<a href="#h0-0-3" id="h0-0-3" class="i">+static bool is_maxed(struct client *);
</a> static void cycle_window(struct client *);
 static void rcycle_window(struct client *);
 static void cycle_window_in_group(struct client *);
<a href="#h0-1" id="h0-1" class="h">@@ -113,6 +114,8 @@ static void change_nr_of_groups(uint32_t);
</a> static void mouse_start(enum mouse_mode);
 static void mouse_stop(void);
 static void mouse_toggle(enum mouse_mode);
<a href="#h0-1-3" id="h0-1-3" class="i">+static void update_ewmh_wm_state(struct client *);
</a><a href="#h0-1-4" id="h0-1-4" class="i">+static void handle_wm_state(struct client *, xcb_atom_t, unsigned int);
</a> static void register_event_handlers(void);
 static void event_configure_request(xcb_generic_event_t *);
 static void event_destroy_notify(xcb_generic_event_t *);
<a href="#h0-2" id="h0-2" class="h">@@ -671,10 +674,6 @@ set_focused_no_raise(struct client *client)
</a> 	if (!client-&gt;maxed)
 		set_borders(client, conf.focus_color);
 
<a href="#h0-2-3" id="h0-2-3" class="d">-	/* revert state to normal */
</a><a href="#h0-2-4" id="h0-2-4" class="d">-	xcb_change_property(conn, XCB_PROP_MODE_REPLACE, client-&gt;window,
</a><a href="#h0-2-5" id="h0-2-5" class="d">-			ewmh-&gt;_NET_WM_STATE, ewmh-&gt;_NET_WM_STATE, 32, 2, data);
</a><a href="#h0-2-6" id="h0-2-6" class="d">-
</a> 	/* focus the window */
 	xcb_set_input_focus(conn, XCB_INPUT_FOCUS_POINTER_ROOT,
 			client-&gt;window, XCB_CURRENT_TIME);
<a href="#h0-3" id="h0-3" class="h">@@ -687,8 +686,9 @@ set_focused_no_raise(struct client *client)
</a> 	if (client != focused_win) {
 		if (focused_win != NULL &amp;&amp; !focused_win-&gt;maxed)
 			set_borders(focused_win, conf.unfocus_color);
<a href="#h0-3-3" id="h0-3-3" class="d">-		focused_win = client;
</a> 	}
<a href="#h0-3-5" id="h0-3-5" class="i">+
</a><a href="#h0-3-6" id="h0-3-6" class="i">+	focused_win = client;
</a> }
 
 /*
<a href="#h0-4" id="h0-4" class="h">@@ -917,11 +917,6 @@ static void
</a> maximize_window(struct client *client, int16_t mon_x, int16_t mon_y, uint16_t mon_width, uint16_t mon_height)
 {
 	uint32_t values[1];
<a href="#h0-4-3" id="h0-4-3" class="d">-	xcb_atom_t state[] = {
</a><a href="#h0-4-4" id="h0-4-4" class="d">-		ewmh-&gt;_NET_WM_STATE_FULLSCREEN,
</a><a href="#h0-4-5" id="h0-4-5" class="d">-		XCB_NONE
</a><a href="#h0-4-6" id="h0-4-6" class="d">-	};
</a><a href="#h0-4-7" id="h0-4-7" class="d">-
</a> 	if (client == NULL)
 		return;
 
<a href="#h0-5" id="h0-5" class="h">@@ -943,8 +938,9 @@ maximize_window(struct client *client, int16_t mon_x, int16_t mon_y, uint16_t mo
</a> 	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
 	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
 	client-&gt;maxed = true;
<a href="#h0-5-3" id="h0-5-3" class="d">-	xcb_ewmh_set_wm_state(ewmh, client-&gt;window, 2, state);
</a> 	set_focused_no_raise(client);
<a href="#h0-5-5" id="h0-5-5" class="i">+
</a><a href="#h0-5-6" id="h0-5-6" class="i">+	update_ewmh_wm_state(client);
</a> }
 
 static void
<a href="#h0-6" id="h0-6" class="h">@@ -953,11 +949,6 @@ hmaximize_window(struct client *client, int16_t mon_x, uint16_t mon_width)
</a> 	if (client == NULL)
 		return;
 
<a href="#h0-6-3" id="h0-6-3" class="d">-	xcb_atom_t state[] = {
</a><a href="#h0-6-4" id="h0-6-4" class="d">-		ewmh-&gt;_NET_WM_STATE_MAXIMIZED_HORZ,
</a><a href="#h0-6-5" id="h0-6-5" class="d">-		XCB_NONE
</a><a href="#h0-6-6" id="h0-6-6" class="d">-	};
</a><a href="#h0-6-7" id="h0-6-7" class="d">-
</a> 	if (client-&gt;maxed || client-&gt;vmaxed || client-&gt;monocled)
 		unmaximize_window(client);
 
<a href="#h0-7" id="h0-7" class="h">@@ -970,7 +961,7 @@ hmaximize_window(struct client *client, int16_t mon_x, uint16_t mon_width)
</a> 	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
 	client-&gt;hmaxed = true;
 
<a href="#h0-7-3" id="h0-7-3" class="d">-	xcb_ewmh_set_wm_state(ewmh, client-&gt;window, 2, state);
</a><a href="#h0-7-4" id="h0-7-4" class="i">+	update_ewmh_wm_state(client);
</a> }
 
 static void
<a href="#h0-8" id="h0-8" class="h">@@ -979,11 +970,6 @@ vmaximize_window(struct client *client, int16_t mon_y, uint16_t mon_height)
</a> 	if (client == NULL)
 		return;
 
<a href="#h0-8-3" id="h0-8-3" class="d">-	xcb_atom_t state[] = {
</a><a href="#h0-8-4" id="h0-8-4" class="d">-		ewmh-&gt;_NET_WM_STATE_MAXIMIZED_VERT,
</a><a href="#h0-8-5" id="h0-8-5" class="d">-		XCB_NONE
</a><a href="#h0-8-6" id="h0-8-6" class="d">-	};
</a><a href="#h0-8-7" id="h0-8-7" class="d">-
</a> 	if (client-&gt;maxed || client-&gt;hmaxed || client-&gt;monocled)
 		unmaximize_window(client);
 
<a href="#h0-9" id="h0-9" class="h">@@ -996,7 +982,8 @@ vmaximize_window(struct client *client, int16_t mon_y, uint16_t mon_height)
</a> 	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
 	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
 	client-&gt;vmaxed = true;
<a href="#h0-9-3" id="h0-9-3" class="d">-	xcb_ewmh_set_wm_state(ewmh, client-&gt;window, 2, state);
</a><a href="#h0-9-4" id="h0-9-4" class="i">+
</a><a href="#h0-9-5" id="h0-9-5" class="i">+	update_ewmh_wm_state(client);
</a> }
 
 static void
<a href="#h0-10" id="h0-10" class="h">@@ -1020,6 +1007,8 @@ monocle_window(struct client *client, int16_t mon_x, int16_t mon_y, uint16_t mon
</a> 	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
 	client-&gt;monocled = true;
 	set_focused_no_raise(client);
<a href="#h0-10-3" id="h0-10-3" class="i">+
</a><a href="#h0-10-4" id="h0-10-4" class="i">+	update_ewmh_wm_state(client);
</a> }
 
 static void
<a href="#h0-11" id="h0-11" class="h">@@ -1038,8 +1027,22 @@ unmaximize_window(struct client *client)
</a> 
 	teleport_window(client-&gt;window, client-&gt;geom.x, client-&gt;geom.y);
 	resize_window_absolute(client-&gt;window, client-&gt;geom.width, client-&gt;geom.height);
<a href="#h0-11-3" id="h0-11-3" class="d">-	xcb_ewmh_set_wm_state(ewmh, client-&gt;window, 2, state);
</a> 	set_borders(client, conf.unfocus_color);
<a href="#h0-11-5" id="h0-11-5" class="i">+
</a><a href="#h0-11-6" id="h0-11-6" class="i">+	xcb_change_property(conn, XCB_PROP_MODE_REPLACE, client-&gt;window,
</a><a href="#h0-11-7" id="h0-11-7" class="i">+			ewmh-&gt;_NET_WM_STATE, ewmh-&gt;_NET_WM_STATE, 32, 2, state);
</a><a href="#h0-11-8" id="h0-11-8" class="i">+}
</a><a href="#h0-11-9" id="h0-11-9" class="i">+
</a><a href="#h0-11-10" id="h0-11-10" class="i">+static bool
</a><a href="#h0-11-11" id="h0-11-11" class="i">+is_maxed(struct client *client)
</a><a href="#h0-11-12" id="h0-11-12" class="i">+{
</a><a href="#h0-11-13" id="h0-11-13" class="i">+	if (client == NULL)
</a><a href="#h0-11-14" id="h0-11-14" class="i">+		return false;
</a><a href="#h0-11-15" id="h0-11-15" class="i">+
</a><a href="#h0-11-16" id="h0-11-16" class="i">+	return client-&gt;maxed
</a><a href="#h0-11-17" id="h0-11-17" class="i">+		|| client-&gt;vmaxed
</a><a href="#h0-11-18" id="h0-11-18" class="i">+		|| client-&gt;hmaxed
</a><a href="#h0-11-19" id="h0-11-19" class="i">+		|| client-&gt;monocled;
</a> }
 
 static void
<a href="#h0-12" id="h0-12" class="h">@@ -1544,6 +1547,80 @@ mouse_toggle(enum mouse_mode mode)
</a> 		mouse_start(mode);
 }
 
<a href="#h0-12-3" id="h0-12-3" class="i">+static void
</a><a href="#h0-12-4" id="h0-12-4" class="i">+update_ewmh_wm_state(struct client *client)
</a><a href="#h0-12-5" id="h0-12-5" class="i">+{
</a><a href="#h0-12-6" id="h0-12-6" class="i">+	int i;
</a><a href="#h0-12-7" id="h0-12-7" class="i">+	uint32_t values[12];
</a><a href="#h0-12-8" id="h0-12-8" class="i">+
</a><a href="#h0-12-9" id="h0-12-9" class="i">+	if (client == NULL)
</a><a href="#h0-12-10" id="h0-12-10" class="i">+		return;
</a><a href="#h0-12-11" id="h0-12-11" class="i">+#define HANDLE_WM_STATE(s) \
</a><a href="#h0-12-12" id="h0-12-12" class="i">+	values[i] = ewmh-&gt;_NET_WM_STATE_##s; \
</a><a href="#h0-12-13" id="h0-12-13" class="i">+	i++; \
</a><a href="#h0-12-14" id="h0-12-14" class="i">+	DMSG(&quot;ewmh net_wm_state %s present\n&quot;, #s);
</a><a href="#h0-12-15" id="h0-12-15" class="i">+
</a><a href="#h0-12-16" id="h0-12-16" class="i">+	i = 0;
</a><a href="#h0-12-17" id="h0-12-17" class="i">+	if (client-&gt;maxed) {
</a><a href="#h0-12-18" id="h0-12-18" class="i">+		HANDLE_WM_STATE(FULLSCREEN);
</a><a href="#h0-12-19" id="h0-12-19" class="i">+	}
</a><a href="#h0-12-20" id="h0-12-20" class="i">+	if (client-&gt;vmaxed) {
</a><a href="#h0-12-21" id="h0-12-21" class="i">+		HANDLE_WM_STATE(MAXIMIZED_VERT);
</a><a href="#h0-12-22" id="h0-12-22" class="i">+	}
</a><a href="#h0-12-23" id="h0-12-23" class="i">+	if (client-&gt;hmaxed) {
</a><a href="#h0-12-24" id="h0-12-24" class="i">+		HANDLE_WM_STATE(MAXIMIZED_HORZ);
</a><a href="#h0-12-25" id="h0-12-25" class="i">+	}
</a><a href="#h0-12-26" id="h0-12-26" class="i">+
</a><a href="#h0-12-27" id="h0-12-27" class="i">+	xcb_ewmh_set_wm_state(ewmh, client-&gt;window, i, values);
</a><a href="#h0-12-28" id="h0-12-28" class="i">+}
</a><a href="#h0-12-29" id="h0-12-29" class="i">+
</a><a href="#h0-12-30" id="h0-12-30" class="i">+static void
</a><a href="#h0-12-31" id="h0-12-31" class="i">+handle_wm_state(struct client *client, xcb_atom_t state, unsigned int action)
</a><a href="#h0-12-32" id="h0-12-32" class="i">+{
</a><a href="#h0-12-33" id="h0-12-33" class="i">+	int16_t mon_x, mon_y;
</a><a href="#h0-12-34" id="h0-12-34" class="i">+	uint16_t mon_w, mon_h;
</a><a href="#h0-12-35" id="h0-12-35" class="i">+	get_monitor_size(client, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
</a><a href="#h0-12-36" id="h0-12-36" class="i">+	if (state == ewmh-&gt;_NET_WM_STATE_FULLSCREEN) {
</a><a href="#h0-12-37" id="h0-12-37" class="i">+		if (action == XCB_EWMH_WM_STATE_ADD) {
</a><a href="#h0-12-38" id="h0-12-38" class="i">+			maximize_window(client, mon_x, mon_y, mon_w, mon_h);
</a><a href="#h0-12-39" id="h0-12-39" class="i">+		} else if (action == XCB_EWMH_WM_STATE_REMOVE &amp;&amp; client-&gt;maxed) {
</a><a href="#h0-12-40" id="h0-12-40" class="i">+			unmaximize_window(client);
</a><a href="#h0-12-41" id="h0-12-41" class="i">+			set_focused(client);
</a><a href="#h0-12-42" id="h0-12-42" class="i">+		} else if (action == XCB_EWMH_WM_STATE_TOGGLE) {
</a><a href="#h0-12-43" id="h0-12-43" class="i">+			if (client-&gt;maxed) {
</a><a href="#h0-12-44" id="h0-12-44" class="i">+				unmaximize_window(client);
</a><a href="#h0-12-45" id="h0-12-45" class="i">+				set_focused(client);
</a><a href="#h0-12-46" id="h0-12-46" class="i">+			} else {
</a><a href="#h0-12-47" id="h0-12-47" class="i">+				maximize_window(client, mon_x, mon_y, mon_w, mon_h);
</a><a href="#h0-12-48" id="h0-12-48" class="i">+			}
</a><a href="#h0-12-49" id="h0-12-49" class="i">+		}
</a><a href="#h0-12-50" id="h0-12-50" class="i">+	} else if (state == ewmh-&gt;_NET_WM_STATE_MAXIMIZED_VERT) {
</a><a href="#h0-12-51" id="h0-12-51" class="i">+		if (action == XCB_EWMH_WM_STATE_ADD) {
</a><a href="#h0-12-52" id="h0-12-52" class="i">+			vmaximize_window(client, mon_y, mon_h);
</a><a href="#h0-12-53" id="h0-12-53" class="i">+		} else if (action == XCB_EWMH_WM_STATE_REMOVE) {
</a><a href="#h0-12-54" id="h0-12-54" class="i">+			if (client-&gt;vmaxed)
</a><a href="#h0-12-55" id="h0-12-55" class="i">+				unmaximize_window(client);
</a><a href="#h0-12-56" id="h0-12-56" class="i">+		} else if (action == XCB_EWMH_WM_STATE_TOGGLE) {
</a><a href="#h0-12-57" id="h0-12-57" class="i">+			if (client-&gt;vmaxed)
</a><a href="#h0-12-58" id="h0-12-58" class="i">+				unmaximize_window(client);
</a><a href="#h0-12-59" id="h0-12-59" class="i">+			else
</a><a href="#h0-12-60" id="h0-12-60" class="i">+				vmaximize_window(client, mon_y, mon_h);
</a><a href="#h0-12-61" id="h0-12-61" class="i">+		}
</a><a href="#h0-12-62" id="h0-12-62" class="i">+	} else if (state == ewmh-&gt;_NET_WM_STATE_MAXIMIZED_HORZ) {
</a><a href="#h0-12-63" id="h0-12-63" class="i">+		if (action == XCB_EWMH_WM_STATE_ADD) {
</a><a href="#h0-12-64" id="h0-12-64" class="i">+			hmaximize_window(client, mon_y, mon_h);
</a><a href="#h0-12-65" id="h0-12-65" class="i">+		} else if (action == XCB_EWMH_WM_STATE_REMOVE) {
</a><a href="#h0-12-66" id="h0-12-66" class="i">+			if (client-&gt;hmaxed)
</a><a href="#h0-12-67" id="h0-12-67" class="i">+				unmaximize_window(client);
</a><a href="#h0-12-68" id="h0-12-68" class="i">+		} else if (action == XCB_EWMH_WM_STATE_TOGGLE) {
</a><a href="#h0-12-69" id="h0-12-69" class="i">+			if (client-&gt;hmaxed)
</a><a href="#h0-12-70" id="h0-12-70" class="i">+				unmaximize_window(client);
</a><a href="#h0-12-71" id="h0-12-71" class="i">+			else
</a><a href="#h0-12-72" id="h0-12-72" class="i">+				hmaximize_window(client, mon_x, mon_w);
</a><a href="#h0-12-73" id="h0-12-73" class="i">+		}
</a><a href="#h0-12-74" id="h0-12-74" class="i">+	}
</a><a href="#h0-12-75" id="h0-12-75" class="i">+}
</a><a href="#h0-12-76" id="h0-12-76" class="i">+
</a> /*
  * Adds X event handlers to the array.
  */
<a href="#h0-13" id="h0-13" class="h">@@ -1741,6 +1818,7 @@ event_map_request(xcb_generic_event_t *ev)
</a> 
 	fit_on_screen(client);
 
<a href="#h0-13-3" id="h0-13-3" class="i">+	/* window is normal */
</a> 	xcb_change_property(conn, XCB_PROP_MODE_REPLACE, client-&gt;window,
 			ewmh-&gt;_NET_WM_STATE, ewmh-&gt;_NET_WM_STATE, 32, 2, data);
 
<a href="#h0-14" id="h0-14" class="h">@@ -1855,63 +1933,13 @@ event_client_message(xcb_generic_event_t *ev)
</a> 		if (ipc_handlers[ipc_command] != NULL)
 			(ipc_handlers[ipc_command])(data + 1);
 		DMSG(&quot;%u %u %u %u %u\n&quot;, data[0], data[1], data[2], data[3], data[4]);
<a href="#h0-14-3" id="h0-14-3" class="d">-	} else if (e-&gt;type == ewmh-&gt;_NET_WM_STATE &amp;&amp; e-&gt;format == 32) {
</a><a href="#h0-14-4" id="h0-14-4" class="d">-		/* A window changed its state */
</a><a href="#h0-14-5" id="h0-14-5" class="i">+	} else {
</a> 		client = find_client(&amp;e-&gt;window);
 		if (client == NULL)
 			return;
<a href="#h0-14-9" id="h0-14-9" class="d">-		action = e-&gt;data.data32[0];
</a><a href="#h0-14-10" id="h0-14-10" class="d">-		maxed = client-&gt;maxed;
</a><a href="#h0-14-11" id="h0-14-11" class="d">-		vmaxed = client-&gt;vmaxed;
</a><a href="#h0-14-12" id="h0-14-12" class="d">-		hmaxed = client-&gt;hmaxed;
</a><a href="#h0-14-13" id="h0-14-13" class="d">-		get_monitor_size(client, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
</a><a href="#h0-14-14" id="h0-14-14" class="d">-
</a><a href="#h0-14-15" id="h0-14-15" class="d">-		/* We handle only two states at the same time */
</a><a href="#h0-14-16" id="h0-14-16" class="d">-		for (int i = 0; i &lt; 2; i++) {
</a><a href="#h0-14-17" id="h0-14-17" class="d">-			xcb_atom_t state = e-&gt;data.data32[i + 1];
</a><a href="#h0-14-18" id="h0-14-18" class="d">-			bool *var = NULL, *orig = NULL;
</a><a href="#h0-14-19" id="h0-14-19" class="d">-			if (state == ewmh-&gt;_NET_WM_STATE_FULLSCREEN) {
</a><a href="#h0-14-20" id="h0-14-20" class="d">-				var = &amp;maxed;
</a><a href="#h0-14-21" id="h0-14-21" class="d">-				orig = &amp;client-&gt;maxed;
</a><a href="#h0-14-22" id="h0-14-22" class="d">-			} else if (state == ewmh-&gt;_NET_WM_STATE_MAXIMIZED_VERT) {
</a><a href="#h0-14-23" id="h0-14-23" class="d">-				var = &amp;vmaxed;
</a><a href="#h0-14-24" id="h0-14-24" class="d">-				orig = &amp;client-&gt;vmaxed;
</a><a href="#h0-14-25" id="h0-14-25" class="d">-			} else if (state == ewmh-&gt;_NET_WM_STATE_MAXIMIZED_HORZ) {
</a><a href="#h0-14-26" id="h0-14-26" class="d">-				var = &amp;hmaxed;
</a><a href="#h0-14-27" id="h0-14-27" class="d">-				orig = &amp;client-&gt;hmaxed;
</a><a href="#h0-14-28" id="h0-14-28" class="d">-			}
</a><a href="#h0-14-29" id="h0-14-29" class="d">-			if (var != NULL) {
</a><a href="#h0-14-30" id="h0-14-30" class="d">-				if (action == XCB_EWMH_WM_STATE_REMOVE)
</a><a href="#h0-14-31" id="h0-14-31" class="d">-					*var = false;
</a><a href="#h0-14-32" id="h0-14-32" class="d">-				else if (action == XCB_EWMH_WM_STATE_ADD)
</a><a href="#h0-14-33" id="h0-14-33" class="d">-					*var = true;
</a><a href="#h0-14-34" id="h0-14-34" class="d">-				else if (action == XCB_EWMH_WM_STATE_TOGGLE)
</a><a href="#h0-14-35" id="h0-14-35" class="d">-					*var = !(*var);
</a><a href="#h0-14-36" id="h0-14-36" class="d">-
</a><a href="#h0-14-37" id="h0-14-37" class="d">-				/* if the state changed, update */
</a><a href="#h0-14-38" id="h0-14-38" class="d">-				if (*var != *orig) {
</a><a href="#h0-14-39" id="h0-14-39" class="d">-					/* state added */
</a><a href="#h0-14-40" id="h0-14-40" class="d">-					if (*var) {
</a><a href="#h0-14-41" id="h0-14-41" class="d">-						/* reset */
</a><a href="#h0-14-42" id="h0-14-42" class="d">-						unmaximize_window(client);
</a><a href="#h0-14-43" id="h0-14-43" class="d">-						if (var == &amp;maxed)
</a><a href="#h0-14-44" id="h0-14-44" class="d">-							maximize_window(client, mon_x, mon_y, mon_w, mon_h);
</a><a href="#h0-14-45" id="h0-14-45" class="d">-						else if (var == &amp;vmaxed)
</a><a href="#h0-14-46" id="h0-14-46" class="d">-							vmaximize_window(client, mon_y, mon_h);
</a><a href="#h0-14-47" id="h0-14-47" class="d">-						else if (var == &amp;hmaxed)
</a><a href="#h0-14-48" id="h0-14-48" class="d">-							hmaximize_window(client, mon_x, mon_w);
</a><a href="#h0-14-49" id="h0-14-49" class="d">-						xcb_atom_t data[] = {
</a><a href="#h0-14-50" id="h0-14-50" class="d">-							state,
</a><a href="#h0-14-51" id="h0-14-51" class="d">-							XCB_NONE
</a><a href="#h0-14-52" id="h0-14-52" class="d">-						};
</a><a href="#h0-14-53" id="h0-14-53" class="d">-						DMSG(&quot;wm state set to %d\n&quot;, data[0]);
</a><a href="#h0-14-54" id="h0-14-54" class="d">-						xcb_ewmh_set_wm_state(ewmh, client-&gt;window, 2, data);
</a><a href="#h0-14-55" id="h0-14-55" class="d">-					} else {
</a><a href="#h0-14-56" id="h0-14-56" class="d">-						unmaximize_window(client);
</a><a href="#h0-14-57" id="h0-14-57" class="d">-						set_focused(client);
</a><a href="#h0-14-58" id="h0-14-58" class="d">-					}
</a><a href="#h0-14-59" id="h0-14-59" class="d">-				}
</a><a href="#h0-14-60" id="h0-14-60" class="d">-			}
</a><a href="#h0-14-61" id="h0-14-61" class="i">+		if (e-&gt;type == ewmh-&gt;_NET_WM_STATE) {
</a><a href="#h0-14-62" id="h0-14-62" class="i">+			handle_wm_state(client, e-&gt;data.data32[1], e-&gt;data.data32[0]);
</a><a href="#h0-14-63" id="h0-14-63" class="i">+			handle_wm_state(client, e-&gt;data.data32[2], e-&gt;data.data32[0]);
</a> 		}
 	}
 }
<a href="#h0-15" id="h0-15" class="h">@@ -2028,6 +2056,11 @@ ipc_window_move(uint32_t *d)
</a> 	if (focused_win == NULL)
 		return;
 
<a href="#h0-15-3" id="h0-15-3" class="i">+	if (is_maxed(focused_win)) {
</a><a href="#h0-15-4" id="h0-15-4" class="i">+		unmaximize_window(focused_win);
</a><a href="#h0-15-5" id="h0-15-5" class="i">+		set_focused(focused_win);
</a><a href="#h0-15-6" id="h0-15-6" class="i">+	}
</a><a href="#h0-15-7" id="h0-15-7" class="i">+
</a> 	x = d[2];
 	y = d[3];
 if (d[0])
<a href="#h0-16" id="h0-16" class="h">@@ -2050,6 +2083,11 @@ ipc_window_move_absolute(uint32_t *d)
</a> 	if (focused_win == NULL)
 		return;
 
<a href="#h0-16-3" id="h0-16-3" class="i">+	if (is_maxed(focused_win)) {
</a><a href="#h0-16-4" id="h0-16-4" class="i">+		unmaximize_window(focused_win);
</a><a href="#h0-16-5" id="h0-16-5" class="i">+		set_focused(focused_win);
</a><a href="#h0-16-6" id="h0-16-6" class="i">+	}
</a><a href="#h0-16-7" id="h0-16-7" class="i">+
</a> 	x = d[2];
 	y = d[3];
 
<a href="#h0-17" id="h0-17" class="h">@@ -2074,6 +2112,11 @@ ipc_window_resize(uint32_t *d)
</a> 	if (focused_win == NULL)
 		return;
 
<a href="#h0-17-3" id="h0-17-3" class="i">+	if (is_maxed(focused_win)) {
</a><a href="#h0-17-4" id="h0-17-4" class="i">+		unmaximize_window(focused_win);
</a><a href="#h0-17-5" id="h0-17-5" class="i">+		set_focused(focused_win);
</a><a href="#h0-17-6" id="h0-17-6" class="i">+	}
</a><a href="#h0-17-7" id="h0-17-7" class="i">+
</a> 	w = d[2];
 	h = d[3];
 
<a href="#h0-18" id="h0-18" class="h">@@ -2116,6 +2159,11 @@ ipc_window_resize_absolute(uint32_t *d)
</a> 	if (focused_win == NULL)
 		return;
 
<a href="#h0-18-3" id="h0-18-3" class="i">+	if (is_maxed(focused_win)) {
</a><a href="#h0-18-4" id="h0-18-4" class="i">+		unmaximize_window(focused_win);
</a><a href="#h0-18-5" id="h0-18-5" class="i">+		set_focused(focused_win);
</a><a href="#h0-18-6" id="h0-18-6" class="i">+	}
</a><a href="#h0-18-7" id="h0-18-7" class="i">+
</a> 	w = d[0];
 	h = d[1];
 
<a href="#h0-19" id="h0-19" class="h">@@ -2144,12 +2192,13 @@ ipc_window_maximize(uint32_t *d)
</a> 
 	if (focused_win-&gt;maxed) {
 		unmaximize_window(focused_win);
<a href="#h0-19-3" id="h0-19-3" class="d">-		set_focused(focused_win);
</a> 	} else {
 		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
 		maximize_window(focused_win, mon_x, mon_y, mon_w, mon_h);
 	}
 
<a href="#h0-19-9" id="h0-19-9" class="i">+	set_focused(focused_win);
</a><a href="#h0-19-10" id="h0-19-10" class="i">+
</a> 	xcb_flush(conn);
 }
 
<a href="#h0-20" id="h0-20" class="h">@@ -2165,12 +2214,13 @@ ipc_window_hor_maximize(uint32_t *d)
</a> 
 	if (focused_win-&gt;hmaxed) {
 		unmaximize_window(focused_win);
<a href="#h0-20-3" id="h0-20-3" class="d">-		set_focused(focused_win);
</a> 	} else {
 		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, NULL);
 		hmaximize_window(focused_win, mon_x, mon_w);
 	}
 
<a href="#h0-20-9" id="h0-20-9" class="i">+	set_focused(focused_win);
</a><a href="#h0-20-10" id="h0-20-10" class="i">+
</a> 	xcb_flush(conn);
 }
 
<a href="#h0-21" id="h0-21" class="h">@@ -2186,12 +2236,13 @@ ipc_window_ver_maximize(uint32_t *d)
</a> 
 	if (focused_win-&gt;vmaxed) {
 		unmaximize_window(focused_win);
<a href="#h0-21-3" id="h0-21-3" class="d">-		set_focused(focused_win);
</a> 	} else {
 		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, NULL, &amp;mon_h);
 		vmaximize_window(focused_win, mon_y, mon_h);
 	}
 
<a href="#h0-21-9" id="h0-21-9" class="i">+	set_focused(focused_win);
</a><a href="#h0-21-10" id="h0-21-10" class="i">+
</a> 	xcb_flush(conn);
 }
 
<a href="#h0-22" id="h0-22" class="h">@@ -2207,12 +2258,13 @@ ipc_window_monocle(uint32_t *d)
</a> 
 	if (focused_win-&gt;monocled) {
 		unmaximize_window(focused_win);
<a href="#h0-22-3" id="h0-22-3" class="d">-		set_focused(focused_win);
</a> 	} else {
 		get_monitor_size(focused_win, &amp;mon_x, &amp;mon_y, &amp;mon_w, &amp;mon_h);
 		monocle_window(focused_win, mon_x, mon_y, mon_w, mon_h);
 	}
 
<a href="#h0-22-9" id="h0-22-9" class="i">+	set_focused(focused_win);
</a><a href="#h0-22-10" id="h0-22-10" class="i">+
</a> 	xcb_flush(conn);
 }
 
<a href="#h0-23" id="h0-23" class="h">@@ -2241,8 +2293,7 @@ ipc_window_put_in_grid(uint32_t *d)
</a> 	if (focused_win == NULL || grid_x &gt;= grid_width || grid_y &gt;= grid_height)
 		return;
 
<a href="#h0-23-3" id="h0-23-3" class="d">-	if (focused_win-&gt;maxed || focused_win-&gt;vmaxed
</a><a href="#h0-23-4" id="h0-23-4" class="d">-			|| focused_win-&gt;hmaxed || focused_win-&gt;monocled) {
</a><a href="#h0-23-5" id="h0-23-5" class="i">+	if (is_maxed(focused_win)) {
</a> 		unmaximize_window(focused_win);
 		set_focused(focused_win);
 	}
<a href="#h0-24" id="h0-24" class="h">@@ -2279,6 +2330,11 @@ ipc_window_snap(uint32_t *d)
</a> 	if (focused_win == NULL)
 		return;
 
<a href="#h0-24-3" id="h0-24-3" class="i">+	if (is_maxed(focused_win)) {
</a><a href="#h0-24-4" id="h0-24-4" class="i">+		unmaximize_window(focused_win);
</a><a href="#h0-24-5" id="h0-24-5" class="i">+		set_focused(focused_win);
</a><a href="#h0-24-6" id="h0-24-6" class="i">+	}
</a><a href="#h0-24-7" id="h0-24-7" class="i">+
</a> 	fit_on_screen(focused_win);
 
 	win_x = focused_win-&gt;geom.x;
</pre>
</div>
</body>
</html>
